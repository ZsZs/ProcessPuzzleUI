<!DOCTYPE HTML>
<html>
<head>
   <title>Test page for RssResource.js</title>
   <meta http-equiv="content-type" content="text/html; charset=UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=8"/>
	
   <link rel="stylesheet" type="text/css" href="../../JsUnit/css/jsUnitStyle.css">
   
   <script type="text/javascript">
      var contextRootPrefix = "../../../";
   </script>
   
   <!--[if IE]>
      <script type="text/javascript" src="../../Libraries/MochaUI/excanvas.js"></script>
   <![endif]-->  
   
   <script type="text/javascript" src="../../Libraries/JsHamcrest/jshamcrest.js"></script>
   <script type="text/javascript" src="../../Libraries/JsMockito/JsMockito.js"></script>
   <script type="text/javascript" src="../../Libraries/Log4JavaScript/log4javascript.js"></script>
   <script type="text/javascript" src="../../Libraries/MooTools/mootools-core-1.4.0-full-compat.js"></script>
   <script type="text/javascript" src="../../Libraries/MooTools/mootools-more-1.4.0.1.js"></script>
   <script type="text/javascript" src="../../JsUnit/app/jsUnitCore.js"></script>
   <script type="text/javascript" src="../../JsUnit/app/JsTestCase.js"></script>
   <script type="text/javascript" src="../../JsUnit/app/JsTestFunction.js"></script>

   <script type="text/javascript" src="../../Libraries/Sarissa/sarissa.js"></script>  
   <script type="text/javascript" src="../../Libraries/Sarissa/sarissa_ieemu_xpath.js"></script>

   <script type="text/javascript" src="../../Source/FundamentalTypes/ArrayList.js"></script>
   <script type="text/javascript" src="../../Source/FundamentalTypes/WebUIException.js"></script>
   <script type="text/javascript" src="../../Source/FundamentalTypes/UndefinedXmlResourceException.js"></script>
   <script type="text/javascript" src="../../Source/FundamentalTypes/XmlResource.js"></script>
   <script type="text/javascript" src="../../Source/NewsReader/RssChannel.js"></script>
   <script type="text/javascript" src="../../Source/NewsReader/RssItem.js"></script>
   <script type="text/javascript" src="../../Source/NewsReader/RssResource.js"></script>

   <script type="text/javascript" >
      window.addEvent('domready', function() {
	     runTestFunction();
  	  });
  	  
      JsHamcrest.Integration.JsUnit();

      var CHANNEL_TITLE = "ProcessPuzzle";
      var CHANNEL_LINK = "http://processpuzzle.com";
      var CHANNEL_DESCRIPTION = "ProcessPuzzle company news.";
      var CHANNEL_LANGUAGE = "en-us";
      var CHANNEL_PUBDATE = "Tue, 10 Jun 2003 04:00:00 GMT";
      var CHANNEL_LAST_BUILD_DATE = "Tue, 10 Jun 2003 09:41:01 GMT";
      var CHANNEL_DOCS = "http://processpuzzle.com/rss";
      var CHANNEL_GENERATOR = "Weblog Editor 2.0";
      var CHANNEL_MANAGING_EDITOR = "zsolt.zsuffa@example.com";
      var CHANNEL_WEB_MASTER = "peter.krima@example.com";
      var ITEM_ONE_TITLE = "HONNIA furniture design service lunched";
      var ITEM_ONE_LINK = "http://honnia.hu/news";
      var ITEM_ONE_DESCRIPTION = "Cerasus Llc. lunched a new woldwide available furniture design service based on ProcessPuzzle.";
      var ITEM_ONE_PUBDATE = "Tue, 03 Jun 2003 09:39:21 GMT";
      var ITEM_ONE_GUID = "http://processpuzzle.com#item573";
  	  var RSS_URI = "../NewsReader/TestNews.xml";
  	  var rssResource;

      function setUp() {
         rssResource = new RssResource( RSS_URI, { nameSpaces : "xmlns:pp='http://www.processpuzzle.com/ResourceBundle'" } );
      }

      function tearDown() {
         rssResource.release();
         rssResource = null;
      }
      
      function testInitialization_RetrievesXmlResource() {
         //SETUP: see setUp();
         //EXCERCISE:
         //VERIFY:
         assertNotNull( rssResource );
         assertNotNull( rssResource.getDocument() );
         assertTrue( rssResource.isSuccess() );
         assertTrue( !rssResource.isAsync() );
         assertEquals( RSS_URI, rssResource.getUri() );
      }
      
      function testUnmarshall_ProcessesChannelProperties(){
         //SETUP: see setUp();
         //EXCERCISE:
            rssResource.unmarshall();
      
         //VERIFY:
         var channel = rssResource.getChannel();
         assertThat( channel, not( nil() ));
         assertThat( channel.getTitle(), equalTo( CHANNEL_TITLE ));
         assertThat( channel.getLink(), equalTo( CHANNEL_LINK ));
         assertThat( channel.getDescription(), equalTo( CHANNEL_DESCRIPTION ));
         assertThat( channel.getLanguage(), equalTo( CHANNEL_LANGUAGE ));
         assertThat( channel.getPublicationDate(), equalTo( CHANNEL_PUBDATE ));
         assertThat( channel.getBuildDate(), equalTo( CHANNEL_LAST_BUILD_DATE ));
         assertThat( channel.getDocuments(), equalTo( CHANNEL_DOCS ));
         assertThat( channel.getGenerator(), equalTo( CHANNEL_GENERATOR ));
         assertThat( channel.getManagingDirector(), equalTo( CHANNEL_MANAGING_EDITOR ));
         assertThat( channel.getWebMaster(), equalTo( CHANNEL_WEB_MASTER ));
      }
      
      function testUnmarshall_ProcessesItems(){
         //SETUP: see setUp();
         //EXCERCISE:
         rssResource.unmarshall();
      
         //VERIFY:
         assertThat( rssResource.getChannel().getItems().size(), equalTo( 2 ));
         var rssItemOne = rssResource.getChannel().getItems().get( 0 );
         assertThat( rssItemOne.getTitle(), equalTo( ITEM_ONE_TITLE ));
         assertThat( rssItemOne.getLink(), equalTo( ITEM_ONE_LINK ));
         assertThat( rssItemOne.getDescription(), equalTo( ITEM_ONE_DESCRIPTION ));
         assertThat( rssItemOne.getPublicationDate(), equalTo( ITEM_ONE_PUBDATE ));
         assertThat( rssItemOne.getGlobalUniqueId(), equalTo( ITEM_ONE_GUID ));
      }
            
      //runs a test function during debugging
      function runTestFunction(){
         setUp();
         testUnmarshall_ProcessesChannelProperties();
         tearDown();
      }

   </script>
</head>

<body>
    <h1>RssResource.js test page</h1>
</body>
</html>
