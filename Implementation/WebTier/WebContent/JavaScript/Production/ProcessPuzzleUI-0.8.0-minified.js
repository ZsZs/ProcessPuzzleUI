var MUI=MochaUI=new Hash({version:"0.9.7",options:new Hash({theme:"default",advancedEffects:false,standardEffects:true}),path:{source:"scripts/source/",themes:"themes/",plugins:"plugins/"},themePath:function(){return MUI.path.themes+MUI.options.theme+"/"},files:new Hash()});MUI.files[MUI.path.source+"Core/Core.js"]="loaded";MUI.extend({Windows:{instances:new Hash()},ieSupport:"excanvas",updateContent:function(c){var c=$extend({element:null,childElement:null,method:null,data:null,title:null,content:null,loadMethod:null,url:null,scrollbars:null,padding:null,require:{},onContentLoaded:$empty},c);c.require=$extend({css:[],images:[],js:[],onload:null},c.require);var b={};if(!c.element){return}var d=c.element;if(MUI.Windows.instances.get(d.id)){b.recipient="window"}else{b.recipient="panel"}var a=d.retrieve("instance");if(c.title){a.titleEl.set("html",c.title)}var f=a.contentEl;b.contentContainer=c.childElement!=null?c.childElement:a.contentEl;var h=a.contentWrapperEl;if(!c.loadMethod){if(!a.options.loadMethod){if(!c.url){c.loadMethod="html"}else{c.loadMethod="xhr"}}else{c.loadMethod=a.options.loadMethod}}var g=c.scrollbars||a.options.scrollbars;if(b.contentContainer==a.contentEl){h.setStyles({overflow:g!=false&&c.loadMethod!="iframe"?"auto":"hidden"})}if(c.padding!=null){f.setStyles({"padding-top":c.padding.top,"padding-bottom":c.padding.bottom,"padding-left":c.padding.left,"padding-right":c.padding.right})}if(b.contentContainer==f){f.empty().show();f.getAllNext(".column").destroy();f.getAllNext(".columnHandle").destroy()}b.onContentLoaded=function(){if(c.require.js.length||typeof c.require.onload=="function"){new MUI.Require({js:c.require.js,onload:function(){if(Browser.Engine.presto){c.require.onload.delay(100)}else{c.require.onload()}(c.onContentLoaded&&c.onContentLoaded!=$empty)?c.onContentLoaded():a.fireEvent("contentLoaded",d)}.bind(this)})}else{(c.onContentLoaded&&c.onContentLoaded!=$empty)?c.onContentLoaded():a.fireEvent("contentLoaded",d)}};if(c.require.css.length||c.require.images.length){new MUI.Require({css:c.require.css,images:c.require.images,onload:function(){this.loadSelect(a,c,b)}.bind(this)})}else{this.loadSelect(a,c,b)}},loadSelect:function(a,c,b){switch(c.loadMethod){case"xhr":this.updateContentXHR(a,c,b);break;case"iframe":this.updateContentIframe(a,c,b);break;case"json":this.updateContentJSON(a,c,b);break;case"html":default:this.updateContentHTML(a,c,b);break}},updateContentJSON:function(a,c,b){var f=a.contentEl;var d=b.contentContainer;new Request({url:c.url,update:d,method:c.method!=null?c.method:"get",data:c.data!=null?new Hash(c.data).toQueryString():"",evalScripts:false,evalResponse:false,headers:{"Content-Type":"application/json"},onRequest:function(){if(b.recipient=="window"&&d==f){a.showSpinner()}else{if(b.recipient=="panel"&&d==f&&$("spinner")){$("spinner").show()}}}.bind(this),onFailure:function(){if(d==f){d.set("html","<p><strong>Error Loading XMLHttpRequest</strong></p>");if(recipient=="window"){a.hideSpinner()}else{if(recipient=="panel"&&$("spinner")){$("spinner").hide()}}}if(d==f){d.set("html","<p><strong>Error Loading XMLHttpRequest</strong></p>");if(b.recipient=="window"){a.hideSpinner()}else{if(b.recipient=="panel"&&$("spinner")){$("spinner").hide()}}}}.bind(this),onException:function(){}.bind(this),onSuccess:function(g){if(d==f){if(d==f){if(b.recipient=="window"){a.hideSpinner()}else{if(b.recipient=="panel"&&$("spinner")){$("spinner").hide()}}}var g=JSON.decode(g);a.fireEvent("loaded",$A([c.element,g,a]))}}.bind(this),onComplete:function(){}.bind(this)}).get()},updateContentXHR:function(a,c,b){var g=a.contentEl;var f=b.contentContainer;var d=b.onContentLoaded;new Request.HTML({url:c.url,update:f,method:c.method!=null?c.method:"get",data:c.data!=null?new Hash(c.data).toQueryString():"",evalScripts:a.options.evalScripts,evalResponse:a.options.evalResponse,onRequest:function(){if(b.recipient=="window"&&f==g){a.showSpinner()}else{if(b.recipient=="panel"&&f==g&&$("spinner")){$("spinner").show()}}}.bind(this),onFailure:function(h){if(f==g){var k=new RegExp("<title>[\n\rs]*(.*)[\n\rs]*</title>","gmi");var j=k.exec(h.responseText);if(!j){j="Unknown"}f.set("html","<h3>Error: "+j[1]+"</h3>");if(b.recipient=="window"){a.hideSpinner()}else{if(b.recipient=="panel"&&$("spinner")){$("spinner").hide()}}}}.bind(this),onSuccess:function(){g.addClass("pad");if(f==g){if(b.recipient=="window"){a.hideSpinner()}else{if(b.recipient=="panel"&&$("spinner")){$("spinner").hide()}}}Browser.Engine.trident4?d.delay(750):d()}.bind(this),onComplete:function(){}.bind(this)}).send()},updateContentIframe:function(a,c,b){var g=a.contentEl;var f=b.contentContainer;var h=a.contentWrapperEl;var d=b.onContentLoaded;if(a.options.contentURL==""||f!=g){return}g.removeClass("pad");g.setStyle("padding","0px");a.iframeEl=new Element("iframe",{id:a.options.id+"_iframe",name:a.options.id+"_iframe","class":"mochaIframe",src:c.url,marginwidth:0,marginheight:0,frameBorder:0,scrolling:"auto",styles:{height:h.offsetHeight-h.getStyle("border-top").toInt()-h.getStyle("border-bottom").toInt(),width:a.panelEl?h.offsetWidth-h.getStyle("border-left").toInt()-h.getStyle("border-right").toInt():"100%"}}).injectInside(g);a.iframeEl.addEvent("load",function(j){if(b.recipient=="window"){a.hideSpinner()}else{if(b.recipient=="panel"&&f==g&&$("spinner")){$("spinner").hide()}}Browser.Engine.trident4?d.delay(50):d()}.bind(this));if(b.recipient=="window"){a.showSpinner()}else{if(b.recipient=="panel"&&f==g&&$("spinner")){$("spinner").show()}}},updateContentHTML:function(a,c,b){var g=a.contentEl;var f=b.contentContainer;var d=b.onContentLoaded;var h=new Array("element","textnode","whitespace","collection");g.addClass("pad");if(h.contains($type(c.content))){c.content.inject(f)}else{f.set("html",c.content)}if(f==g){if(b.recipient=="window"){a.hideSpinner()}else{if(b.recipient=="panel"&&$("spinner")){$("spinner").hide()}}}Browser.Engine.trident4?d.delay(50):d()},reloadIframe:function(a){Browser.Engine.gecko?$(a).src=$(a).src:top.frames[a].location.reload(true)},roundedRect:function(g,d,k,j,c,b,h,f){g.fillStyle="rgba("+h.join(",")+","+f+")";g.beginPath();g.moveTo(d,k+b);g.lineTo(d,k+c-b);g.quadraticCurveTo(d,k+c,d+b,k+c);g.lineTo(d+j-b,k+c);g.quadraticCurveTo(d+j,k+c,d+j,k+c-b);g.lineTo(d+j,k+b);g.quadraticCurveTo(d+j,k,d+j-b,k);g.lineTo(d+b,k);g.quadraticCurveTo(d,k,d,k+b);g.fill()},triangle:function(f,c,j,h,b,g,d){f.beginPath();f.moveTo(c+h,j);f.lineTo(c,j+b);f.lineTo(c+h,j+b);f.closePath();f.fillStyle="rgba("+g.join(",")+","+d+")";f.fill()},circle:function(d,b,h,g,f,c){d.beginPath();d.arc(b,h,g,0,Math.PI*2,true);d.fillStyle="rgba("+f.join(",")+","+c+")";d.fill()},notification:function(a){new MUI.Window({loadMethod:"html",closeAfter:1500,type:"notification",addClass:"notification",content:a,width:220,height:40,y:53,padding:{top:10,right:12,bottom:10,left:12},shadowBlur:5})},toggleAdvancedEffects:function(a){if(MUI.options.advancedEffects==false){MUI.options.advancedEffects=true;if(a){this.toggleAdvancedEffectsLink=new Element("div",{"class":"check",id:"toggleAdvancedEffects_check"}).inject(a)}}else{MUI.options.advancedEffects=false;if(this.toggleAdvancedEffectsLink){this.toggleAdvancedEffectsLink.destroy()}}},toggleStandardEffects:function(a){if(MUI.options.standardEffects==false){MUI.options.standardEffects=true;if(a){this.toggleStandardEffectsLink=new Element("div",{"class":"check",id:"toggleStandardEffects_check"}).inject(a)}}else{MUI.options.standardEffects=false;if(this.toggleStandardEffectsLink){this.toggleStandardEffectsLink.destroy()}}},underlayInitialize:function(){if(!$("windowUnderlay")){var a=new Element("div",{id:"windowUnderlay",styles:{height:window.getCoordinates().height,opacity:0.01,display:"none"}}).inject(document.body)}},setUnderlaySize:function(){$("windowUnderlay").setStyle("height",window.getCoordinates().height)}});function fixPNG(f){if(Browser.Engine.trident4&&document.body.filters){var b=(f.id)?"id='"+f.id+"' ":"";var d=(f.className)?"class='"+f.className+"' ":"";var g=(f.title)?"title='"+f.title+"' ":"title='"+f.alt+"' ";var c="display:inline-block;"+f.style.cssText;var a="<span "+b+d+g+' style="width:'+f.width+"px; height:"+f.height+"px;"+c+";filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+f.src+"', sizingMethod='scale');\"></span>";f.outerHTML=a}}document.addEvent("mousedown",function(a){MUI.blurAll.delay(50)});window.addEvent("domready",function(){MUI.underlayInitialize()});window.addEvent("resize",function(){if($("windowUnderlay")){MUI.setUnderlaySize()}else{MUI.underlayInitialize()}});Element.implement({hide:function(){this.setStyle("display","none");return this},show:function(){this.setStyle("display","block");return this}});Element.implement({shake:function(b,j){b=b||3;j=j||500;j=(j/50).toInt()-1;var f=this.getParent();if(f!=$(document.body)&&f.getStyle("position")=="static"){f.setStyle("position","relative")}var a=this.getStyle("position");if(a=="static"){this.setStyle("position","relative");a="relative"}if(Browser.Engine.trident){f.setStyle("height",f.getStyle("height"))}var h=this.getPosition(f);if(a=="relative"&&!Browser.Engine.presto){h.x-=f.getStyle("paddingLeft").toInt();h.y-=f.getStyle("paddingTop").toInt()}var g=this.retrieve("morph");if(g){g.cancel();var c=g.options}var g=this.get("morph",{duration:50,link:"chain"});for(var d=0;d<j;d++){g.start({top:h.y+$random(-b,b),left:h.x+$random(-b,b)})}g.start({top:h.y,left:h.x}).chain(function(){if(c){this.set("morph",c)}}.bind(this));return this}});String.implement({parseQueryString:function(){var b=this.split(/[&;]/);var a={};if(b.length){b.each(function(d){var c=d.split("=");if(c.length&&c.length==2){a[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}})}return a}});Request.HTML.implement({processHTML:function(c){var b=c.match(/<body[^>]*>([\s\S]*?)<\/body>/i);c=(b)?b[1]:c;var a=new Element("div");return a.set("html",c)}});MUI.getCSSRule=function(b){for(var c=0;c<document.styleSheets.length;c++){var d=document.styleSheets[c];var a=d.cssRules?d.cssRules:d.rules;for(i=0;i<a.length;i++){if(a[i].selectorText==b){return a[i]}}}return false};if(location.protocol=="file:"){Request.implement({isSuccess:function(a){return(a==0||(a>=200)&&(a<300))}});Browser.Request=function(){return $try(function(){return new ActiveXObject("MSXML2.XMLHTTP")},function(){return new XMLHttpRequest()})}}MUI.Require=new Class({Implements:[Options],options:{css:[],images:[],js:[],onload:$empty},initialize:function(a){this.setOptions(a);var a=this.options;this.assetsToLoad=a.css.length+a.images.length+a.js.length;this.assetsLoaded=0;var b=0;if(a.css.length){a.css.each(function(c){this.getAsset(c,function(){if(b==a.css.length-1){if(this.assetsLoaded==this.assetsToLoad-1){this.requireOnload()}else{this.assetsLoaded++;this.requireContinue.delay(50,this)}}else{b++;this.assetsLoaded++}}.bind(this))}.bind(this))}else{if(!a.js.length&&!a.images.length){this.options.onload();return true}else{this.requireContinue.delay(50,this)}}},requireOnload:function(){this.assetsLoaded++;if(this.assetsLoaded==this.assetsToLoad){this.options.onload();return true}},requireContinue:function(){var a=this.options;if(a.images.length){a.images.each(function(b){this.getAsset(b,this.requireOnload.bind(this))}.bind(this))}if(a.js.length){a.js.each(function(b){this.getAsset(b,this.requireOnload.bind(this))}.bind(this))}},getAsset:function(b,c){if(MUI.files[b]=="loaded"){if(typeof c=="function"){c()}return true}else{if(MUI.files[b]=="loading"){var d=0;var a=(function(){d++;if(MUI.files[b]=="loading"&&d<"100"){return}$clear(a);if(typeof c=="function"){c()}}).periodical(50)}else{MUI.files[b]="loading";properties={onload:c!="undefined"?c:$empty};var f=properties.onload;properties.onload=function(){MUI.files[b]="loaded";if(f){f()}}.bind(this);switch(b.match(/\.\w+$/)[0]){case".js":return Asset.javascript(b,properties);case".css":return Asset.css(b,properties);case".jpg":case".png":case".gif":return Asset.image(b,properties)}alert('The required file "'+b+'" could not be loaded')}}}});$extend(Asset,{javascript:function(g,d){d=$extend({onload:$empty,document:document,check:$lambda(true)},d);if($(d.id)){d.onload();return $(d.id)}var b=new Element("script",{src:g,type:"text/javascript"});var f=d.onload.bind(b),a=d.check,h=d.document;delete d.onload;delete d.check;delete d.document;if(!Browser.Engine.webkit419&&!Browser.Engine.presto){b.addEvents({load:f,readystatechange:function(){if(Browser.Engine.trident&&["loaded","complete"].contains(this.readyState)){f()}}}).setProperties(d)}else{var c=(function(){if(!$try(a)){return}$clear(c);Browser.Engine.presto?f.delay(500):f()}).periodical(50)}return b.inject(h.head)},css:function(b,a){a=$extend({id:null,media:"screen",onload:$empty},a);new Request({method:"get",url:b,onComplete:function(c){var d=new Element("link",{id:a.id,rel:"stylesheet",media:a.media,type:"text/css",href:b}).inject(document.head);a.onload()}.bind(this),onFailure:function(c){},onSuccess:function(){}.bind(this)}).send()}});MUI.extend({newWindowsFromHTML:function(a){new MUI.Require({js:[MUI.path.plugins+"mochaui/Window/Windows-from-html.js"],onload:function(){new MUI.newWindowsFromHTML(a)}})},newWindowsFromJSON:function(a){new MUI.Require({js:[MUI.path.plugins+"mochaui/Window/Windows-from-json.js"],onload:function(){new MUI.newWindowsFromJSON(a)}})},arrangeCascade:function(){new MUI.Require({js:[MUI.path.plugins+"mochaui/Window/Arrange-cascade.js"],onload:function(){new MUI.arrangeCascade()}})},arrangeTile:function(){new MUI.Require({js:[MUI.path.plugins+"mochaui/Window/Arrange-tile.js"],onload:function(){new MUI.arrangeTile()}})},saveWorkspace:function(){new MUI.Require({js:[MUI.path.plugins+"mochaui/Layout/Workspaces.js"],onload:function(){new MUI.saveWorkspace()}})},loadWorkspace:function(){new MUI.Require({js:[MUI.path.plugins+"mochaui/Layout/Workspaces.js"],onload:function(){new MUI.loadWorkspace()}})},Themes:{init:function(a){new MUI.Require({js:[MUI.path.plugins+"mochaui/Utilities/Themes.js"],onload:function(){MUI.Themes.init(a)}})}}});MUI.files[MUI.path.source+"Layout/Dock.js"]="loaded";MUI.options.extend({dockWrapper:"dockWrapper",dockVisible:"true",dock:"dock"});MUI.extend({minimizeAll:function(){$$(".mocha").each(function(b){var a=b.retrieve("instance");if(!a.isMinimized&&a.options.minimizable==true){MUI.Dock.minimizeWindow(b)}}.bind(this))}});MUI.Dock={options:{useControls:true,dockPosition:"bottom",dockVisible:true,trueButtonColor:[70,245,70],enabledButtonColor:[115,153,191],disabledButtonColor:[170,170,170]},initialize:function(a){if(!MUI.Desktop){return}MUI.dockVisible=this.options.dockVisible;this.dockWrapper=$(MUI.options.dockWrapper);this.dock=$(MUI.options.dock);this.autoHideEvent=null;this.dockAutoHide=false;if(!this.dockWrapper){return}if(!this.options.useControls){if($("dockPlacement")){$("dockPlacement").setStyle("cursor","default")}if($("dockAutoHide")){$("dockAutoHide").setStyle("cursor","default")}}this.dockWrapper.setStyles({display:"block",position:"absolute",top:null,bottom:MUI.Desktop.desktopFooter?MUI.Desktop.desktopFooter.offsetHeight:0,left:0});if(this.options.useControls){this.initializeDockControls()}if($("dockLinkCheck")){this.sidebarCheck=new Element("div",{"class":"check",id:"dock_check"}).inject($("dockLinkCheck"))}this.dockSortables=new Sortables("#dockSort",{opacity:1,constrain:true,clone:false,revert:false});if(!(MUI.dockVisible)){this.dockWrapper.hide()}MUI.Desktop.setDesktopSize();if(MUI.myChain){MUI.myChain.callChain()}},initializeDockControls:function(){this.setDockColors();if(this.options.useControls){var b=new Element("canvas",{id:"dockCanvas",width:"15",height:"18"}).inject(this.dock);if(Browser.Engine.trident&&MUI.ieSupport=="excanvas"){G_vmlCanvasManager.initElement(b)}}var a=$("dockPlacement");var c=$("dockAutoHide");a.setProperty("title","Position Dock Top");a.addEvent("click",function(){this.moveDock()}.bind(this));c.setProperty("title","Turn Auto Hide On");c.addEvent("click",function(f){if(this.dockWrapper.getProperty("dockPosition")=="top"){return false}var d=$("dockCanvas").getContext("2d");this.dockAutoHide=!this.dockAutoHide;if(this.dockAutoHide){$("dockAutoHide").setProperty("title","Turn Auto Hide Off");MUI.circle(d,5,14,3,this.options.trueButtonColor,1);this.autoHideEvent=function(h){if(!this.dockAutoHide){return}if(!MUI.Desktop.desktopFooter){var g=this.dockWrapper.offsetHeight;if(g<25){g=25}}else{if(MUI.Desktop.desktopFooter){var g=this.dockWrapper.offsetHeight+MUI.Desktop.desktopFooter.offsetHeight;if(g<25){g=25}}}if(!MUI.Desktop.desktopFooter&&h.client.y>(document.getCoordinates().height-g)){if(!MUI.dockVisible){this.dockWrapper.show();MUI.dockVisible=true;MUI.Desktop.setDesktopSize()}}else{if(MUI.Desktop.desktopFooter&&h.client.y>(document.getCoordinates().height-g)){if(!MUI.dockVisible){this.dockWrapper.show();MUI.dockVisible=true;MUI.Desktop.setDesktopSize()}}else{if(MUI.dockVisible){this.dockWrapper.hide();MUI.dockVisible=false;MUI.Desktop.setDesktopSize()}}}}.bind(this);document.addEvent("mousemove",this.autoHideEvent)}else{$("dockAutoHide").setProperty("title","Turn Auto Hide On");MUI.circle(d,5,14,3,this.options.enabledButtonColor,1);document.removeEvent("mousemove",this.autoHideEvent)}}.bind(this));this.renderDockControls();if(this.options.dockPosition=="top"){this.moveDock()}},setDockColors:function(){var c=MUI.getCSSRule(".dockButtonEnabled");if(c&&c.style.backgroundColor){this.options.enabledButtonColor=new Color(c.style.backgroundColor)}var a=MUI.getCSSRule(".dockButtonDisabled");if(a&&a.style.backgroundColor){this.options.disabledButtonColor=new Color(a.style.backgroundColor)}var b=MUI.getCSSRule(".dockButtonTrue");if(b&&b.style.backgroundColor){this.options.trueButtonColor=new Color(b.style.backgroundColor)}},renderDockControls:function(){var a=$("dockCanvas").getContext("2d");a.clearRect(0,0,100,100);MUI.circle(a,5,4,3,this.options.enabledButtonColor,1);if(this.dockWrapper.getProperty("dockPosition")=="top"){MUI.circle(a,5,14,3,this.options.disabledButtonColor,1)}else{if(this.dockAutoHide){MUI.circle(a,5,14,3,this.options.trueButtonColor,1)}else{MUI.circle(a,5,14,3,this.options.enabledButtonColor,1)}}},moveDock:function(){var a=$("dockCanvas").getContext("2d");if(this.dockWrapper.getStyle("position")!="relative"){this.dockWrapper.setStyles({position:"relative",bottom:null});this.dockWrapper.addClass("top");MUI.Desktop.setDesktopSize();this.dockWrapper.setProperty("dockPosition","top");a.clearRect(0,0,100,100);MUI.circle(a,5,4,3,this.options.enabledButtonColor,1);MUI.circle(a,5,14,3,this.options.disabledButtonColor,1);$("dockPlacement").setProperty("title","Position Dock Bottom");$("dockAutoHide").setProperty("title","Auto Hide Disabled in Top Dock Position");this.dockAutoHide=false}else{this.dockWrapper.setStyles({position:"absolute",bottom:MUI.Desktop.desktopFooter?MUI.Desktop.desktopFooter.offsetHeight:0});this.dockWrapper.removeClass("top");MUI.Desktop.setDesktopSize();this.dockWrapper.setProperty("dockPosition","bottom");a.clearRect(0,0,100,100);MUI.circle(a,5,4,3,this.options.enabledButtonColor,1);MUI.circle(a,5,14,3,this.options.enabledButtonColor,1);$("dockPlacement").setProperty("title","Position Dock Top");$("dockAutoHide").setProperty("title","Turn Auto Hide On")}},createDockTab:function(f){var a=f.retrieve("instance");var d=new Element("div",{id:a.options.id+"_dockTab","class":"dockTab",title:b}).inject($("dockClear"),"before");d.addEvent("mousedown",function(g){new Event(g).stop();this.timeDown=$time()});d.addEvent("mouseup",function(g){this.timeUp=$time();if((this.timeUp-this.timeDown)<275){if(MUI.Windows.windowsVisible==false){MUI.toggleWindowVisibility();if(a.isMinimized==true){MUI.Dock.restoreMinimized.delay(25,MUI.Dock,f)}else{MUI.focusWindow(f)}return}if(a.isMinimized==true){MUI.Dock.restoreMinimized.delay(25,MUI.Dock,f)}else{if(a.windowEl.hasClass("isFocused")&&a.options.minimizable==true){MUI.Dock.minimizeWindow(f)}else{MUI.focusWindow(f)}var h=document.getCoordinates();if(f.getStyle("left").toInt()>h.width||f.getStyle("top").toInt()>h.height){MUI.centerWindow(f)}}}});this.dockSortables.addItems(d);var b=a.titleEl.innerHTML;var c=new Element("div",{id:a.options.id+"_dockTabText","class":"dockText"}).set("html",b.substring(0,19)+(b.length>19?"...":"")).inject($(d));if(a.options.icon!=false){}MUI.Desktop.setDesktopSize()},makeActiveTab:function(){var c=MUI.getWindowWithHighestZindex();var a=c.retrieve("instance");$$(".dockTab").removeClass("activeDockTab");if(a.isMinimized!=true){a.windowEl.addClass("isFocused");var b=$(a.options.id+"_dockTab");if(b!=null){b.addClass("activeDockTab")}}else{a.windowEl.removeClass("isFocused")}},minimizeWindow:function(c){if(c!=$(c)){return}var a=c.retrieve("instance");a.isMinimized=true;if(a.iframeEl){if(!Browser.Engine.trident){a.iframeEl.setStyle("visibility","hidden")}else{a.iframeEl.hide()}}a.contentBorderEl.setStyle("visibility","hidden");if(a.toolbarWrapperEl){a.toolbarWrapperEl.hide()}c.setStyle("visibility","hidden");if(Browser.Platform.mac&&Browser.Engine.gecko){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){var b=new Number(RegExp.$1);if(b<3){a.contentWrapperEl.setStyle("overflow","hidden")}}}MUI.Desktop.setDesktopSize();setTimeout(function(){c.setStyle("zIndex",1);c.removeClass("isFocused");this.makeActiveTab()}.bind(this),100);a.fireEvent("onMinimize",c)},restoreMinimized:function(b){var a=b.retrieve("instance");if(a.isMinimized==false){return}if(MUI.Windows.windowsVisible==false){MUI.toggleWindowVisibility()}MUI.Desktop.setDesktopSize();if(a.options.scrollbars==true&&!a.iframeEl){a.contentWrapperEl.setStyle("overflow","auto")}if(a.isCollapsed){MUI.collapseToggle(b)}b.setStyle("visibility","visible");a.contentBorderEl.setStyle("visibility","visible");if(a.toolbarWrapperEl){a.toolbarWrapperEl.show()}if(a.iframeEl){if(!Browser.Engine.trident){a.iframeEl.setStyle("visibility","visible")}else{a.iframeEl.show()}}a.isMinimized=false;MUI.focusWindow(b);a.fireEvent("onRestore",b)},toggle:function(){if(!MochaUI.dockVisible){this.dockWrapper.show();MUI.dockVisible=true;MUI.Desktop.setDesktopSize()}else{this.dockWrapper.hide();MUI.dockVisible=false;MUI.Desktop.setDesktopSize()}}};if(!document.createElement("canvas").getContext){(function(){var w=Math;var x=w.round;var t=w.sin;var F=w.cos;var o=w.abs;var E=w.sqrt;var a=10;var p=a/2;function k(){return this.context_||(this.context_=new r(this))}var v=Array.prototype.slice;function G(m,H,I){var j=v.call(arguments,2);return function(){return m.apply(H,j.concat(v.call(arguments)))}}var l={init:function(j){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var m=j||document;m.createElement("canvas");m.attachEvent("onreadystatechange",G(this.init_,this,m))}},init_:function(I){if(!I.namespaces.g_vml_){I.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML")}if(!I.namespaces.g_o_){I.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML")}if(!I.styleSheets.ex_canvas_){var H=I.createStyleSheet();H.owningElement.id="ex_canvas_";H.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}var m=I.getElementsByTagName("canvas");for(var j=0;j<m.length;j++){this.initElement(m[j])}},initElement:function(m){if(!m.getContext){m.getContext=k;m.innerHTML="";m.attachEvent("onpropertychange",D);m.attachEvent("onresize",b);var j=m.attributes;if(j.width&&j.width.specified){m.style.width=j.width.nodeValue+"px"}else{m.width=m.clientWidth}if(j.height&&j.height.specified){m.style.height=j.height.nodeValue+"px"}else{m.height=m.clientHeight}}return m}};function D(m){var j=m.srcElement;switch(m.propertyName){case"width":j.style.width=j.attributes.width.nodeValue+"px";j.getContext().clearRect();break;case"height":j.style.height=j.attributes.height.nodeValue+"px";j.getContext().clearRect();break}}function b(m){var j=m.srcElement;if(j.firstChild){j.firstChild.style.width=j.clientWidth+"px";j.firstChild.style.height=j.clientHeight+"px"}}l.init();var f=[];for(var A=0;A<16;A++){for(var z=0;z<16;z++){f[A*16+z]=A.toString(16)+z.toString(16)}}function s(){return[[1,0,0],[0,1,0],[0,0,1]]}function d(I,H){var m=s();for(var j=0;j<3;j++){for(var L=0;L<3;L++){var J=0;for(var K=0;K<3;K++){J+=I[j][K]*H[K][L]}m[j][L]=J}}return m}function y(m,j){j.fillStyle=m.fillStyle;j.lineCap=m.lineCap;j.lineJoin=m.lineJoin;j.lineWidth=m.lineWidth;j.miterLimit=m.miterLimit;j.shadowBlur=m.shadowBlur;j.shadowColor=m.shadowColor;j.shadowOffsetX=m.shadowOffsetX;j.shadowOffsetY=m.shadowOffsetY;j.strokeStyle=m.strokeStyle;j.globalAlpha=m.globalAlpha;j.arcScaleX_=m.arcScaleX_;j.arcScaleY_=m.arcScaleY_;j.lineScale_=m.lineScale_}function c(m){var J,I=1;m=String(m);if(m.substring(0,3)=="rgb"){var L=m.indexOf("(",3);var j=m.indexOf(")",L+1);var K=m.substring(L+1,j).split(",");J="#";for(var H=0;H<3;H++){J+=f[Number(K[H])]}if(K.length==4&&m.substr(3,1)=="a"){I=K[3]}}else{J=m}return{color:J,alpha:I}}function u(j){switch(j){case"butt":return"flat";case"round":return"round";case"square":default:return"square"}}function r(m){this.m_=s();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle="#000";this.fillStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=a*1;this.globalAlpha=1;this.canvas=m;var j=m.ownerDocument.createElement("div");j.style.width=m.clientWidth+"px";j.style.height=m.clientHeight+"px";j.style.overflow="hidden";j.style.position="absolute";m.appendChild(j);this.element_=j;this.arcScaleX_=1;this.arcScaleY_=1;this.lineScale_=1}var n=r.prototype;n.clearRect=function(){this.element_.innerHTML=""};n.beginPath=function(){this.currentPath_=[]};n.moveTo=function(m,j){var H=this.getCoords_(m,j);this.currentPath_.push({type:"moveTo",x:H.x,y:H.y});this.currentX_=H.x;this.currentY_=H.y};n.lineTo=function(m,j){var H=this.getCoords_(m,j);this.currentPath_.push({type:"lineTo",x:H.x,y:H.y});this.currentX_=H.x;this.currentY_=H.y};n.bezierCurveTo=function(H,m,N,M,L,J){var j=this.getCoords_(L,J);var K=this.getCoords_(H,m);var I=this.getCoords_(N,M);q(this,K,I,j)};function q(j,I,H,m){j.currentPath_.push({type:"bezierCurveTo",cp1x:I.x,cp1y:I.y,cp2x:H.x,cp2y:H.y,x:m.x,y:m.y});j.currentX_=m.x;j.currentY_=m.y}n.quadraticCurveTo=function(L,H,m,j){var K=this.getCoords_(L,H);var J=this.getCoords_(m,j);var M={x:this.currentX_+2/3*(K.x-this.currentX_),y:this.currentY_+2/3*(K.y-this.currentY_)};var I={x:M.x+(J.x-this.currentX_)/3,y:M.y+(J.y-this.currentY_)/3};q(this,M,I,J)};n.arc=function(O,M,N,J,m,H){N*=a;var S=H?"at":"wa";var P=O+F(J)*N-p;var R=M+t(J)*N-p;var j=O+F(m)*N-p;var Q=M+t(m)*N-p;if(P==j&&!H){P+=0.125}var I=this.getCoords_(O,M);var L=this.getCoords_(P,R);var K=this.getCoords_(j,Q);this.currentPath_.push({type:S,x:I.x,y:I.y,radius:N,xStart:L.x,yStart:L.y,xEnd:K.x,yEnd:K.y})};n.rect=function(H,m,j,I){this.moveTo(H,m);this.lineTo(H+j,m);this.lineTo(H+j,m+I);this.lineTo(H,m+I);this.closePath()};n.strokeRect=function(H,m,j,I){var J=this.currentPath_;this.beginPath();this.moveTo(H,m);this.lineTo(H+j,m);this.lineTo(H+j,m+I);this.lineTo(H,m+I);this.closePath();this.stroke();this.currentPath_=J};n.fillRect=function(H,m,j,I){var J=this.currentPath_;this.beginPath();this.moveTo(H,m);this.lineTo(H+j,m);this.lineTo(H+j,m+I);this.lineTo(H,m+I);this.closePath();this.fill();this.currentPath_=J};n.createLinearGradient=function(m,I,j,H){var J=new B("gradient");J.x0_=m;J.y0_=I;J.x1_=j;J.y1_=H;return J};n.createRadialGradient=function(I,K,H,m,J,j){var L=new B("gradientradial");L.x0_=I;L.y0_=K;L.r0_=H;L.x1_=m;L.y1_=J;L.r1_=j;return L};n.drawImage=function(V,I){var O,M,Q,ad,T,R,Y,af;var P=V.runtimeStyle.width;var U=V.runtimeStyle.height;V.runtimeStyle.width="auto";V.runtimeStyle.height="auto";var N=V.width;var ab=V.height;V.runtimeStyle.width=P;V.runtimeStyle.height=U;if(arguments.length==3){O=arguments[1];M=arguments[2];T=R=0;Y=Q=N;af=ad=ab}else{if(arguments.length==5){O=arguments[1];M=arguments[2];Q=arguments[3];ad=arguments[4];T=R=0;Y=N;af=ab}else{if(arguments.length==9){T=arguments[1];R=arguments[2];Y=arguments[3];af=arguments[4];O=arguments[5];M=arguments[6];Q=arguments[7];ad=arguments[8]}else{throw Error("Invalid number of arguments")}}}var ae=this.getCoords_(O,M);var J=Y/2;var m=af/2;var ac=[];var j=10;var L=10;ac.push(" <g_vml_:group",' coordsize="',a*j,",",a*L,'"',' coordorigin="0,0"',' style="width:',j,"px;height:",L,"px;position:absolute;");if(this.m_[0][0]!=1||this.m_[0][1]){var K=[];K.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",x(ae.x/a),",","Dy=",x(ae.y/a),"");var aa=ae;var Z=this.getCoords_(O+Q,M);var X=this.getCoords_(O,M+ad);var S=this.getCoords_(O+Q,M+ad);aa.x=w.max(aa.x,Z.x,X.x,S.x);aa.y=w.max(aa.y,Z.y,X.y,S.y);ac.push("padding:0 ",x(aa.x/a),"px ",x(aa.y/a),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",K.join(""),", sizingmethod='clip');")}else{ac.push("top:",x(ae.y/a),"px;left:",x(ae.x/a),"px;")}ac.push(' ">','<g_vml_:image src="',V.src,'"',' style="width:',a*Q,"px;"," height:",a*ad,'px;"',' cropleft="',T/N,'"',' croptop="',R/ab,'"',' cropright="',(N-T-Y)/N,'"',' cropbottom="',(ab-R-af)/ab,'"'," />","</g_vml_:group>");this.element_.insertAdjacentHTML("BeforeEnd",ac.join(""))};n.stroke=function(ah){var M=[];var N=false;var at=c(ah?this.fillStyle:this.strokeStyle);var ad=at.color;var an=at.alpha*this.globalAlpha;var J=10;var P=10;M.push("<g_vml_:shape",' filled="',!!ah,'"',' style="position:absolute;width:',J,"px;height:",P,'px;"',' coordorigin="0 0" coordsize="',a*J," ",a*P,'"',' stroked="',!ah,'"',' path="');var O=false;var ar={x:null,y:null};var Z={x:null,y:null};for(var am=0;am<this.currentPath_.length;am++){var al=this.currentPath_[am];var aq;switch(al.type){case"moveTo":aq=al;M.push(" m ",x(al.x),",",x(al.y));break;case"lineTo":M.push(" l ",x(al.x),",",x(al.y));break;case"close":M.push(" x ");al=null;break;case"bezierCurveTo":M.push(" c ",x(al.cp1x),",",x(al.cp1y),",",x(al.cp2x),",",x(al.cp2y),",",x(al.x),",",x(al.y));break;case"at":case"wa":M.push(" ",al.type," ",x(al.x-this.arcScaleX_*al.radius),",",x(al.y-this.arcScaleY_*al.radius)," ",x(al.x+this.arcScaleX_*al.radius),",",x(al.y+this.arcScaleY_*al.radius)," ",x(al.xStart),",",x(al.yStart)," ",x(al.xEnd),",",x(al.yEnd));break}if(al){if(ar.x==null||al.x<ar.x){ar.x=al.x}if(Z.x==null||al.x>Z.x){Z.x=al.x}if(ar.y==null||al.y<ar.y){ar.y=al.y}if(Z.y==null||al.y>Z.y){Z.y=al.y}}}M.push(' ">');if(!ah){var Y=this.lineScale_*this.lineWidth;if(Y<1){an*=Y}M.push("<g_vml_:stroke",' opacity="',an,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',u(this.lineCap),'"',' weight="',Y,'px"',' color="',ad,'" />')}else{if(typeof this.fillStyle=="object"){var Q=this.fillStyle;var V=0;var ak={x:0,y:0};var ae=0;var T=1;if(Q.type_=="gradient"){var S=Q.x0_/this.arcScaleX_;var m=Q.y0_/this.arcScaleY_;var R=Q.x1_/this.arcScaleX_;var au=Q.y1_/this.arcScaleY_;var ap=this.getCoords_(S,m);var ao=this.getCoords_(R,au);var L=ao.x-ap.x;var K=ao.y-ap.y;V=Math.atan2(L,K)*180/Math.PI;if(V<0){V+=360}if(V<0.000001){V=0}}else{var ap=this.getCoords_(Q.x0_,Q.y0_);var j=Z.x-ar.x;var I=Z.y-ar.y;ak={x:(ap.x-ar.x)/j,y:(ap.y-ar.y)/I};j/=this.arcScaleX_*a;I/=this.arcScaleY_*a;var aj=w.max(j,I);ae=2*Q.r0_/aj;T=2*Q.r1_/aj-ae}var ac=Q.colors_;ac.sort(function(W,H){return W.offset-H.offset});var X=ac.length;var ab=ac[0].color;var aa=ac[X-1].color;var ag=ac[0].alpha*this.globalAlpha;var af=ac[X-1].alpha*this.globalAlpha;var ai=[];for(var am=0;am<X;am++){var U=ac[am];ai.push(U.offset*T+ae+" "+U.color)}M.push('<g_vml_:fill type="',Q.type_,'"',' method="none" focus="100%"',' color="',ab,'"',' color2="',aa,'"',' colors="',ai.join(","),'"',' opacity="',af,'"',' g_o_:opacity2="',ag,'"',' angle="',V,'"',' focusposition="',ak.x,",",ak.y,'" />')}else{M.push('<g_vml_:fill color="',ad,'" opacity="',an,'" />')}}M.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",M.join(""))};n.fill=function(){this.stroke(true)};n.closePath=function(){this.currentPath_.push({type:"close"})};n.getCoords_=function(I,H){var j=this.m_;return{x:a*(I*j[0][0]+H*j[1][0]+j[2][0])-p,y:a*(I*j[0][1]+H*j[1][1]+j[2][1])-p}};n.save=function(){var j={};y(this,j);this.aStack_.push(j);this.mStack_.push(this.m_);this.m_=d(s(),this.m_)};n.restore=function(){y(this.aStack_.pop(),this);this.m_=this.mStack_.pop()};function h(H){for(var J=0;J<3;J++){for(var I=0;I<2;I++){if(!isFinite(H[J][I])||isNaN(H[J][I])){return false}}}return true}function C(H,j,I){if(!h(j)){return}H.m_=j;if(I){var J=j[0][0]*j[1][1]-j[0][1]*j[1][0];H.lineScale_=E(o(J))}}n.translate=function(H,m){var j=[[1,0,0],[0,1,0],[H,m,1]];C(this,d(j,this.m_),false)};n.rotate=function(m){var I=F(m);var H=t(m);var j=[[I,H,0],[-H,I,0],[0,0,1]];C(this,d(j,this.m_),false)};n.scale=function(H,m){this.arcScaleX_*=H;this.arcScaleY_*=m;var j=[[H,0,0],[0,m,0],[0,0,1]];C(this,d(j,this.m_),true)};n.transform=function(J,I,L,K,m,j){var H=[[J,I,0],[L,K,0],[m,j,1]];C(this,d(H,this.m_),true)};n.setTransform=function(K,J,M,L,I,H){var j=[[K,J,0],[M,L,0],[I,H,1]];C(this,j,true)};n.clip=function(){};n.arcTo=function(){};n.createPattern=function(){return new g};function B(j){this.type_=j;this.x0_=0;this.y0_=0;this.r0_=0;this.x1_=0;this.y1_=0;this.r1_=0;this.colors_=[]}B.prototype.addColorStop=function(m,j){j=c(j);this.colors_.push({offset:m,color:j.color,alpha:j.alpha})};function g(){}G_vmlCanvasManager=l;CanvasRenderingContext2D=r;CanvasGradient=B;CanvasPattern=g})()}MUI.files[MUI.path.source+"Layout/Layout.js"]="loaded";MUI.extend({Columns:{instances:new Hash(),columnIDCount:0},Panels:{instances:new Hash(),panelIDCount:0}});MUI.Desktop={options:{desktop:"desktop",desktopHeader:"desktopHeader",desktopFooter:"desktopFooter",desktopNavBar:"desktopNavbar",pageWrapper:"pageWrapper",page:"page",desktopFooter:"desktopFooterWrapper"},initialize:function(a){this.options.desktop=a.desktop?a.desktop:this.options.desktop;this.options.desktopHeader=a.desktopHeader?a.desktopHeader:this.options.desktopHeader;this.options.desktopFooter=a.desktopFooter?a.desktopFooter:this.options.desktopFooter;this.options.desktopNavBar=a.desktopNavBar?a.desktopNavBar:this.options.desktopNavBar;this.options.pageWrapper=a.pageWrapper?a.pageWrapper:this.options.pageWrapper;this.options.page=a.page?a.page:this.options.page;this.options.desktopFooter=a.desktopFooter?a.desktopFooter:this.options.desktopFooter;this.desktop=$(this.options.desktop);this.desktopHeader=$(this.options.desktopHeader);this.desktopNavBar=$(this.options.desktopNavBar);this.pageWrapper=$(this.options.pageWrapper);this.page=$(this.options.page);this.desktopFooter=$(this.options.desktopFooter);MUI.underlayInitialize();if(this.desktop){($$("body")).setStyles({overflow:"hidden",height:"100%",margin:0});($$("html")).setStyles({overflow:"hidden",height:"100%"})}if(!MUI.Dock){this.setDesktopSize()}this.menuInitialize();window.addEvent("resize",function(b){this.onBrowserResize()}.bind(this));if(MUI.myChain){MUI.myChain.callChain()}},menuInitialize:function(){if(Browser.Engine.trident4&&this.desktopNavBar){this.desktopNavBar.getElements("li").each(function(a){a.addEvent("mouseenter",function(){this.addClass("ieHover")});a.addEvent("mouseleave",function(){this.removeClass("ieHover")})})}},onBrowserResize:function(){this.setDesktopSize();setTimeout(function(){MUI.Windows.instances.each(function(a){if(a.isMaximized){if(a.iframeEl){a.iframeEl.setStyle("visibility","hidden")}var d=document.getCoordinates();var b=a.contentBorderEl.getStyle("border-top").toInt()+a.contentBorderEl.getStyle("border-bottom").toInt();var c=a.toolbarWrapperEl?a.toolbarWrapperEl.getStyle("height").toInt()+a.toolbarWrapperEl.getStyle("border-top").toInt():0;a.contentWrapperEl.setStyles({height:d.height-a.options.headerHeight-a.options.footerHeight-b-c,width:d.width});a.drawWindow();if(a.iframeEl){a.iframeEl.setStyles({height:a.contentWrapperEl.getStyle("height")});a.iframeEl.setStyle("visibility","visible")}}}.bind(this))}.bind(this),100)},setDesktopSize:function(){var d=window.getCoordinates();var b=$(MUI.options.dockWrapper);if(this.desktop){this.desktop.setStyle("height",d.height)}if(this.pageWrapper){var a=MUI.dockVisible?b.offsetHeight:0;var c=d.height;c-=this.pageWrapper.getStyle("border-top").toInt();c-=this.pageWrapper.getStyle("border-bottom").toInt();if(this.desktopHeader){c-=this.desktopHeader.offsetHeight}if(this.desktopFooter){c-=this.desktopFooter.offsetHeight}c-=a;if(c<0){c=0}this.pageWrapper.setStyle("height",c)}if(MUI.Columns.instances.getKeys().length>0){MUI.Desktop.resizePanels()}},resizePanels:function(){MUI.panelHeight();MUI.rWidth()},maximizeWindow:function(g){var h=MUI.Windows.instances.get(g.id);var k=h.options;var c=h.windowDrag;if(g!=$(g)||h.isMaximized){return}if(h.isCollapsed){MUI.collapseToggle(g)}h.isMaximized=true;if(h.options.restrict){c.detach();if(k.resizable){h.detachResizable()}h.titleBarEl.setStyle("cursor","default")}if(k.container!=this.desktop){this.desktop.grab(g);if(this.options.restrict){c.container=this.desktop}}h.oldTop=g.getStyle("top");h.oldLeft=g.getStyle("left");var d=h.contentWrapperEl;d.oldWidth=d.getStyle("width");d.oldHeight=d.getStyle("height");if(h.iframeEl){if(!Browser.Engine.trident){h.iframeEl.setStyle("visibility","hidden")}else{h.iframeEl.hide()}}var b=document.getCoordinates();var k=h.options;var f=k.shadowBlur;var j=k.shadowOffset;var a=b.height-k.headerHeight-k.footerHeight;a-=h.contentBorderEl.getStyle("border-top").toInt();a-=h.contentBorderEl.getStyle("border-bottom").toInt();a-=(h.toolbarWrapperEl?h.toolbarWrapperEl.getStyle("height").toInt()+h.toolbarWrapperEl.getStyle("border-top").toInt():0);MUI.resizeWindow(g,{width:b.width,height:a,top:j.y-f,left:j.x-f});h.fireEvent("onMaximize",g);if(h.maximizeButtonEl){h.maximizeButtonEl.setProperty("title","Restore")}MUI.focusWindow(g)},restoreWindow:function(d){var a=d.retrieve("instance");if(d!=$(d)||!a.isMaximized){return}var b=a.options;a.isMaximized=false;if(b.restrict){a.windowDrag.attach();if(b.resizable){a.reattachResizable()}a.titleBarEl.setStyle("cursor","move")}if(a.iframeEl){if(!Browser.Engine.trident){a.iframeEl.setStyle("visibility","hidden")}else{a.iframeEl.hide()}}var c=a.contentWrapperEl;MUI.resizeWindow(d,{width:c.oldWidth,height:c.oldHeight,top:a.oldTop,left:a.oldLeft});a.fireEvent("onRestore",d);if(a.maximizeButtonEl){a.maximizeButtonEl.setProperty("title","Maximize")}}};MUI.Column=new Class({Implements:[Events,Options],options:{id:null,container:null,placement:null,width:null,resizeLimit:[],sortable:true,isCollapsed:false,onResize:$empty,onCollapse:$empty,onExpand:$empty},initialize:function(b){this.setOptions(b);$extend(this,{timestamp:$time(),isCollapsed:false,oldWidth:0});if(this.options.id==null){this.options.id="column"+(++MUI.Columns.columnIDCount)}var b=this.options;var h=MUI.Columns.instances;var d=h.get(b.id);if(b.container==null){b.container=MUI.Desktop.pageWrapper}else{$(b.container).setStyle("overflow","hidden")}if(typeof this.options.container=="string"){this.options.container=$(this.options.container)}if(d){var a=d}if(this.columnEl){return}else{h.set(b.id,this)}if($(b.container).getElement(".pad")!=null){$(b.container).getElement(".pad").hide()}if($(b.container).getElement(".mochaContent")!=null){$(b.container).getElement(".mochaContent").hide()}this.columnEl=new Element("div",{id:this.options.id,"class":"column expanded",styles:{width:b.placement=="main"?null:b.width}}).inject($(b.container));this.columnEl.store("instance",this);var c=this.columnEl.getParent();var g=c.getStyle("height").toInt();this.columnEl.setStyle("height",g);if(this.options.sortable){if(!this.options.container.retrieve("sortables")){var f=new Sortables(this.columnEl,{opacity:1,handle:".panel-header",constrain:false,revert:false,onSort:function(){$$(".column").each(function(j){j.getChildren(".panelWrapper").each(function(k){k.getElement(".panel").removeClass("bottomPanel")});if(j.getChildren(".panelWrapper").getLast()){j.getChildren(".panelWrapper").getLast().getElement(".panel").addClass("bottomPanel")}j.getChildren(".panelWrapper").each(function(l){var k=l.getElement(".panel");var n=l.getParent().id;a=MUI.Panels.instances.get(k.id);a.options.column=n;if(a){var m=k.getParent().getNext(".expanded");if(m){m=m.getElement(".panel")}a.partner=m}});MUI.panelHeight()}.bind(this))}.bind(this)});this.options.container.store("sortables",f)}else{this.options.container.retrieve("sortables").addLists(this.columnEl)}}if(b.placement=="main"){this.columnEl.addClass("rWidth")}switch(this.options.placement){case"left":this.handleEl=new Element("div",{id:this.options.id+"_handle","class":"columnHandle"}).inject(this.columnEl,"after");this.handleIconEl=new Element("div",{id:b.id+"_handle_icon","class":"handleIcon"}).inject(this.handleEl);addResizeRight(this.columnEl,b.resizeLimit[0],b.resizeLimit[1]);break;case"right":this.handleEl=new Element("div",{id:this.options.id+"_handle","class":"columnHandle"}).inject(this.columnEl,"before");this.handleIconEl=new Element("div",{id:b.id+"_handle_icon","class":"handleIcon"}).inject(this.handleEl);addResizeLeft(this.columnEl,b.resizeLimit[0],b.resizeLimit[1]);break}if(this.options.isCollapsed&&this.options.placement!="main"){this.columnToggle()}if(this.handleEl!=null){this.handleEl.addEvent("dblclick",function(){this.columnToggle()}.bind(this))}MUI.rWidth()},close:function(){MUI.closeColumn(this.options.id)},columnCollapse:function(){var a=this.columnEl;this.oldWidth=a.getStyle("width").toInt();this.resize.detach();this.handleEl.removeEvents("dblclick");this.handleEl.addEvent("click",function(){this.columnExpand()}.bind(this));this.handleEl.setStyle("cursor","pointer").addClass("detached");a.setStyle("width",0);this.isCollapsed=true;a.addClass("collapsed");a.removeClass("expanded");MUI.rWidth();this.fireEvent("onCollapse");return true},columnExpand:function(){var a=this.columnEl;a.setStyle("width",this.oldWidth);this.isCollapsed=false;a.addClass("expanded");a.removeClass("collapsed");this.handleEl.removeEvents("click");this.handleEl.addEvent("dblclick",function(){this.columnCollapse()}.bind(this));this.resize.attach();this.handleEl.setStyle("cursor",Browser.Engine.webkit?"col-resize":"e-resize").addClass("attached");MUI.rWidth();this.fireEvent("onExpand");return true},columnToggle:function(){if(this.isCollapsed==false){this.columnCollapse()}else{this.columnExpand()}}});MUI.Column.implement(new Options,new Events);MUI.Panel=new Class({Implements:[Events,Options],options:{id:null,title:"New Panel",column:null,require:{css:[],images:[],js:[],onload:null},loadMethod:null,contentURL:null,method:"get",data:null,evalScripts:true,evalResponse:false,content:"Panel content",tabsURL:null,tabsData:null,tabsOnload:$empty,header:true,headerToolbox:false,headerToolboxURL:"pages/lipsum.html",headerToolboxOnload:$empty,height:125,addClass:"",scrollbars:true,padding:{top:0,right:0,bottom:0,left:0},collapsible:true,onBeforeBuild:$empty,onContentLoaded:$empty,onResize:$empty,onCollapse:$empty,onExpand:$empty},initialize:function(b){this.setOptions(b);this.isClosing=false;$extend(this,{timestamp:$time(),isCollapsed:false,oldHeight:0,partner:null});if(this.options.id==null){this.options.id="panel"+(++MUI.Panels.panelIDCount)}var g=MUI.Panels.instances;var c=g.get(this.options.id);var b=this.options;if(c){var a=c}if(this.panelEl){return}else{g.set(this.options.id,this)}this.fireEvent("onBeforeBuild");if(b.loadMethod=="iframe"){b.padding={top:0,right:0,bottom:0,left:0}}this.showHandle=true;if($(b.column).getChildren().length==0){this.showHandle=false}this.panelWrapperEl=new Element("div",{id:this.options.id+"_wrapper","class":"panelWrapper expanded"}).inject($(b.column));this.panelEl=new Element("div",{id:this.options.id,"class":"panel expanded",styles:{height:b.height}}).inject(this.panelWrapperEl);this.panelEl.store("instance",this);this.panelEl.addClass(b.addClass);this.contentEl=new Element("div",{id:b.id+"_pad","class":"pad"}).inject(this.panelEl);this.contentWrapperEl=this.panelEl;this.contentEl.setStyles({"padding-top":b.padding.top,"padding-bottom":b.padding.bottom,"padding-left":b.padding.left,"padding-right":b.padding.right});this.panelHeaderEl=new Element("div",{id:this.options.id+"_header","class":"panel-header",styles:{display:b.header?"block":"none"}}).inject(this.panelEl,"before");var d=MUI.Columns.instances;var f=d.get(this.options.column);if(this.options.collapsible){this.collapseToggleInit()}if(this.options.headerToolbox){this.panelHeaderToolboxEl=new Element("div",{id:b.id+"_headerToolbox","class":"panel-header-toolbox"}).inject(this.panelHeaderEl)}this.panelHeaderContentEl=new Element("div",{id:b.id+"_headerContent","class":"panel-headerContent"}).inject(this.panelHeaderEl);if(f.options.sortable){this.panelHeaderEl.setStyle("cursor","move");f.options.container.retrieve("sortables").addItems(this.panelWrapperEl);if(this.panelHeaderToolboxEl){this.panelHeaderToolboxEl.addEvent("mousedown",function(h){h=new Event(h).stop();h.target.focus()});this.panelHeaderToolboxEl.setStyle("cursor","default")}}this.titleEl=new Element("h2",{id:b.id+"_title"}).inject(this.panelHeaderContentEl);this.handleEl=new Element("div",{id:b.id+"_handle","class":"horizontalHandle",styles:{display:this.showHandle==true?"block":"none"}}).inject(this.panelEl,"after");this.handleIconEl=new Element("div",{id:b.id+"_handle_icon","class":"handleIcon"}).inject(this.handleEl);addResizeBottom(b.id);if(b.require.css.length||b.require.images.length){new MUI.Require({css:b.require.css,images:b.require.images,onload:function(){this.newPanel()}.bind(this)})}else{this.newPanel()}},destroy:function(){MUI.closePanel(this.panelEl)},newPanel:function(){options=this.options;if(this.options.headerToolbox){MUI.updateContent({element:this.panelEl,childElement:this.panelHeaderToolboxEl,loadMethod:"xhr",url:options.headerToolboxURL,onContentLoaded:options.headerToolboxOnload})}if(options.tabsURL==null){this.titleEl.set("html",options.title)}else{this.panelHeaderContentEl.addClass("tabs");MUI.updateContent({element:this.panelEl,childElement:this.panelHeaderContentEl,loadMethod:"xhr",url:options.tabsURL,data:options.tabsData,onContentLoaded:options.tabsOnload})}MUI.updateContent({element:this.panelEl,content:options.content,method:options.method,data:options.data,url:options.contentURL,onContentLoaded:null,require:{js:options.require.js,onload:options.require.onload}});$(options.column).getChildren(".panelWrapper").each(function(a){a.getElement(".panel").removeClass("bottomPanel")});$(options.column).getChildren(".panelWrapper").getLast().getElement(".panel").addClass("bottomPanel");MUI.panelHeight(options.column,this.panelEl,"new")},collapseToggleInit:function(a){var a=this.options;this.panelHeaderCollapseBoxEl=new Element("div",{id:a.id+"_headerCollapseBox","class":"toolbox"}).inject(this.panelHeaderEl);if(a.headerToolbox){this.panelHeaderCollapseBoxEl.addClass("divider")}this.collapseToggleEl=new Element("div",{id:a.id+"_collapseToggle","class":"panel-collapse icon16",styles:{width:16,height:16},title:"Collapse Panel"}).inject(this.panelHeaderCollapseBoxEl);this.collapseToggleEl.addEvent("click",function(g){var b=this.panelEl;var c=this.panelWrapperEl;var h=MUI.Panels.instances;var f=[];c.getAllPrevious(".panelWrapper").each(function(k){var j=h.get(k.getElement(".panel").id);if(j.isCollapsed==false){f.push(k.getElement(".panel").id)}});c.getAllNext(".panelWrapper").each(function(k){var j=h.get(k.getElement(".panel").id);if(j.isCollapsed==false){f.push(k.getElement(".panel").id)}});if(this.isCollapsed==false){var d=MUI.Columns.instances.get($(a.column).id);if(f.length==0&&d.options.placement!="main"){var d=MUI.Columns.instances.get($(a.column).id);d.columnToggle();return}else{if(f.length==0&&d.options.placement=="main"){return}}this.oldHeight=b.getStyle("height").toInt();if(this.oldHeight<10){this.oldHeight=20}this.contentEl.setStyle("position","absolute");b.setStyle("height",0);this.isCollapsed=true;c.addClass("collapsed");c.removeClass("expanded");MUI.panelHeight(a.column,b,"collapsing");MUI.panelHeight();this.collapseToggleEl.removeClass("panel-collapsed");this.collapseToggleEl.addClass("panel-expand");this.collapseToggleEl.setProperty("title","Expand Panel");this.fireEvent("onCollapse")}else{this.contentEl.setStyle("position",null);b.setStyle("height",this.oldHeight);this.isCollapsed=false;c.addClass("expanded");c.removeClass("collapsed");MUI.panelHeight(this.options.column,b,"expanding");MUI.panelHeight();this.collapseToggleEl.removeClass("panel-expand");this.collapseToggleEl.addClass("panel-collapsed");this.collapseToggleEl.setProperty("title","Collapse Panel");this.fireEvent("onExpand")}}.bind(this))}});MUI.Panel.implement(new Options,new Events);MUI.extend({panelHeight:function(a,c,b){if(a!=null){MUI.panelHeight2($(a),c,b)}else{$$(".column").each(function(d){MUI.panelHeight2(d)}.bind(this))}},panelHeight2:function(f,o,g){var b=MUI.Panels.instances;var l=f.getParent();var k=l.getStyle("height").toInt();if(Browser.Engine.trident4&&l==MUI.Desktop.pageWrapper){k-=1}f.setStyle("height",k);var j=[];f.getChildren(".panelWrapper").each(function(p){j.push(p.getElement(".panel"))}.bind(this));var m=[];f.getChildren(".expanded").each(function(p){m.push(p.getElement(".panel"))}.bind(this));var c=[];var d;var a=0;this.panelsTotalHeight=0;this.height=0;j.each(function(p){instance=b.get(p.id);if(p.getParent().hasClass("expanded")&&p.getParent().getNext(".expanded")){instance.partner=p.getParent().getNext(".expanded").getElement(".panel");instance.resize.attach();instance.handleEl.setStyles({display:"block",cursor:Browser.Engine.webkit?"row-resize":"n-resize"}).removeClass("detached")}else{instance.resize.detach();instance.handleEl.setStyles({display:"none",cursor:null}).addClass("detached")}if(p.getParent().getNext(".panelWrapper")==null){instance.handleEl.hide()}}.bind(this));f.getChildren().each(function(p){p.getChildren().each(function(r){if(r.hasClass("panel")){var q=b.get(r.id);anyNextSiblingsExpanded=function(s){var t;s.getParent().getAllNext(".panelWrapper").each(function(u){var v=b.get(u.getElement(".panel").id);if(v.isCollapsed==false){t=true}}.bind(this));return t}.bind(this);anyExpandingNextSiblingsExpanded=function(s){var t;o.getParent().getAllNext(".panelWrapper").each(function(u){var v=b.get(u.getElement(".panel").id);if(v.isCollapsed==false){t=true}}.bind(this));return t}.bind(this);anyNextContainsChanging=function(t){var s=[];t.getParent().getAllNext(".panelWrapper").each(function(v){s.push(v.getElement(".panel"))}.bind(this));var u=s.contains(o);return u}.bind(this);nextExpandedChanging=function(s){var t;if(s.getParent().getNext(".expanded")){if(s.getParent().getNext(".expanded").getElement(".panel")==o){t=true}}return t};if(g=="new"){if(!q.isCollapsed&&r!=o){c.push(r);this.panelsTotalHeight+=r.offsetHeight.toInt()}}else{if(g==null||g=="collapsing"){if(!q.isCollapsed&&(!anyNextContainsChanging(r)||!anyNextSiblingsExpanded(r))){c.push(r);this.panelsTotalHeight+=r.offsetHeight.toInt()}}else{if(g=="expanding"&&!q.isCollapsed&&r!=o){if(!anyNextContainsChanging(r)||(!anyExpandingNextSiblingsExpanded(r)&&nextExpandedChanging(r))){c.push(r);this.panelsTotalHeight+=r.offsetHeight.toInt()}}}}if(r.style.height){this.height+=r.getStyle("height").toInt()}}else{this.height+=r.offsetHeight.toInt()}}.bind(this))}.bind(this));var n=f.offsetHeight.toInt()-this.height;this.height=0;f.getChildren().each(function(p){this.height+=p.offsetHeight.toInt()}.bind(this));var n=f.offsetHeight.toInt()-this.height;c.each(function(p){var r=p.offsetHeight.toInt()>=1?this.panelsTotalHeight/p.offsetHeight.toInt():1;var q=p.getStyle("height").toInt()+(n/r);if(q<1){q=0}p.setStyle("height",q);if(!$defined(g)){b[p.id].fireEvent("onResize")}}.bind(this));this.height=0;f.getChildren().each(function(p){p.getChildren().each(function(q){this.height+=q.offsetHeight.toInt();if(q.hasClass("panel")&&q.getStyle("height").toInt()>a){d=q;a=q.getStyle("height").toInt()}}.bind(this))}.bind(this));var n=f.offsetHeight.toInt()-this.height;if(n!=0&&a>0){var h=d.getStyle("height").toInt()+n;if(h<1){d.setStyle("height",0)}else{d.setStyle("height",h)}}l.getChildren(".columnHandle").each(function(r){var q=r.getParent();if(q.getStyle("height").toInt()<1){return}var p=q.getStyle("height").toInt()-r.getStyle("border-top").toInt()-r.getStyle("border-bottom").toInt();if(Browser.Engine.trident4&&q==MUI.Desktop.pageWrapper){p-=1}r.setStyle("height",p)});m.each(function(p){MUI.resizeChildren(p)}.bind(this))},resizeChildren:function(b){var d=MUI.Panels.instances;var a=d.get(b.id);var c=a.contentWrapperEl;if(a.iframeEl){if(!Browser.Engine.trident){a.iframeEl.setStyles({height:c.getStyle("height"),width:c.offsetWidth-c.getStyle("border-left").toInt()-c.getStyle("border-right").toInt()})}else{a.iframeEl.setStyles({height:c.getStyle("height"),width:c.offsetWidth-c.getStyle("border-left").toInt()-c.getStyle("border-right").toInt()-1});a.iframeEl.setStyles({width:c.offsetWidth-c.getStyle("border-left").toInt()-c.getStyle("border-right").toInt()})}}},rWidth:function(a){if(a==null){var a=MUI.Desktop.desktop}a.getElements(".rWidth").each(function(f){var b=f.offsetWidth.toInt();b-=f.getStyle("border-left").toInt();b-=f.getStyle("border-right").toInt();var d=f.getParent();this.width=0;d.getChildren().each(function(h){if(h.hasClass("mocha")!=true){this.width+=h.offsetWidth.toInt()}}.bind(this));var c=d.offsetWidth.toInt()-this.width;var g=b+c;if(g<1){g=0}f.setStyle("width",g);f.getChildren(".panel").each(function(h){h.setStyle("width",g-h.getStyle("border-left").toInt()-h.getStyle("border-right").toInt());MUI.resizeChildren(h)}.bind(this))})}});function addResizeRight(d,c,b){if(!$(d)){return}d=$(d);var g=MUI.Columns.instances;var a=g.get(d.id);var f=d.getNext(".columnHandle");f.setStyle("cursor",Browser.Engine.webkit?"col-resize":"e-resize");if(!c){c=50}if(!b){b=250}if(Browser.Engine.trident){f.addEvents({mousedown:function(){f.setCapture()},mouseup:function(){f.releaseCapture()}})}a.resize=d.makeResizable({handle:f,modifiers:{x:"width",y:false},limit:{x:[c,b]},onStart:function(){d.getElements("iframe").setStyle("visibility","hidden");d.getNext(".column").getElements("iframe").setStyle("visibility","hidden")}.bind(this),onDrag:function(){if(Browser.Engine.gecko){$$(".panel").each(function(h){if(h.getElements(".mochaIframe").length==0){h.hide()}})}MUI.rWidth(d.getParent());if(Browser.Engine.gecko){$$(".panel").show()}if(Browser.Engine.trident4){d.getChildren().each(function(j){var h=$(d).getStyle("width").toInt();h-=j.getStyle("border-right").toInt();h-=j.getStyle("border-left").toInt();h-=j.getStyle("padding-right").toInt();h-=j.getStyle("padding-left").toInt();j.setStyle("width",h)}.bind(this))}}.bind(this),onComplete:function(){MUI.rWidth(d.getParent());d.getElements("iframe").setStyle("visibility","visible");d.getNext(".column").getElements("iframe").setStyle("visibility","visible");a.fireEvent("onResize")}.bind(this)})}function addResizeLeft(d,c,b){if(!$(d)){return}d=$(d);var h=MUI.Columns.instances;var a=h.get(d.id);var g=d.getPrevious(".columnHandle");g.setStyle("cursor",Browser.Engine.webkit?"col-resize":"e-resize");var f=d.getPrevious(".column");if(!c){c=50}if(!b){b=250}if(Browser.Engine.trident){g.addEvents({mousedown:function(){g.setCapture()},mouseup:function(){g.releaseCapture()}})}a.resize=d.makeResizable({handle:g,modifiers:{x:"width",y:false},invert:true,limit:{x:[c,b]},onStart:function(){$(d).getElements("iframe").setStyle("visibility","hidden");f.getElements("iframe").setStyle("visibility","hidden")}.bind(this),onDrag:function(){MUI.rWidth(d.getParent())}.bind(this),onComplete:function(){MUI.rWidth(d.getParent());$(d).getElements("iframe").setStyle("visibility","visible");f.getElements("iframe").setStyle("visibility","visible");a.fireEvent("onResize");h[f.id].fireEvent("onResize")}.bind(this)})}function addResizeBottom(b){if(!$(b)){return}var b=$(b);var d=MUI.Panels.instances;var a=d.get(b.id);var c=a.handleEl;c.setStyle("cursor",Browser.Engine.webkit?"row-resize":"n-resize");partner=a.partner;min=0;max=function(){return b.getStyle("height").toInt()+partner.getStyle("height").toInt()}.bind(this);if(Browser.Engine.trident){c.addEvents({mousedown:function(){c.setCapture()},mouseup:function(){c.releaseCapture()}})}a.resize=b.makeResizable({handle:c,modifiers:{x:false,y:"height"},limit:{y:[min,max]},invert:false,onBeforeStart:function(){partner=a.partner;this.originalHeight=b.getStyle("height").toInt();this.partnerOriginalHeight=partner.getStyle("height").toInt()}.bind(this),onStart:function(){if(a.iframeEl){if(!Browser.Engine.trident){a.iframeEl.setStyle("visibility","hidden");partner.getElements("iframe").setStyle("visibility","hidden")}else{a.iframeEl.hide();partner.getElements("iframe").hide()}}}.bind(this),onDrag:function(){partnerHeight=partnerOriginalHeight;partnerHeight+=(this.originalHeight-b.getStyle("height").toInt());partner.setStyle("height",partnerHeight);MUI.resizeChildren(b,b.getStyle("height").toInt());MUI.resizeChildren(partner,partnerHeight);b.getChildren(".column").each(function(f){MUI.panelHeight(f)});partner.getChildren(".column").each(function(f){MUI.panelHeight(f)})}.bind(this),onComplete:function(){partnerHeight=partnerOriginalHeight;partnerHeight+=(this.originalHeight-b.getStyle("height").toInt());partner.setStyle("height",partnerHeight);MUI.resizeChildren(b,b.getStyle("height").toInt());MUI.resizeChildren(partner,partnerHeight);b.getChildren(".column").each(function(g){MUI.panelHeight(g)});partner.getChildren(".column").each(function(g){MUI.panelHeight(g)});if(a.iframeEl){if(!Browser.Engine.trident){a.iframeEl.setStyle("visibility","visible");partner.getElements("iframe").setStyle("visibility","visible")}else{a.iframeEl.show();partner.getElements("iframe").show();var f=a.iframeEl.getStyle("width").toInt();a.iframeEl.setStyle("width",f-1);MUI.rWidth();a.iframeEl.setStyle("width",f)}}a.fireEvent("onResize")}.bind(this)})}MUI.extend({closeColumn:function(b){b=$(b);if(b==null){return}var f=MUI.Columns.instances;var a=f.get(b.id);if(a==null||a.isClosing){return}a.isClosing=true;var c=$(b).getElements(".panel");c.each(function(g){MUI.closePanel(g.id)}.bind(this));if(Browser.Engine.trident){b.dispose();if(a.handleEl!=null){a.handleEl.dispose()}}else{b.destroy();if(a.handleEl!=null){a.handleEl.destroy()}}if(MUI.Desktop){MUI.Desktop.resizePanels()}var d=a.options.container.retrieve("sortables");if(d){d.removeLists(b)}f.erase(a.options.id);return true},closePanel:function(h){h=$(h);if(h==null){return}var g=MUI.Panels.instances;var a=g.get(h.id);if(h!=$(h)||a.isClosing){return}var c=a.options.column;a.isClosing=true;var d=MUI.Columns.instances;var f=d.get(c);if(f.options.sortable&&f.options.container.retrieve("sortables")){f.options.container.retrieve("sortables").removeItems(a.panelWrapperEl)}a.removeEvents();a.panelWrapperEl.destroy();if(MUI.Desktop){MUI.Desktop.resizePanels()}var b=$(c).getElements(".panelWrapper");b.each(function(j){j.getElement(".panel").removeClass("bottomPanel")});if(b.length>0){b.getLast().getElement(".panel").addClass("bottomPanel")}g.erase(a.options.id);return true}});MUI.extend({initializeTabs:function(a,b){$(a).setStyle("list-style","none");$(a).getElements("li").each(function(d){var c=d.getFirst("a").addEvent("click",function(f){f.preventDefault()});d.addEvent("click",function(f){MUI.updateContent({element:$(b),url:c.get("href")});MUI.selected(this,a)})})},selected:function(b,a){$(a).getChildren().each(function(c){c.removeClass("selected")});b.addClass("selected")}});MUI.files[MUI.path.source+"Window/Window.js"]="loading";MUI.extend({Windows:{instances:new Hash(),indexLevel:100,windowIDCount:0,windowsVisible:true,focusingWindow:false}});MUI.Windows.windowOptions={id:null,title:"New Window",icon:false,type:"window",require:{css:[],images:[],js:[],onload:null},loadMethod:null,method:"get",contentURL:null,data:null,closeAfter:false,evalScripts:true,evalResponse:false,content:"Window content",toolbar:false,toolbarPosition:"top",toolbarHeight:29,toolbarURL:"pages/lipsum.html",toolbarData:null,toolbarContent:"",toolbarOnload:$empty,toolbar2:false,toolbar2Position:"bottom",toolbar2Height:29,toolbar2URL:"pages/lipsum.html",toolbar2Data:null,toolbar2Content:"",toolbar2Onload:$empty,container:null,restrict:true,shape:"box",collapsible:true,minimizable:true,maximizable:true,closable:true,storeOnClose:false,modalOverlayClose:true,draggable:null,draggableGrid:false,draggableLimit:false,draggableSnap:false,resizable:null,resizeLimit:{x:[250,2500],y:[125,2000]},addClass:"",width:300,height:125,headerHeight:25,footerHeight:25,cornerRadius:8,x:null,y:null,scrollbars:true,padding:{top:10,right:12,bottom:10,left:12},shadowBlur:5,shadowOffset:{x:0,y:1},controlsOffset:{right:6,top:6},useCanvas:true,useCanvasControls:true,useSpinner:true,headerStartColor:[250,250,250],headerStopColor:[229,229,229],bodyBgColor:[229,229,229],minimizeBgColor:[255,255,255],minimizeColor:[0,0,0],maximizeBgColor:[255,255,255],maximizeColor:[0,0,0],closeBgColor:[255,255,255],closeColor:[0,0,0],resizableColor:[254,254,254],onBeforeBuild:$empty,onContentLoaded:$empty,onFocus:$empty,onBlur:$empty,onResize:$empty,onMinimize:$empty,onMaximize:$empty,onRestore:$empty,onClose:$empty,onCloseComplete:$empty};MUI.Windows.windowOptionsOriginal=$merge(MUI.Windows.windowOptions);MUI.Window=new Class({Implements:[Events,Options],options:MUI.Windows.windowOptions,initialize:function(a){this.setOptions(a);var a=this.options;$extend(this,{mochaControlsWidth:0,minimizebuttonX:0,maximizebuttonX:0,closebuttonX:0,headerFooterShadow:a.headerHeight+a.footerHeight+(a.shadowBlur*2),oldTop:0,oldLeft:0,isMaximized:false,isMinimized:false,isCollapsed:false,timestamp:$time()});if(a.type!="window"){a.container=document.body;a.minimizable=false}if(!a.container){a.container=MUI.Desktop&&MUI.Desktop.desktop?MUI.Desktop.desktop:document.body}if(a.resizable==null){if(a.type!="window"||a.shape=="gauge"){a.resizable=false}else{a.resizable=true}}if(a.draggable==null){a.draggable=a.type!="window"?false:true}if(a.shape=="gauge"||a.type=="notification"){a.collapsible=false;a.maximizable=false;a.contentBgColor="transparent";a.scrollbars=false;a.footerHeight=0}if(a.type=="notification"){a.closable=false;a.headerHeight=0}if(MUI.Dock&&$(MUI.options.dock)){if(MUI.Dock.dock&&a.type!="modal"&&a.type!="modal2"){a.minimizable=a.minimizable}}else{a.minimizable=false}a.maximizable=MUI.Desktop&&MUI.Desktop.desktop&&a.maximizable&&a.type!="modal"&&a.type!="modal2";if(this.options.type=="modal2"){this.options.shadowBlur=0;this.options.shadowOffset={x:0,y:0};this.options.useSpinner=false;this.options.useCanvas=false;this.options.footerHeight=0;this.options.headerHeight=0}a.id=a.id||"win"+(++MUI.Windows.windowIDCount);this.windowEl=$(a.id);if(a.require.css.length||a.require.images.length){new MUI.Require({css:a.require.css,images:a.require.images,onload:function(){this.newWindow()}.bind(this)})}else{this.newWindow()}return this},saveValues:function(){var a=this.windowEl.getCoordinates();this.options.x=a.left.toInt();this.options.y=a.top.toInt()},newWindow:function(d){var b=MUI.Windows.instances;var l=MUI.Windows.instances.get(this.options.id);var m=this.options;if(l){var k=l}if(this.windowEl&&!this.isClosing){if(k.isMinimized){MUI.Dock.restoreMinimized(this.windowEl)}else{if(k.isCollapsed){MUI.collapseToggle(this.windowEl);setTimeout(MUI.focusWindow.pass(this.windowEl,this),10)}else{if(this.windowEl.hasClass("windowClosed")){if(k.check){k.check.show()}this.windowEl.removeClass("windowClosed");this.windowEl.setStyle("opacity",0);this.windowEl.addClass("mocha");if(MUI.Dock&&$(MUI.options.dock)&&k.options.type=="window"){var h=$(k.options.id+"_dockTab");if(h!=null){h.show()}MUI.Desktop.setDesktopSize()}k.displayNewWindow()}else{var j=document.getCoordinates();if(this.windowEl.getStyle("left").toInt()>j.width||this.windowEl.getStyle("top").toInt()>j.height){MUI.centerWindow(this.windowEl)}setTimeout(MUI.focusWindow.pass(this.windowEl,this),10);if(MUI.options.standardEffects==true){this.windowEl.shake()}}}}return}else{b.set(m.id,this)}this.isClosing=false;this.fireEvent("onBeforeBuild");MUI.Windows.indexLevel++;this.windowEl=new Element("div",{"class":"mocha",id:m.id,styles:{position:"absolute",width:m.width,height:m.height,display:"block",opacity:0,zIndex:MUI.Windows.indexLevel+=2}});this.windowEl.store("instance",this);this.windowEl.addClass(m.addClass);if(m.type=="modal2"){this.windowEl.addClass("modal2")}if(Browser.Engine.trident&&m.shape=="gauge"){this.windowEl.setStyle("backgroundImage","url(../images/spacer.gif)")}if((this.options.type=="modal"||m.type=="modal2")&&Browser.Platform.mac&&Browser.Engine.gecko){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){var c=new Number(RegExp.$1);if(c<3){this.windowEl.setStyle("position","fixed")}}}if(m.loadMethod=="iframe"){m.padding={top:0,right:0,bottom:0,left:0}}this.insertWindowElements();this.titleEl.set("html",m.title);this.contentWrapperEl.setStyle("overflow","hidden");this.contentEl.setStyles({"padding-top":m.padding.top,"padding-bottom":m.padding.bottom,"padding-left":m.padding.left,"padding-right":m.padding.right});if(m.shape=="gauge"){if(m.useCanvasControls){this.canvasControlsEl.setStyle("visibility","hidden")}else{this.controlsEl.setStyle("visibility","hidden")}this.windowEl.addEvent("mouseover",function(){this.mouseover=true;var n=function(){if(this.mouseover!=false){if(m.useCanvasControls){this.canvasControlsEl.setStyle("visibility","visible")}else{this.controlsEl.setStyle("visibility","visible")}this.canvasHeaderEl.setStyle("visibility","visible");this.titleEl.show()}};n.delay(0,this)}.bind(this));this.windowEl.addEvent("mouseleave",function(){this.mouseover=false;if(this.options.useCanvasControls){this.canvasControlsEl.setStyle("visibility","hidden")}else{this.controlsEl.setStyle("visibility","hidden")}this.canvasHeaderEl.setStyle("visibility","hidden");this.titleEl.hide()}.bind(this))}this.windowEl.inject(m.container);this.setColors();if(m.type!="notification"){this.setMochaControlsWidth()}MUI.updateContent({element:this.windowEl,content:m.content,method:m.method,url:m.contentURL,data:m.data,onContentLoaded:null,require:{js:m.require.js,onload:m.require.onload}});if(this.options.toolbar==true){MUI.updateContent({element:this.windowEl,childElement:this.toolbarEl,content:m.toolbarContent,loadMethod:"xhr",method:m.method,url:m.toolbarURL,data:m.toolbarData,onContentLoaded:m.toolbarOnload})}if(this.options.toolbar2==true){MUI.updateContent({element:this.windowEl,childElement:this.toolbar2El,content:m.toolbar2Content,loadMethod:"xhr",method:m.method,url:m.toolbar2URL,data:m.toolbar2Data,onContentLoaded:m.toolbar2Onload})}this.drawWindow();this.attachDraggable();this.attachResizable();this.setupEvents();if(m.resizable){this.adjustHandles()}if(m.container==document.body||m.container==MUI.Desktop.desktop){var a=window.getSize()}else{var a=$(this.options.container).getSize()}var g,f;if(!m.y){if(MUI.Desktop&&MUI.Desktop.desktop){f=(a.y*0.5)-(this.windowEl.offsetHeight*0.5);if(f<-m.shadowBlur){f=-m.shadowBlur}}else{f=window.getScroll().y+(window.getSize().y*0.5)-(this.windowEl.offsetHeight*0.5);if(f<-m.shadowBlur){f=-m.shadowBlur}}}else{f=m.y-m.shadowBlur}if(this.options.x==null){g=(a.x*0.5)-(this.windowEl.offsetWidth*0.5);if(g<-m.shadowBlur){g=-m.shadowBlur}}else{g=m.x-m.shadowBlur}this.windowEl.setStyles({top:f,left:g});this.opacityMorph=new Fx.Morph(this.windowEl,{duration:350,transition:Fx.Transitions.Sine.easeInOut,onComplete:function(){if(Browser.Engine.trident){this.drawWindow()}}.bind(this)});this.displayNewWindow();this.morph=new Fx.Morph(this.windowEl,{duration:200});this.windowEl.store("morph",this.morph);this.resizeMorph=new Fx.Elements([this.contentWrapperEl,this.windowEl],{duration:400,transition:Fx.Transitions.Sine.easeInOut,onStart:function(){this.resizeAnimation=this.drawWindow.periodical(20,this)}.bind(this),onComplete:function(){$clear(this.resizeAnimation);this.drawWindow();if(this.iframeEl){this.iframeEl.setStyle("visibility","visible")}}.bind(this)});this.windowEl.store("resizeMorph",this.resizeMorph);if($(this.windowEl.id+"LinkCheck")){this.check=new Element("div",{"class":"check",id:this.options.id+"_check"}).inject(this.windowEl.id+"LinkCheck")}if(this.options.closeAfter!=false){MUI.closeWindow.delay(this.options.closeAfter,this,this.windowEl)}if(MUI.Dock&&$(MUI.options.dock)&&this.options.type=="window"){MUI.Dock.createDockTab(this.windowEl)}},displayNewWindow:function(){options=this.options;if(options.type=="modal"||options.type=="modal2"){MUI.currentModal=this.windowEl;if(Browser.Engine.trident4){$("modalFix").show()}$("modalOverlay").show();if(MUI.options.advancedEffects==false){$("modalOverlay").setStyle("opacity",0.6);this.windowEl.setStyles({zIndex:11000,opacity:1})}else{MUI.Modal.modalOverlayCloseMorph.cancel();MUI.Modal.modalOverlayOpenMorph.start({opacity:0.6});this.windowEl.setStyles({zIndex:11000});this.opacityMorph.start({opacity:1})}$$(".dockTab").removeClass("activeDockTab");$$(".mocha").removeClass("isFocused");this.windowEl.addClass("isFocused")}else{if(MUI.options.advancedEffects==false){this.windowEl.setStyle("opacity",1);setTimeout(MUI.focusWindow.pass(this.windowEl,this),10)}else{if(Browser.Engine.trident){this.drawWindow(false)}this.opacityMorph.start({opacity:1});setTimeout(MUI.focusWindow.pass(this.windowEl,this),10)}}},setupEvents:function(){var a=this.windowEl;if(this.closeButtonEl){this.closeButtonEl.addEvent("click",function(b){new Event(b).stop();MUI.closeWindow(a)}.bind(this))}if(this.options.type=="window"){a.addEvent("mousedown",function(b){if(Browser.Engine.trident){new Event(b).stop()}MUI.focusWindow(a);if(a.getStyle("top").toInt()<-this.options.shadowBlur){a.setStyle("top",-this.options.shadowBlur)}}.bind(this))}if(this.minimizeButtonEl){this.minimizeButtonEl.addEvent("click",function(b){new Event(b).stop();MUI.Dock.minimizeWindow(a)}.bind(this))}if(this.maximizeButtonEl){this.maximizeButtonEl.addEvent("click",function(b){new Event(b).stop();if(this.isMaximized){MUI.Desktop.restoreWindow(a)}else{MUI.Desktop.maximizeWindow(a)}}.bind(this))}if(this.options.collapsible==true){this.titleEl.addEvent("selectstart",function(b){b=new Event(b).stop()}.bind(this));if(Browser.Engine.trident){this.titleBarEl.addEvent("mousedown",function(b){this.titleEl.setCapture()}.bind(this));this.titleBarEl.addEvent("mouseup",function(b){this.titleEl.releaseCapture()}.bind(this))}this.titleBarEl.addEvent("dblclick",function(b){b=new Event(b).stop();MUI.collapseToggle(this.windowEl)}.bind(this))}},attachDraggable:function(){var a=this.windowEl;if(!this.options.draggable){return}this.windowDrag=new Drag.Move(a,{handle:this.titleBarEl,container:this.options.restrict==true?$(this.options.container):false,grid:this.options.draggableGrid,limit:this.options.draggableLimit,snap:this.options.draggableSnap,onStart:function(){if(this.options.type!="modal"&&this.options.type!="modal2"){MUI.focusWindow(a);$("windowUnderlay").show()}if(this.iframeEl){if(!Browser.Engine.trident){this.iframeEl.setStyle("visibility","hidden")}else{this.iframeEl.hide()}}}.bind(this),onComplete:function(){if(this.options.type!="modal"&&this.options.type!="modal2"){$("windowUnderlay").hide()}if(this.iframeEl){if(!Browser.Engine.trident){this.iframeEl.setStyle("visibility","visible")}else{this.iframeEl.show()}}this.saveValues()}.bind(this)})},attachResizable:function(){var a=this.windowEl;if(!this.options.resizable){return}this.resizable1=this.windowEl.makeResizable({handle:[this.n,this.ne,this.nw],limit:{y:[function(){return this.windowEl.getStyle("top").toInt()+this.windowEl.getStyle("height").toInt()-this.options.resizeLimit.y[1]}.bind(this),function(){return this.windowEl.getStyle("top").toInt()+this.windowEl.getStyle("height").toInt()-this.options.resizeLimit.y[0]}.bind(this)]},modifiers:{x:false,y:"top"},onStart:function(){this.resizeOnStart();this.coords=this.contentWrapperEl.getCoordinates();this.y2=this.coords.top.toInt()+this.contentWrapperEl.offsetHeight}.bind(this),onDrag:function(){this.coords=this.contentWrapperEl.getCoordinates();this.contentWrapperEl.setStyle("height",this.y2-this.coords.top.toInt());this.resizeOnDrag()}.bind(this),onComplete:function(){this.resizeOnComplete()}.bind(this)});this.resizable2=this.contentWrapperEl.makeResizable({handle:[this.e,this.ne],limit:{x:[this.options.resizeLimit.x[0]-(this.options.shadowBlur*2),this.options.resizeLimit.x[1]-(this.options.shadowBlur*2)]},modifiers:{x:"width",y:false},onStart:function(){this.resizeOnStart()}.bind(this),onDrag:function(){this.resizeOnDrag()}.bind(this),onComplete:function(){this.resizeOnComplete()}.bind(this)});this.resizable3=this.contentWrapperEl.makeResizable({container:this.options.restrict==true?$(this.options.container):false,handle:this.se,limit:{x:[this.options.resizeLimit.x[0]-(this.options.shadowBlur*2),this.options.resizeLimit.x[1]-(this.options.shadowBlur*2)],y:[this.options.resizeLimit.y[0]-this.headerFooterShadow,this.options.resizeLimit.y[1]-this.headerFooterShadow]},modifiers:{x:"width",y:"height"},onStart:function(){this.resizeOnStart()}.bind(this),onDrag:function(){this.resizeOnDrag()}.bind(this),onComplete:function(){this.resizeOnComplete()}.bind(this)});this.resizable4=this.contentWrapperEl.makeResizable({handle:[this.s,this.sw],limit:{y:[this.options.resizeLimit.y[0]-this.headerFooterShadow,this.options.resizeLimit.y[1]-this.headerFooterShadow]},modifiers:{x:false,y:"height"},onStart:function(){this.resizeOnStart()}.bind(this),onDrag:function(){this.resizeOnDrag()}.bind(this),onComplete:function(){this.resizeOnComplete()}.bind(this)});this.resizable5=this.windowEl.makeResizable({handle:[this.w,this.sw,this.nw],limit:{x:[function(){return this.windowEl.getStyle("left").toInt()+this.windowEl.getStyle("width").toInt()-this.options.resizeLimit.x[1]}.bind(this),function(){return this.windowEl.getStyle("left").toInt()+this.windowEl.getStyle("width").toInt()-this.options.resizeLimit.x[0]}.bind(this)]},modifiers:{x:"left",y:false},onStart:function(){this.resizeOnStart();this.coords=this.contentWrapperEl.getCoordinates();this.x2=this.coords.left.toInt()+this.contentWrapperEl.offsetWidth}.bind(this),onDrag:function(){this.coords=this.contentWrapperEl.getCoordinates();this.contentWrapperEl.setStyle("width",this.x2-this.coords.left.toInt());this.resizeOnDrag()}.bind(this),onComplete:function(){this.resizeOnComplete()}.bind(this)})},resizeOnStart:function(){$("windowUnderlay").show();if(this.iframeEl){if(!Browser.Engine.trident){this.iframeEl.setStyle("visibility","hidden")}else{this.iframeEl.hide()}}},resizeOnDrag:function(){if(Browser.Engine.gecko){this.windowEl.getElements(".panel").each(function(a){a.store("oldOverflow",a.getStyle("overflow"));a.setStyle("overflow","visible")})}this.drawWindow();this.adjustHandles();if(Browser.Engine.gecko){this.windowEl.getElements(".panel").each(function(a){a.setStyle("overflow",a.retrieve("oldOverflow"))})}},resizeOnComplete:function(){$("windowUnderlay").hide();if(this.iframeEl){if(!Browser.Engine.trident){this.iframeEl.setStyle("visibility","visible")}else{this.iframeEl.show();this.iframeEl.setStyle("width","99%");this.iframeEl.setStyle("height",this.contentWrapperEl.offsetHeight);this.iframeEl.setStyle("width","100%");this.iframeEl.setStyle("height",this.contentWrapperEl.offsetHeight)}}if(this.contentWrapperEl.getChildren(".column")!=null){MUI.rWidth(this.contentWrapperEl);this.contentWrapperEl.getChildren(".column").each(function(a){MUI.panelHeight(a)})}this.fireEvent("onResize",this.windowEl)},adjustHandles:function(){var d=this.options.shadowBlur;var k=d*2;var l=this.options.shadowOffset;var f=d-l.y-1;var h=d+l.x-1;var a=d+l.y-1;var c=d-l.x-1;var g=this.windowEl.getCoordinates();var b=g.width-k+2;var j=g.height-k+2;this.n.setStyles({top:f,left:c+10,width:b-20});this.e.setStyles({top:f+10,right:h,height:j-30});this.s.setStyles({bottom:a,left:c+10,width:b-30});this.w.setStyles({top:f+10,left:c,height:j-20});this.ne.setStyles({top:f,right:h});this.se.setStyles({bottom:a,right:h});this.sw.setStyles({bottom:a,left:c});this.nw.setStyles({top:f,left:c})},detachResizable:function(){this.resizable1.detach();this.resizable2.detach();this.resizable3.detach();this.resizable4.detach();this.resizable5.detach();this.windowEl.getElements(".handle").hide()},reattachResizable:function(){this.resizable1.attach();this.resizable2.attach();this.resizable3.attach();this.resizable4.attach();this.resizable5.attach();this.windowEl.getElements(".handle").show()},insertWindowElements:function(){var d=this.options;var a=d.height;var f=d.width;var h=d.id;var b={};if(Browser.Engine.trident4){b.zIndexFixEl=new Element("iframe",{id:h+"_zIndexFix","class":"zIndexFix",scrolling:"no",marginWidth:0,marginHeight:0,src:"",styles:{position:"absolute"}}).inject(this.windowEl)}b.overlayEl=new Element("div",{id:h+"_overlay","class":"mochaOverlay",styles:{position:"absolute",top:0,left:0}}).inject(this.windowEl);b.titleBarEl=new Element("div",{id:h+"_titleBar","class":"mochaTitlebar",styles:{cursor:d.draggable?"move":"default"}}).inject(b.overlayEl,"top");b.titleEl=new Element("h3",{id:h+"_title","class":"mochaTitle"}).inject(b.titleBarEl);if(d.icon!=false){b.titleEl.setStyles({"padding-left":28,background:"url("+d.icon+") 5px 4px no-repeat"})}b.contentBorderEl=new Element("div",{id:h+"_contentBorder","class":"mochaContentBorder"}).inject(b.overlayEl);if(d.toolbar){b.toolbarWrapperEl=new Element("div",{id:h+"_toolbarWrapper","class":"mochaToolbarWrapper",styles:{height:d.toolbarHeight}}).inject(b.contentBorderEl,d.toolbarPosition=="bottom"?"after":"before");if(d.toolbarPosition=="bottom"){b.toolbarWrapperEl.addClass("bottom")}b.toolbarEl=new Element("div",{id:h+"_toolbar","class":"mochaToolbar",styles:{height:d.toolbarHeight}}).inject(b.toolbarWrapperEl)}if(d.toolbar2){b.toolbar2WrapperEl=new Element("div",{id:h+"_toolbar2Wrapper","class":"mochaToolbarWrapper",styles:{height:d.toolbar2Height}}).inject(b.contentBorderEl,d.toolbar2Position=="bottom"?"after":"before");if(d.toolbar2Position=="bottom"){b.toolbar2WrapperEl.addClass("bottom")}b.toolbar2El=new Element("div",{id:h+"_toolbar2","class":"mochaToolbar",styles:{height:d.toolbar2Height}}).inject(b.toolbar2WrapperEl)}var g={id:h+"_contentWrapper","class":"mochaContentWrapper",styles:{width:f+"px",height:a+"px"}};b.contentWrapperEl=new Element("div",g);b.contentWrapperEl.inject(b.contentBorderEl);if(this.options.shape=="gauge"){b.contentBorderEl.setStyle("borderWidth",0)}b.contentEl=new Element("div",{id:h+"_content","class":"mochaContent"}).inject(b.contentWrapperEl);if(this.options.useCanvas==true&&Browser.Engine.trident!=true){b.canvasEl=new Element("canvas",{id:h+"_canvas","class":"mochaCanvas",width:10,height:10}).inject(this.windowEl)}if(this.options.useCanvas==true&&Browser.Engine.trident){b.canvasEl=new Element("canvas",{id:h+"_canvas","class":"mochaCanvas",width:50000,height:20000,styles:{position:"absolute",top:0,left:0}}).inject(this.windowEl);if(MUI.ieSupport=="excanvas"){G_vmlCanvasManager.initElement(b.canvasEl);b.canvasEl=this.windowEl.getElement(".mochaCanvas")}}b.controlsEl=new Element("div",{id:h+"_controls","class":"mochaControls"}).inject(b.overlayEl,"after");if(d.useCanvasControls==true){b.canvasControlsEl=new Element("canvas",{id:h+"_canvasControls","class":"mochaCanvasControls",width:14,height:14}).inject(this.windowEl);if(Browser.Engine.trident&&MUI.ieSupport=="excanvas"){G_vmlCanvasManager.initElement(b.canvasControlsEl);b.canvasControlsEl=this.windowEl.getElement(".mochaCanvasControls")}}if(d.closable){b.closeButtonEl=new Element("div",{id:h+"_closeButton","class":"mochaCloseButton mochaWindowButton",title:"Close"}).inject(b.controlsEl)}if(d.maximizable){b.maximizeButtonEl=new Element("div",{id:h+"_maximizeButton","class":"mochaMaximizeButton mochaWindowButton",title:"Maximize"}).inject(b.controlsEl)}if(d.minimizable){b.minimizeButtonEl=new Element("div",{id:h+"_minimizeButton","class":"mochaMinimizeButton mochaWindowButton",title:"Minimize"}).inject(b.controlsEl)}if(d.useSpinner==true&&d.shape!="gauge"&&d.type!="notification"){b.spinnerEl=new Element("div",{id:h+"_spinner","class":"mochaSpinner",width:16,height:16}).inject(this.windowEl,"bottom")}if(this.options.shape=="gauge"){b.canvasHeaderEl=new Element("canvas",{id:h+"_canvasHeader","class":"mochaCanvasHeader",width:this.options.width,height:26}).inject(this.windowEl,"bottom");if(Browser.Engine.trident&&MUI.ieSupport=="excanvas"){G_vmlCanvasManager.initElement(b.canvasHeaderEl);b.canvasHeaderEl=this.windowEl.getElement(".mochaCanvasHeader")}}if(Browser.Engine.trident){b.overlayEl.setStyle("zIndex",2)}if(Browser.Platform.mac&&Browser.Engine.gecko){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){var c=new Number(RegExp.$1);if(c<3){b.overlayEl.setStyle("overflow","auto")}}}if(d.resizable){b.n=new Element("div",{id:h+"_resizeHandle_n","class":"handle",styles:{top:0,left:10,cursor:"n-resize"}}).inject(b.overlayEl,"after");b.ne=new Element("div",{id:h+"_resizeHandle_ne","class":"handle corner",styles:{top:0,right:0,cursor:"ne-resize"}}).inject(b.overlayEl,"after");b.e=new Element("div",{id:h+"_resizeHandle_e","class":"handle",styles:{top:10,right:0,cursor:"e-resize"}}).inject(b.overlayEl,"after");b.se=new Element("div",{id:h+"_resizeHandle_se","class":"handle cornerSE",styles:{bottom:0,right:0,cursor:"se-resize"}}).inject(b.overlayEl,"after");b.s=new Element("div",{id:h+"_resizeHandle_s","class":"handle",styles:{bottom:0,left:10,cursor:"s-resize"}}).inject(b.overlayEl,"after");b.sw=new Element("div",{id:h+"_resizeHandle_sw","class":"handle corner",styles:{bottom:0,left:0,cursor:"sw-resize"}}).inject(b.overlayEl,"after");b.w=new Element("div",{id:h+"_resizeHandle_w","class":"handle",styles:{top:10,left:0,cursor:"w-resize"}}).inject(b.overlayEl,"after");b.nw=new Element("div",{id:h+"_resizeHandle_nw","class":"handle corner",styles:{top:0,left:0,cursor:"nw-resize"}}).inject(b.overlayEl,"after")}$extend(this,b)},setColors:function(){if(this.options.useCanvas==true){var c=/\?(.*?)\)/;if((this.titleBarEl.getStyle("backgroundImage")!="none")&&this.titleBarEl.getStyle("backgroundImage").match(c)){var d=this.titleBarEl.getStyle("backgroundImage");d=d.match(c)[1];d=d.parseQueryString();var a=d.from;var b=d.to.replace(/\"/,"");this.options.headerStartColor=new Color(a);this.options.headerStopColor=new Color(b);this.titleBarEl.addClass("replaced")}else{if(this.titleBarEl.getStyle("background-color")!==""&&this.titleBarEl.getStyle("background-color")!=="transparent"){this.options.headerStartColor=new Color(this.titleBarEl.getStyle("background-color")).mix("#fff",20);this.options.headerStopColor=new Color(this.titleBarEl.getStyle("background-color")).mix("#000",20);this.titleBarEl.addClass("replaced")}}if(this.windowEl.getStyle("background-color")!==""&&this.windowEl.getStyle("background-color")!=="transparent"){this.options.bodyBgColor=new Color(this.windowEl.getStyle("background-color"));this.windowEl.addClass("replaced")}if(this.options.resizable&&this.se.getStyle("background-color")!==""&&this.se.getStyle("background-color")!=="transparent"){this.options.resizableColor=new Color(this.se.getStyle("background-color"));this.se.addClass("replaced")}}if(this.options.useCanvasControls==true){if(this.minimizeButtonEl){if(this.minimizeButtonEl.getStyle("color")!==""&&this.minimizeButtonEl.getStyle("color")!=="transparent"){this.options.minimizeColor=new Color(this.minimizeButtonEl.getStyle("color"))}if(this.minimizeButtonEl.getStyle("background-color")!==""&&this.minimizeButtonEl.getStyle("background-color")!=="transparent"){this.options.minimizeBgColor=new Color(this.minimizeButtonEl.getStyle("background-color"));this.minimizeButtonEl.addClass("replaced")}}if(this.maximizeButtonEl){if(this.maximizeButtonEl.getStyle("color")!==""&&this.maximizeButtonEl.getStyle("color")!=="transparent"){this.options.maximizeColor=new Color(this.maximizeButtonEl.getStyle("color"))}if(this.maximizeButtonEl.getStyle("background-color")!==""&&this.maximizeButtonEl.getStyle("background-color")!=="transparent"){this.options.maximizeBgColor=new Color(this.maximizeButtonEl.getStyle("background-color"));this.maximizeButtonEl.addClass("replaced")}}if(this.closeButtonEl){if(this.closeButtonEl.getStyle("color")!==""&&this.closeButtonEl.getStyle("color")!=="transparent"){this.options.closeColor=new Color(this.closeButtonEl.getStyle("color"))}if(this.closeButtonEl.getStyle("background-color")!==""&&this.closeButtonEl.getStyle("background-color")!=="transparent"){this.options.closeBgColor=new Color(this.closeButtonEl.getStyle("background-color"));this.closeButtonEl.addClass("replaced")}}}},drawWindow:function(b){if(this.drawingWindow==true){return}this.drawingWindow=true;if(this.isCollapsed){this.drawWindowCollapsed(b);return}var h=this.windowEl;var n=this.options;var c=n.shadowBlur;var k=c*2;var m=this.options.shadowOffset;this.overlayEl.setStyles({width:this.contentWrapperEl.offsetWidth});if(this.iframeEl){this.iframeEl.setStyle("height",this.contentWrapperEl.offsetHeight)}var d=this.contentBorderEl.getStyle("border-top").toInt()+this.contentBorderEl.getStyle("border-bottom").toInt();var g=this.toolbarWrapperEl?this.toolbarWrapperEl.getStyle("height").toInt()+this.toolbarWrapperEl.getStyle("border-top").toInt():0;var f=this.toolbar2WrapperEl?this.toolbar2WrapperEl.getStyle("height").toInt()+this.toolbar2WrapperEl.getStyle("border-top").toInt():0;this.headerFooterShadow=n.headerHeight+n.footerHeight+k;var j=this.contentWrapperEl.getStyle("height").toInt()+this.headerFooterShadow+g+f+d;var a=this.contentWrapperEl.getStyle("width").toInt()+k;this.windowEl.setStyles({height:j,width:a});this.overlayEl.setStyles({height:j,top:c-m.y,left:c-m.x});if(this.options.useCanvas==true){if(Browser.Engine.trident){this.canvasEl.height=20000;this.canvasEl.width=50000}this.canvasEl.height=j;this.canvasEl.width=a}if(Browser.Engine.trident4){this.zIndexFixEl.setStyles({width:a,height:j})}this.titleBarEl.setStyles({width:a-k,height:n.headerHeight});if(n.useSpinner==true&&n.shape!="gauge"&&n.type!="notification"){this.spinnerEl.setStyles({left:c-m.x+3,bottom:c+m.y+4})}if(this.options.useCanvas!=false){var l=this.canvasEl.getContext("2d");l.clearRect(0,0,a,j);switch(n.shape){case"box":this.drawBox(l,a,j,c,m,b);break;case"gauge":this.drawGauge(l,a,j,c,m,b);break}if(n.resizable){MUI.triangle(l,a-(c+m.x+17),j-(c+m.y+18),11,11,n.resizableColor,1)}if(Browser.Engine.trident){MUI.triangle(l,0,0,10,10,n.resizableColor,0)}}if(n.type!="notification"&&n.useCanvasControls==true){this.drawControls(a,j,b)}if(MUI.Desktop&&this.contentWrapperEl.getChildren(".column").length!=0){MUI.rWidth(this.contentWrapperEl);this.contentWrapperEl.getChildren(".column").each(function(o){MUI.panelHeight(o)})}this.drawingWindow=false;return this},drawWindowCollapsed:function(b){var f=this.windowEl;var l=this.options;var c=l.shadowBlur;var g=c*2;var k=l.shadowOffset;var d=l.headerHeight+g+2;var h=d;var a=this.contentWrapperEl.getStyle("width").toInt()+g;this.windowEl.setStyle("height",h);this.overlayEl.setStyles({height:h,top:c-k.y,left:c-k.x});if(Browser.Engine.trident4){this.zIndexFixEl.setStyles({width:a,height:h})}this.windowEl.setStyle("width",a);this.overlayEl.setStyle("width",a);this.titleBarEl.setStyles({width:a-g,height:l.headerHeight});if(this.options.useCanvas!=false){this.canvasEl.height=h;this.canvasEl.width=a;var j=this.canvasEl.getContext("2d");j.clearRect(0,0,a,h);this.drawBoxCollapsed(j,a,h,c,k,b);if(l.useCanvasControls==true){this.drawControls(a,h,b)}if(Browser.Engine.trident){MUI.triangle(j,0,0,10,10,l.resizableColor,0)}}this.drawingWindow=false;return this},drawControls:function(h,f,j){var g=this.options;var d=g.shadowBlur;var c=g.shadowOffset;var b=g.controlsOffset;this.controlsEl.setStyles({right:d+c.x+b.right,top:d-c.y+b.top});this.canvasControlsEl.setStyles({right:d+c.x+b.right,top:d-c.y+b.top});this.closebuttonX=g.closable?this.mochaControlsWidth-7:this.mochaControlsWidth+12;this.maximizebuttonX=this.closebuttonX-(g.maximizable?19:0);this.minimizebuttonX=this.maximizebuttonX-(g.minimizable?19:0);var a=this.canvasControlsEl.getContext("2d");a.clearRect(0,0,100,100);if(this.options.closable){this.closebutton(a,this.closebuttonX,7,g.closeBgColor,1,g.closeColor,1)}if(this.options.maximizable){this.maximizebutton(a,this.maximizebuttonX,7,g.maximizeBgColor,1,g.maximizeColor,1)}if(this.options.minimizable){this.minimizebutton(a,this.minimizebuttonX,7,g.minimizeBgColor,1,g.minimizeColor,1)}if(Browser.Engine.trident){MUI.circle(a,0,0,3,this.options.resizableColor,0)}},drawBox:function(j,a,h,c,k,b){var l=this.options;var g=c*2;var d=this.options.cornerRadius;if(b!=false){for(var f=0;f<=c;f++){MUI.roundedRect(j,k.x+f,k.y+f,a-(f*2)-k.x,h-(f*2)-k.y,d+(c-f),[0,0,0],f==c?0.29:0.065+(f*0.01))}}this.bodyRoundedRect(j,c-k.x,c-k.y,a-g,h-g,d,l.bodyBgColor);if(this.options.type!="notification"){this.topRoundedRect(j,c-k.x,c-k.y,a-g,l.headerHeight,d,l.headerStartColor,l.headerStopColor)}},drawBoxCollapsed:function(j,a,h,c,k,b){var l=this.options;var g=c*2;var d=l.cornerRadius;if(b!=false){for(var f=0;f<=c;f++){MUI.roundedRect(j,k.x+f,k.y+f,a-(f*2)-k.x,h-(f*2)-k.y,d+(c-f),[0,0,0],f==c?0.3:0.06+(f*0.01))}}this.topRoundedRect2(j,c-k.x,c-k.y,a-g,l.headerHeight+2,d,l.headerStartColor,l.headerStopColor)},drawGauge:function(h,a,g,c,j,b){var k=this.options;var d=(a*0.5)-(c)+16;if(b!=false){for(var f=0;f<=c;f++){MUI.circle(h,a*0.5+j.x,(g+k.headerHeight)*0.5+j.x,(a*0.5)-(f*2)-j.x,[0,0,0],f==c?0.75:0.075+(f*0.04))}}MUI.circle(h,a*0.5-j.x,(g+k.headerHeight)*0.5-j.y,(a*0.5)-c,k.bodyBgColor,1);this.canvasHeaderEl.setStyles({top:c-j.y,left:c-j.x});var h=this.canvasHeaderEl.getContext("2d");h.clearRect(0,0,a,100);h.beginPath();h.lineWidth=24;h.lineCap="round";h.moveTo(13,13);h.lineTo(a-(c*2)-13,13);h.strokeStyle="rgba(0, 0, 0, .65)";h.stroke()},bodyRoundedRect:function(d,c,h,g,b,a,f){d.fillStyle="rgba("+f.join(",")+", 1)";d.beginPath();d.moveTo(c,h+a);d.lineTo(c,h+b-a);d.quadraticCurveTo(c,h+b,c+a,h+b);d.lineTo(c+g-a,h+b);d.quadraticCurveTo(c+g,h+b,c+g,h+b-a);d.lineTo(c+g,h+a);d.quadraticCurveTo(c+g,h,c+g-a,h);d.lineTo(c+a,h);d.quadraticCurveTo(c,h,c,h+a);d.fill()},topRoundedRect:function(k,h,g,a,j,f,c,d){var b=k.createLinearGradient(0,0,0,j);b.addColorStop(0,"rgb("+c.join(",")+")");b.addColorStop(1,"rgb("+d.join(",")+")");k.fillStyle=b;k.beginPath();k.moveTo(h,g);k.lineTo(h,g+j);k.lineTo(h+a,g+j);k.lineTo(h+a,g+f);k.quadraticCurveTo(h+a,g,h+a-f,g);k.lineTo(h+f,g);k.quadraticCurveTo(h,g,h,g+f);k.fill()},topRoundedRect2:function(k,h,g,a,j,f,c,d){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){k.fillStyle="rgba("+d.join(",")+", 1)"}else{var b=k.createLinearGradient(0,this.options.shadowBlur-1,0,j+this.options.shadowBlur+3);b.addColorStop(0,"rgb("+c.join(",")+")");b.addColorStop(1,"rgb("+d.join(",")+")");k.fillStyle=b}k.beginPath();k.moveTo(h,g+f);k.lineTo(h,g+j-f);k.quadraticCurveTo(h,g+j,h+f,g+j);k.lineTo(h+a-f,g+j);k.quadraticCurveTo(h+a,g+j,h+a,g+j-f);k.lineTo(h+a,g+f);k.quadraticCurveTo(h+a,g,h+a-f,g);k.lineTo(h+f,g);k.quadraticCurveTo(h,g,h,g+f);k.fill()},maximizebutton:function(f,c,j,b,h,g,d){f.beginPath();f.arc(c,j,7,0,Math.PI*2,true);f.fillStyle="rgba("+b.join(",")+","+h+")";f.fill();f.strokeStyle="rgba("+g.join(",")+","+d+")";f.lineWidth=2;f.beginPath();f.moveTo(c,j-3.5);f.lineTo(c,j+3.5);f.moveTo(c-3.5,j);f.lineTo(c+3.5,j);f.stroke()},closebutton:function(f,c,j,b,h,g,d){f.beginPath();f.arc(c,j,7,0,Math.PI*2,true);f.fillStyle="rgba("+b.join(",")+","+h+")";f.fill();f.strokeStyle="rgba("+g.join(",")+","+d+")";f.lineWidth=2;f.beginPath();f.moveTo(c-3,j-3);f.lineTo(c+3,j+3);f.moveTo(c+3,j-3);f.lineTo(c-3,j+3);f.stroke()},minimizebutton:function(f,c,j,b,h,g,d){f.beginPath();f.arc(c,j,7,0,Math.PI*2,true);f.fillStyle="rgba("+b.join(",")+","+h+")";f.fill();f.strokeStyle="rgba("+g.join(",")+","+d+")";f.lineWidth=2;f.beginPath();f.moveTo(c-3.5,j);f.lineTo(c+3.5,j);f.stroke()},setMochaControlsWidth:function(){this.mochaControlsWidth=0;var a=this.options;if(a.minimizable){this.mochaControlsWidth+=(this.minimizeButtonEl.getStyle("margin-left").toInt()+this.minimizeButtonEl.getStyle("width").toInt())}if(a.maximizable){this.mochaControlsWidth+=(this.maximizeButtonEl.getStyle("margin-left").toInt()+this.maximizeButtonEl.getStyle("width").toInt())}if(a.closable){this.mochaControlsWidth+=(this.closeButtonEl.getStyle("margin-left").toInt()+this.closeButtonEl.getStyle("width").toInt())}this.controlsEl.setStyle("width",this.mochaControlsWidth);if(a.useCanvasControls==true){this.canvasControlsEl.setProperty("width",this.mochaControlsWidth)}},hideSpinner:function(){if(this.spinnerEl){this.spinnerEl.hide()}return this},showSpinner:function(){if(this.spinnerEl){this.spinnerEl.show()}return this},close:function(){if(!this.isClosing){MUI.closeWindow(this.windowEl)}return this},minimize:function(){MUI.Dock.minimizeWindow(this.windowEl);return this},maximize:function(){if(this.isMinimized){MUI.Dock.restoreMinimized(this.windowEl)}MUI.Desktop.maximizeWindow(this.windowEl);return this},restore:function(){if(this.isMinimized){MUI.Dock.restoreMinimized(this.windowEl)}else{if(this.isMaximized){MUI.Desktop.restoreWindow(this.windowEl)}}return this},resize:function(a){MUI.resizeWindow(this.windowEl,a);return this},center:function(){MUI.centerWindow(this.windowEl);return this},hide:function(){this.windowEl.setStyle("display","none");return this},show:function(){this.windowEl.setStyle("display","block");return this},destroy:function(){MUI.closeWindow(this.windowEl)}});MUI.extend({closeWindow:function(c){var a=c.retrieve("instance");if(c!=$(c)||a.isClosing){return}a.isClosing=true;a.fireEvent("onClose",c);if(a.options.storeOnClose){this.storeOnClose(a,c);return}if(a.check){a.check.destroy()}if((a.options.type=="modal"||a.options.type=="modal2")&&Browser.Engine.trident4){$("modalFix").hide()}if(MUI.options.advancedEffects==false){if(a.options.type=="modal"||a.options.type=="modal2"){$("modalOverlay").setStyle("opacity",0)}MUI.closingJobs(c);return true}else{if(Browser.Engine.trident){a.drawWindow(false)}if(a.options.type=="modal"||a.options.type=="modal2"){MUI.Modal.modalOverlayCloseMorph.start({opacity:0})}var b=new Fx.Morph(c,{duration:120,onComplete:function(){MUI.closingJobs(c);return true}.bind(this)});b.start({opacity:0.4})}},closingJobs:function(f){var d=MUI.Windows.instances;var a=d.get(f.id);f.setStyle("visibility","hidden");if(Browser.Engine.trident){f.dispose()}else{f.destroy()}a.fireEvent("onCloseComplete");if(a.options.type!="notification"){var c=this.getWindowWithHighestZindex();this.focusWindow(c)}d.erase(a.options.id);if(this.loadingWorkspace==true){this.windowUnload()}if(MUI.Dock&&$(MUI.options.dock)&&a.options.type=="window"){var b=$(a.options.id+"_dockTab");if(b!=null){MUI.Dock.dockSortables.removeItems(b).destroy()}MUI.Desktop.setDesktopSize()}},storeOnClose:function(a,d){if(a.check){a.check.hide()}d.setStyles({zIndex:-1});d.addClass("windowClosed");d.removeClass("mocha");if(MUI.Dock&&$(MUI.options.dock)&&a.options.type=="window"){var c=$(a.options.id+"_dockTab");if(c!=null){c.hide()}MUI.Desktop.setDesktopSize()}a.fireEvent("onCloseComplete");if(a.options.type!="notification"){var b=this.getWindowWithHighestZindex();this.focusWindow(b)}a.isClosing=false},closeAll:function(){$$(".mocha").each(function(a){this.closeWindow(a)}.bind(this))},collapseToggle:function(c){var a=c.retrieve("instance");var b=c.getElements(".handle");if(a.isMaximized==true){return}if(a.isCollapsed==false){a.isCollapsed=true;b.hide();if(a.iframeEl){a.iframeEl.setStyle("visibility","hidden")}a.contentBorderEl.setStyles({visibility:"hidden",position:"absolute",top:-10000,left:-10000});if(a.toolbarWrapperEl){a.toolbarWrapperEl.setStyles({visibility:"hidden",position:"absolute",top:-10000,left:-10000})}a.drawWindowCollapsed()}else{a.isCollapsed=false;a.drawWindow();a.contentBorderEl.setStyles({visibility:"visible",position:null,top:null,left:null});if(a.toolbarWrapperEl){a.toolbarWrapperEl.setStyles({visibility:"visible",position:null,top:null,left:null})}if(a.iframeEl){a.iframeEl.setStyle("visibility","visible")}b.show()}},toggleWindowVisibility:function(){MUI.Windows.instances.each(function(a){if(a.options.type=="modal"||a.options.type=="modal2"||a.isMinimized==true){return}var b=$(a.options.id);if(b.getStyle("visibility")=="visible"){if(a.iframe){a.iframeEl.setStyle("visibility","hidden")}if(a.toolbarEl){a.toolbarWrapperEl.setStyle("visibility","hidden")}a.contentBorderEl.setStyle("visibility","hidden");b.setStyle("visibility","hidden");MUI.Windows.windowsVisible=false}else{b.setStyle("visibility","visible");a.contentBorderEl.setStyle("visibility","visible");if(a.iframe){a.iframeEl.setStyle("visibility","visible")}if(a.toolbarEl){a.toolbarWrapperEl.setStyle("visibility","visible")}MUI.Windows.windowsVisible=true}}.bind(this))},focusWindow:function(f,c){MUI.Windows.focusingWindow=true;var b=function(){MUI.Windows.focusingWindow=false};b.delay(170,this);if($$(".mocha").length==0){return}if(f!=$(f)||f.hasClass("isFocused")){return}var d=MUI.Windows.instances;var a=d.get(f.id);if(a.options.type=="notification"){f.setStyle("zIndex",11001);return}MUI.Windows.indexLevel+=2;f.setStyle("zIndex",MUI.Windows.indexLevel);$("windowUnderlay").setStyle("zIndex",MUI.Windows.indexLevel-1).inject($(f),"after");d.each(function(g){if(g.windowEl.hasClass("isFocused")){g.fireEvent("onBlur",g.windowEl)}g.windowEl.removeClass("isFocused")});if(MUI.Dock&&$(MUI.options.dock)&&a.options.type=="window"){MUI.Dock.makeActiveTab()}f.addClass("isFocused");if(c!=false){a.fireEvent("onFocus",f)}},getWindowWithHighestZindex:function(){this.highestZindex=0;$$(".mocha").each(function(a){this.zIndex=a.getStyle("zIndex");if(this.zIndex>=this.highestZindex){this.highestZindex=this.zIndex}}.bind(this));$$(".mocha").each(function(a){if(a.getStyle("zIndex")==this.highestZindex){this.windowWithHighestZindex=a}}.bind(this));return this.windowWithHighestZindex},blurAll:function(){if(MUI.Windows.focusingWindow==false){$$(".mocha").each(function(b){var a=b.retrieve("instance");if(a.options.type!="modal"&&a.options.type!="modal2"){b.removeClass("isFocused")}});$$(".dockTab").removeClass("activeDockTab")}},centerWindow:function(g){if(!g){MUI.Windows.instances.each(function(h){if(h.windowEl.hasClass("isFocused")){g=h.windowEl}})}var a=g.retrieve("instance");var b=a.options;var d=b.container.getCoordinates();var c=window.getScroll().y+(window.getSize().y*0.5)-(g.offsetHeight*0.5);if(c<-a.options.shadowBlur){c=-a.options.shadowBlur}var f=(d.width*0.5)-(g.offsetWidth*0.5);if(f<-a.options.shadowBlur){f=-a.options.shadowBlur}if(MUI.options.advancedEffects==true){a.morph.start({top:c,left:f})}else{g.setStyles({top:c,left:f})}},resizeWindow:function(g,k){var h=g.retrieve("instance");$extend({width:null,height:null,top:null,left:null,centered:true},k);var c=g.getStyle("width").toInt();var j=g.getStyle("height").toInt();var d=g.getStyle("top").toInt();var b=g.getStyle("left").toInt();if(k.centered){var f=typeof(k.top)!="undefined"?k.top:d-((k.height-j)*0.5);var a=typeof(k.left)!="undefined"?k.left:b-((k.width-c)*0.5)}else{var f=typeof(k.top)!="undefined"?k.top:d;var a=typeof(k.left)!="undefined"?k.left:b}if(MUI.options.advancedEffects==false){g.setStyles({top:f,left:a});h.contentWrapperEl.setStyles({height:k.height,width:k.width});h.drawWindow();if(h.iframeEl){if(!Browser.Engine.trident){h.iframeEl.setStyle("visibility","visible")}else{h.iframeEl.show()}}}else{g.retrieve("resizeMorph").start({"0":{height:k.height,width:k.width},"1":{top:f,left:a}})}return h},dynamicResize:function(d){var a=d.retrieve("instance");var c=a.contentWrapperEl;var b=a.contentEl;c.setStyles({height:b.offsetHeight,width:b.offsetWidth});a.drawWindow()}});document.addEvent("keydown",function(a){if(a.key=="q"&&a.control&&a.alt){MUI.toggleWindowVisibility()}});MUI.files[MUI.path.source+"Window/Modal.js"]="loaded";MUI.Modal=new Class({Extends:MUI.Window,options:{type:"modal"},initialize:function(a){if(!$("modalOverlay")){this.modalInitialize();window.addEvent("resize",function(){this.setModalSize()}.bind(this))}this.parent(a)},modalInitialize:function(){var a=new Element("div",{id:"modalOverlay",styles:{height:document.getCoordinates().height,opacity:0.6}}).inject(document.body);a.setStyles({position:Browser.Engine.trident4?"absolute":"fixed"});a.addEvent("click",function(d){var c=MUI.Windows.instances.get(MUI.currentModal.id);if(c.options.modalOverlayClose==true){MUI.closeWindow(MUI.currentModal)}});if(Browser.Engine.trident4){var b=new Element("iframe",{id:"modalFix",scrolling:"no",marginWidth:0,marginHeight:0,src:"",styles:{height:document.getCoordinates().height}}).inject(document.body)}MUI.Modal.modalOverlayOpenMorph=new Fx.Morph($("modalOverlay"),{duration:150});MUI.Modal.modalOverlayCloseMorph=new Fx.Morph($("modalOverlay"),{duration:150,onComplete:function(){$("modalOverlay").hide();if(Browser.Engine.trident4){$("modalFix").hide()}}.bind(this)})},setModalSize:function(){$("modalOverlay").setStyle("height",document.getCoordinates().height);if(Browser.Engine.trident4){$("modalFix").setStyle("height",document.getCoordinates().height)}}});if(Browser.Engine.webkit){MUI.Window.implement({shadowStart:function(c,b,a){c.shadowColor="rgba(0, 0, 0, 0.85)";c.shadowOffsetX=a.x;c.shadowOffsetY=a.y;c.shadowBlur=b},shadowStop:function(a){a.shadowColor="rgba(0,0,0,0)";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0},drawBox:function(g,h,d,c,b,j){var f=c*2;var a=this.options.cornerRadius;if(j!=false){this.shadowStart(g,c,b)}this.bodyRoundedRect(g,c-b.x,c-b.y,h-f,d-f,a,this.options.bodyBgColor);this.shadowStop(g);if(this.options.type!="notification"){this.topRoundedRect(g,c-b.x,c-b.y,h-f,this.options.headerHeight,a,this.options.headerStartColor,this.options.headerStopColor)}},drawBoxCollapsed:function(h,a,g,c,j,b){var k=this.options;var f=c*2;var d=k.cornerRadius;if(b!=false){this.shadowStart(h,c,j)}this.topRoundedRect2(h,c-j.x,c-j.y,a-f,k.headerHeight+2,d,k.headerStartColor,k.headerStopColor);this.shadowStop(h)},drawBoxCollapsed:function(h,a,g,c,j,b){var k=this.options;var f=c*2;var d=k.cornerRadius;if(b!=false){this.shadowStart(h,c,j)}this.topRoundedRect2(h,c-j.x,c-j.y,a-f,k.headerHeight+2,d,k.headerStartColor,k.headerStopColor);this.shadowStop(h)},drawGauge:function(f,h,d,c,b,j){var g=this.options;var a=(h*0.5)-(c)+16;if(j!=false){this.shadowStart(f,c,b)}MUI.circle(f,h*0.5-b.x,(d+g.headerHeight)*0.5-b.y,(h*0.5)-c,g.bodyBgColor,1);this.shadowStop(f);this.canvasHeaderEl.setStyles({top:c-b.y,left:c-b.x});var f=this.canvasHeaderEl.getContext("2d");f.clearRect(0,0,h,100);f.beginPath();f.lineWidth=24;f.lineCap="round";f.moveTo(13,13);f.lineTo(h-(c*2)-13,13);f.strokeStyle="rgba(0, 0, 0, .65)";f.stroke()}})}var ArrayList=new Class({initialize:function(){this.array=new Array()},add:function(a){this.array[this.array.length]=a},addAll:function(b){if(b instanceof Array){for(var a=0;a<b.length;a++){this.add(b[a])}}else{if(b instanceof ArrayList){for(var a=0;a<b.size();a++){this.add(b.get(a))}}}},clear:function(){this.array=new Array()},clone:function(){var a=new ArrayList();this.each(function(c,b){a.add(c)},this);return a},contains:function(b){for(var a=0;a<this.array.length;a++){if(this.array[a]==b){return true}}return false},each:function(c,d){for(var b=0,a=this.size();b<a;b++){c.call(d,this.get(b),b,this)}},equals:function(b){if(!instanceOf(b,ArrayList)){return false}if(b.size()!=this.size()){return false}for(var a=0;a<this.size();a++){if(this.get(a)!=b.get(a)){return false}}return true},get:function(a){return this.array[a]},getLast:function(){return this.get(this.size()-1)},indexOf:function(b){var a=null;this.array.some(function(d,c){if(d.equals(b)){a=c;return true}},this);return a},isEmpty:function(){if(this.size()>0){return false}else{return true}},iterator:function(){return new ArrayListIterator(this)},remove:function(a){var b=this.get(a);if(b){this.array[a]=null;this.array=this.array.clean()}},size:function(){return this.array.length}});var ArrayListIterator=new Class({initialize:function(a){this.arrayList=a;this.index=0},hasNext:function(){return this.index<this.arrayList.size()},next:function(){return this.arrayList.get(this.index++)}});function AssertUtil(){}new AssertUtil();AssertUtil.assertInclude=function(a,b){if(a==null){throw new AssertException("file "+b+" was not included ")}};AssertUtil.assertParamNotNull=function(a,b){if(a==null){throw new IllegalArgumentException("Parameter must not be null: "+b)}};AssertUtil.assertParamIsNotEmpty=function(a,b){AssertUtil.assertParamNotNull(a,b);if(StringUtil.isEmpty(a)){throw new IllegalArgumentException("Parameter must not be empty: "+b)}};AssertUtil.assertIntegerParam=function(b,c){AssertUtil.assertParamNotNull(b,c);var a=parseInt(b,10);if((a==null)||(isNaN(a))){throw new IllegalArgumentException("Invalid Integer Parameter: "+c)}};AssertUtil.assertTrue=function(b,a){if(!b){throw new IllegalArgumentException("Expression: "+a+" evaluated to false.")}};AssertUtil.assertGreaterThanZeroParam=function(b,c){AssertUtil.assertIntegerParam(b,c);var a=parseInt(b,10);if(a<=0){throw new IllegalArgumentException(" assertGreaterThanZeroParam : "+c)}};AssertUtil.assertInstance=function(c,a,b){AssertUtil.assertParamNotNull(c,"param");AssertUtil.assertParamFalse(typeof(a)=="string","Invalid clazz parameter");if(!(c instanceof a)){throw new IllegalArgumentException(" Invalid parameter must be instance of "+b)}};AssertUtil.assertParamInstance=function(c,a,b){if(!(c instanceof a)){throw new IllegalArgumentException(" Invalid parameter must be instance of "+b)}};AssertUtil.assertResultNotNull=function(a,b){if(a==null){throw new AssertException("Invalid result value: "+b)}};AssertUtil.assertParamFalse=function(b,a){if(b){throw new IllegalArgumentException("AssertParamFalse Exception message: "+a)}};AssertUtil.assertMethodExists=function(a,b){AssertUtil.assertParamNotNull(a,"object");if(a[b]==null){throw new AssertException(" Object "+a+" does not have function :"+b)}};AssertUtil.assertMemberState=function(g,b,a,f,d,c){if(d){if(g==null){throw new AssertException(" Member "+b+" must not be null ")}if(!(g instanceof a)){throw new AssertException(" Invalid state "+b+" must be instance of "+f)}}else{if(g!=null){if(!(g instanceof a)){throw new AssertException("Invalid state "+b+" must be instance of "+f)}}}};AssertUtil.assertMemberStateString=function(d,a,c,b){if(c){if(typeof(d)!=typeof(" ")){throw new AssertException(new AssertException("Invalid state "+a+" must be instance of string and not "+typeof(d)))}if(StringUtil.isEmpty(d)){throw new AssertException("AssertException "+a+" must not be empty")}}else{if(d!=null){if(typeof(d)!=typeof(" ")){throw new AssertException("Invalid state "+a+" must be instance string ")}}}};var HashMap=new Class({initialize:function(){this.table=new Array();this.len=8;this.length=0},clear:function(){for(var a=0;a<this.table.length;a++){this.table[a]=null}this.length=0},containsKey:function(b){var d=this.hash(b);var a=this.indexFor(d);var c=this.table[a];while(c!=null){if(c.hash==d&&b.equals(c.key)){return true}c=c.next}return false},containsValue:function(c){if(c==null){return false}var b=this.table;for(var a=0;a<b.length;a++){for(var d=b[a];d!=null;d=d.next){if(c.equals(d.value)){return true}}}return false},each:function(d,f){var c=this.iterator();var a=0;while(c.hasNext()){var b=c.next();d.call(f,b,a,this);a++}},equals:function(f){if(f.size()!=this.size()){return false}for(var b=this.iterator();b.hasNext();){var d=b.next();var a=d.getKey();var c=d.getValue();if(!c.equals(f.get(a))){return false}}return true},get:function(a){if(!a){return null}var b=this.getEntry(a);if(b){return b.value}else{return null}},hashCode:function(){var b=0;for(var a=this.iterator();a.hasNext();){b+=a.next().hashCode()}return b},isEmpty:function(){return this.length==0},iterator:function(){var a=this.table.length;var b=null;while(a>0&&b==null){b=this.table[--a]}return new HashIterator(this.table,a,b)},put:function(c,g){var h=this.hash(c);var a=this.indexFor(h);for(var f=this.table[a];f!=null;f=f.next){if(f.hash==h&&c.equals(f.key)){var b=f.value;f.value=g;return b}}this.addEntry(h,c,g,a);var d=Math.ceil(this.length*1.5);if(d>this.len){this.len=this.len<<1;this.rehash()}return null},putAll:function(d){var a=false;for(var b=d.iterator();b.hasNext();){var c=b.next();if(this.put(c.getKey(),c.getValue())){a=true}}},remove:function(a){var b=this.removeEntryForKey(a);return(b==null?null:b.value)},removeEntryForKey:function(b){var g=this.hash(b);var a=this.indexFor(g);var d=this.table[a];var f=d;while(f!=null){var c=f.next;if(f.hash==g&&b.equals(f.key)){this.length--;if(d.equals(f)){this.table[a]=c}else{d.next=c}return f}d=f;f=c}return f},size:function(){return this.length},toString:function(){return this.getKey()+"="+this.getValue()},addEntry:function(d,b,c,a){this.table[a]=new Entry(d,b,c,this.table[a]);this.length++}.protect(),getEntry:function(b){var d=this.hash(b);var a=this.indexFor(d);var c=this.table[a];while(true){if(c==null){return null}if(c.hash==d&&b.equals(c.key)){return c}c=c.next}},hash:function(a){var b=a.hashCode();return b}.protect(),indexFor:function(b){var a=b&(this.len-1);return a}.protect(),rehash:function(){var a=this.table;this.table=new Array();for(var c=0;c<a.length;c++){var f=a[c];if(f!=null){a[c]=null;do{var d=f.next;var b=this.indexFor(f.hash);f.next=this.table[b];this.table[b]=f;f=d}while(f!=null)}}}.protect()});var Entry=new Class({initialize:function(d,a,c,b){this.value=c;this.next=b;this.key=a;this.hash=d},getKey:function(){return this.key},getValue:function(){return this.value},setValue:function(b){var a=this.value;this.value=b;return a},equals:function(d){var a=d;var g=this.getKey();var c=a.getKey();var f=this.getValue();var b=a.getValue();return(g.equals(c)&&f.equals(b))}});var HashIterator=new Class({initialize:function(c,b,a){this.table=c;this.nextEntry=a;this.index=b;this.current=null},hasNext:function(){return this.nextEntry!=null},next:function(){var c=this.nextEntry;if(c==null){throw"No such Element"}var d=c.next;var b=this.table;var a=this.index;while(d==null&&a>0){d=b[--a]}this.index=a;this.nextEntry=d;this.current=c;return this.current}});var HashSet=new Class({initialize:function(){this.map=new HashMap();this.ZERO=0},add:function(a){this.map.put(a,this.ZERO)==null},addAll:function(c){var a=false;for(var b=c.iterator();b.hasNext();){if(this.add(b.next())){a=true}}return a},clear:function(){this.map.clear()},contains:function(a){return this.map.containsKey(a)},each:function(d,f){var c=this.iterator();var a=0;while(c.hasNext()){var b=c.next();d.call(f,b,a,this);a++}},equals:function(b){if(b.size()!=this.size()){return false}for(var a=this.iterator();a.hasNext();){if(!b.contains(a.next())){return false}}return true},hashCode:function(){var b=0;for(var a=this.iterator();a.hasNext();){b+=a.next().hashCode()}return b},isEmpty:function(){return this.map.isEmpty()},iterator:function(){return new SetIterator(this.map)},remove:function(a){return this.map.remove(a).equals(this.ZERO)},size:function(){return this.map.size()},toArray:function(){var a=new Array();var b=0;for(var c=this.iterator();c.hasNext();){a[b++]=c.next()}return a},hashIterator:function(a){this.it=a}.protect()});var SetIterator=new Class({initialize:function(a){this.mapIterator=a.iterator()},hasNext:function(){return this.mapIterator.hasNext()},next:function(){return this.mapIterator.next().getKey()}});var WebUIException=new Class({Implements:Options,options:{cause:null,description:"Please overwrite this option.",message:"",name:"WebUIException",source:null},initialize:function(a){this.setOptions(a);this.parameters},stackTrace:function(){var a="";if(this.options.cause&&this.options.cause.stackTrace()){a+="\n"+this.options.cause.stackTrace()}return a},getCause:function(){return this.options.cause},getDescription:function(){return this.options.description},getMessage:function(){return this.options.description.substitute(this.parameters)},getName:function(){return this.options.name},getSource:function(){return this.options.source}});var IllegalArgumentException=new Class({Extends:WebUIException,options:{description:"Argument: '{argumentName}' has inappropriate value: '{argumentValue}'.",name:"IllegalArgumentException"},initialize:function(c,b,a){this.parent(a);this.parameters={argumentName:c,argumentValue:b}}});Object.extend({hashCode:function(a){var d=0;var c=a.toString();for(var b=0;b<c.length;b++){d=31*d+c.charCodeAt(b)}return d},isA:function(a,b){var c=typeOf(b);if(c=="string"){var f=b.split("."),d=f.shift();b=window[d];if(!b){return false}while(d=f.shift()){if(!d in b){return false}b=b[d]}c=typeOf(b)}if(["function","class"].contains(c)){return(a instanceof b)}return false},typeMatches:function(a,b){return a.getClass()===b.getClass()},equals:function(a,c){if(!a.typeMatches(c)){return false}if(typeOf(a)=="object"){for(var b in a){if(a[b]!=c[b]){return false}}return true}else{return a.toString()===c.toString()}}});Class.implement({equals:function(a){return this.hashCode()==a.hashCode()},hashCode:function(){var a=Object.hashCode(this.prototype.initialize.$origin);return a}});var JavaObject=new Class({hashCode:function(){return Object.hashCode(this)},typeMatches:function(a){return Object.typeMaches(this,a)},equals:function(a){return Object.equals(this,a)}});Array.implement({equals:function(b){var a=true;this.each(function(d,c){var f=d.equals(b[c]);if(!f){a=false}});return a}});Boolean.implement({parseBoolean:function(booleanString){return eval(booleanString)}});function parseBoolean(a){return new Boolean().parseBoolean(a)}String.implement({compareTo:function(c){if(!this.typeMatches(c)){throw"Type Mismacth!"}var b=this.toString();var a=c.toString();if(b===a){return 0}else{if(b>a){return 1}else{return -1}}},compareToIgnoreCase:function(c){if(!this.typeMatches(c)){throw"Type Mismacth!"}var b=this.toUpperCase();var a=c.toUpperCase();if(b===a){return 0}else{if(b>a){return 1}else{return -1}}},concat:function(a){return new String(this.toString()+a)},endsWith:function(a){return this.substring(this.length-a.length)==a},equals:function(a){return Object.equals(this,a)},equalsIgnoreCase:function(a){if(typeOf(a)!="string"){return false}return this.toUpperCase()===a.toUpperCase()},hashCode:function(){return Object.hashCode(this)},startsWith:function(a){return this.substring(0,a.length)==a},toCharArray:function(){var b=new Array();for(var a=0;a<this.length;a++){b[a]=this.charAt(a)}return b},trim:function(){return this.replace(/(^\s*)|(\s*$)/g,"")},typeMatches:function(a){return typeOf(this)===typeOf(a)}});Number.implement({compareTo:function(a){if(!this.typeMatches(a)){return false}return this-a},equals:function(a){if(!this.typeMatches(a)){return false}return this.toString()==a.toString()},hashCode:function(){return(this)},toBinaryString:function(a){return a.toString(2)},toHexString:function(a){return a.toString(16)}});Date.implement({compareTo:function(d){if(!this.typeMatches(d)){return false}var c=this.getTime();var a=d.getTime();var f=c-a;var b=f&4294967295;return b},equals:function(a){if(!this.typeMatches(a)){return false}return this.getTime()==a.getTime()},hashCode:function(){var b=this.getTime();var c=Number.toHexString(b);var d=0;if(c.length>8){d=parseInt(c.substring(0,c.length-8),16)}var a=b&4294967295;return a^d},typeMatches:function(a){return typeOf(this)===typeOf(a)}});Function.implement({equals:function(a){if(!this.typeMatches(a)){return false}return this===a},typeMatches:function(a){return typeOf(this)===typeOf(a)}});var LinkedHashMap=new Class({Extends:HashMap,initialize:function(){this.parent();this.firstEntry=null;this.lastEntry=null},clear:function(){this.firstEntry=null;this.lastEntry=null;this.parent()},each:function(d,f){var c=this.iterator();var a=0;while(c.hasNext()){var b=c.next();d.call(f,b,a,this);a++}},first:function(){return this.firstEntry.getValue()},firstKey:function(){if(this.length>0){return this.firstEntry.getKey()}else{return null}},iterator:function(){return new LinkedHashIterator(this.firstEntry)},last:function(){return this.lastEntry.getValue()},lastKey:function(){if(this.length>0){return this.lastEntry.getKey()}else{return null}},next:function(a){if(!a){return null}var c=this.getEntry(a);var b=c.getNextEntry();if(b){return b.getValue()}else{return null}},nextKey:function(a){if(!a){return null}var c=this.getEntry(a);var b=c.getNextEntry();if(b){return b.getKey()}else{return null}},previous:function(a){return this.get(this.previousKey(a))},previousKey:function(a){if(!a){return null}var b=this.getEntry(a);return this.findKeyBySerialIndex(b.getSerialIndex()-1)},addEntry:function(f,b,d,a){var c=new LinkedEntry(f,b,d,this.table[a],this.length,this.lastEntry);this.table[a]=c;if(this.firstEntry==null){this.firstEntry=c}if(this.lastEntry){this.lastEntry.setNextEntry(c)}this.lastEntry=c;this.length++}.protect(),findKeyBySerialIndex:function(b){var a=null;this.each(function(d,c){if(d.getSerialIndex()==b){a=d.getKey()}},this);return a}.protect()});var LinkedEntry=new Class({Extends:Entry,initialize:function(g,b,d,c,f,a){this.parent(g,b,d,c);this.nextEntry=null;this.previousEntry=a;this.serialIndex=f},getNextEntry:function(){return this.nextEntry},getSerialIndex:function(){return this.serialIndex},setNextEntry:function(a){this.nextEntry=a}});var LinkedHashIterator=new Class({initialize:function(a){this.currentEntry=a},hasNext:function(){return this.currentEntry!=null},next:function(){var a=this.currentEntry;this.currentEntry=a.getNextEntry();return a}});var OptionsResource=new Class({Implements:[Options],options:{nameSelector:"@name",optionSelector:"option",valueSelector:"@value"},initialize:function(b,a){assertThat(b,not(nil()));this.setOptions(a);this.definitionElement=b;this.optionsAsText="";this.optionsObject},unmarshall:function(){this.unmarshallOptions();this.evaluateOptions()},getOptions:function(){return this.optionsObject},evaluateOptions:function(){this.optionsObject=eval("({"+this.optionsAsText+"})")}.protect(),unmarshallOptions:function(){var a=XmlResource.selectNodes(this.options.optionSelector,this.definitionElement);a.each(function(b,d){if(d>0){this.optionsAsText+=", "}var c=XmlResource.selectNodeText(this.options.nameSelector,b);var f=XmlResource.selectNodeText(this.options.valueSelector,b);this.optionsAsText+=c+" : "+f},this)}.protect()});var RemoteResource=new Class({Extends:Request,options:{async:true,method:"get",nameSpaces:"xmlns:pp='http://www.processpuzzle.com'"},initialize:function(b,a){assertThat(b,not(nil()));this.parent(a);this.options.url=b},isSuccess:function(){try{return(location.protocol==="file:"&&!this.status&&this.status===0&&(this.response.text||this.response.xml))||(this.status>=200&&this.status<300)||(this.status===304)||(this.status===1223)}catch(a){}return false},retrieve:function(){try{this.send(this.options.url)}catch(a){if(a.name=="NS_ERROR_FILE_NOT_FOUND"){this.failure()}else{if(a.name=="Error"){this.failure()}else{throw new a}}}},getUri:function(){return this.options.url},isAsync:function(){return this.options.async}});var RemoteStyleSheet=new Class({Implements:[Options,Events],Binds:["_checker"],options:{delay:100,maxAttempts:1000,idPrefix:"css-preload-"},initialize:function(b,a){this.setOptions(a);this.path=b;this.id=this.options.idPrefix+(new Date().getTime())},getPath:function(){return this.path},getID:function(){return this.id},getElement:function(){return this.link},_onready:function(){var a=[this.getPath(),this.getElement()];this.fireEvent("ready",a)},_onerror:function(){this.link.destroy();this.link=null;var a=[this.getPath()];this.fireEvent("error",a)},_onstart:function(){var a=[this.getPath(),this.getElement()];this.fireEvent("start",a)},createLinkElement:function(){this.link=new Element("link");this.link.type="text/css";this.link.rel="stylesheet";this.link.id=this.getID();this.link.href=this.getPath();return this.link},_checker:function(){if(!this.counter){this.counter=0}var d=$(this.getID());if(d.sheet){var f=document.styleSheets;for(var c=0;c<f.length;c++){var b=f[c];var a=b.ownerNode?b.ownerNode:b.owningElement;if(a&&a.id==this.getID()){this._onready();return}if(this.counter++>this.options.maxAttempts){this._onerror();return}}}this._checker.delay(this.options.delay,this)},start:function(){var b=false;this.link=this.createLinkElement();if(Browser.ie||Browser.opera){this.link.onload=this._onready.bind(this);this.link.onerror=this._onerror.bind(this)}else{b=true}try{document.getElement("head").appendChild(this.link);this._onstart()}catch(a){this._onerror(a)}if(b){try{this._checker()}catch(a){alert(a)}}}});var ResourceUri=new Class({Implements:Options,options:{applyCacheBuster:false,componentName:"ResourceUri",contentType:"xml",documentType:null,documentTypeKey:"documentType"},initialize:function(c,a,b){assertThat(c,not(nil()));this.setOptions(b);this.documentContentUri;this.documentVariables;this.locale=a;this.fullUri=c;this.uri;this.determineStrippedUri();this.determineDocumentContentUri();this.determineDocumentType();this.determineDocumentVariables();if(this.options.applyCacheBuster){this.fullUri=this.appendCacheBusterParameterToUri(this.fullUri)}},appendCacheBusterParameterToUri:function(a){if(a.indexOf("?")==-1){a+="?"}else{a+="&"}a+="cacheBuster=";a+=new Date().getTime();return a},determineLocalizedUri:function(){var a=this.fullUri.indexOf("."+this.options.contentType)>=0?this.fullUri.substring(0,this.fullUri.lastIndexOf("."+this.options.contentType)):this.fullUri;a+="_"+this.locale.getLanguage()+"."+this.options.contentType;return a},isLocal:function(){var a=new URI(this.fullUri);var b=new URI(document.location.href);return a.get("host")==""||a.get("host")==b.get("host")},getDocumentContentUri:function(){return this.documentContentUri},getDocumentType:function(){return this.options.documentType},getDocumentVariables:function(){return this.documentVariables},getUri:function(){return this.uri},determineDocumentContentUri:function(){var givenUri=new URI(this.fullUri);if(givenUri.get("data")&&givenUri.getData("contentUri")){this.documentContentUri=eval(givenUri.getData("contentUri"))}else{this.documentContentUri=null}}.protect(),determineDocumentType:function(){if(!this.options.documentType){var a=new URI(this.fullUri);if(a.get("data")&&a.getData(this.options.documentTypeKey)){this.options.documentType=AbstractDocument.Types[a.getData(this.options.documentTypeKey)]}}}.protect(),determineDocumentVariables:function(){var a=new URI(this.fullUri);if(a.get("data")&&a.getData("documentVariables")){this.documentVariables=a.getData("documentVariables")}else{this.documentVariables=null}}.protect(),determineStrippedUri:function(){if(this.fullUri.indexOf("?")>0){this.uri=this.fullUri.substring(0,this.fullUri.indexOf("?"))}else{this.uri=this.fullUri}}});var StringTokenizer=new Class({Implements:[Options],options:{delimiters:" \t\n\r\f",returnTokens:false},initialize:function(b,a){assertThat(b,not(nil()));this.setOptions(a);this.s=b;this.current=0;if(!this.returnTokens){while((this.current<this.s.length)&&(this.options.delimiters.indexOf(this.s.charAt(this.current))>=0)){this.current++}}if(this.current>=this.s.length){this.moreTokens=false}else{this.moreTokens=true}},countTokens:function(){var a=0;while(this.hasMoreTokens()){a++;this.nextToken()}return a},hasMoreTokens:function(){return this.moreTokens},nextToken:function(c){var d,b,a;if(arguments.length>=1){this.delimiters=delimiters}d=this.current;while((this.current<this.s.length)&&(this.options.delimiters.indexOf(this.s.charAt(this.current))<0)){this.current++}if(this.current==d){this.current++}a=this.current-d;b=this.s.substr(d,a);if(!this.returnTokens){while((this.current<this.s.length)&&(this.options.delimiters.indexOf(this.s.charAt(this.current))>=0)){this.current++}}if(this.current>=this.s.length){this.moreTokens=false}return b}});var TimeOutBehaviour=new Class({Implements:[Options],options:{delay:200,maxTries:20},initialize:function(a){this.setOptions(a);this.checkedProcessName;this.numberOfTries;this.timer},checkTimeOut:function(){this.numberOfTries++;if(this.numberOfTries>=this.options.maxTries){clearInterval(this.timer);this.timeOut(new TimeOutException(this.options.componentName,this.checkedProcessName))}},startTimeOutTimer:function(a){this.checkedProcessName=a;this.numberOfTries=0;this.timer=this.checkTimeOut.periodical(this.options.delay)},stopTimeOutTimer:function(){clearInterval(this.timer)},});var TimeOutException=new Class({Extends:WebUIException,options:{description:"Executing the '{componentName}' element's '{processName}' timed out. See the stack trace for the root cause.",name:"TimeoutException"},initialize:function(a,c,b){this.parent(b);this.parameters={componentName:a,processName:c};this.componentName=a;this.processName=c},getComponentName:function(){return this.componentName},getProcessName:function(){return this.processName},});var UndefinedXmlResourceException=new Class({Extends:WebUIException,options:{description:"Given xml resource: '{resourceName}' doesn't exist or can't be accessed.",name:"UndefinedXmlResourceException"},initialize:function(b,a){this.parent(a);this.parameters={resourceName:b}}});var lastUniqueIdentifier=0;var UniqueId=new Class({initialize:function(a){this.prefix=typeOf(a)=="string"?a:""},generate:function(){lastUniqueIdentifier++;return this.prefix+lastUniqueIdentifier.toString(16-this.prefix.length)}});UniqueId.generate=function(a){var b=new UniqueId(a);return b.generate()};var XPathSelectionException=new Class({Extends:WebUIException,options:{description:"XPath selector: '{selector}' didn't resulted any element of XML: '{xmlResourceUri}'.",name:"XPathSelectionException"},initialize:function(a,c,b){this.parent(b);this.parameters={selector:a,xmlResourceUri:c}}});var XmlResource=new Class({Extends:Request,options:{applyCacheBuster:true,nameSpaces:"xmlns:pp='http://www.processpuzzle.com'",onComplete:function(a){if(a){this.xmlAsText=a;if(this.options.parseOnComplete){this.xmlDoc=Sarissa.getDomDocument();var b=new DOMParser();this.xmlDoc=b.parseFromString(a,"text/xml")}}},onException:function(b,a){},onFailure:function(a){},parseOnComplete:true},initialize:function(b,a){assertThat(b,not(nil()));assertThat(Sarissa.XPATH_INITIALIZED,is(true));if(this.options.applyCacheBuster){this.resourceUri=new ResourceUri(b,null,{applyCacheBuster:true});b=this.resourceUri.getUri()}this.parent(a);this.options.url=b;this.options.method="get";this.options.async=false;this.xmlAsText=null;this.xmlDoc=null;this.refreshResource()},createElement:function(c,b){var a=this.xmlDoc.createElement(c);if(b&&b.text){a.appendChild(this.xmlDoc.createTextNode(b.text))}return a},determineAttributeValue:function(b,a){return XmlResource.determineAttributeValue(b,a)},determineNodeText:function(a){return XmlResource.determineNodeText(a)},injectElement:function(c,d,b){assertThat(c,not(nil()));assertThat(d,not(nil()));var a=this.selectNode(d);if(!a){throw new XPathSelectionException(d,this.options.url)}a.appendChild(c)},isSuccess:function(){try{return !this.status&&location.protocol==="file:"||(this.status>=200&&this.status<300)||this.status===304||this.status===1223||this.status===0}catch(a){}return false},release:function(){this.xmlDoc=null},selectNode:function(a,c){var b=this.selectNodes(a,c);if(b){return b[0]}else{return null}},selectNodes:function(a,f){var c=f!=null?f:this.xmlDoc;var b=null;try{b=c.selectNodes(a);if(typeOf(b)=="collection"){b=Array.from(b)}}catch(d){return null}return b},selectNodeText:function(a,d,b){var c=this.selectNodes(a,d);if(c&&c.length>0&&c[0]){return XmlResource.determineNodeText(c[0])}else{if(b){return b}else{return null}}},refreshResource:function(){try{this.send(this.options.url)}catch(a){throw new UndefinedXmlResourceException(this.options.url)}if(this.options.parseOnComplete&&this.xmlDoc==null){throw new UndefinedXmlResourceException(this.options.url)}if(this.xmlDoc){this.xmlDoc.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'  "+this.options.nameSpaces);this.xmlDoc.setProperty("SelectionLanguage","XPath")}},transform:function(a){},getDocument:function(){return this.xmlDoc},getUri:function(){return this.options.url},getXmlAsText:function(){return this.xmlAsText},isAsync:function(){return this.options.async}});XmlResource.determineAttributeValue=function(c,b,a){var d=c.selectNodes("@"+b);if(d&&d.length==1){return d[0].nodeValue}else{if(a){return a}else{return null}}};XmlResource.determineNodeText=function(c,a){var b=null;if(c){b=Sarissa.getText(c);if(!b){b=a}}return b};XmlResource.selectNode=function(a,b){var c=XmlResource.selectNodes(a,b);if(c){return c[0]}else{return null}};XmlResource.selectNodes=function(a,b){var d=null;try{d=b.selectNodes(a);if(typeOf(d)=="collection"){d=Array.from(d)}}catch(c){log4javascript.getDefaultLogger().debug("Selector: '"+a+"' caused excection: "+c.message);return null}return d};XmlResource.selectNodeText=function(a,d,c,b){var f=XmlResource.selectNode(a,d,c);if(!f&&b){return b}else{return XmlResource.determineNodeText(f,b)}};function TransformXML(d,a){var b=new XmlResource(d);var c=new XmlResource(a);var f=XMLDocument();b.transformNodeToObject(c,f);return f}function XMLTransformator(f,a){var d=new XML();d.load(f);var c=new XSLT(a);var g=new XML();this.getSourceXML=function(){return d};this.getResultXML=function(){return g};this.transform=b;function b(){g=new XML(c.transform(d));return g.getDOM()}}function RemoveWhitespaceNodesFromXML(a){var c=/\S/;for(var b=0;b<a.childNodes.length;b++){if(a.childNodes[b].nodeType==3&&!c.test(a.childNodes[b].nodeValue)){a.removeChild(a.childNodes[b]);b--}else{RemoveWhitespaceNodesFromXML(a.childNodes[b])}}}XmlResource.Positions={Before:0,After:1,FirstChild:2,LastChild:3,Undefined:4};(function(){var b={storage:{},destroy:function(c,d){this.storage[c]=null},store:function(c,d){this.storage[c]=d},retrieve:function(c){return this.storage[c]||null}};Class.Singleton=function(){this.$className=String.uniqueID()};Class.Singleton.prototype.check=function(d){if(!d){d=b}var c=d.retrieve("single:"+this.$className);if(!c){d.store("single:"+this.$className,this)}return c};Class.Singleton.prototype.destroyInstance=function(d){if(!d){d=b}var c=d.retrieve("single:"+this.$className);if(c){d.destroy("single:"+this.$className,this)}};var a=function(c){var d=c.prototype.$className;return d?this.retrieve("single:"+d):null};if(("Element" in this)&&Element.implement){Element.implement({getInstanceOf:a})}Class.getInstanceOf=a.bind(b)}).call(this);var WebUILogger=new Class({Implements:[Class.Singleton,Options],options:{defaultLoggerName:"WebUI"},initialize:function(b,a){return this.check()||this.setUp(b,a)},setUp:function(b,a){this.appenders=new HashMap();this.defaultLogger=null;this.layouts=new HashMap();this.loggers=new HashMap();this.loggerIsConfigured=false;if(b){this.configure(b)}else{this.configureDefaultLogger()}},configure:function(h){for(i=0;i<h.getLoggingLayoutElements().length;i++){var f=h.getLoggingLayoutName(i);var g=this.configureLayout(f,h);this.layouts.put(f,g)}for(i=0;i<h.getLoggingAppenderElements().length;i++){var d=h.getLoggingAppenderName(i);var a=this.configureAppender(d,h);this.appenders.put(d,a)}for(i=0;i<h.getLoggerElements().length;i++){var c=h.getLoggerName(i);var b=this.configureLogger(c,h);this.loggers.put(c,b)}this.determineDefaultLogger();this.loggerIsConfigured=true},configureDefaultLogger:function(){this.defaultLogger=log4javascript.getDefaultLogger()},debug:function(a){this.log(WebUILogger.DEBUG,a)},error:function(a){this.log(WebUILogger.ERROR,a)},fatal:function(a){this.log(WebUILogger.FATAL,a)},group:function(b,a){this.defaultLogger.group(b,a)},groupEnd:function(){this.defaultLogger.groupEnd()},info:function(a){this.log(WebUILogger.INFO,a)},log:function(a,b){if(!this.logLevelIsValid(a)){throw new IllegalArgumentException("logLevel",a)}this.defaultLogger.log(a,b)},tearDown:function(){var b=this.loggers.iterator();while(b.hasNext()){var a=b.next().getValue();a.removeAllAppenders()}this.layouts.clear();this.appenders.clear();this.loggers.clear();this.loggerIsConfigured=false},trace:function(a){this.log(WebUILogger.TRACE,a)},warn:function(a){this.log(WebUILogger.WARN,a)},getAppender:function(a){return this.appenders.get(a)},getAppenders:function(){return this.appenders},getDefaultLogger:function(){return this.defaultLogger},getLayout:function(a){return this.layouts.get(a)},getLayouts:function(){return this.layouts},getLevel:function(){return this.defaultLogger.getLevel()},getLogger:function(a){return this.loggers.get(a)},getLoggers:function(){return this.loggers},getName:function(){return this.options.defaultLoggerName},isConfigured:function(){return this.loggerIsConfigured},configureAppender:function(d,a){var l=null;var g=a.getLoggingAppenderLazyInit(d);var m=a.getLoggingAppenderHeight(d);var k=a.getLoggingAppenderInitiallyMinimized(d);var j=a.getLoggingAppenderUseDocumentWrite(d);var c=a.getLoggingAppenderWidth(d);switch(a.getLoggingAppenderType(d).toUpperCase()){case"WUI:ALERTAPPENDER":l=new log4javascript.AlertAppender();break;case"WUI:AJAXAPPENDER":var b=a.getLoggingAppenderURL(d);l=new log4javascript.AjaxAppender(b);break;case"WUI:BROWSERCONSOLEAPPENDER":l=new log4javascript.BrowserConsoleAppender();break;case"WUI:INPAGEAPPENDER":var f=a.getLoggingAppenderContainerElementId(d);l=new log4javascript.InPageAppender(f,g,k,j,c,m);break;case"WUI:POPUPAPPENDER":var g=a.getLoggingAppenderLazyInit(d);var k=a.getLoggingAppenderInitiallyMinimized(d);var j=a.getLoggingAppenderUseDocumentWrite(d);var c=a.getLoggingAppenderWidth(d);var m=a.getLoggingAppenderHeight(d);l=new log4javascript.PopUpAppender(g,k,j,c,m);break;default:l=new log4javascript.PopUpAppender()}if(this.logLevelValueIsValid(a.getLoggingAppenderThreshold(d))){l.setThreshold(this.parseLevel(a.getLoggingAppenderThreshold(d)))}var h=this.layouts.get(a.getLoggingAppenderLayoutReference(d));l.setLayout(h);return l}.protect(),configureLayout:function(a,d){var b=d.getLoggingLayoutPattern(a);var c=new log4javascript.PatternLayout(b);return c}.protect(),configureLogger:function(b,d){var a=log4javascript.getLogger(b);a.setLevel(this.parseLevel(d.getLoggerLevel(b)));var c=this.appenders.get(d.getLoggingLoggerAppenderReference(b));a.addAppender(c);if(d.getLoggingLoggerIsDefault(b)){this.options.defaultLoggerName=b}return a}.protect(),determineDefaultLogger:function(){if(this.defaultLogger==null){this.defaultLogger=this.getLogger(this.options.defaultLoggerName)}}.protect(),logLevelIsValid:function(a){switch(a){case log4javascript.Level.ALL:return true;case log4javascript.Level.TRACE:return true;case log4javascript.Level.DEBUG:return true;case log4javascript.Level.INFO:return true;case log4javascript.Level.WARN:return true;case log4javascript.Level.ERROR:return true;case log4javascript.Level.FATAL:return true;case log4javascript.Level.NONE:return true;default:return false}}.protect(),logLevelValueIsValid:function(a){if(this.parseLevel(a)!=null){return true}else{return false}}.protect(),parseLevel:function(a){if(typeOf(a)!="string"){return null}switch(a.toUpperCase()){case"ALL":return log4javascript.Level.ALL;case"TRACE":return log4javascript.Level.TRACE;case"DEBUG":return log4javascript.Level.DEBUG;case"INFO":return log4javascript.Level.INFO;case"WARN":return log4javascript.Level.WARN;case"ERROR":return log4javascript.Level.ERROR;case"FATAL":return log4javascript.Level.FATAL;case"NONE":return log4javascript.Level.NONE;default:return null}}.protect()});WebUILogger.ALL=log4javascript.Level.ALL;WebUILogger.TRACE=log4javascript.Level.TRACE;WebUILogger.DEBUG=log4javascript.Level.DEBUG;WebUILogger.INFO=log4javascript.Level.INFO;WebUILogger.WARN=log4javascript.Level.WARN;WebUILogger.ERROR=log4javascript.Level.ERROR;WebUILogger.FATAL=log4javascript.Level.FATAL;WebUILogger.NONE=log4javascript.Level.NONE;var WebUIMessageBus=new Class({Implements:[Class.Singleton,Options],options:{message:"hello"},initialize:function(a){return this.check()||this.setUp(a)},setUp:function(a){this.setOptions(a);this.lastMessage=null;this.subscribersToMessages=new HashMap()}.protect(),notifySubscribers:function(c){this.lastMessage=c;var a=c.getClass();var d=this.getSubscribersToMessage(a);if(d&&d.size()>0){var b;d.each(function(g,f){g(c);b=f},this);return b}else{return null}},subscribeToMessage:function(a,b){var c=this.getSubscribersToMessage(a);if(c==null){c=new ArrayList()}c.add(b);this.subscribersToMessages.put(a.prototype.options.name,c)},writeOffFromMessage:function(a,b){var c=this.getSubscribersToMessage(a);if(c==null){return}c.remove(c.indexOf(b))},tearDown:function(){this.subscribersToMessages.clear()},getLastMessage:function(){return this.lastMessage},getMessageListSize:function(){return this.subscribersToMessages.size()},getSubscribersToMessage:function(a){return this.subscribersToMessages.get(a.prototype.options.name)}});var AbstractDocument=new Class({Implements:[Events,Options],Binds:["attachEditor","detachEditor","determineContainerElement","finalizeConstruction","finalizeDestruction","instantiateEditor","loadDocumentContent","loadResources","onConstructionError","onContainerResize","onDocumentError","onDocumentReady","onEditorAttached","onResourceError","onResourcesLoaded","releaseResources","resetProperties","subscribeToWebUIMessages","webUIMessageHandler"],options:{componentName:"AbstractDocument",contentUriSelector:"contentUri",descriptionSelector:"description",documentContainerId:"DocumentContainer",documentContentExtension:".xml",documentContentUri:null,documentContentNameSpace:"xmlns:pp='http://www.processpuzzle.com'",documentDefinitionNameSpace:"xmlns:sd='http://www.processpuzzle.com/SmartDocument'",documentDefinitionUri:null,documentDefinitionUriSelector:"@documentDefinition",documentEditorClass:"DocumentEditor",documentVariables:null,eventFireDelay:5,handleMenuSelectedEventsDefault:false,handleMenuSelectedEventsSelector:"handleMenuSelectedEvents",nameSelector:"name",resourcesSelector:"resources",rootElementName:"/smartDocumentDefinition",versionSelector:"version"},initialize:function(b,a){this.setOptions(a);this.constructionChain=new Chain();this.containerElement;this.contentUri;this.description;this.destructionChain=new Chain();this.documentContent;this.documentDefinition;this.documentDefinitionUri;this.editor;this.error;this.handleMenuSelectedEvents;this.htmlElementFactory;this.i18Resource=b;this.logger=Class.getInstanceOf(WebUILogger);this.messageBus=Class.getInstanceOf(WebUIMessageBus);this.name;this.resources;this.state=AbstractDocument.States.UNINITIALIZED;this.version;this.loadDocumentDefinition();this.loadDocumentContent();this.state=AbstractDocument.States.INITIALIZED},construct:function(){this.compileConstructionChain();this.constructionChain.callChain()},destroy:function(){this.compileDestructionChain();this.destructionChain.callChain()},onConstructionError:function(a){if(a){this.error=a}this.revertConstruction();this.fireEvent("documentError",this.error)},onContainerResize:function(a){},onDocumentError:function(a){this.error=a;this.revertConstruction();this.fireEvent("documentError",a)},onDocumentReady:function(){this.constructionChain.callChain()},onEditorAttached:function(){this.constructionChain.callChain()},onResourceError:function(a){this.error=a},onResourcesLoaded:function(){if(this.resources.isSuccess()){this.constructionChain.callChain()}else{this.onConstructionError()}},showNotification:function(a){if(this.state==AbstractDocument.States.CONSTRUCTED){var b=new MenuSelectedMessage({originator:this.name,activityType:DesktopWindow.Activity.SHOW_NOTIFICATION,notification:a});this.messageBus.notifySubscribers(b)}},showWindow:function(a){if(this.state==AbstractDocument.States.CONSTRUCTED){var b=new MenuSelectedMessage({originator:this.name,activityType:DesktopWindow.Activity.SHOW_WINDOW,windowName:a});this.messageBus.notifySubscribers(b)}},unmarshall:function(){this.unmarshallProperties();this.unmarshallResources();this.state=AbstractDocument.States.UNMARSHALLED},webUIMessageHandler:function(a){if(this.state!=AbstractDocument.States.CONSTRUCTED){return}if(instanceOf(a,MenuSelectedMessage)&&a.getActivityType()==AbstractDocument.Activity.MODIFY_DOCUMENT){switch(a.getActionType()){case AbstractDocument.Action.ADD_IMAGE:this.editor.textAddImage();break;case AbstractDocument.Action.ADD_LINK:this.editor.textAddLink();break;case AbstractDocument.Action.ALIGN_CENTER:this.editor.textAlignCenter();break;case AbstractDocument.Action.ALIGN_LEFT:this.editor.textAlignLeft();break;case AbstractDocument.Action.ALIGN_JUSTIFY:this.editor.textAlignJustify();break;case AbstractDocument.Action.ALIGN_RIGHT:this.editor.textAlignRight();break;case AbstractDocument.Action.BOLD:this.editor.textBold();break;case AbstractDocument.Action.INDENT:this.editor.textIndent();break;case AbstractDocument.Action.ITALIC:this.editor.textItalic();break;case AbstractDocument.Action.ORDERED_LIST:this.editor.textOrderedList();break;case AbstractDocument.Action.OUTDENT:this.editor.textOutdent();break;case AbstractDocument.Action.REDO:this.editor.textRedo();break;case AbstractDocument.Action.REMOVE_LINK:this.editor.textRemoveLink();break;case AbstractDocument.Action.STRIKETHROUGH:this.editor.textStrikethrough();break;case AbstractDocument.Action.TOGGLE_VIEW:this.editor.textToggleView();break;case AbstractDocument.Action.UNDERLINE:this.editor.textUnderline();break;case AbstractDocument.Action.UNDO:this.editor.textUndo();break;case AbstractDocument.Action.UNORDERED_LIST:this.editor.textUnorderedList();break}}this.lastHandledMessage=a},getContainerElement:function(){return this.containerElement},getDescription:function(){return this.description},getDocumentContent:function(){return this.documentContent},getDocumentContentUri:function(){return this.options.documentContentUr},getDocumentDefinition:function(){return this.documentDefinition},getDocumentDefinitionUri:function(){return this.options.documentDefinitionUri},getEditor:function(){return this.editor},getError:function(){return this.error},getHandleMenuSelectedEvents:function(){return this.handleMenuSelectedEvents},getHtmlElementFactory:function(){return this.htmlElementFactory},getLogger:function(){return this.logger},getMessageBus:function(){return this.messageBus},getName:function(){return this.name},getResources:function(){return this.resources},getState:function(){return this.state},getVersion:function(){return this.version},isSuccess:function(){return this.error==null},attachEditor:function(){this.editor.attach(this.containerElement)}.protect(),compileConstructionChain:function(){this.constructionChain.chain(this.determineContainerElement,this.instantiateEditor,this.attachEditor,this.subscribeToWebUIMessages,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.releseResource,this.detachEditor,this.resetProperties,this.finalizeDestruction)}.protect(),detachEditor:function(){if(this.editor){this.editor.detach()}this.destructionChain.callChain()}.protect(),determineContainerElement:function(){this.containerElement=$(this.options.documentContainerId);this.htmlElementFactory=new WidgetElementFactory(this.containerElement,this.i18Resource);this.constructionChain.callChain()}.protect(),finalizeConstruction:function(){this.state=AbstractDocument.States.CONSTRUCTED;this.fireEvent("documentReady",this,this.options.eventFireDelay)}.protect(),finalizeDestruction:function(){this.constructionChain.clearChain();this.destructionChain.clearChain();this.state=AbstractDocument.States.INITIALIZED;this.fireEvent("documentDestroyed",this)}.protect(),instantiateEditor:function(){var editorClass=eval(this.options.documentEditorClass);this.editor=new editorClass(this.i18Resource,{onEditorAttached:this.onEditorAttached});this.constructionChain.callChain()}.protect(),loadDocumentContent:function(){if(this.options.documentContentUri){try{var a=new ResourceUri(this.options.documentContentUri,this.i18Resource.getLocale(),{contentType:this.options.documentContentExtension.substring(1)});this.documentContent=new XmlResource(a.determineLocalizedUri())}catch(b){try{this.documentContent=new XmlResource(this.options.documentContentUri)}catch(b){throw new IllegalArgumentException("SmartDocument.options.documentContentUri",this.options.documentContentUri)}}}else{this.options.documentContentUri=this.options.documentDefinitionUri.substring(0,this.options.documentDefinitionUri.lastIndexOf(".xml"));try{this.documentContent=new XmlResource(this.options.documentContentUri+"_"+this.i18Resource.getLocale().getLanguage()+this.options.documentContentExtension)}catch(b){this.logger.trace("Content of "+this.name+" document couldn't be loaded.")}}}.protect(),loadDocumentDefinition:function(){if(this.options.documentDefinitionUri){this.documentDefinition=new XmlResource(this.options.documentDefinitionUri)}else{throw new IllegalArgumentException("SmartDocument.options.documentDefinitionUri",this.options.documentDefinitionUri)}}.protect(),loadResources:function(){if(this.resources){this.resources.load()}else{this.constructionChain.callChain()}}.protect(),releaseResources:function(){if(this.resources){this.resources.release()}this.destructionChain.callChain()}.protect(),resetProperties:function(){this.description=null;this.options.documentContentUri=null;this.options.documentDefinitionUri=null;this.editor=null;this.name=null;this.version=null;this.destructionChain.callChain()}.protect(),revertConstruction:function(){if(this.editor){this.editor.destroy()}this.resetProperties();this.state=AbstractDocument.States.INITIALIZED}.protect(),subscribeToWebUIMessages:function(){if(this.handleMenuSelectedEvents){this.logger.debug(this.options.componentName+".subscribeToWebUIMessages() started.");this.messageBus.subscribeToMessage(MenuSelectedMessage,this.webUIMessageHandler)}this.constructionChain.callChain()}.protect(),unmarshallProperties:function(){this.description=this.documentDefinition.selectNodeText(this.options.rootElementName+"/"+this.options.descriptionSelector);this.handleMenuSelectedEvents=parseBoolean(this.documentDefinition.selectNodeText(this.options.rootElementName+"/"+this.options.handleMenuSelectedEventsSelector,null,this.options.handleMenuSelectedEventsDefault));this.name=this.documentDefinition.selectNodeText(this.options.rootElementName+"/"+this.options.nameSelector);this.version=this.documentDefinition.selectNodeText(this.options.rootElementName+"/"+this.options.versionSelector);this.contentUri=this.documentDefinition.selectNodeText(this.options.rootElementName+"/"+this.options.contentUriSelector)}.protect(),unmarshallResources:function(){var a=this.documentDefinition.selectNode(this.options.rootElementName+"/"+this.options.resourcesSelector);if(a){this.resources=new ResourceManager(a,{onResourcesLoaded:this.onResourcesLoaded,onResourceError:this.onResourceError});this.resources.unmarshall()}}.protect()});AbstractDocument.States={UNINITIALIZED:0,INITIALIZED:1,UNMARSHALLED:2,CONSTRUCTED:3};AbstractDocument.Types={HTML:"StaticHtml",SMART:"SmartDocument",REMOTE_RESOURCE:"RemoteResource"};AbstractDocument.Activity={LOAD_DOCUMENT:"loadDocument",MODIFY_DOCUMENT:"modifyDocument"};AbstractDocument.Action={BOLD:"bold",ITALIC:"italic",UNDERLINE:"underline",STRIKETHROUGH:"strikethrough",UNORDERED_LIST:"unorderedList",ORDERED_LIST:"orderedList",INDENT:"indent",OUTDENT:"outdent",ALIGN_LEFT:"alignLeft",ALIGN_CENTER:"alighCenter",ALIGN_RIGHT:"alignRight",ALIGN_JUSTIFY:"alignJustify",UNDO:"undo",REDO:"redo",ADD_LINK:"addLink",REMOVE_LINK:"removeLink",ADD_IMAGE:"addImage",TOGGLE_VIEW:"toggleView"};var WebUIMessage=new Class({Implements:Options,options:{activityType:null,actionType:null,description:"Generic Browser Interface message. Normally this message should be overwritten by subclasses.",isDefault:false,messageClass:null,messageResource:null,name:"WebUIMessage",originator:null},initialize:function(a){this.setOptions(a)},destroy:function(){this.options.activityType=null;this.options.actionType=null},unmarshall:function(){if(this.options.messageResource){this.unmarshallProperties()}},getActionType:function(){return this.options.actionType},getActivityType:function(){return this.options.activityType},getClass:function(){return this.options.messageClass},getDescription:function(){return this.options.description},getMessageProperties:function(){return this.messageProperties},getName:function(){return this.options.name},getOptions:function(){return this.options},getOriginator:function(){return this.options.originator},isDefault:function(){return this.options.isDefault},unmarshallProperties:function(){var messageText=XmlResource.determineNodeText(this.options.messageResource);var messageProperties=messageText?eval("("+messageText+")"):{};this.setOptions(messageProperties)}.protect()});var DocumentSelectedMessage=new Class({Extends:WebUIMessage,options:{actionType:null,activityType:null,description:"A message about the event that a SmartDocument of RemoteResource was selected.",documentContentURI:null,documentType:AbstractDocument.Types.SMART,documentURI:null,name:"DocumentSelectedMessage",notification:null,windowName:null},initialize:function(a){this.setOptions(a);this.options.messageClass=DocumentSelectedMessage},getActionType:function(){return this.options.actionType},getActivityType:function(){return this.options.activityType},getContextItemId:function(){return this.options.contextItemId},getDocumentContentURI:function(){return this.options.documentContentURI},getDocumentType:function(){return this.options.documentType},getDocumentURI:function(){return this.options.documentURI},getNotification:function(){return this.options.notification},getWindowName:function(){return this.options.windowName}});var BrowserWidget=new Class({Implements:[Events,Options],Binds:["broadcastConstructedMessage","destroyChildHtmlElements","finalizeConstruction","finalizeDestruction","webUIMessageHandler"],options:{componentName:"BrowserWidget",dataXmlNameSpace:"xmlns:pp='http://www.processpuzzle.com'",definitionXmlNameSpace:"xmlns:pp='http://www.processpuzzle.com'",descriptionSelector:"//pp:widgetDefinition/description",domDocument:this.document,eventDeliveryDelay:5,nameSelector:"//pp:widgetDefinition/name",optionsSelector:"//pp:widgetDefinition/options",subscribeToWebUIMessages:false,useLocalizedData:false,widgetContainerId:"widgetContainer",widgetDataURI:null,widgetDefinitionURI:null,widgetVersionSelector:"//pp:widgetDefinition/version"},initialize:function(a,c,b){this.setOptions(a);this.componentStateManager;this.constructionChain=new Chain();this.containerElement;this.dataXml;this.definitionXml;this.description;this.destructionChain=new Chain();this.elementFactory=null;this.error;this.givenOptions=a;this.i18Resource=null;this.lastHandledMessage=null;this.locale;this.logger;this.messageBus;this.name;this.state;this.stateSpecification;this.widgetVersion;this.webUIController=null;this.deduceInitializationArguments(a,c);this.containerElement=document.id($(this.options.widgetContainerId));this.configureComponentStateManager();this.configureLogger();this.configureMessageBus();this.loadWidgetDefinition();this.loadWidgetData();assertThat(this.i18Resource,not(nil()));if(this.containerElement==null){throw new IllegalArgumentException("Parameter 'widgetContainerId' in invalid.")}if(!this.i18Resource.isLoaded){throw new IllegalArgumentException("ResourceBundle should be already loaded.")}this.elementFactory=new WidgetElementFactory(this.containerElement,this.i18Resource,b);this.restoreComponentState();this.state=BrowserWidget.States.INITIALIZED},construct:function(){if(this.state<BrowserWidget.States.CONSTRUCTED){this.compileConstructionChain();this.constructionChain.callChain()}return this},destroy:function(){if(this.state==BrowserWidget.States.CONSTRUCTED){this.compileDestructionChain();this.destructionChain.callChain()}},getText:function(a){var c=null;try{c=this.i18Resource.getText(a)}catch(b){c=a}return c},removeChild:function(c,b){var a=b==undefined?this.containerElement:b;if(a!=null&&c!=null){a.removeChild(c)}},restoreComponentState:function(){this.stateSpecification=this.componentStateManager.retrieveComponentState(this.options.componentName);this.parseStateSpecification()},storeComponentState:function(){this.compileStateSpecification();this.componentStateManager.storeComponentState(this.options.componentName,this.stateSpecification)}.protect(),unmarshall:function(){this.unmarshallProperties();this.unmarshallOptions();this.state=BrowserWidget.States.UNMARSHALLED;return this},updateText:function(c,d,b){var a=c.findElementById(c,d);a.set("text",this.getText(b))},webUIMessageHandler:function(a){if(a.getOriginator()==this.options.componentName){return}if(this.state!=BrowserWidget.States.CONSTRUCTED){throw new UnconfiguredWidgetException({source:"BrowserWidget.webUIMessageHandler()"})}this.lastHandledMessage=a},getContainerElement:function(){return this.containerElement},getDataXml:function(){return this.dataXml},getDefinitionXml:function(){return this.definitionXml},getDescription:function(){return this.description},getElementFactory:function(){return this.elementFactory},getHtmlDOMDocument:function(){return this.options.domDocument},getLastMessage:function(){return this.lastHandledMessage},getLocale:function(){return this.locale},getLogger:function(){return this.logger},getMessageBus:function(){return this.messageBus},getName:function(){return this.name},getResourceBundle:function(){return this.i18Resource},getState:function(){return this.state},broadcastConstructedMessage:function(){var a=new WidgetConstuctedMessage({originator:this.options.componentName});this.messageBus.notifySubscribers(a)}.protect(),compileConstructionChain:function(){this.constructionChain.chain(this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyChildHtmlElements,this.finalizeDestruction)}.protect(),compileStateSpecification:function(){}.protect(),configureComponentStateManager:function(){if(this.webUIController==null){this.componentStateManager=Class.getInstanceOf(ComponentStateManager)}else{this.componentStateManager=this.webUIController.getStateManager()}}.protect(),configureLogger:function(){if(this.webUIController==null){this.logger=Class.getInstanceOf(WebUILogger);if(this.logger==null){this.logger=new WebUILogger()}}else{this.logger=this.webUIController.getLogger()}}.protect(),configureMessageBus:function(){if(this.webUIController==null){this.messageBus=Class.getInstanceOf(WebUIMessageBus)}else{this.messageBus=this.webUIController.getMessageBus()}this.subscribeToWebUIMessages()}.protect(),deduceInitializationArguments:function(a,b){if(b){this.i18Resource=b;this.locale=b.getLocale()}else{this.webUIController=Class.getInstanceOf(WebUIController);this.i18Resource=this.webUIController.getResourceBundle();this.locale=this.webUIController.getCurrentLocale()}}.protect(),destroyChildHtmlElements:function(){this.containerElement=document.id(this.containerElement);this.containerElement.getElements("*").each(function(b,a){if(b.removeEvents){b.removeEvents()}if(b.destroy){b.destroy()}});this.destructionChain.callChain()}.protect(),finalizeConstruction:function(){this.logger.trace(this.options.componentName+".onConstructed() of '"+this.name+"'.");this.storeComponentState();this.state=BrowserWidget.States.CONSTRUCTED;this.constructionChain.clearChain();this.broadcastConstructedMessage();this.fireEvent("constructed",this,this.options.eventDeliveryDelay)}.protect(),finalizeDestruction:function(){this.logger.trace(this.options.componentName+".onDestroyed() of '"+this.name+"'.");this.state=BrowserWidget.States.INITIALIZED;this.destructionChain.clearChain();this.fireEvent("destroyed",this,this.options.eventDeliveryDelay)}.protect(),loadWebUIConfiguration:function(){try{this.webUIConfiguration=new WebUIConfiguration(this.options.configurationUri)}catch(a){alert("Couldn't load Browser Front-End configuration: "+this.options.configurationUri)}}.protect(),loadWidgetData:function(){if(this.options.widgetDataURI){try{var a=this.options.useLocalizedData?new ResourceUri(this.options.widgetDataURI,this.locale).determineLocalizedUri():this.options.widgetDataURI;this.dataXml=new XmlResource(a,{nameSpaces:this.options.dataXmlNameSpace})}catch(b){this.logger.debug("Widget data: '"+this.options.widgetDataURI+"' not found.")}}}.protect(),loadWidgetDefinition:function(){if(this.options.widgetDefinitionURI){try{this.definitionXml=new XmlResource(this.options.widgetDefinitionURI,{nameSpaces:this.options.definitionXmlNameSpace})}catch(a){this.logger.debug("Widget definition: '"+this.options.widgetDefinitionURI+"' not found.")}}}.protect(),parseStateSpecification:function(){}.protect(),revertConstruction:function(){this.fireEvent("constructionError",this.error)}.protect(),subscribeToWebUIMessages:function(){if(this.options.subscribeToWebUIMessages){this.options.subscribeToWebUIMessages.each(function(a,b){this.messageBus.subscribeToMessage(a,this.webUIMessageHandler)},this)}}.protect(),unmarshallOptions:function(){if(this.definitionXml){var a=this.definitionXml.selectNode(this.options.optionsSelector);if(a){var b=new OptionsResource(a);b.unmarshall();this.setOptions(b.getOptions())}this.setOptions(this.givenOptions)}}.protect(),unmarshallProperties:function(){if(this.definitionXml){this.description=this.definitionXml.selectNodeText(this.options.descriptionSelector);this.name=this.definitionXml.selectNodeText(this.options.nameSelector)}}.protect(),writeOffFromWebUIMessages:function(){if(this.options.subscribeToWebUIMessages){this.options.subscribeToWebUIMessages.each(function(a,b){this.messageBus.writeOffFromMessage(a,this.webUIMessageHandler)},this)}}});BrowserWidget.States={UNINITIALIZED:0,INITIALIZED:1,UNMARSHALLED:2,CONSTRUCTED:3};var UnconfiguredWidgetException=new Class({Extends:WebUIException,options:{description:"Browser Widget is unconfigured therefore the requested operation can't be carried out.",name:"UnconfiguredWidgetException"},initialize:function(a){this.setOptions(a);this.parent(a)}});var WidgetConstuctedMessage=new Class({Extends:WebUIMessage,options:{actionType:null,activityType:null,description:"New widget was constructed.",name:"WidgetConstructedMessage",notification:null,windowName:null},initialize:function(a){this.setOptions(a);this.options.messageClass=WidgetConstuctedMessage},getActionType:function(){return this.options.actionType},getActivityType:function(){return this.options.activityType},getContextItemId:function(){return this.options.contextItemId},getNotification:function(){return this.options.notification},getWindowName:function(){return this.options.windowName}});var WidgetConstructionException=new Class({Extends:WebUIException,options:{description:"Constructing widget: '{widgetName}' caused the following error: '{configurationErrorDescription}'.",name:"WidgetConstructionException"},initialize:function(c,b,a){this.parent(a);this.parameters={widgetName:c,configurationErrorDescription:b}},getConfigurationErrorDescription:function(){return this.parameters.ConfigurationErrorDescription},getWidgetName:function(){return this.parameters.widgetName},});var WidgetElementFactory=new Class({Implements:Options,options:{appendByDefault:true,buttonClassName:"buttonSmall",defaultPosition:3,formFieldsContainerClassName:"editableContainer",fieldSetImageAlt:"Show/Hide",fieldSetImageSource:"Images/expver.png",fieldSetImageStyle:{cursor:"pointer"},fieldSetImageTitle:"Show/Hide",fieldSetStyle:{"border-color":"#336699",width:"100%"},labelClassName:"label",readOnlyContainerClassName:"readOnlyContainer",rowClassName:"row",valueClassName:"formw"},initialize:function(c,b,a){assertThat(c,not(nil()));assertThat(b,not(nil()));this.setOptions(a);this.containerElement=c;this.i18Resource=b},create:function(d,f,b,a,c){var g=new Element(d,c);if(f){g.appendText(this.i18Resource.getText(f))}if(b||this.options.appendByDefault){this.appendElement(g,b,a)}return g},createAnchor:function(h,a,k,m,c,d){var l;var g=a?new ResourceUri(a):null;if(k){l={href:"#",events:{click:k}}}else{if(g&&g.isLocal()){if(g.getDocumentType()==AbstractDocument.Types.SMART){var b="top.webUIController.loadSmartDocument('"+g.getUri()+"'";b+=g.getDocumentContentUri()?", '"+g.getDocumentContentUri()+"'":"";b+=g.getDocumentVariables()?", "+g.getDocumentVariables():"";b+=");";l={href:"#",onclick:b}}else{l={href:"#",onclick:"top.webUIController.loadHtmlDocument('"+a+"');"}}}else{l={href:a}}}var j=this.mergeProperties(l,d);var f=this.create("A",h,m,c,j);return f},createButton:function(j,f,k,b,c){var h={"class":this.options.buttonClassName,type:"button",value:j,events:{click:f}};var d=this.mergeProperties(h,c);var a=this.create("INPUT",null,k,b,d);if(j){var g=this.i18Resource.getText(j);a.set("value",g)}return a},createCollapsibleArea:function(b,a,c){return this.create("div",null,b,a,this.mergeProperties({"class":this.options.readOnlyContainerClassName},c))},createDivision:function(b,a,c){return this.create("div",null,b,a,this.mergeProperties({"class":this.options.readOnlyContainerClassName},c))},createFieldSet:function(b,k,c,d){var h={styles:this.options.fieldSetStyle};var f=this.mergeProperties(h,d);var j=this.create("FIELDSET",null,k,c,f);var g=this.create("LEGEND",null,j,WidgetElementFactory.Positions.LastChild);var a={id:b,src:this.options.fieldSetImageSource,alt:this.options.fieldSetImageAlt,title:this.options.fieldSetImageTitle,styles:this.options.fieldSetImageStyle};this.create("IMG",null,g,WidgetElementFactory.Positions.LastChild,a);return j},createForm:function(f,d,b,a,g){assertThat(f,not(nil()));assertThat(d.toUpperCase()=="POST"||d.toUpperCase()=="GET",is(true));var c=this.create("FORM",null,b,a,this.mergeProperties({id:f,name:"form",method:d},g));this.create("DIV",null,c,WidgetElementFactory.Positions.LastChild,{"class":this.options.formFieldsContainerClassName});this.create("DIV",null,c,WidgetElementFactory.Positions.LastChild,{"class":this.options.readOnlyContainerClassName});return c},createHiddenDivision:function(c,b,a,g){var d={id:c,styles:{display:"none"},"class":this.options.readOnlyContainerClassName};var f=this.create("DIV",null,b,a,this.mergeProperties(d,g));return f},createOption:function(d,f,b,a,g){var c={value:d};return this.create("OPTION",f,b,a,this.mergeProperties(c,g))},createRowLabel:function(c,b,a,d){return this.create("span",c,b,a,{"class":this.options.labelClassName})},createRowValue:function(c,f,b,a,d){return this.create("span",c,b,a,{id:f,"class":this.options.valueClassName})},createStaticRow:function(g,f,j,c,b,a){var d=this.create("div",null,c,b,{"class":this.options.rowClassName});this.create("label",g,d,WidgetElementFactory.Positions.LastChild,{"class":this.options.labelClassName});if(a){var h=this.create("span",null,d,WidgetElementFactory.Positions.LastChild,{id:j,"class":this.options.valueClassName});this.createAnchor(f,a,null,h)}else{this.create("span",f,d,WidgetElementFactory.Positions.LastChild,{id:j,"class":this.options.valueClassName})}return d},createTable:function(m,o,k){var b=this.create("TABLE",null,o,k);var d=this.create("THEAD",null,b,WidgetElementFactory.Positions.LastChild);var h=this.create("TBODY",null,b,WidgetElementFactory.Positions.LastChild);var n=this.create("TR",null,d,WidgetElementFactory.Positions.LastChild);for(var j=1;j<=m.getColumns().size();j++){var a=m.getColumns().getColumnByIndex(j-1);this.create("TH",a.getCaption(),n,WidgetElementFactory.Positions.LastChild)}for(var j=0;j<m.getRows().size();j++){var f=m.getRow(j);var g=this.create("TR",null,h,WidgetElementFactory.Positions.LastChild);for(var l=0;l<f.length;l++){this.create("TD",f[l],g,WidgetElementFactory.Positions.LastChild)}}return b},appendElement:function(d,b,a){b=$(b);var c=b==undefined?this.containerElement:b;switch(a){case WidgetElementFactory.Positions.Before:c.grab(d,"before");break;case WidgetElementFactory.Positions.After:c.grab(d,"after");break;case WidgetElementFactory.Positions.FirstChild:c.grab(d,"top");break;case WidgetElementFactory.Positions.LastChild:c.grab(d,"bottom");break;default:c.appendChild(d,"Last");break}}.protect(),mergeProperties:function(c,a){var b=Object.merge(c,a);return b}.protect()});var TableColumnDefinition=new Class({initialize:function(a,c){this.caption=null;this.i18Resource=c;try{this.caption=this.i18Resource.getText(a)}catch(b){this.caption=a}},getCaption:function(){return this.caption}});var TableColumnList=new Class({initialize:function(){this.tableColumns=new ArrayList()},add:function(a){this.tableColumns.add(a)},getColumnByIndex:function(b){var a=null;this.tableColumns.each(function(d,c){if(c==b){a=d}},this);return a},size:function(){return this.tableColumns.size()}});var TableHeaderDefinition=new Class({initialize:function(a){this.tableColumns=new TableColumnList();this.i18Resource=a},addColumn:function(b){var a=new TableColumnDefinition(b,this.i18Resource);this.tableColumns.add(a)},getColumns:function(){return this.tableColumns}});var TableDefinition=new Class({initialize:function(a){this.tableHeaderDefinition=new TableHeaderDefinition(a);this.tableRows=new TableRowList()},addColumn:function(a){this.tableHeaderDefinition.addColumn(a)},addRow:function(a){this.tableRows.add(a)},getColumns:function(){return this.tableHeaderDefinition.getColumns()},getRow:function(a){return this.tableRows.getRowByIndex(a)},getRows:function(){return this.tableRows}});var TableRowList=new Class({initialize:function(){this.tableRows=new ArrayList()},add:function(a){this.tableRows.add(a)},getRowByIndex:function(b){var a=null;this.tableRows.each(function(c,d){if(d==b){a=c}},this);return a},size:function(){return this.tableRows.size()}});WidgetElementFactory.Positions={Before:0,After:1,FirstChild:2,LastChild:3,Undefined:4};var StateTransformer=new Class({Implements:[Events,Options],options:{unknownValue:"unknown"},initialize:function(a,b){assertThat(a,not(nil()));this.setOptions(b);this.stateMachine=a},parse:function(){},toString:function(){},setUnknowsValuesToNull:function(a){if(a==this.options.unknownValue){return null}for(var b in a){if(a[b]==this.options.unknownValue){a[b]=null}}return a}.protect(),transformComponentStateToString:function(a){var b="";var d=a.getValue();if(d==null){d=this.options.unknownValue}if(typeOf(d)=="string"){b="'"+d+"'"}else{if(typeOf(d)=="object"){b="{";for(var c in d){if(b!="{"){b+=","}if(d[c]==null){b+=c+":'"+this.options.unknownValue+"'"}else{b+=c+":"+this.transformStateValueToString(d[c])}}b+="}"}else{b="'"+d.toString()+"'"}}return b}.protect(),transformStateValueToString:function(b){valueString="";if(typeOf(b)=="string"){valueString="'"+b+"'"}else{if(typeOf(b)=="object"){valueString="{";for(var a in b){if(valueString!="{"){valueString+=","}if(b[a]==null){valueString+=a+":'"+this.options.unknownValue+"'"}else{valueString+=a+":'"+b[a]+"'"}}valueString+="}"}else{valueString=b.toString()}}return valueString}.protect()});var DefaultStateTransformer=new Class({Extends:StateTransformer,options:{},initialize:function(a,b){this.parent(a,b)},parse:function(stateString){var tokenizer=new StringTokenizer(stateString,{delimiters:";"});while(tokenizer.hasMoreTokens()){var token=tokenizer.nextToken();var componentName=token.substring(0,token.indexOf(":"));var componentStateString=token.substring(token.indexOf(":")+1);var componentState=eval("("+componentStateString.trim()+")");componentState=this.setUnknowsValuesToNull(componentState);this.fireEvent("componentStateParse",[[componentName,componentState]])}},toString:function(){var a="";this.stateMachine.each(function(b,c){if(a!=""){a+=";"}a+=b.getKey()+":";a+=this.transformComponentStateToString(b)},this);return a}});var ComponentStateManager=new Class({Implements:[Events,Options,Class.Singleton],Binds:["onComponentStateParse"],options:{componentName:"ComponentStateManager",componentsInUri:[],stateUriTransformer:DefaultStateTransformer,stateValidityPeriod:900000},initialize:function(a){return this.check()||this.setUp(a)},setUp:function(a){this.setOptions(a);this.stateMachine=new LinkedHashMap();this.stateTransformer=new DefaultStateTransformer(this.stateMachine,{onComponentStateParse:this.onComponentStateParse});this.uriTransformer=new FixedComponentOrderedTransformer(this.stateMachine,this.options.componentsInUri,{onComponentStateParse:this.onComponentStateParse})}.protect(),includeComponentNameToUri:function(a){this.uriTransformer.addComponentName(a)},onComponentStateParse:function(a){this.storeComponentState(a[0].trim(),a[1])},parse:function(a){if(a){this.stateTransformer.parse(a)}},parseUri:function(a){this.uriTransformer.parse(a)},persist:function(){$.jStorage.set(this.options.componentName,this.toString());$.jStorage.setTTL(this.options.componentName,this.options.stateValidityPeriod)},reset:function(){this.stateMachine.clear();$.jStorage.flush()},restore:function(){var a=$.jStorage.get(this.options.componentName);this.parse(a)},restoreStateFromUri:function(){if(window.location.hash.substring(2)){var a=this.toString();try{this.parseUri(window.location.hash.substring(2))}catch(b){this.parse(a)}}},retrieveComponentState:function(a){return this.stateMachine.get(a)},storeComponentState:function(a,b){if(a&&b){this.stateMachine.put(a,b)}},toString:function(){return this.stateTransformer.toString()},toUri:function(){return this.uriTransformer.toString()},getDefaultTransformer:function(){return this.stateTransformer},getUriTransformer:function(){return this.uriTransformer},});var FixedComponentOrderedTransformer=new Class({Extends:StateTransformer,options:{},initialize:function(a,c,b){assertThat(c,not(nil()));this.parent(a,b);this.componentList=c},addComponentName:function(a){this.componentList.include(a)},parse:function(stateString){stateString=stateString.replace("%7B","{");stateString=stateString.replace("%7D","}");stateString=stateString.replace("%27","'");var tokenizer=new StringTokenizer(stateString,{delimiters:";"});var componentIndex=0;while(tokenizer.hasMoreTokens()){var componentName=this.componentList[componentIndex++];var componentStateString=tokenizer.nextToken();var componentState=eval("("+componentStateString.trim()+")");componentState=this.setUnknowsValuesToNull(componentState);this.fireEvent("componentStateParse",[[componentName,componentState]])}},toString:function(){var a="";this.stateMachine.each(function(b,c){if(this.componentList.contains(b.getKey())){if(a!=""){a+=";"}a+=this.transformComponentStateToString(b)}},this);return a},getComponentNames:function(){return this.componentList},});var ComplexContentBehaviour=new Class({Implements:[Events,Options],options:{contentAreaElementStyle:"complexContentArea",contentUrlSelector:"contentURL",disableScrollBars:false,disableScrollBarsSelector:"disableScrollBars",documentContentUriSelector:"document/documentContentUri",documentDefinitionUriSelector:"document/documentDefinitionUri",documentNameSeparator:"_",documentTypeDefault:AbstractDocument.Types.SMART,documentTypeSelector:"document/@type",documentWrapperId:"_documentWrapper_"+(new Date().getTime()),documentWrapperIdSelector:"document/@id",documentWrapperStyle:"documentWrapper",documentWrapperStyleSelector:"document/@elementStyle",documentWrapperTag:"div",documentWrapperTagSelector:"document/@tag",errorDocumentUri:"Content/System/ErrorDocument.xml",eventSourcesSelector:"eventOriginators",handleMenuSelectedEvents:false,handleMenuSelectedEventsSelector:"handleMenuSelectedEvents",handleTabSelectedEvents:false,handleTabSelectedEventsSelector:"handleTabSelectedEvents",headerSelector:"panelHeader",heightDefault:125,heightSelector:"height",nameSelector:"name",nameSpaces:"xmlns:pp='http://www.processpuzzle.com'",pluginSelector:"plugin",scrollBarStyle:"scroll",showHeaderSelector:"showHeader",storeStateInUriSelector:"storeStateInUri",storeStateSelector:"storeState",titleSelector:"title",widthDefault:300,widthSelector:"width"},initialize:function(c,a,b){this.setOptions(b);this.componentRootElement;this.contentAreaElement;this.contentContainerElement;this.contentUrl;this.document;this.documentContentUri;this.documentContentType=AbstractDocument.Types.HTML;this.documentDefinitionUri;this.documentWrapper;this.documentWrapperId;this.documentWrapperStyle;this.documentWrapperTag;this.documentVariables;this.error;this.eventSources=null;this.handleMenuSelectedEvents;this.handleTabSelectedEvents;this.header;this.height;this.lastHandledMessage;this.name;this.plugin;this.showHeader;this.stateSpecification;this.storedDocumentNeedsToBeRestored=false;this.storeState=false;this.storeStateInUri=false;this.title;this.verticalScrollBar;this.width},onContainerResize:function(){var a=this.contentContainerElement.getSize();if(this.verticalScrollBar){this.verticalScrollBar.refresh(this.contentContainerElement.getSize());a=this.verticalScrollBar.getContentViewSize()}if(this.document&&this.document.getState()==AbstractDocument.States.CONSTRUCTED){this.adjustDocumentWrapperSize(a);this.document.onContainerResize({x:parseInt(this.documentWrapper.getStyle("width")),y:parseInt(this.documentWrapper.getStyle("height"))})}},onDocumentError:function(a){this.error=a;this.loadErrorDocument();this.fireEvent("panelError",a);this.constructionChain.callChain()},onDocumentReady:function(){this.logger.trace(this.options.componentName+".construct() of '"+this.name+"' finished.");this.onContainerResize();this.storeComponentState();this.fireEvent("documentLoaded",this.documentDefinitionUri,this.options.eventFireDelay);this.constructionChain.callChain()},onHeaderConstructed:function(){this.logger.trace(this.options.componentName+".construct() of '"+this.name+"'s header finished.");this.constructionChain.callChain()},onHeaderConstructionError:function(a){this.error=a;this.revertConstruction();this.fireEvent("panelError",this.error,this.options.eventFireDelay);this.fireEvent("panelConstructed",this,this.options.eventFireDelay)},onPluginConstructed:function(){this.logger.trace(this.options.componentName+".construct() of '"+this.name+"'s plugin finished.");if(this.verticalScrollBar){this.verticalScrollBar.refresh()}this.constructionChain.callChain()},onPluginError:function(a){this.error=a;this.instantiateErrorDocument();this.fireEvent("panelError",this.error);this.constructionChain.callChain()},webUIMessageHandler:function(a){if(this.state!=DesktopElement.States.CONSTRUCTED){return}if((instanceOf(a,MenuSelectedMessage)||instanceOf(a,TabSelectedMessage))&&(a.getActivityType()==AbstractDocument.Activity.LOAD_DOCUMENT)&&(this.eventSources==null||this.eventSources.contains(a.getOriginator()))){if(this.storedContentHasPrecedence(a)){this.storedDocumentNeedsToBeRestored=false;return}this.destroyDocument();this.destroyDocumentWrapper();this.processMessageProperties(a);this.loadDocument(a.getDocumentType())}this.lastHandledMessage=a},getColumnReference:function(){return this.columnReference},getComponentStateManager:function(){return this.componentStateManager},getContentAreaElement:function(){return this.contentAreaElement},getContentContainerId:function(){return this.name+this.options.componentContentIdPostfix},getContentUrl:function(){return this.contentUrl},getDocument:function(){return this.document},getDocumentContentUri:function(){return this.documentContentUri},getDocumentDefinitionUri:function(){return this.documentDefinitionUri},getDocumentWrapperId:function(){return this.documentWrapperId},getDocumentWrapperStyle:function(){return this.documentWrapperStyle},getDocumentWrapperTag:function(){return this.documentWrapperTag},getEventSources:function(){return this.eventSources},getHeader:function(){return this.header},getHeight:function(){return this.height},getLogger:function(){return this.logger},getMessageBus:function(){return this.messageBus},getName:function(){return this.name},getPlugin:function(){return this.plugin},getShowHeader:function(){return this.showHeader},getState:function(){return this.state},getStoreState:function(){return this.storeState},getStoreStateInUri:function(){return this.storeStateInUri},getTitle:function(){return this.title},getToolBox:function(){return this.header},getVerticalScrollBar:function(){return this.verticalScrollBar},getWidth:function(){return this.width},isSuccess:function(){return this.error==null},addScrollBars:function(){if(!this.options.disableScrollBars){this.verticalScrollBar=new ScrollingBehaviour(this.contentAreaElement,{contentHeight:this.contentContainerElement.getSize().y,contentWidth:this.contentContainerElement.getSize().x});this.verticalScrollBar.construct()}this.constructionChain.callChain()}.protect(),adjustDocumentWrapperSize:function(a){var b=parseInt(this.documentWrapper.getStyle("margin-left"))+parseInt(this.documentWrapper.getStyle("margin-right"));b+=2*parseInt(this.documentWrapper.getStyle("border"));b+=parseInt(this.documentWrapper.getStyle("padding-left"))+parseInt(this.documentWrapper.getStyle("padding-right"));this.documentWrapper.setStyles({width:(a.x-b)+"px"})}.protect(),cleanUpContentElement:function(){if(this.contentContainerElement){var a=this.contentContainerElement.getElements?this.contentContainerElement.getElements("*"):Array.from(this.contentContainerElement.getElementsByTagName("*"));a.each(function(c,b){if(c.destroy){c.destroy()}},this)}}.protect(),constructDocument:function(){if(this.document){this.createDocumentWrapper();this.document.construct()}else{this.constructionChain.callChain()}}.protect(),constructPlugin:function(){if(this.plugin){try{this.plugin.construct()}catch(a){this.logger.error("Constructing plugin of panel: '"+this.name+"' caused error.")}}else{this.constructionChain.callChain()}}.protect(),constructHeader:function(){if(this.header){this.header.construct($(this.name+"_header"))}else{this.constructionChain.callChain()}}.protect(),createContentAreaElement:function(){var a=this.contentContainerElement.getChildren("#"+this.name+"_pad")[0];if(a){this.contentAreaElement=a}else{this.contentAreaElement=new Element("div");this.contentContainerElement.grab(this.contentAreaElement)}this.contentAreaElement.addClass(this.options.contentAreaElementStyle);if(!this.options.disableScrollBars){this.contentContainerElement.setStyle("overflow","hidden")}this.constructionChain.callChain()}.protect(),createDocumentWrapper:function(){this.documentWrapper=new Element(this.documentWrapperTag,{id:this.documentWrapperId,"class":this.documentWrapperStyle});this.contentAreaElement.grab(this.documentWrapper);this.documentWrapper.setStyle("width",this.contentContainerElement.getSize().x+"px")}.protect(),destroyComponentRootElement:function(){if(this.componentRootElement){if(this.componentRootElement.destroy){this.componentRootElement.destroy()}else{this.componentRootElement.removeNode()}}}.protect(),destroyComponents:function(){this.destroyDocument();this.destroyDocumentWrapper();this.destroyScrollBars();this.cleanUpContentElement();this.destroyHeader();this.destroyPlugin();this.destructionChain.callChain()}.protect(),destroyDocument:function(){if(this.document){this.document.removeEvents();this.document.destroy()}this.document=null}.protect(),destroyDocumentWrapper:function(){if(this.documentWrapper&&this.documentWrapper.destroy){this.documentWrapper.destroy()}this.documentWrapper=null}.protect(),destroyHeader:function(){if(this.header){this.header.removeEvents();this.header.destroy()}}.protect(),destroyPlugin:function(){if(this.plugin){this.plugin.removeEvents();this.plugin.destroy()}}.protect(),destroyScrollBars:function(){if(this.verticalScrollBar){this.verticalScrollBar.destroy();this.verticalScrollBar=null}}.protect(),determineComponentElements:function(){this.componentRootElement=$(this.name+this.options.componentRootElementIdPostfix);this.componentRootElement=$(this.componentRootElement);this.contentContainerElement=$(this.getContentContainerId());this.contentContainerElement=document.id(this.contentContainerElement);this.constructionChain.callChain()}.protect(),instantiateDocument:function(a,c){var b=null;switch(a){case AbstractDocument.Types.HTML:b=new HtmlDocument(this.internationalization,c);break;case AbstractDocument.Types.SMART:b=new SmartDocument(this.internationalization,c);break}return b}.protect(),instantiateErrorDocument:function(){this.documentDefinitionUri=this.options.errorDocumentUri;this.documentContentUri=null;this.documentVariables=null;this.document=this.instantiateDocument(AbstractDocument.Types.SMART,{documentContainerId:this.documentWrapperId,documentDefinitionUri:this.options.errorDocumentUri,onDocumentReady:this.onDocumentReady,onDocumentError:this.onDocumentError});this.document.unmarshall()}.protect(),internationalizeContentUri:function(){this.contentUrl=this.contentUrl.substring(0,this.contentUrl.lastIndexOf(".html"))+"_"+this.internationalization.getLocale().getLanguage()+".html"}.protect(),loadDocument:function(a){this.document=this.instantiateDocument(a,{documentContainerId:this.documentWrapperId,documentDefinitionUri:this.documentDefinitionUri,documentContentUri:this.documentContentUri,documentVariables:this.documentVariables,onDocumentReady:this.onDocumentReady,onDocumentError:this.onDocumentError});this.document.unmarshall();this.constructDocument()}.protect(),loadErrorDocument:function(){this.documentDefinitionUri=this.options.errorDocumentUri;this.documentContentUri=null;this.documentVariables=null;this.loadDocument(AbstractDocument.Types.SMART)}.protect(),parseStateSpecification:function(){this.documentDefinitionUri=this.stateSpecification.documentDefinitionURI!="null"?this.stateSpecification.documentDefinitionURI:null;this.documentContentUri=this.stateSpecification.documentContentURI!="null"?this.stateSpecification.documentContentURI:null;this.documentContentType=this.stateSpecification.documentType!="null"?this.stateSpecification.documentType:this.options.documentTypeDefault}.protect(),processMessageProperties:function(a){this.documentDefinitionUri=a.getDocumentURI();this.documentContentUri=a.getDocumentContentURI();this.documentContentType=a.getDocumentType();this.documentVariables=a.getDocumentVariables()}.protect(),resetProperties:function(){this.contentUrl=null;this.documentContentUri=null;this.documentDefinitionUri=null;this.documentWrapperId=null;this.documentWrapperStyle=null;this.documentWrapperTag=null;this.height=null;this.name=null;this.showHeader=null;this.title=null;this.destructionChain.callChain()}.protect(),restoreComponentState:function(){if(this.storeState){this.stateSpecification=this.componentStateManager.retrieveComponentState(this.options.componentName);if(this.stateSpecification){this.parseStateSpecification();if(this.documentDefinitionUri){this.storedDocumentNeedsToBeRestored=true;this.document=this.instantiateDocument(this.documentContentType,{documentContainerId:this.documentWrapperId,documentDefinitionUri:this.documentDefinitionUri,documentContentUri:this.documentContentUri,onDocumentReady:this.onDocumentReady,onDocumentError:this.onDocumentError});this.document.unmarshall()}}}this.constructionChain.callChain()}.protect(),revertComplexContentBehaviour:function(){this.destroyComponents();this.resetProperties()}.protect(),storeComponentState:function(){if(this.storeState){this.stateSpecification={documentDefinitionURI:this.documentDefinitionUri,documentContentURI:this.documentContentUri,documentType:this.documentContentType,documentVariables:this.documentVariables};this.componentStateManager.storeComponentState(this.options.componentName,this.stateSpecification)}}.protect(),storedContentHasPrecedence:function(a){return this.storedDocumentNeedsToBeRestored==true&&a.isDefault()}.protect(),subscribeToWebUIMessages:function(){if(this.handleMenuSelectedEvents){this.logger.debug(this.options.componentName+".subscribeToWebUIMessages() started.");this.messageBus.subscribeToMessage(MenuSelectedMessage,this.webUIMessageHandler)}if(this.handleTabSelectedEvents){this.logger.debug(this.options.componentName+".subscribedToWebUIMessages() started.");this.messageBus.subscribeToMessage(TabSelectedMessage,this.webUIMessageHandler)}this.constructionChain.callChain()}.protect(),unmarshallDocument:function(){this.documentContentUri=XmlResource.selectNodeText(this.options.documentContentUriSelector,this.definitionElement);this.documentDefinitionUri=XmlResource.selectNodeText(this.options.documentDefinitionUriSelector,this.definitionElement);this.documentContentType=XmlResource.selectNodeText(this.options.documentTypeSelector,this.definitionElement,this.options.nameSpaces,this.options.documentTypeDefault);this.documentWrapperId=XmlResource.selectNodeText(this.options.documentWrapperIdSelector,this.definitionElement,this.options.nameSpaces,this.name+this.options.documentWrapperId);this.documentWrapperStyle=XmlResource.selectNodeText(this.options.documentWrapperStyleSelector,this.definitionElement,this.options.nameSpaces,this.options.documentWrapperStyle);this.documentWrapperTag=XmlResource.selectNodeText(this.options.documentWrapperTagSelector,this.definitionElement,this.options.nameSpaces,this.options.documentWrapperTag);if(this.documentDefinitionUri){this.document=this.instantiateDocument(this.documentContentType,{documentContainerId:this.documentWrapperId,documentDefinitionUri:this.documentDefinitionUri,documentContentUri:this.documentContentUri,onDocumentReady:this.onDocumentReady,onDocumentError:this.onDocumentError});this.document.unmarshall()}}.protect(),unmarshallHeader:function(){var a=XmlResource.selectNode(this.options.headerSelector,this.definitionElement);if(a){this.header=new DesktopPanelHeader(a,this.internationalization,{onHeaderConstructed:this.onHeaderConstructed,onHeaderConstructionError:this.onHeaderConstructionError});this.header.unmarshall()}}.protect(),unmarshallPlugin:function(){var a=XmlResource.selectNode(this.options.pluginSelector,this.definitionElement);if(a){this.plugin=new DocumentPlugin(a,this.internationalization,{onConstructed:this.onPluginConstructed,onConstructionError:this.onPluginError});this.plugin.unmarshall()}}.protect(),unmarshallProperties:function(){this.contentUrl=XmlResource.selectNodeText(this.options.contentUrlSelector,this.definitionElement);this.options.disableScrollBars=parseBoolean(XmlResource.determineAttributeValue(this.definitionElement,this.options.disableScrollBarsSelector,this.options.disableScrollBars));this.height=parseInt(XmlResource.determineAttributeValue(this.definitionElement,this.options.heightSelector,this.options.heightDefault));this.eventSources=eval(XmlResource.determineAttributeValue(this.definitionElement,this.options.eventSourcesSelector,null,this.eventSources));this.name=XmlResource.determineAttributeValue(this.definitionElement,this.options.nameSelector);this.showHeader=parseBoolean(XmlResource.determineAttributeValue(this.definitionElement,this.options.showHeaderSelector));this.handleMenuSelectedEvents=parseBoolean(XmlResource.determineAttributeValue(this.definitionElement,this.options.handleMenuSelectedEventsSelector,this.options.handleMenuSelectedEvents));this.handleTabSelectedEvents=parseBoolean(XmlResource.determineAttributeValue(this.definitionElement,this.options.handleTabSelectedEventsSelector,this.options.handleTabSelectedEvents));this.storeState=parseBoolean(XmlResource.determineAttributeValue(this.definitionElement,this.options.storeStateSelector,false));this.storeStateInUri=parseBoolean(XmlResource.determineAttributeValue(this.definitionElement,this.options.storeStateInUriSelector,false));this.title=XmlResource.selectNodeText(this.options.titleSelector,this.definitionElement);if(this.internationalization){this.title=this.internationalization.getText(this.title)}this.width=parseInt(XmlResource.determineAttributeValue(this.definitionElement,this.options.widthSelector,this.options.widthDefault));this.options.componentName=this.name;if(this.storeStateInUri){this.componentStateManager.includeComponentNameToUri(this.name)}}.protect()});var ConfigurationTimeoutException=new Class({Extends:WebUIException,options:{description:"Configuring '{configurationPath}' exceeded the '{resourceLoadTimeout}'ms timeout period.",name:"ConfigurationTimeoutException"},initialize:function(b,c,a){this.setOptions(a);this.parent(a);this.parameters={configurationPath:b,resourceLoadTimeout:c}}});var Desktop=new Class({Implements:[Events,Options,TimeOutBehaviour],Binds:["checkTimeOut","constructColumns","constructContentArea","constructFooter","constructHeader","constructPanels","constructWindowDocker","constructWindows","destroyColumns","destroyContentArea","destroyFooter","destroyHeader","destroyHiddenElements","destroyPanels","destroyWindowDocker","destroyWindows","finalizeConstruction","finalizeDestruction","hideDesktop","initializeMUI","loadResources","onColumnConstructed","onColumnDestructed","onContentAreaConstructed","onError","onFooterConstructed","onHeaderConstructed","onPanelConstructed","onPanelDestructed","onResourceError","onResourcesLoaded","onWindowConstructed","onWindowDestructed","onWindowDockerConstructed","releaseResources","removeDesktopEvents","showDesktop","showNotification","subscribeToWebUIMessages","webUIMessageHandler"],options:{callChainDelay:2000,componentName:"Desktop",columnSelector:"/desktopConfiguration/columns/column",configurationXmlNameSpace:"xmlns:dc='http://www.processpuzzle.com/DesktopConfiguration'",configurationURI:"DesktopConfiguration.xml",containerIdSelector:"/desktopConfiguration/containerId",contentAreaSelector:"/desktopConfiguration/contentArea",defaultContainerId:"desktop",descriptionSelector:"/desktopConfiguration/description",errorDocumentUri:"Content/System/ErrorDocument.xml",eventFireDelay:5,footerSelector:"/desktopConfiguration/footer",headerSelector:"/desktopConfiguration/header",nameSelector:"/desktopConfiguration/name",panelSelector:"/desktopConfiguration/panels/panel",pluginOnloadDelay:1000,resourceLoadTimeout:5000,resourcesSelector:"/desktopConfiguration/resources",skin:"ProcessPuzzle",versionSelector:"/desktopConfiguration/version",windowDockerSelector:"/desktopConfiguration/windowDocker",windowSelector:"/desktopConfiguration/windows/window",},initialize:function(c,b,a){this.presetOptionsBasedOnWebUIConfiguration(c);this.setOptions(a);this.componentStateManager=Class.getInstanceOf(ComponentStateManager);this.columns=new LinkedHashMap();this.configurationXml=new XmlResource(this.options.configurationURI,{nameSpaces:this.options.configurationXmlNameSpace});this.constructionChain=new Chain();this.containerElement;this.containerId;this.contentArea;this.currentLocale=null;this.description;this.destructionChain=new Chain();this.dock=null;this.error;this.footer;this.header;this.lastHandledMessage;this.logger=Class.getInstanceOf(WebUILogger);this.messageBus=Class.getInstanceOf(WebUIMessageBus);this.MUIDesktop=null;this.name;this.numberOfConstructedColumns=0;this.numberOfConstructedPanels=0;this.numberOfConstructedWindows=0;this.panels=new LinkedHashMap();this.resourceBundle=b;this.resources=null;this.state=DesktopElement.States.UNINITIALIZED;this.version;this.webUIConfiguration=c;this.windowDocker;this.windows=new HashMap();this.determineCurrentLocale();this.loadI18Resources();this.configureLogger();this.state=DesktopElement.States.UNINITIALIZED},construct:function(){this.startTimeOutTimer("construct");this.constructionChain.chain(this.hideDesktop,this.loadResources,this.constructHeader,this.constructWindowDocker,this.constructContentArea,this.constructFooter,this.initializeMUI,this.constructColumns,this.constructPanels,this.constructWindows,this.subscribeToWebUIMessages,this.showDesktop,this.finalizeConstruction).callChain()},destroy:function(){if(this.state>DesktopElement.States.UNMARSHALLED){this.destructionChain.chain(this.hideDesktop,this.releaseResources,this.removeDesktopEvents,this.destroyWindows,this.destroyPanels,this.destroyColumns,this.destroyHeader,this.destroyContentArea,this.destroyFooter,this.destroyWindowDocker,this.destroyHiddenElements,this.finalizeDestruction).callChain()}},onColumnConstructed:function(a){this.numberOfConstructedColumns++;this.fireEvent("desktopComponentConstructed",a.name);if(this.numberOfConstructedColumns==this.columns.size()){this.logger.debug(this.options.componentName+", loading desktop column is finished.");this.callNextConfigurationStep()}},onColumnDestructed:function(a){this.numberOfConstructedColumns--;if(this.numberOfConstructedColumns==0){this.logger.debug(this.options.componentName+", destroy of desktop columns is finished.");this.columns.clear();this.destructionChain.callChain()}},onContentAreaConstructed:function(){this.logger.debug(this.options.componentName+", constructing desktop content area is finished.");this.fireEvent("desktopComponentConstructed","DesktopContentArea");this.callNextConfigurationStep()},onError:function(a){this.error=a},onFooterConstructed:function(){this.logger.debug(this.options.componentName+", loading desktop footer is finished.");this.fireEvent("desktopComponentConstructed","DesktopFooter");this.callNextConfigurationStep()},onHeaderConstructed:function(){this.logger.debug(this.options.componentName+", loading desktop header is finished.");this.fireEvent("desktopComponentConstructed","DesktopHeader");this.callNextConfigurationStep()},onPanelConstructed:function(a){this.numberOfConstructedPanels++;this.fireEvent("desktopComponentConstructed",a.name);if(this.numberOfConstructedPanels==this.panels.size()){this.logger.debug(this.options.componentName+", loading desktop panels is finished.");this.callNextConfigurationStep()}},onPanelDestructed:function(a){this.numberOfConstructedPanels--;if(this.numberOfConstructedPanels==0){this.logger.debug(this.options.componentName+", destroy of desktop panels is finished.");this.panels.clear();this.destructionChain.callChain()}},onResourceError:function(a){this.error=a},onResourcesLoaded:function(){this.logger.debug(this.options.componentName+", loading desktop resources is finished.");this.callNextConfigurationStep()},onWindowConstructed:function(a){this.logger.debug(this.options.componentName+", constructing desktop window "+a.getName()+" is finished.");this.fireEvent("desktopComponentConstructed",a.name);if(a.getOnReadyCallback()&&typeOf(a.getOnReadyCallback())=="function"){a.getOnReadyCallback()()}},onWindowDestructed:function(a){this.numberOfConstructedWindows--;if(this.numberOfConstructedWindows==0){this.windows.clear();this.destructionChain.callChain()}},onWindowDockerConstructed:function(){this.logger.debug(this.options.componentName+", constructing desktop window docker is finished.");this.callNextConfigurationStep()},showNotification:function(a){if(this.state==DesktopElement.States.CONSTRUCTED){MUI.notification(this.resourceBundle.getText("DesktopNotification."+a))}},showWindow:function(b,a){var c=this.windows.get(b);if(c){if(c.getState()==DesktopElement.States.INITIALIZED){c.unmarshall()}c.construct(a)}return c},unmarshall:function(){this.unmarshallDesktopProperties();this.unmarshallResources();this.unmarshallHeader();this.unmarshallDesktopContentArea();this.unmarshallFooter();this.unmarshallWindowDocker();this.unmarshallColumns();this.unmarshallPanels();this.unmarshallWindows();this.componentStateManager.restoreStateFromUri();this.state=DesktopElement.States.UNMARSHALLED},webUIMessageHandler:function(a){if(this.state!=DesktopElement.States.CONSTRUCTED){return}if(instanceOf(a,MenuSelectedMessage)){switch(a.getActivityType()){case DesktopWindow.Activity.SHOW_NOTIFICATION:this.showNotification(a.getNotification());break;case DesktopWindow.Activity.SHOW_WINDOW:this.showWindow(a.getWindowName());break}}this.lastHandledMessage=a},getColumns:function(){return this.columns},getConfigurationXml:function(){return this.configurationXml},getContainerId:function(){return this.containerId},getCurrentLocale:function(){return this.currentLocale},getDescription:function(){return this.description},getMUIDesktop:function(){return this.MUIDesktop},getFooter:function(){return this.footer},getHeader:function(){return this.header},getName:function(){return this.name},getPanels:function(){return this.panels},getResources:function(){return this.resources},getState:function(){return this.state},getVersion:function(){return this.version},getWindowDocker:function(){return this.windowDocker},getWindows:function(){return this.windows},isSuccess:function(){return this.error==null},callNextConfigurationStep:function(){if(this.isSuccess()){this.constructionChain.callChain()}else{this.revertConstruction()}}.protect(),configureLogger:function(){if(!this.logger.isConfigured()){this.logger.configure(this.webUIConfiguration)}}.protect(),constructColumns:function(){this.logger.debug(this.options.componentName+".constructColumns() started.");if(this.columns.size()>0){this.columns.each(function(d,a){var b=d.getValue();try{b.construct()}catch(c){this.onError(c)}},this)}else{this.callNextConfigurationStep()}}.protect(),constructContentArea:function(){this.logger.debug(this.options.componentName+".constructContentArea() started.");if(this.contentArea){this.contentArea.construct()}else{this.callNextConfigurationStep()}}.protect(),constructHeader:function(){this.logger.debug(this.options.componentName+".constructHeader() started.");if(this.header){this.header.construct()}else{this.callNextConfigurationStep()}}.protect(),constructFooter:function(){this.logger.debug(this.options.componentName+".constructFooter() started.");if(this.footer){this.footer.construct()}else{this.callNextConfigurationStep()}}.protect(),constructPanels:function(){this.logger.debug(this.options.componentName+".constructPanels() started.");if(this.panels.size()>0){this.panels.each(function(d,b){var a=d.getValue();try{a.construct()}catch(c){this.onError(c)}},this)}else{this.callNextConfigurationStep()}}.protect(),constructWindowDocker:function(){this.logger.debug(this.options.componentName+".constructWindowDocker() started.");if(this.windowDocker){this.windowDocker.construct()}else{this.callNextConfigurationStep()}}.protect(),constructWindows:function(){this.logger.debug(this.options.componentName+".constructWindows() started.");this.callNextConfigurationStep()}.protect(),destroyColumns:function(){this.logger.debug(this.options.componentName+".destroyColumns() started.");this.columns.each(function(c,a){var b=c.getValue();b.destroy()},this)}.protect(),destroyContentArea:function(){if(this.contentArea){this.contentArea.destroy()}this.destructionChain.callChain()}.protect(),destroyElementById:function(a){if($(a)){$(a).destroy()}}.protect(),destroyFooter:function(){if(this.footer){this.footer.destroy()}this.destructionChain.callChain()}.protect(),destroyHeader:function(){if(this.header){this.header.destroy()}this.destructionChain.callChain()}.protect(),destroyHiddenElements:function(){this.destroyElementById("windowUnderlay");this.destroyElementById("lbOverlay");this.destroyElementById("lbCenter");this.destroyElementById("lbBottomContainer");this.destructionChain.callChain()}.protect(),destroyPanels:function(){this.logger.debug(this.options.componentName+".destroyPanels() started.");this.panels.each(function(c,b){var a=c.getValue();a.destroy()},this)}.protect(),destroyWindowDocker:function(){if(this.windowDocker){this.windowDocker.destroy()}this.destructionChain.callChain()}.protect(),destroyWindows:function(){this.logger.debug(this.options.componentName+".destroyWindows() started.");this.numberOfConstructedWindows=this.windows.size();if(this.numberOfConstructedWindows>0){this.windows.each(function(b,a){var c=b.getValue();c.destroy()},this)}else{this.destructionChain.callChain()}}.protect(),determineCurrentLocale:function(){if(this.resourceBundle.isLoaded){this.currentLocale=this.resourceBundle.getLocale()}else{this.currentLocale=new ProcessPuzzleLocale();this.currentLocale.parse(this.webUIConfiguration.getI18DefaultLocale())}}.protect(),finalizeConstruction:function(){this.state=DesktopElement.States.CONSTRUCTED;this.stopTimeOutTimer("construct");this.constructionChain.clearChain();this.fireEvent("constructed",this,this.options.eventFireDelay)}.protect(),finalizeDestruction:function(){this.state=DesktopElement.States.INITIALIZED;this.destructionChain.clearChain();this.fireEvent("destructed",this,this.options.eventFireDelay)}.protect(),hideDesktop:function(){this.containerElement.setStyle("visibility","hidden");if(this.destructionChain.$chain.length>0){this.destructionChain.callChain()}this.callNextConfigurationStep()}.protect(),initializeMUI:function(){this.logger.debug(this.options.componentName+".initializeMUI() started.");MUI.myChain=new Chain();MUI.myChain.chain(function(){MUI.Desktop.initialize({desktop:this.containerId,desktopHeader:this.header.getId(),desktopFooter:this.footer.getFooterId(),desktopFooterWrapper:this.footer.getId(),desktopNavBar:this.header.getNavigationBarId(),pageWrapper:this.contentArea.getId()})}.bind(this),function(){MUI.Dock.initialize()});MUI.myChain.callChain();this.MUIDesktop=MUI.Desktop;this.dock=MUI.Dock;this.callNextConfigurationStep()}.protect(),loadResources:function(){this.logger.debug(this.options.componentName+".loadResources() started.");if(this.resources){this.resources.load()}else{this.onResourcesLoaded()}}.protect(),loadI18Resources:function(){if(!this.resourceBundle.isLoaded){this.resourceBundle.load(this.currentLocale)}}.protect(),presetOptionsBasedOnWebUIConfiguration:function(a){if(a!="undefined"&&a!=null){this.options.skin=a.getDefaultSkin();this.options.configurationURI=a.getSkinConfiguration(this.options.skin)}}.protect(),proceedWithConfigurationChainWhenResourcesLoaded:function(){if(this.pendingResourcesCounter>0){return false}else{this.callNextConfigurationStep()}}.protect(),releaseResources:function(){if(this.resources){this.resources.release()}this.destructionChain.callChain()}.protect(),removeDesktopEvents:function(){this.containerElement.removeEvents();window.removeEvents();document.removeEvents();this.destructionChain.callChain()}.protect(),revertConstruction:function(){if(this.resources){this.resources.release()}if(this.header){this.header.destroy()}if(this.contentArea){this.contentArea.destroy()}if(this.footer){this.footer.destroy()}if(this.windowDocker){this.windowDocker.destroy()}this.destroyWindows();this.destroyPanels();this.destroyColumns();this.removeDesktopEvents();this.state=DesktopElement.States.INITIALIZED;this.fireEvent("error",this.error)}.protect(),showDesktop:function(){this.containerElement.setStyle("visibility","visible");this.callNextConfigurationStep()}.protect(),subscribeToWebUIMessages:function(){this.logger.debug(this.options.componentName+".subscribeToWebUIMessages() started.");this.messageBus.subscribeToMessage(MenuSelectedMessage,this.webUIMessageHandler);this.callNextConfigurationStep()}.protect(),timeOut:function(a){this.error=a;this.revertConstruction()}.protect(),unmarshallColumns:function(){var a=this.configurationXml.selectNodes(this.options.columnSelector);a.each(function(c,b){var d=new DesktopColumn(c,{componentContainerId:this.containerId,onConstructed:this.onColumnConstructed,onDestructed:this.onColumnDestructed,onError:this.onError});d.unmarshall();this.columns.put(d.getName(),d)},this)}.protect(),unmarshallDesktopContentArea:function(){var a=this.configurationXml.selectNode(this.options.contentAreaSelector);if(a){this.contentArea=new DesktopContentArea(a,this.resourceBundle,{componentContainerId:this.containerId,onConstructed:this.onContentAreaConstructed,onConstructionError:this.onError});this.contentArea.unmarshall()}}.protect(),unmarshallDesktopProperties:function(){this.name=this.configurationXml.selectNodeText(this.options.nameSelector);this.description=this.configurationXml.selectNodeText(this.options.descriptionSelector);this.version=this.configurationXml.selectNodeText(this.options.versionSelector);this.containerId=this.configurationXml.selectNodeText(this.options.containerIdSelector);if(!this.containerId){this.containerId=this.options.defaultContainerId}this.containerElement=$(this.containerId);if(!this.containerElement){throw new NoneExistingDesktopContainerElementException(this.containerId)}}.protect(),unmarshallFooter:function(){var a=this.configurationXml.selectNode(this.options.footerSelector);if(a){this.footer=new DesktopFooter(a,this.resourceBundle,{componentContainerId:this.containerId,onConstructed:this.onFooterConstructed,onError:this.onError});this.footer.unmarshall()}}.protect(),unmarshallHeader:function(){var a=this.configurationXml.selectNode(this.options.headerSelector);if(a){this.header=new DesktopHeader(a,this.resourceBundle,{componentContainerId:this.containerId,onConstructed:this.onHeaderConstructed,onError:this.onError});this.header.unmarshall()}}.protect(),unmarshallPanels:function(){var a=this.configurationXml.selectNodes(this.options.panelSelector);a.each(function(d,c){var b=new DesktopPanel(d,this.resourceBundle,{componentContainerId:this.containerId,errorDocumentUri:this.options.errorDocumentUri,onConstructed:this.onPanelConstructed,onDestructed:this.onPanelDestructed,onError:this.onError});b.unmarshall();this.panels.put(b.getName(),b)},this)}.protect(),unmarshallResources:function(){var a=this.configurationXml.selectNode(this.options.resourcesSelector);if(a){this.resources=new ResourceManager(a,{onResourcesLoaded:this.onResourcesLoaded,onResourceError:this.onResourceError});this.resources.unmarshall()}}.protect(),unmarshallWindowDocker:function(){var a=this.configurationXml.selectNode(this.options.windowDockerSelector);if(a){this.windowDocker=new WindowDocker(a,this.resourceBundle,{componentContainerId:this.containerId,onConstructed:this.onWindowDockerConstructed,onError:this.onError});this.windowDocker.unmarshall()}}.protect(),unmarshallWindows:function(){var a=this.configurationXml.selectNodes(this.options.windowSelector);a.each(function(c,b){var d=new DesktopWindow(c,this.resourceBundle,{componentContainerId:this.containerId,errorDocumentUri:this.options.errorDocumentUri,onConstructed:this.onWindowConstructed,onDestructed:this.onWindowDestructed,onError:this.onError});d.unmarshall();this.windows.put(d.getName(),d)},this)}.protect(),});var DesktopElement=new Class({Implements:[Events,Options,TimeOutBehaviour],Binds:["checkTimeOut","constructed","createHtmlElement","destroyComponents","destroyHtmlElement","finalizeConstruction","finalizeDestruction","resetProperties","onConstructionError"],options:{componentContainerId:"desktop",componentName:"DesktopElement",defaultTag:"div",definitionXmlNameSpace:"xmlns:pp='http://www.processpuzzle.com'",eventFireDelay:2,idSelector:"@id",tagSelector:"@tag",},initialize:function(b,c,a){this.setOptions(a);this.componentStateManager;this.constructionChain=new Chain();this.containerElement;this.definitionElement=b;this.destructionChain=new Chain();this.error;this.htmlElement;this.id;this.internationalization=c;this.logger;this.messageBus;this.state=DesktopElement.States.UNINITIALIZED;this.tag;this.setUp()},construct:function(){if(this.state!=DesktopElement.States.UNMARSHALLED){throw new UnconfiguredDocumentElementException("destroy","initialized")}this.logger.trace(this.options.componentName+".construct() of '"+this.id+"'started.");this.startTimeOutTimer("construct");this.compileConstructionChain();this.constructionChain.callChain()},destroy:function(){this.logger.trace(this.options.componentName+".destroy() of '"+this.name+"' started.");if(this.state==DesktopElement.States.CONSTRUCTED){this.startTimeOutTimer("destruct");this.compileDestructionChain();this.destructionChain.callChain()}else{this.finalizeDestruction()}},onConstructionError:function(a){this.error=a;this.revertConstruction()},unmarshall:function(){this.state=DesktopElement.States.UNMARSHALLED},getComponentStateManager:function(){return this.componentStateManager},getContainerElement:function(){return this.containerElement},getContainerElementId:function(){return this.options.componentContainerId},getDefinitionElement:function(){return this.definitionElement},getId:function(){return this.id},getState:function(){return this.state},isSuccess:function(){return this.error==null},compileConstructionChain:function(){this.constructionChain.chain(this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyComponents,this.resetProperties,this.destroyHtmlElement,this.finalizeDestruction)}.protect(),configureLogger:function(){if(this.webUIController==null){this.logger=Class.getInstanceOf(WebUILogger);if(this.logger==null){this.logger=new WebUILogger()}}else{this.logger=this.webUIController.getLogger()}}.protect(),createHtmlElement:function(){if(this.tag){this.htmlElement=new Element(this.tag);if(this.id){this.htmlElement.set("id",this.id)}this.htmlElement.inject(this.containerElement)}this.constructionChain.callChain()}.protect(),definitionElementAttribute:function(a){var b=XmlResource.selectNode(a,this.definitionElement);if(b){return b.value}else{return null}}.protect(),destroyComponents:function(){this.destructionChain.callChain()}.protect(),destroyHtmlElement:function(){if(this.htmlElement){this.htmlElement.destroy()}this.destructionChain.callChain()}.protect(),finalizeConstruction:function(){this.stopTimeOutTimer();this.state=DesktopElement.States.CONSTRUCTED;this.constructionChain.clearChain();this.fireEvent("constructed",this,this.options.eventFireDelay)}.protect(),finalizeDestruction:function(){this.stopTimeOutTimer();this.state=DesktopElement.States.INITIALIZED;this.destructionChain.clearChain();this.fireEvent("destructed",this,this.options.eventFireDelay)}.protect(),resetProperties:function(){this.destructionChain.callChain()}.protect(),revertConstruction:function(){this.stopTimeOutTimer();this.state=DesktopElement.States.INITIALIZED;this.fireEvent("error",this.error)}.protect(),setUp:function(){this.componentStateManager=Class.getInstanceOf(ComponentStateManager);this.configureLogger();this.containerElement=$(this.options.componentContainerId);if(this.containerElement==null){throw new IllegalArgumentException("Parameter 'componetContainerId' in invalid.")}this.messageBus=Class.getInstanceOf(WebUIMessageBus);this.state=DesktopElement.States.INITIALIZED}.protect(),timeOut:function(a){this.error=a;this.revertConstruction()}.protect(),unmarshallElementProperties:function(){this.id=this.definitionElementAttribute(this.options.idSelector);if(!this.id){this.id=this.options.idPrefix+(new Date().getTime())}if(this.dataElementsIndex>0){this.id+="#"+this.dataElementsIndex}this.tag=this.definitionElementAttribute(this.options.tagSelector);if(!this.tag){this.tag=this.options.defaultTag}}.protect()});DesktopElement.States={UNINITIALIZED:0,INITIALIZED:1,UNMARSHALLED:2,CONSTRUCTED:3};var DesktopColumn=new Class({Extends:DesktopElement,Binds:["constructMUIColumn","destroyMUIColumn"],options:{componentName:"DesktopColumn",maximumWidthSelector:"maximumWidth",minimumWidthSelector:"minimumWidth",nameSelector:"name",placementSelector:"placement",widthSelector:"width"},initialize:function(b,a){this.parent(b,null,a);this.maximumWidth;this.minimumWidth;this.MUIColumn;this.name;this.placement;this.width},construct:function(){this.parent()},destroy:function(){this.parent()},unmarshall:function(){this.maximumWidth=parseInt(XmlResource.determineAttributeValue(this.definitionElement,this.options.maximumWidthSelector));this.minimumWidth=parseInt(XmlResource.determineAttributeValue(this.definitionElement,this.options.minimumWidthSelector));this.name=XmlResource.determineAttributeValue(this.definitionElement,this.options.nameSelector);this.placement=XmlResource.determineAttributeValue(this.definitionElement,this.options.placementSelector);this.width=parseInt(XmlResource.determineAttributeValue(this.definitionElement,this.options.widthSelector));this.parent()},getMaximumWidth:function(){return this.maximumWidth},getMinimumWidth:function(){return this.minimumWidth},getMUIColumn:function(){return this.MUIColumn},getName:function(){return this.name},getPlacement:function(){return this.placement},getWidth:function(){return this.width},compileConstructionChain:function(){this.constructionChain.chain(this.constructMUIColumn,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyMUIColumn,this.finalizeDestruction)}.protect(),constructMUIColumn:function(){this.MUIColumn=new MUI.Column({id:this.name,placement:this.placement,width:this.width,resizeLimit:[this.minimumWidth,this.maximumWidth]});this.constructionChain.callChain()}.protect(),destroyMUIColumn:function(){if(this.MUIColumn){this.MUIColumn.close()}this.destructionChain.callChain()}.protect()});var DesktopContentArea=new Class({Extends:DesktopElement,options:{componentName:"DesktopContentArea",},initialize:function(c,a,b){this.options.type="DesktopContentArea";this.parent(c,a,b)},construct:function(){this.parent()},unmarshall:function(){this.unmarshallElementProperties();this.parent()},compileConstructionChain:function(){this.constructionChain.chain(this.createHtmlElement,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyHtmlElement,this.finalizeDestruction)}.protect()});var DesktopDocument=new Class({Extends:DesktopElement,Binds:["constructDocument","instantiateDocument","onDocumentError","onDocumentReady"],options:{componentName:"DesktopDocument",documentDataNameSpace:"",documentDataUriSelector:"@documentData",documentDefinitionNameSpace:"xmlns:sd='http://www.processpuzzle.com/SmartDocument'",documentDefinitionUriSelector:"@documentDefinition"},initialize:function(b,a,c){this.parent(b,a,c);this.document;this.documentDataUri;this.documentDefinitionUri},construct:function(){this.parent()},destroy:function(){this.parent()},onDocumentError:function(a){this.onConstructionError(a)},onDocumentReady:function(){this.constructionChain.callChain()},unmarshall:function(){this.unmarshallProperties();this.instantiateDocument();this.parent()},getDocument:function(){return this.document},getDocumentDefinitionUri:function(){return this.documentDefinitionUri},compileConstructionChain:function(){this.constructionChain.chain(this.constructDocument,this.finalizeConstruction)}.protect(),constructDocument:function(){this.document.construct()}.protect(),destroyComponents:function(){if(this.document){this.document.destroy()}this.destructionChain.callChain()}.protect(),instantiateDocument:function(){this.document=new SmartDocument(this.internationalization,{documentContainerId:this.options.componentContainerId,documentDefinitionUri:this.documentDefinitionUri,documentContentUri:this.documentDataUri,onDocumentReady:this.onDocumentReady,onDocumentError:this.onDocumentError});this.document.unmarshall()}.protect(),resetProperties:function(){this.document=null;this.documentDataUri=null;this.documentDefinitionUri=null;this.destructionChain.callChain()}.protect(),revertConstruction:function(){if(this.document&&this.document.getState()>AbstractDocument.States.INITIALIZED){this.document.destroy()}this.document=null;this.parent()},unmarshallProperties:function(){this.documentDefinitionUri=XmlResource.selectNodeText(this.options.documentDefinitionUriSelector,this.definitionElement,[this.options.definitionXmlNameSpace,this.options.documentDefinitionNameSpace])}.protect()});var DesktopElementConfigurationException=new Class({Extends:WebUIException,options:{description:"Configuring '{desktopElementName}' caused error.",name:"ConfigurationTimeoutException"},initialize:function(b,a){this.setOptions(a);this.parent(a);this.parameters={desktopElementName:b}}});var DesktopElementFactory=new Class({Implements:Options,options:{},initialize:function(){},create:function(d,a,b){var c;switch(d.tagName.toUpperCase()){case"COMPOSITEELEMENT":c=new CompositeDesktopElement(d,a,b);break;case"DOCUMENTBODY":c=new DesktopBody(d,a,b);break;case"FOOTER":c=new DesktopFooter(d,a,b);break;case"FOOTERBAR":c=new DesktopFooterBar(d,a,b);break;case"HEADER":c=new DesktopHeader(d,a,b);break;case"NAVIGATIONBAR":c=new DesktopNavigationBar(d,a,b);break;case"TITLEBAR":c=new DesktopTitleBar(d,a,b);break;case"ELEMENT":default:c=new DesktopElement(d,a,b);break}return c}});DesktopElementFactory.create=function(f,a,c){var b=new DesktopElementFactory();var d=b.create(f,a,c);return d};var DesktopFooter=new Class({Extends:DesktopDocument,options:{componentName:"DesktopFooter",subElementsSelector:"footerBar | compositeElement | element",},initialize:function(c,a,b){this.parent(c,a,b);this.footerId},construct:function(){this.parent()},unmarshall:function(){this.parent();this.footerId=this.document.getBody().elements.first().getId()},getId:function(){return this.document.getBody().getId()},getFooterId:function(){return this.footerId}});var DesktopHeader=new Class({Extends:DesktopDocument,options:{componentName:"DesktopHeader",navigationBarId:"desktopNavigationBar"},initialize:function(c,a,b){this.parent(c,a,b)},construct:function(){this.parent()},unmarshall:function(){this.parent()},getId:function(){return this.document.getBody().getId()},getNavigationBarId:function(){return this.options.navigationBarId}});var DesktopPanel=new Class({Extends:DesktopElement,Implements:[ComplexContentBehaviour],Binds:["addScrollBars","constructDocument","constructPlugin","constructHeader","createContentAreaElement","destroyComponents","destroyMUIPanel","determineComponentElements","finalizeConstruction","finalizeDestruction","instantiateMUIPanel","loadHtmlDocument","loadSmartDocument","onContainerResize","onDocumentError","onDocumentReady","onHeaderConstructed","onHeaderConstructionError","onMUIPanelLoaded","onPluginConstructed","onPluginError","restoreComponentState","subscribeToWebUIMessages","webUIMessageHandler"],options:{columnReferenceSelector:"columnReference",componentContentIdPostfix:"",componentName:"DesktopPanel",componentRootElementIdPostfix:"_wrapper",panelContentElementSuffix:"_pad"},initialize:function(c,a,b){this.parent(c,a,b);this.columnReference;this.MUIPanel;this.MUIPanelLoaded=false},construct:function(){this.parent()},destroy:function(){this.parent();this.columnReference=null},onMUIPanelLoaded:function(){this.logger.trace(this.options.componentName+".construct() of '"+this.name+"'s MUIPanel finished.");this.MUIPanelLoaded=true;this.constructionChain.callChain()},unmarshall:function(){this.unmarshallProperties();this.unmarshallPanelProperties();this.unmarshallHeader();this.unmarshallPlugin();this.unmarshallDocument();this.parent()},getColumnReference:function(){return this.columnReference},getContentUrl:function(){return this.contentUrl},getDocument:function(){return this.document},getDocumentContentUri:function(){return this.documentContentUri},getDocumentDefinitionUri:function(){return this.documentDefinitionUri},getDocumentWrapperId:function(){return this.documentWrapperId},getDocumentWrapperStyle:function(){return this.documentWrapperStyle},getDocumentWrapperTag:function(){return this.documentWrapperTag},getHeader:function(){return this.header},getMUIPanel:function(){return this.MUIPanel},getName:function(){return this.name},getPlugin:function(){return this.plugin},getShowHeader:function(){return this.showHeader},getState:function(){return this.state},getTitle:function(){return this.title},getToolBox:function(){return this.header},isSuccess:function(){return this.error==null},compileConstructionChain:function(){this.constructionChain.chain(this.restoreComponentState,this.instantiateMUIPanel,this.determineComponentElements,this.constructHeader,this.createContentAreaElement,this.constructPlugin,this.constructDocument,this.addScrollBars,this.subscribeToWebUIMessages,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyComponents,this.resetProperties,this.destroyHtmlElement,this.destroyMUIPanel,this.finalizeDestruction)}.protect(),destroyMUIPanel:function(){if(this.MUIPanel){this.MUIPanel.removeEvents();this.MUIPanel.destroy();this.MUIPanel=null}this.destructionChain.callChain()}.protect(),determinePanelElement:function(){this.componentRootElement=$(this.name+this.options.panelIdPostfix);this.componentRootElement=$(this.componentRootElement);this.panelContentElement=$(this.name);this.constructionChain.callChain()}.protect(),instantiateMUIPanel:function(){var a=this.header&&this.header.getPlugin()?"":this.title;try{this.MUIPanel=new MUI.Panel({column:this.columnReference,content:"",onContentLoaded:this.header?null:this.onMUIPanelLoaded,contentURL:this.contentUrl,id:this.name,header:this.showHeader,headerToolbox:this.header?true:false,headerToolboxOnload:this.header?this.onMUIPanelLoaded:null,headerToolboxURL:this.header?this.header.getToolBoxUrl():null,height:this.height,onResize:this.onContainerResize,scrollbars:true,title:a})}catch(b){var c=b.name+": "+b.message;c+=b.stack?"\n"+b.stack:"";this.logger.error(c);this.fireEvent("constructed",this,3*this.options.eventFireDelay);this.onConstructionError(b)}}.protect(),loadHtmlDocument:function(b){this.documentContentUri=b.getDocumentURI();this.documentContentType=b.getDocumentType();var a=this.documentContentUri+this.options.documentNameSeparator+this.resourceBundle.getLocale().getLanguage()+".html";MUI.updateContent({element:$(this.name),onContentLoaded:this.onDocumentReady,padding:{top:0,right:5,bottom:0,left:5},title:this.title,url:a})}.protect(),revertConstruction:function(){this.revertComplexContentBehaviour();this.parent()}.protect(),unmarshallPanelProperties:function(){this.columnReference=XmlResource.determineAttributeValue(this.definitionElement,this.options.columnReferenceSelector)}.protect(),});var DesktopPanelHeader=new Class({Implements:[Events,Options],Binds:["construct","onPluginConstructed","onPluginConstructionError"],options:{componentName:"DesktopPanelHeader",contentStyleSelector:"@contentStyle",contextRootPrefix:"",headerSelector:"panelHeader",pluginSelector:"plugin",toolboxContent:"JavaScript/Source/Desktop/EmptyToolboxContent.html",toolboxSelector:"toolBox",toolBoxUrlSelector:"@toolBoxUrl",type:"DesktopPanel"},initialize:function(b,c,a){this.setOptions(a);this.contentStyle;this.contextElement;this.definitionElement=b;this.error=false;this.internationalization=c;this.logger=Class.getInstanceOf(WebUILogger);this.plugin;this.state=DesktopPanelHeader.States.INITIALIZED;this.toolBox=null;this.toolBoxOnLoad=null;this.toolBoxUrl=this.options.toolboxContent},construct:function(a,b){this.contextElement=a;this.constructPlugin();this.addContentStyle()},destroy:function(){if(this.plugin){this.plugin.destroy()}},onPluginConstructed:function(){this.state=DesktopPanelHeader.States.CONSTRUCTED;this.fireEvent("headerConstructed",this)},onPluginConstructionError:function(){this.error=true;this.revertConstruction();this.state=DesktopPanelHeader.States.INITIALIZED;this.fireEvent("headerConstructionError",this)},unmarshall:function(){this.contentStyle=XmlResource.selectNodeText(this.options.contentStyleSelector,this.definitionElement);this.toolBoxUrl=XmlResource.selectNodeText(this.options.toolBoxUrlSelector,this.definitionElement);if(!this.toolBoxUrl){this.toolBoxUrl=this.options.contextRootPrefix+this.options.toolboxContent}var a=XmlResource.selectNode(this.options.pluginSelector,this.definitionElement);if(a){this.plugin=new DocumentPlugin(a,this.internationalization,{onConstructed:this.onPluginConstructed,onConstructionError:this.onPluginConstructionError});this.plugin.unmarshall()}this.state=DesktopPanelHeader.States.UNMARSHALLED},getContentStyle:function(){return this.contentStyle},getDefinitionElement:function(){return this.definitionElement},getHeaderToolBox:function(){return this.plugin!=null},getPlugin:function(){return this.plugin},getState:function(){return this.state},getToolBoxUrl:function(){return this.toolBoxUrl},addContentStyle:function(){if(this.contentStyle){this.contextElement.getElementById(this.contextElement.get("id")+"Content").addClass(this.contentStyle)}}.protect(),constructPlugin:function(){if(this.plugin){this.plugin.construct()}else{this.onPluginConstructed()}}.protect(),revertConstruction:function(){if(this.plugin){this.plugin.destroy()}}});DesktopPanelHeader.States={UNINITIALIZED:0,INITIALIZED:1,UNMARSHALLED:2,CONSTRUCTED:3};var DesktopStructure=new Class({Implements:[Options],options:{desktopColumnIdSelector:"name",desktopColumnMaximumWidthSelector:"maximumWidth",desktopColumnMinimumWidthSelector:"minimumWidth",desktopColumnPlacementSelector:"placement",desktopColumnWidthSelector:"width",desktopColumnsSelector:"/pp:desktopConfiguration/columns/column",desktopElementId:"desktop",desktopPanelColumnSelector:"columnReference",desktopPanelContentUrlSelector:"contentURL",desktopPanelHeightSelector:"height",desktopPanelIdSelector:"name",desktopPanelRequireSelector:"require",desktopPanelsSelector:"/pp:desktopConfiguration/panels/panel",desktopPanelTitleSelector:"title",dockerAutoHideId:"dockAutoHide",dockerClearId:"dockClear",dockerClearClass:"clear",dockerControlsId:"dock",dockerPlacementId:"dockPlacement",dockerSelector:"/pp:desktopConfiguration/windowDocker",dockerSortId:"dockSort",dockerWrapperId:"dockWrapper",documentContainerId:"pageWrapper",elementsSelector:"elements/element",footerBarSelector:"/pp:desktopConfiguration/footer/footerBar",footerBarElementId:"desktopFooter",footerElementId:"desktopFooterWrapper",footerSelector:"/pp:desktopConfiguration/footer",headerElementId:"desktopHeader",headerSelector:"/pp:desktopConfiguration/header",navigationBarSelector:"/pp:desktopConfiguration/header/navigationBar",navigationBarElementId:"desktopNavbar",idAttributeSelector:"@name",styleSheetElementsSelector:"pp:desktopConfiguration/resources/styleSheets/styleSheet",tagAttributeSelector:"@tag",titleBarSelector:"/pp:desktopConfiguration/header/titleBar",titleBarWrapperId:"desktopTitlebarWrapper"},initialize:function(a,b){this.setOptions(a);this.configurationXml=b;this.desktopColumns=new ArrayList();this.desktopElement=$(this.options.desktopElementId);this.desktopPanels=new ArrayList();this.desktopWindows=new ArrayList();this.documentContainerElement=null;this.footerBarElement=null;this.footerElement=null;this.headerElement=null;this.navigationBarElement=null;this.titleBarElement=null;this.titleBarWrapperElement=null},addDesktopColumn:function(a){this.desktopColumns.add(a)},determineDesktopElementId:function(){return this.desktopElement!=null?this.desktopElement.get("id"):this.options.desktopElementId},determineHeaderElementId:function(){return this.headerElement!=null?this.headerElement.get("id"):this.options.headerElementId},determineFooterElementId:function(){return this.footerElement!=null?this.footerElement.get("id"):this.options.footerElementId},determineNavigationBarElementId:function(){return this.navigationBarElement!=null?this.navigationBarElement.get("id"):this.options.navigationBarElementId},determineDocumentContainerElementId:function(){return this.documentContainerElement!=null?this.documentContainerElement.get("id"):this.options.documentContainerElementId},determineFooterBarElementId:function(){return this.footerBarElement!=null?this.footerBarElement.get("id"):this.options.footerBarElementId},getDesktopColumnIdSelector:function(){return this.options.desktopColumnIdSelector},getDesktopColumnMaximumWidthSelector:function(){return this.options.desktopColumnMaximumWidthSelector},getDesktopColumnMinimumWidthSelector:function(){return this.options.desktopColumnMinimumWidthSelector},getDesktopColumnPlacementSelector:function(){return this.options.desktopColumnPlacementSelector},getDesktopColumnWidthSelector:function(){return this.options.desktopColumnWidthSelector},getDesktopColumns:function(){return this.desktopColumns},getDesktopColumnsSelector:function(){return this.options.desktopColumnsSelector},getDesktopElement:function(){return this.desktopElement},getDesktopPanelContentUrlSelector:function(){return this.options.desktopPanelContentUrlSelector},getDesktopPanelColumnSelector:function(){return this.options.desktopPanelColumnSelector},getDesktopPanelHeightSelector:function(){return this.options.desktopPanelHeightSelector},getDesktopPanelIdSelector:function(){return this.options.desktopPanelIdSelector},getDesktopPanelRequireSelector:function(){return this.options.desktopPanelRequireSelector},getDesktopPanels:function(){return this.desktopPanels},getDesktopPanelsSelector:function(){return this.options.desktopPanelsSelector},getDesktopPanelTitleSelector:function(){return this.options.desktopPanelTitleSelector},getDesktopWindows:function(){return this.desktopWindows},getDocumentContainerElement:function(){return this.documentContainerElement},getDocumentContainerId:function(){return this.options.documentContainerId},getElementsSelector:function(){return this.options.elementsSelector},getFooterBarElement:function(){return this.footerBarElement},getFooterBarSelector:function(){return this.options.footerBarSelector},getFooterElement:function(){return this.footerElement},getFooterSelector:function(){return this.options.footerSelector},getHeaderElement:function(){return this.headerElement},getHeaderSelector:function(){return this.options.headerSelector},getIdAttributeSelector:function(){return this.options.idAttributeSelector},getNavigationBarElement:function(){return this.navigationBarElement},getNavigationBarSelector:function(){return this.options.navigationBarSelector},getStyleSheetByIndex:function(a){var b=this.getStyleSheetElementByIndex(a);return this.configurationXml.selectNode("text()",b).nodeValue},getStyleSheetElementByIndex:function(a){return this.getStyleSheetElements()[a]},getStyleSheetElements:function(){return this.configurationXml.selectNodes(this.options.styleSheetElementsSelector)},getTagAttributeSelector:function(){return this.options.tagAttributeSelector},getTitleBarElement:function(){return this.titleBarElement},getTitleBarSelector:function(){return this.options.titleBarSelector},getTitleBarWrapperElement:function(){return this.titleBarWrapperElement},getTitleBarWrapperId:function(){return this.options.titleBarWrapperId},getWindowDockerAutoHideId:function(){return this.options.dockerAutoHideId},getWindowDockerClearId:function(){return this.options.dockerClearId},getWindowDockerClearClass:function(){return this.options.dockerClearClass},getWindowDockerControlsId:function(){return this.options.dockerControlsId},getWindowDockerId:function(){return this.options.dockerWrapperId},getWindowDockerPlacementId:function(){return this.options.dockerPlacementId},getWindowDockerSelector:function(){return this.options.dockerSelector},getWindowDockerSortId:function(){return this.options.dockerSortId},setDesktopElement:function(a){this.desktopElement=a},setDocumentContainerElement:function(a){this.documentContainerElement=a},setFooterBarElement:function(a){this.footerBarElement=a},setFooterElement:function(a){this.footerElement=a},setHeaderElement:function(a){this.headerElement=a},setNavigationBarElement:function(a){this.navigationBarElement=a},setTitleBarElement:function(a){this.titleBarElement=a},setTitleBarWrapperElement:function(a){this.titleBarWrapperElement=a}});var DesktopWindow=new Class({Extends:DesktopElement,Implements:[ComplexContentBehaviour],Binds:["addScrollBars","constructDocument","constructHeader","constructPlugin","createContentAreaElement","destroy","destroyMUIWindow","determineComponentElements","finalizeConstruction","instantiateMUIWindow","loadHtmlDocument","loadSmartDocument","onContainerResize","onDocumentError","onDocumentReady","onHeaderConstructed","onHeaderConstructionError","onMUIWindowLoaded","onPluginConstructed","onPluginError","restoreComponentState","subscribeToWebUIMessages","webUIMessageHandler"],options:{componentContainerId:"desktop",componentContentIdPostfix:"_content",componentName:"DesktopWindow",componentRootElementIdPostfix:"",},initialize:function(b,c,a){this.parent(b,c,a);this.MUIWindow;this.onReadyCallBack},construct:function(a){this.onReadyCallBack=a;this.parent()},destroy:function(){this.parent()},onMUIWindowLoaded:function(){this.constructionChain.callChain()},unmarshall:function(){this.unmarshallProperties();this.unmarshallWindowProperties();this.unmarshallHeader();this.unmarshallPlugin();this.unmarshallDocument();this.parent()},getMUIWindow:function(){return this.MUIWindow},getOnReadyCallback:function(){return this.onReadyCallBack},getWindowContentElement:function(){return this.contentContainerElement},getWindowElement:function(){return this.componentRootElement},compileConstructionChain:function(){this.constructionChain.chain(this.instantiateMUIWindow,this.determineComponentElements,this.constructHeader,this.createContentAreaElement,this.constructPlugin,this.constructDocument,this.addScrollBars,this.subscribeToWebUIMessages,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyComponents,this.resetProperties,this.destroyHtmlElement,this.destroyMUIWindow,this.finalizeDestruction)}.protect(),destroyMUIWindow:function(){if(this.MUIWindow){this.MUIWindow.removeEvents();this.MUIWindow.destroy();this.MUIWindow=null}this.destructionChain.callChain()}.protect(),instantiateMUIWindow:function(){if(this.contentUrl){this.internationalizeContentUri()}this.MUIWindow=new MUI.Window({container:this.containerElement,contentURL:this.contentUrl?this.contentUrl:null,height:this.height,id:this.name,onClose:this.destroy,onContentLoaded:this.contentUrl?this.onMUIWindowLoaded:null,onResize:this.onContainerResize,title:this.internationalization.getText(this.title),width:this.width});if(!this.contentUrl){this.constructionChain.callChain()}}.protect(),revertConstruction:function(){this.revertComplexContentBehaviour();this.parent()}.protect(),unmarshallWindowProperties:function(){}.protect(),});DesktopWindow.Activity={SHOW_WINDOW:"showWindow",SHOW_NOTIFICATION:"showNotification"};var NoneExistingDesktopContainerElementException=new Class({Extends:WebUIException,options:{description:"The specifified desktop container element: '{desktopContainerId}' doesn't exist.",name:"NoneExistingDesktopContainerElementException"},initialize:function(b,a){this.setOptions(a);this.parent(a);this.parameters={desktopContainerId:b}}});var PanelInterpreter=new Class({Implements:[Options],options:{headerSelector:"panelHeader",pluginSelector:"plugin",toolboxContent:"../Desktop/EmptyToolboxContent.html"},initialize:function(b,a){this.setOptions(a);this.headerToolBox=false;this.headerToolBoxOnLoad=null;this.headerToolBoxURL=this.options.toolboxContent;this.panelConfiguration=b;this.headerPlugin=null},interpret:function(){this.interpretPanelHeader()},getHeaderPlugin:function(){return this.headerPlugin},getHeaderToolBox:function(){return this.headerToolBox},getHeaderToolBoxOnLoad:function(){return this.headerToolBoxOnLoad},getHeaderToolBoxURL:function(){return this.headerToolBoxURL},interpretPanelHeader:function(){var a=XmlResource.selectNode(this.options.headerSelector,this.panelConfiguration);if(a){this.headerToolBox=true;this.interpretPlugin(a);this.headerToolBoxOnLoad=this.headerPlugin.onload}}.protect(),interpretPlugin:function(parentConfigurationElement){this.headerPlugin={css:[],images:[],js:[],onload:null};var pluginText=XmlResource.selectNodeText(this.options.pluginSelector,parentConfigurationElement);this.headerPlugin=pluginText!=null?eval("("+pluginText+")"):this.headerPlugin}});var ResourceLoadTimeoutException=new Class({Extends:WebUIException,options:{description:"Loading one or more resources exceeded the '{resourceLoadTimeout}' ms timeout period.",name:"ResourceLoadTimeoutException"},initialize:function(b,a){this.setOptions(a);this.parent(a);this.parameters={resourceLoadTimeout:b}}});var ResourceNotFoundException=new Class({Extends:WebUIException,options:{description:"Resource '{resourceName}' not found.",name:"ResourceNotFoundException"},initialize:function(b,a){this.setOptions(a);this.parent(a);this.parameters={resourceName:b}}});var UnconfiguredDesktopElementException=new Class({Extends:WebUIException,options:{description:"When calling method: '{methodName}' of a DocumentElement it should be in: '{statusName}' .",name:"UnconfiguredDesktopElementException"},initialize:function(b,a,c){this.setOptions(c);this.parent(c);this.parameters={methodName:b,statusName:a}}});var WindowDocker=new Class({Extends:DesktopElement,Binds:["createDockerElements","injectDockerElement"],options:{componentName:"WindowDocker",dockerAutoHideId:"dockAutoHide",dockerClearId:"dockClear",dockerClearClass:"clear",dockerControlsId:"dock",dockerPlacementId:"dockPlacement",dockerSelector:"/desktopConfiguration/windowDocker",dockerSortId:"dockSort",dockerWrapperId:"dockWrapper"},initialize:function(c,a,b){this.parent(c,a,b);this.dockerAutoHideElement;this.dockerClearElement;this.dockerControlsElement;this.dockerPlacementElement;this.dockerSortElement},construct:function(){this.parent()},destroy:function(){this.parent()},unmarshall:function(){this.unmarshallElementProperties();this.parent()},compileConstructionChain:function(){this.constructionChain.chain(this.createDockerElements,this.createHtmlElement,this.injectDockerElement,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyComponents,this.resetProperties,this.destroyHtmlElement,this.finalizeDestruction)}.protect(),createDockerElements:function(){this.dockerControlsElement=new Element("div",{id:this.options.dockerControlsId});this.dockerPlacementElement=new Element("div",{id:this.options.dockerPlacementId});this.dockerAutoHideElement=new Element("div",{id:this.options.dockerAutoHideId});this.dockerSortElement=new Element("div",{id:this.options.dockerSortId});this.dockerClearElement=new Element("div",{id:this.options.dockerClearId,"class":this.options.dockerClearClass});this.constructionChain.callChain()}.protect(),destroyComponents:function(){this.dockerClearElement.destroy();this.dockerSortElement.destroy();this.dockerAutoHideElement.destroy();this.dockerPlacementElement.destroy();this.destructionChain.callChain()}.protect(),injectDockerElement:function(){this.htmlElement.grab(this.dockerControlsElement,"bottom");this.dockerControlsElement.grab(this.dockerPlacementElement,"bottom");this.dockerControlsElement.grab(this.dockerAutoHideElement,"bottom");this.dockerControlsElement.grab(this.dockerSortElement,"bottom");this.dockerSortElement.grab(this.dockerClearElement,"bottom");this.constructionChain.callChain()}.protect(),resetProperties:function(){this.dockerAutoHideElement=null;this.dockerClearElement=null;this.dockerControlsElement=null;this.dockerPlacementElement=null;this.dockerSortElement=null;this.destructionChain.callChain()}.protect()});var DiagramWidget=new Class({Extends:BrowserWidget,Binds:["destroyCanvas","destroyFigures","drawCanvas","drawFigures","onFigureConstructed","onFigureConstructionError"],options:{authorSelector:"//pp:widgetDefinition/author",canvasHeightDefault:200,canvasHeightSelector:"//pp:widgetDefinition/canvas/@height",canvasWidthDefault:300,canvasWidthSelector:"//pp:widgetDefinition/canvas/@width",componentName:"DiagramWidget",descriptionSelector:"//pp:widgetDefinition/description",figuresSelector:"//pp:widgetDefinition/figures/annotation | //pp:widgetDefinition/figures/class | //pp:widgetDefinition/figures/inheritanceConnection",nameSelector:"//pp:widgetDefinition/name",paintAreaId:"paintarea",titleSelector:"//pp:widgetDefinition/title",widgetContainerId:"DiagramWidget",widgetDefinitionURI:"MenuDefinition.xml"},initialize:function(a,b){this.parent(a,b);this.author;this.canvas;this.canvasHeight;this.canvasWidth;this.description;this.figures=new ArrayList();this.figuresConstructionChain=new Chain();this.name;this.title;this.paintArea},construct:function(a){this.parent()},destroy:function(){this.parent()},onFigureConstructed:function(a){this.figuresConstructionChain.callChain()},onFigureConstructionError:function(a){this.error=a;this.revertConstruction()},unmarshall:function(){this.unmarshallProperties();this.unmarshallFigures();return this.parent()},getAuthor:function(){return this.author},getCanvas:function(){return this.canvas},getCanvasHeight:function(){return this.canvasHeight},getCanvasWidth:function(){return this.canvasWidth},getDescription:function(){return this.i18Resource.getText(this.description)},getFigures:function(){return this.figures},getName:function(){return this.name},getTitle:function(){return this.i18Resource.getText(this.title)},getPaintArea:function(){return this.paintArea},compileConstructionChain:function(){this.constructionChain.chain(this.drawCanvas,this.drawFigures,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyFigures,this.destroyCanvas,this.destroyChildHtmlElements,this.finalizeDestruction)}.protect(),destroyCanvas:function(){if(this.paintArea&&this.paintArea.destroy){this.paintArea.destroy()}this.destructionChain.callChain()}.protect(),destroyFigures:function(){this.figures.each(function(a,b){a.destroy()}.bind(this));this.figures.clear();this.destructionChain.callChain()}.protect(),drawCanvas:function(){this.paintArea=this.elementFactory.create("div",null,this.containerElement,WidgetElementFactory.Positions.LastChild,{id:this.options.paintAreaId,styles:{height:this.canvasHeight,width:this.canvasWidth}});this.canvas=new draw2d.Workflow(this.options.paintAreaId);this.constructionChain.callChain()}.protect(),drawFigures:function(){if(this.figures.size()>0){this.figures.each(function(a,b){this.figuresConstructionChain.chain(function(){a.draw(this)}.bind(this))},this);this.figuresConstructionChain.chain(function(){this.figuresConstructionChain.clearChain();this.constructionChain.callChain()}.bind(this));this.figuresConstructionChain.callChain()}else{this.constructionChain.callChain()}}.protect(),unmarshallFigures:function(){var a=this.definitionXml.selectNodes(this.options.figuresSelector);if(a){a.each(function(c,d){var b=DiagramFigureFactory.create(c,this.i18Resource,{onFigureConstructed:this.onFigureConstructed,onFigureConstructionError:this.onFigureConstructionError});b.unmarshall();this.figures.add(b)},this)}}.protect(),unmarshallProperties:function(){this.name=this.unmarshallWidgetProperty(null,this.options.nameSelector);this.description=this.unmarshallWidgetProperty("",this.options.descriptionSelector);this.title=this.unmarshallWidgetProperty("",this.options.titleSelector);this.author=this.unmarshallWidgetProperty("",this.options.authorSelector);this.canvasHeight=parseInt(this.unmarshallWidgetProperty(this.options.canvasHeightDefault,this.options.canvasHeightSelector));this.canvasWidth=parseInt(this.unmarshallWidgetProperty(this.options.canvasWidthDefault,this.options.canvasWidthSelector))}.protect(),unmarshallWidgetProperty:function(c,a){var b=this.definitionXml.selectNodeText(a);if(b){return b}else{return c}}.protect()});var DiagramFigure=new Class({Implements:[Events,Options],Binds:["addFigureToCanvas","finalizeDraw"],options:{componentName:"DiagramFigure",nameSelector:"@name",positionXSelector:"@positionX",positionYSelector:"@positionY"},initialize:function(b,c,a){this.setOptions(a);this.canvas;this.definitionXml=b;this.diagram;this.draw2dObject;this.drawChain=new Chain();this.internationalization=c;this.name;this.positionX;this.positionY;this.state=DiagramFigure.States.INITIALIZED},destroy:function(){if(this.state==DiagramFigure.States.CONSTRUCTED){this.removeFigureFromCanvas();this.state=DiagramFigure.States.INITIALIZED}},draw:function(a){assertThat(a,not(nil()));this.diagram=a;this.canvas=a.getCanvas();this.compileDrawChain();this.drawChain.callChain()},unmarshall:function(){this.unmarshallProperties();this.state=DiagramFigure.States.UNMARSHALLED},getDraw2dObject:function(){return this.draw2dObject},getId:function(){return this.draw2dObject.id},getInternationalizedName:function(){return this.internationalization.getText(this.getName())},getName:function(){return this.name},getPositionX:function(){return this.positionX},getPositionY:function(){return this.positionY},getState:function(){return this.state},compileDrawChain:function(){this.drawChain.chain(this.instantiateDraw2dObject,this.addFigureToCanvas,this.finalizeDraw)}.protect(),addFigureToCanvas:function(){this.canvas.addFigure(this.draw2dObject,this.positionX,this.positionY);this.drawChain.callChain()}.protect(),finalizeDraw:function(){this.drawChain.clearChain();this.state=DiagramFigure.States.CONSTRUCTED;this.fireEvent("figureConstructed",this)}.protect(),lookUpDiagramFigure:function(a){var b=null;this.diagram.getFigures().each(function(c,d){if(c.getName()==a){b=c}}.bind(this));return b}.protect(),removeFigureFromCanvas:function(){this.canvas.removeFigure(this.draw2dObject)}.protect(),unmarshallProperties:function(){this.name=XmlResource.selectNodeText(this.options.nameSelector,this.definitionXml);this.positionX=XmlResource.selectNodeText(this.options.positionXSelector,this.definitionXml);this.positionY=XmlResource.selectNodeText(this.options.positionYSelector,this.definitionXml)}.protect()});DiagramFigure.States={UNINITIALIZED:0,INITIALIZED:1,UNMARSHALLED:2,CONSTRUCTED:3};var AnnotationFigure=new Class({Extends:DiagramFigure,Implements:[Events,Options],Binds:["instantiateDraw2dObject","drawAttributes","setDimension"],options:{componentName:"AnnotationFigure",textSelector:"text",heightSelector:"@height",widthSelector:"@width"},initialize:function(b,c,a){this.parent(b,c,a);this.height;this.text;this.width},destroy:function(){this.parent()},draw:function(a){this.parent(a)},unmarshall:function(){this.parent()},getHeight:function(){return this.height},getText:function(){return this.text},getWidth:function(){return this.width},compileDrawChain:function(){this.drawChain.chain(this.instantiateDraw2dObject,this.setDimension,this.addFigureToCanvas,this.finalizeDraw)}.protect(),instantiateDraw2dObject:function(){this.draw2dObject=new draw2d.Annotation(this.text);this.drawChain.callChain()}.protect(),setDimension:function(){this.draw2dObject.setDimension(this.width,this.height);this.drawChain.callChain()}.protect(),unmarshallProperties:function(){this.text=XmlResource.selectNodeText(this.options.textSelector,this.definitionXml);if(this.text){this.text=this.internationalization.getText(this.text)}this.height=parseInt(XmlResource.selectNodeText(this.options.heightSelector,this.definitionXml));this.width=parseInt(XmlResource.selectNodeText(this.options.widthSelector,this.definitionXml));this.parent()}.protect()});var AttributeFigure=new Class({Extends:DiagramFigure,Binds:[],options:{componentName:"AttributeFigure",defaultValueSelector:"@defaultValue",nameSelector:"@name",typeSelector:"@type"},initialize:function(b,c,a){this.setOptions(a);this.defaultValue;this.definitionXml=b;this.internationalization=c;this.name;this.type},destroy:function(){this.parent()},draw:function(a){this.parent(a)},unmarshall:function(){this.parent()},getDefaultValue:function(){return this.defaultValue},getType:function(){return this.type},unmarshallProperties:function(){this.type=XmlResource.selectNodeText(this.options.typeSelector,this.definitionXml);this.defaultValue=XmlResource.selectNodeText(this.options.defaultValueSelector,this.definitionXml);this.parent()}.protect()});var ClassFigure=new Class({Extends:DiagramFigure,Implements:[Events,Options],Binds:["instantiateDraw2dObject","drawAttributes"],options:{attributesSelector:"attributes/attribute",componentName:"ClassFigure"},initialize:function(b,c,a){this.parent(b,c,a);this.attributes=new ArrayList()},destroy:function(){this.parent()},draw:function(a){this.parent(a)},unmarshall:function(){this.unmarshallAttributes();this.parent()},getAttributes:function(){return this.attributes},compileDrawChain:function(){this.drawChain.chain(this.instantiateDraw2dObject,this.drawAttributes,this.addFigureToCanvas,this.finalizeDraw)}.protect(),drawAttributes:function(){this.attributes.each(function(b,a){this.draw2dObject.addAttribute(b.getInternationalizedName(),b.getType(),b.getDefaultValue())}.bind(this));this.drawChain.callChain()}.protect(),instantiateDraw2dObject:function(){this.draw2dObject=new draw2d.shape.uml.Class(this.getInternationalizedName());this.drawChain.callChain()}.protect(),unmarshallAttributes:function(){var a=this.definitionXml.selectNodes(this.options.attributesSelector);if(a){if(!a.each){a=Array.from(a)}a.each(function(d,b){var c=new AttributeFigure(d,this.internationalization);c.unmarshall();this.attributes.add(c)},this)}}.protect()});var ConnectionFigure=new Class({Extends:DiagramFigure,Implements:[Events,Options],Binds:["instantiateDraw2dObject","linkSourceAndTarget"],options:{componentName:"ConnectionFigure",sourceSelector:"@source",targetSelector:"@target"},initialize:function(b,c,a){this.parent(b,c,a);this.sourceFigureName;this.targetFigureName},destroy:function(){this.parent()},draw:function(a){this.parent(a)},unmarshall:function(){this.parent()},getSourceFigureName:function(){return this.sourceFigureName},getTargetFigureName:function(){return this.targetFigureName},compileDrawChain:function(){this.drawChain.chain(this.instantiateDraw2dObject,this.linkSourceAndTarget,this.addFigureToCanvas,this.finalizeDraw)}.protect(),instantiateDraw2dObject:function(){this.draw2dObject=new draw2d.Connection(this.name);this.drawChain.callChain()}.protect(),linkSourceAndTarget:function(){var b=this.lookUpDiagramFigure(this.sourceFigureName);var a=this.lookUpDiagramFigure(this.targetFigureName);this.draw2dObject.setSource(b.getDraw2dObject().portTop);this.draw2dObject.setTarget(a.getDraw2dObject().portTop);this.drawChain.callChain()}.protect(),unmarshallProperties:function(){this.sourceFigureName=XmlResource.selectNodeText(this.options.sourceSelector,this.definitionXml);this.targetFigureName=XmlResource.selectNodeText(this.options.targetSelector,this.definitionXml);this.parent()}.protect()});var DiagramFigureFactory=new Class({Implements:Options,options:{},initialize:function(){},create:function(c,d,b){var a;switch(c.tagName.toUpperCase()){case"ANNOTATION":a=new AnnotationFigure(c,d,b);break;case"CLASS":a=new ClassFigure(c,d,b);break;case"INHERITANCECONNECTION":default:a=new InheritanceConnectionFigure(c,d,b);break}return a}});DiagramFigureFactory.create=function(d,f,c){var b=new DiagramFigureFactory();var a=b.create(d,f,c);return a};var InheritanceConnectionFigure=new Class({Extends:ConnectionFigure,Implements:[Events,Options],Binds:["instantiateDraw2dObject"],options:{componentName:"InheritanceConnectionFigure"},initialize:function(b,c,a){this.parent(b,c,a)},destroy:function(){this.parent()},draw:function(a){this.parent(a)},unmarshall:function(){this.parent()},instantiateDraw2dObject:function(){this.draw2dObject=new draw2d.shape.uml.InheritanceConnection(this.name);this.drawChain.callChain()}.protect()});var DocumentEditor=new Class({Implements:[Events,Options],Binds:["determineStyleSheets","finalizeAttach","instantiateTools","subscribeToWebUIMessages","webUIMessageHandler"],options:{componentName:"DocumentEditor",subscribeToWebUIMessages:[],},initialize:function(b,a){this.setOptions(a);this.internationalization=b;this.attachChain=new Chain();this.lastWebUIMessage;this.logger=Class.getInstanceOf(WebUILogger);this.messageBus=Class.getInstanceOf(WebUIMessageBus);this.styleSheets=new ArrayList();this.subjectElement},attach:function(a){this.subjectElement=a;this.attachChain.chain(this.determineStyleSheets,this.instantiateTools,this.subscribeToWebUIMessages,this.finalizeAttach);this.attachChain.callChain()},detach:function(){this.destroyTools();this.writeOffFromWebUIMessages();this.finalizeDetach()},showNotification:function(a){var b=new MenuSelectedMessage({originator:this.name,activityType:DesktopWindow.Activity.SHOW_NOTIFICATION,notification:this.options.componentName+"."+a});this.messageBus.notifySubscribers(b)},showWindow:function(a){var b=new MenuSelectedMessage({originator:this.name,activityType:DesktopWindow.Activity.SHOW_WINDOW,windowName:a});this.messageBus.notifySubscribers(b)},webUIMessageHandler:function(webUIMessage){var messageHandlerName="this.on"+webUIMessage.getName();try{var messageHandler=eval(messageHandlerName);messageHandler(webUIMessage)}catch(e){this.logger.debug("'"+messageHandleName+"' should be implemented.")}this.lastWebUIMessage=webUIMessage},getSubjectElement:function(){return this.subjectElement},destroyTools:function(){}.protect(),determineStyleSheets:function(){var a=this.subjectElement.getDocument().getElements("link");a.each(function(b,c){try{this.styleSheets.add(b.get("href"))}catch(d){this.logger.error(this.options.componentName+".determineStyleSheets() caused an error.")}},this);this.attachChain.callChain()}.protect(),finalizeAttach:function(){this.attachChain.clearChain();this.fireEvent("editorAttached",this)}.protect(),finalizeDetach:function(){this.fireEvent("editorDetached",this)}.protect(),instantiateTools:function(){this.attachChain.callChain()}.protect(),subscribeToWebUIMessages:function(){if(this.options.subscribeToWebUIMessages){this.options.subscribeToWebUIMessages.each(function(a,b){this.messageBus.subscribeToMessage(a,this.webUIMessageHandler)},this)}this.attachChain.callChain()}.protect(),writeOffFromWebUIMessages:function(){if(this.options.subscribeToWebUIMessages){this.options.subscribeToWebUIMessages.each(function(a,b){this.messageBus.writeOffFromMessage(a,this.webUIMessageHandler)},this)}}.protect(),});var MenuItem=new Class({Implements:[Events,Options],Binds:["onClick"],options:{accordionBehaviour:false,accordionParent:"",captionSelector:"@caption",componentName:"MenuItem",contextItemId:"",href:"#",idPathSeparator:"/",isDefaultSelector:"@isDefault",menuItemIdSelector:"@menuItemId",messagePropertiesSelector:"messageProperties",parentItemId:"",selectedItemStyle:"selectedMenuItem",showSubItems:false,target:"_self"},initialize:function(c,a,b){this.setOptions(b);this.anchorElement;this.definitionXml=c;this.caption;this.elementFactory=a;this.isDefault;this.listItemElement;this.menuItemId;this.messageProperties;this.parentHtmlElement;this.state=BrowserWidget.States.INITIALIZED},addClassToListItem:function(){if(this.listItemElement){this.listItemElement.addClass(this.options.selectedItemStyle)}},construct:function(a){assertThat(a,not(nil()));this.parentHtmlElement=a;if(this.state==BrowserWidget.States.UNMARSHALLED&&this.needsToBeDisplayed()){this.instantiateHtmlElements();this.state=BrowserWidget.States.CONSTRUCTED;if(this.isDefault){this.fireEvent("onDefaultItem",this)}}},destroy:function(){if(this.anchorElement&&this.anchorElement.destroy){this.anchorElement.destroy()}if(this.listItemElement&&this.listItemElement.destroy){this.listItemElement.destroy()}this.state=BrowserWidget.States.INITIALIZED},findItemById:function(a){if(this.getFullId()==a){return this}else{return null}},needsToBeDisplayed:function(){return this.isContextItemUndefined()&&this.isTheRootItem()||this.isContextItemUndefined()&&this.isDirectChildOfRootItem()||this.isContextItemUndefined()&&this.options.showSubItems||this.isTheContextItem()||this.isDirectChildOfContextItem()||this.isChildOfContextItem()&&this.options.showSubItems||this.isDirectChildOfAccordionParent()&&this.options.accordionBehaviour},onClick:function(){this.addClassToListItem();this.fireEvent("onSelection",this)},removeClassFromListItem:function(){if(this.listItemElement&&this.listItemElement.removeClass){this.listItemElement.removeClass(this.options.selectedItemStyle)}},unmarshall:function(){this.unmarshallProperties();this.unmarshallMessage();this.state=BrowserWidget.States.UNMARSHALLED},getAnchorElement:function(){return this.anchorElement},getCaption:function(){return this.caption},getFullId:function(){return this.options.parentItemId+this.options.idPathSeparator+this.menuItemId},getId:function(){return this.menuItemId},getMessageProperties:function(){return this.messageProperties},getListItemElement:function(){return this.listItemElement},getParentElement:function(){return this.parentHtmlElement},getSelectedItemClass:function(){return this.options.selectedItemStyle},getState:function(){return this.state},instantiateHtmlElements:function(){this.listItemElement=this.elementFactory.create("li",null,this.parentHtmlElement,WidgetElementFactory.Positions.lastChild,{id:this.menuItemId});this.anchorElement=this.elementFactory.createAnchor(this.caption,null,this.onClick,this.listItemElement,WidgetElementFactory.Positions.lastChild)}.protect(),isChildOfContextItem:function(){return this.options.parentItemId!=""&&this.getFullId().contains(this.options.contextItemId+this.options.idPathSeparator)}.protect(),isAccordionParentUndefined:function(){return this.options.accordionParent==""}.protect(),isContextItemUndefined:function(){return this.options.contextItemId==""}.protect(),isDirectChildOfContextItem:function(){return !this.isContextItemUndefined()&&((this.options.contextItemId+this.options.idPathSeparator+this.menuItemId)==this.getFullId())}.protect(),isDirectChildOfAccordionParent:function(){return !this.isAccordionParentUndefined()&&((this.options.accordionParent+this.options.idPathSeparator+this.menuItemId)==this.getFullId())}.protect(),isDirectChildOfRootItem:function(){return(this.options.parentItemId.lastIndexOf(this.options.idPathSeparator)==0)}.protect(),isTheContextItem:function(){return !this.isContextItemUndefined()&&this.options.contextItemId==this.getFullId()}.protect(),isTheRootItem:function(){return this.options.parentItemId==""}.protect(),unmarshallMessage:function(){var messageText=XmlResource.selectNodeText(this.options.messagePropertiesSelector,this.definitionXml);this.messageProperties=messageText?eval("("+messageText+")"):{};this.messageProperties.contextItemId=this.getFullId()}.protect(),unmarshallProperties:function(){this.caption=XmlResource.selectNodeText(this.options.captionSelector,this.definitionXml);this.isDefault=parseBoolean(XmlResource.selectNodeText(this.options.isDefaultSelector,this.definitionXml,null,false));this.menuItemId=XmlResource.selectNodeText(this.options.menuItemIdSelector,this.definitionXml)}.protect()});var CompositeMenu=new Class({Extends:MenuItem,Binds:["onDefaultItem","onSelection"],options:{componentName:"CompositeMenu",menuStyle:"menuWidget",subItemsSelector:"menuItem"},initialize:function(c,a,b){this.parent(c,a,b);this.isExpanded;this.listElement;this.subItems=new ArrayList()},collapse:function(){this.destroySubItems();if(this.listElement&&this.listElement.destroy){this.listElement.destroy()}this.isExpanded=false},construct:function(a){this.parent(a);this.constructSubItems()},destroy:function(){if(this.options.showSubItems){this.destroySubItems()}if(this.listElement&&this.listElement.destroy){this.listElement.destroy()}this.parent()},expand:function(){if(this.isExpanded!=undefined){this.unmarshall()}this.options.accordionParent=this.getFullId();this.createListContainerElement();this.constructSubItems();this.isExpanded=true},findItemById:function(b){var a=this.parent(b);if(a){return a}else{this.subItems.each(function(f,c){var d=f.findItemById(b);if(d){a=d}}.bind(this))}return a},onClick:function(){if(this.options.accordionBehaviour){if(!this.isExpanded){this.expand()}else{this.collapse()}}this.parent()},onDefaultItem:function(a){this.fireEvent("onDefaultItem",a)},onSelection:function(a){this.fireEvent("onSelection",a)},unmarshall:function(){this.parent();this.unmarshallSubItems()},getMenuStyle:function(){return this.options.menuStyle},getSelectedElementClass:function(){return this.options.selectedElementClass},getState:function(){return this.state},getSubItems:function(){return this.subItems},anyChildNeedsToBeDisplayed:function(){var a=false;this.subItems.each(function(c,b){if(c.needsToBeDisplayed()){a=true}}.bind(this));return a}.protect(),constructSubItems:function(){this.subItems.each(function(b,a){b.options.accordionParent=this.options.accordionParent;b.construct(this.parentHtmlElement)}.bind(this))}.protect(),createListContainerElement:function(){this.listElement=this.elementFactory.create("ul",null,this.listItemElement,WidgetElementFactory.Positions.lastChild,{id:this.menuItemId});this.parentHtmlElement=this.listElement}.protect(),destroySubItems:function(){this.subItems.each(function(b,a){b.destroy()}.bind(this));this.subItems.clear()}.protect(),instantiateHtmlElements:function(){if(!this.isTheContextItem()){this.parent()}if(this.anyChildNeedsToBeDisplayed()){this.createListContainerElement();if(this.isTheRootItem()||this.isTheContextItem()){this.listElement.addClass(this.options.menuStyle)}}}.protect(),unmarshallProperties:function(){this.parent()}.protect(),unmarshallSubItems:function(){var a=XmlResource.selectNodes(this.options.subItemsSelector,this.definitionXml);if(a){a.each(function(b,c){var d=MenuItemFactory.create(b,this.elementFactory,{accordionBehaviour:this.options.accordionBehaviour,contextItemId:this.options.contextItemId,idPathSeparator:this.options.idPathSeparator,menuStyle:this.options.menuStyle,onDefaultItem:this.onDefaultItem,onSelection:this.onSelection,parentItemId:this.getFullId(),selectedItemStyle:this.options.selectedItemStyle,showSubItems:this.options.showSubItems});d.unmarshall();this.subItems.add(d)}.bind(this))}}.protect()});var HierarchicalMenuWidget=new Class({Extends:BrowserWidget,Binds:["constructMenuItems","destroyMenuItems","determineCurrentItemId","fireCurrentSelection","onDefaultItem","onSelection"],options:{accordionBehaviour:false,componentName:"HierarchicalMenuWidget",contextItemId:"",idPathSeparator:"/",fireDefaultItem:true,menuItemOptions:{},menuStyle:"menuWidget",rootMenuSelector:"//pp:menuWidgetDefinition/menuItem[1]",selectedItemStyle:"selectedMenuItem",showSubItems:false,widgetContainerId:"HierarchicalMenuWidget"},initialize:function(a,b){this.parent(a,b);this.currentItemId;this.defaultItem;this.rootMenu;this.selectedItem;this.ulElement;this.instantiateMenuItemFactory()},construct:function(){this.parent()},destroy:function(){this.parent()},findItemById:function(a){if((a==null)||(this.state!=BrowserWidget.States.UNMARSHALLED&&this.state!=BrowserWidget.States.CONSTRUCTED)){return null}return this.rootMenu.findItemById(a)},onDefaultItem:function(a){if(this.isDirectChildOfContextItem(a)||this.isDirectChildOfPreviousDefault(this.defaultItem,a)){this.defaultItem=a}},onSelection:function(a){if(this.selectedItem!=a){this.deselectCurrentItem();this.selectedItem=a}this.storeComponentState();this.messageBus.notifySubscribers(this.createMessage(a))},unmarshall:function(){this.parent();this.unmarshallMenu()},webUIMessageHandler:function(a){this.parent(a);if(instanceOf(a,MenuSelectedMessage)){if(a.getActionType()=="loadMenu"){this.destroy();this.givenOptions.contextItemId=a.getContextItemId();this.unmarshall();this.construct()}}},getAccordionBehaviour:function(){return this.options.accordionBehaviour},getContextItemId:function(){return this.options.contextItemId},getCurrentItemId:function(){return this.currentItemId},getRootMenu:function(){return this.rootMenu},getSelectedItemClass:function(){return this.options.selectedItemStyle},compileConstructionChain:function(){this.constructionChain.chain(this.constructMenuItems,this.determineCurrentItemId,this.fireCurrentSelection,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyMenuItems,this.destroyChildHtmlElements,this.finalizeDestruction)}.protect(),compileStateSpecification:function(){this.stateSpecification={currentItemId:this.selectedItem.getFullId(),contextItemId:this.options.contextItemId}}.protect(),constructMenuItems:function(){this.rootMenu.construct(this.containerElement);this.constructionChain.callChain()}.protect(),createMessage:function(b){var a=b.getMessageProperties();a.originator=this.options.componentName;if(this.state==BrowserWidget.States.UNMARSHALLED){a.isDefault=true}return new MenuSelectedMessage(a)}.protect(),deselectCurrentItem:function(){if(this.selectedItem){this.selectedItem.removeClassFromListItem()}}.protect(),destroyMenuItems:function(){this.rootMenu.destroy();this.rootMenu=null;this.currentItemId=null;this.defaultItemId=null;this.destructionChain.callChain()}.protect(),determineCurrentItemId:function(){if(this.options.contextItemId){if(this.findItemById(this.options.contextItemId)==null){throw new WidgetConstructionException(this.options.componentName,"ContextItemId is invalid")}}if(!this.currentItemId){this.currentItemId=this.defaultItemId}this.constructionChain.callChain()}.protect(),determineParentDefinitionElement:function(){var a=this.options.parentItemSelector.substitute({menuItemId:this.options.contextItemId});return this.definitionXml.selectNode(a)}.protect(),fireCurrentSelection:function(){var a=this.findItemById(this.currentItemId);if(a==null||(a!=null&&a.getState()!=BrowserWidget.States.CONSTRUCTED)){this.currentItemId=this.defaultItem.getFullId()}var b=this.findItemById(this.currentItemId);b.addClassToListItem();if(this.options.fireDefaultItem){this.onSelection(b)}else{this.selectedItem=b}this.constructionChain.callChain()}.protect(),instantiateMenuItemFactory:function(){MenuItemFactory.singleInstance=new MenuItemFactory({})}.protect(),isDirectChildOfContextItem:function(a){return this.options.contextItemId!=""&&(this.options.contextItemId+this.options.idPathSeparator+a.getId())==a.getFullId()}.protect(),isDirectChildOfPreviousDefault:function(b,a){return b==null||(b.getFullId()+this.options.idPathSeparator+a.getId())==a.getFullId()}.protect(),parseStateSpecification:function(){if(this.stateSpecification){this.currentItemId=this.stateSpecification.currentItemId;this.options.contextItemId=this.stateSpecification.contextItemId;this.givenOptions.contextItemId=this.stateSpecification.contextItemId}}.protect(),standardizeContextItemId:function(){if(this.options.contextItemId!=""&&this.options.contextItemId.charAt(0)!=this.options.idPathSeparator){this.options.contextItemId=this.options.idPathSeparator+this.options.contextItemId}}.protect(),unmarshallMenu:function(){var a=this.dataXml.selectNode(this.options.rootMenuSelector);this.standardizeContextItemId();if(a){this.rootMenu=new RootMenu(a,this.elementFactory,{accordionBehaviour:this.options.accordionBehaviour,contextItemId:this.options.contextItemId,idPathSeparator:this.options.idPathSeparator,menuStyle:this.options.menuStyle,onDefaultItem:this.onDefaultItem,onSelection:this.onSelection,selectedItemStyle:this.options.selectedItemStyle,showSubItems:this.options.showSubItems});this.rootMenu.unmarshall()}}.protect(),unmarshallProperties:function(){this.parent()}.protect()});var LeafMenuItem=new Class({Extends:MenuItem,options:{componentName:"LeafMenuItem"},initialize:function(a,c,f,b,d){this.parent(a,c,f,b,d)}});var MenuItemFactory=new Class({Implements:Options,options:{},initialize:function(a){this.setOptions(a)},create:function(d,b,c){var a=XmlResource.selectNodes("menuItem",d).length>0?true:false;var f;if(a){f=new CompositeMenu(d,b,c)}else{f=new LeafMenuItem(d,b,c)}return f}});MenuItemFactory.create=function(c,b,a){if(!MenuItemFactory.singleInstance){MenuItemFactory.singleInstance=new MenuItemFactory()}return MenuItemFactory.singleInstance.create(c,b,a)};MenuItemFactory.singleInstance;var MenuSelectedMessage=new Class({Extends:WebUIMessage,options:{description:"A message about the event that a menu or tool bar item was selected.",documentContentURI:null,documentType:AbstractDocument.Types.SMART,documentURI:null,documentVariables:null,contextItemId:null,name:"MenuSelectedMessage",notification:null,windowName:null},initialize:function(a){this.setOptions(a);this.options.messageClass=MenuSelectedMessage},getContextItemId:function(){return this.options.contextItemId},getDocumentContentURI:function(){return this.options.documentContentURI},getDocumentType:function(){return this.options.documentType},getDocumentURI:function(){return this.options.documentURI},getDocumentVariables:function(){return this.options.documentVariables},getNotification:function(){return this.options.notification},getProperty:function(a){return this.options[a]},getWindowName:function(){return this.options.windowName}});var RootMenu=new Class({Extends:CompositeMenu,Binds:[],options:{componentName:"RootMenu"},initialize:function(c,a,b){this.parent(c,a,b)},construct:function(a){this.parent(a)},destroy:function(){this.parent()},unmarshall:function(){this.parent()},destroySubItems:function(){this.subItems.each(function(b,a){b.destroy()}.bind(this))}.protect(),instantiateHtmlElements:function(){this.listElement=this.elementFactory.create("ul",null,this.parentHtmlElement,WidgetElementFactory.Positions.lastChild,{id:this.menuItemId});this.listElement.addClass(this.options.menuStyle);this.parentHtmlElement=this.listElement}.protect()});var HtmlDocument=new Class({Extends:AbstractDocument,Binds:["attachEditor","createTextArea","destroyTextArea","onContainerResize","resizeTextArea"],options:{componentName:"HtmlDocument",documentContentExtension:".html",documentDefinitionNameSpace:"xmlns:sd='http://www.processpuzzle.com/HtmlDocument'",documentEditorClass:"TextAreaEditor",rootElementName:"/htmlDocumentDefinition",},initialize:function(b,a){this.parent(b,a);this.textArea},attachEditor:function(){this.editor.attach(this.textArea,this.documentContent.xmlAsText)}.protect(),construct:function(){this.parent()},destroy:function(){this.parent()},onContainerResize:function(a){this.editor.onContainerResize(a)},resizeTextArea:function(){var a=this.textArea.getScroll().y;this.textArea.scrollTo(null,1);while(this.textArea.getScroll().y>0){var b=this.textArea.clientHeight;this.textArea.rows++;if(this.textArea.clientHeight==b){if(this.textArea.getStyle("overflowY")){this.textArea.setStyle("overflowY","")}this.textArea.scrollTo(null,a);return}this.textArea.scrollTop=1}if(!this.textArea.getStyle("overflowY")){this.textArea.setStyle("overflowY","hidden")}},unmarshall:function(){this.parent()},getTextArea:function(){return this.textArea},compileConstructionChain:function(){this.constructionChain.chain(this.determineContainerElement,this.instantiateEditor,this.createTextArea,this.attachEditor,this.subscribeToWebUIMessages,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.releseResource,this.detachEditor,this.destroyTextArea,this.resetProperties,this.finalizeDestruction)}.protect(),createTextArea:function(){this.textArea=this.htmlElementFactory.create("textArea",null,this.containerElement,WidgetElementFactory.Positions.LastChild,{id:this.name,styles:{border:0,margin:0,padding:0,visibility:"hidden",overflowY:"hidden"}});this.textArea.set("html",this.documentContent.xmlAsText);this.textArea.setStyle("width",this.containerElement.getSize().x);this.textArea.setStyle("height",this.textArea.getScrollSize().y);this.resizeTextArea();this.constructionChain.callChain()},destroyTextArea:function(){if(this.textArea.removeEvents){this.textArea.removeEvents()}if(this.textArea.destroy){this.textArea.destroy()}this.destructionChain.callChain()}.protect()});var ProcessPuzzleLocale=new Class({Implements:Options,options:{delimiter:",-",language:"en",country:null,variant:null},initialize:function(a){this.setOptions(a)},equals:function(a){return this.options.language==a.options.language&&this.options.country==a.options.country&&this.options.variant==a.options.variant},parse:function(b){var a=new StringTokenizer(b,{delimiters:this.options.delimiter});i=0;while(a.hasMoreTokens()){var c=a.nextToken().trim();if(i==0){this.options.language=c}else{if(i==1){this.options.country=c}else{if(i==2){this.options.variant=c}}}i++}},toString:function(){var a=this.options.language;if(this.options.country!=null&&this.options.country!=""){a+=this.options.delimiter+this.options.country}if(this.options.variant!=null&&this.options.variant!=""){a+=this.options.delimiter+this.options.variant}return a},getLanguage:function(){return this.options.language},getCountry:function(){return this.options.country},getVariant:function(){return this.options.variant}});var ProcessPuzzleLocaleUtil=new Class({initialize:function(){this.DELIMITER="_"},getFileName:function(a,d,f,h){var b=new String(d);if(h>0){var j=a.getLanguage();if(j!=null&&j!=""){b+=this.DELIMITER;b+=j}}if(h>1){var g=a.getCountry();if(g!=null&&g!=""){b+=this.DELIMITER;b+=g}}if(h>2){var c=a.getVariant();if(c!=null&&c!=""){b+=this.DELIMITER;b+=c}}return b.toString()+f},getFileNameList:function(a,f,g){assertThat(g,not(nil()));assertThat(g,containsString("."));var d=new ArrayList();for(var c=0;c<3;c++){var b=this.getFileName(a,f,g,c);if(!d.contains(b)){d.add(b)}}var h=new Array(d.size());for(var c=0;c<h.length;c++){h[c]=d.get(c)}return h},splitName:function(a){var b=new StringTokenizer(a,{delimiters:this.DELIMITER});var c=new Array();i=0;while(b.hasMoreTokens()){c[i]=b.nextToken();i++}return c}});var ResourceCache=new Class({initialize:function(){this.resources=new HashMap();this.self=this},clear:function(){this.resources.clear()},get:function(a,c){var b=new ResourceKey(a,c);if(!this.resources.containsKey(b)){throw new IllegalArgumentException("no such key: "+b)}return this.resources.get(b)},put:function(b,a){this.resources.put(b,a)}});var ResourceKey=new Class({initialize:function(b,a){assertThat(b,not(nil()));assertThat(a,not(nil()));this.key=b;this.type=a},toString:function(){return this.key+"/"+this.type},hashCode:function(){var b=this.key.hashCode();var a=this.toString().hashCode();return b},equals:function(a){return this.compareTo(a)},compareTo:function(a){if(a instanceof ResourceKey){response=(this.key==a.key);if(response){response=(this.type==a.type)}return response}return false}});var XMLBundleParser=new Class({initialize:function(){this.buffer=new String();this.cache=new ResourceCache();this.key;this.parserLanguage,this.parserCountry,this.parserVariant;this.targetLanguage,this.targetCountry,this.targetVariant;this.saxEventHandler=new SAXEventHandler();this.xmlResource=null;this.xmlAsText=""},characters:function(b,c,a){this.buffer+=b.substring(c,c+a)},endElement:function(b){var a=this.buffer.trim();this.buffer=new String();if(b.equals("Language")){this.parserLanguage=null}if(b.equals("Country")){this.parserCountry=null}if(b.equals("Variant")){this.parserVariant=null}if(b.equals("Resource")&&this.inContext()){this.cache.put(this.key,a)}},parse:function(b,d,a){this.cache=b;this.targetLanguage=a.getLanguage();this.targetCountry=a.getCountry();this.targetVariant=a.getVariant();var c=new SAXDriver();c.setDocumentHandler(this);c.setLexicalHandler(this);c.setErrorHandler(this);this.xmlResource=new XmlResource(d,{parseOnComplete:false});c.parse(this.xmlResource.getXmlAsText())},startElement:function(b,a){if(b.equals("Language")){this.parserLanguage=a.getValueByName("name")}if(b.equals("Country")){this.parserCountry=a.getValueByName("name")}if(b.equals("Variant")){this.parserVariant=a.getValueByName("name")}if(b.equals("Resource")){this.key=new ResourceKey(a.getValueByName("key"),a.getValueByName("type"))}},setXML:function(a){this.xmlAsText=a},inContext:function(){if(this.parserLanguage==null||this.parserLanguage.equals(this.targetLanguage)){if(this.parserCountry==null||this.parserCountry.equals(this.targetCountry)){if(this.parserVariant==null||this.parserVariant.equals(this.targetVariant)){return true}}}return false}.protect()});var XMLResourceBundle=new Class({Implements:Options,options:{componentName:"XMLResourceBundle",defaultLocale:null,nameSpaces:"xmlns:pp='http://www.processpuzzle.com/'"},initialize:function(b,a){assertThat(b,not(nil()));this.setOptions(a);this.cache;this.currentLocale=null;this.isLoaded=false;this.logger=Class.getInstanceOf(WebUILogger);this.localeUtil=new ProcessPuzzleLocaleUtil();this.parser=new XMLBundleParser();this.resourceBundleNames=new Array();this.webUIConfiguration=b;this.determineDefaultLocale();this.determineNameSpace();this.determineResourceBundleNames()},getDefaultLocale:function(){return this.options.defaultLocale},getFile:function(b){var a=this.cache.get(b,"File");return new File(a)},getLocale:function(){return this.currentLocale},getNameSpace:function(){return this.options.nameSpaces},getResourceBundleNames:function(){return this.resourceBundleNames},getText:function(b){if(!b){return null}var a;try{a=this.cache.get(b,"String")}catch(c){a=b}return a},load:function(a){this.logger.debug(this.options.componentName+".load() started.");this.currentLocale=a;this.cache=new ResourceCache();var b=this.determineFileNames(a);var f=0;for(var d=0;d<b.size();d++){if(this.parseFile(b.get(d),a)){f++}}if(f==0){var c=new UndefinedXmlResourceException(b.get(0));throw c}this.isLoaded=true},release:function(){this.currentLocale=null;this.cache.clear();this.cache=null;this.resourceBundleNames.empty();this.isLoaded=false},determineDefaultLocale:function(){var a=this.webUIConfiguration.getI18DefaultLocale();if(a!=null){this.options.defaultLocale=a}}.protect(),determineFileNames:function(a){var b=new ArrayList();this.resourceBundleNames.each(function(f,d){var c=this.localeUtil.getFileNameList(a,f,".xml");b.addAll(c)},this);return b}.protect(),determineNameSpace:function(){var a=this.webUIConfiguration.getI18ResourceBundleNameSpace();if(a!=null){this.options.nameSpaces=a}}.protect(),determineResourceBundleNames:function(){var a=this.webUIConfiguration.getI18ResourceBundleElements();for(i=0;i<this.webUIConfiguration.getI18ResourceBundleElements().length;i++){var b=this.webUIConfiguration.getI18ResourceBundleName(i);this.resourceBundleNames[i]=b}}.protect(),parseFile:function(d,a){try{var c=new XmlResource(d,{nameSpaces:this.options.nameSpaces})}catch(b){return false}this.parser.parse(this.cache,d,a);return true}.protect()});(function(h){if(!h||!(h.toJSON||Object.toJSON||window.JSON)){throw new Error("jQuery, MooTools or Prototype needs to be loaded before jStorage!")}var j={},f={jStorage:"{}"},k=null,m=0,p=h.toJSON||Object.toJSON||(window.JSON&&(JSON.encode||JSON.stringify)),g=h.evalJSON||(window.JSON&&(JSON.decode||JSON.parse))||function(r){return String(r).evalJSON()},l=false,o,d={isXML:function(s){var r=(s?s.ownerDocument||s:0).documentElement;return r?r.nodeName!=="HTML":false},encode:function(s){if(!this.isXML(s)){return false}try{return new XMLSerializer().serializeToString(s)}catch(r){try{return s.xml}catch(t){}}return false},decode:function(s){var r=("DOMParser" in window&&(new DOMParser()).parseFromString)||(window.ActiveXObject&&function(u){var v=new ActiveXObject("Microsoft.XMLDOM");v.async="false";v.loadXML(u);return v}),t;if(!r){return false}t=r.call("DOMParser" in window&&(new DOMParser())||window,s,"text/xml");return this.isXML(t)?t:false}};function n(){var r=false;if("localStorage" in window){try{window.localStorage.setItem("_tmptest","tmpval");r=true;window.localStorage.removeItem("_tmptest")}catch(s){}}if(r){try{if(window.localStorage){f=window.localStorage;l="localStorage"}}catch(w){}}else{if("globalStorage" in window){try{if(window.globalStorage){f=window.globalStorage[window.location.hostname];l="globalStorage"}}catch(v){}}else{k=new Element("link");if(k.addBehavior){k.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(k);k.load("jStorage");var u="{}";try{u=k.getAttribute("jStorage")}catch(t){}f.jStorage=u;l="userDataBehavior"}else{k=null;return}}}b();q()}function b(){if(f.jStorage){try{j=g(String(f.jStorage))}catch(r){f.jStorage="{}"}}else{f.jStorage="{}"}m=f.jStorage?String(f.jStorage).length:0}function c(){try{f.jStorage=p(j);if(k){k.setAttribute("jStorage",f.jStorage);k.save("jStorage")}m=f.jStorage?String(f.jStorage).length:0}catch(r){}}function a(r){if(!r||(typeof r!="string"&&typeof r!="number")){throw new TypeError("Key name must be string or numeric")}if(r=="__jstorage_meta"){throw new TypeError("Reserved key name")}return true}function q(){var v,r,t,s=Infinity,u=false;clearTimeout(o);if(!j.__jstorage_meta||typeof j.__jstorage_meta.TTL!="object"){return}v=+new Date();t=j.__jstorage_meta.TTL;for(r in t){if(t.hasOwnProperty(r)){if(t[r]<=v){delete t[r];delete j[r];u=true}else{if(t[r]<s){s=t[r]}}}}if(s!=Infinity){o=setTimeout(q,s-v)}if(u){c()}}h.jStorage={version:"0.1.6.1",set:function(r,s){a(r);if(d.isXML(s)){s={_is_xml:true,xml:d.encode(s)}}else{if(typeof s=="function"){s=null}else{if(s&&typeof s=="object"){s=g(p(s))}}}j[r]=s;c();return s},get:function(r,s){a(r);if(r in j){if(j[r]&&typeof j[r]=="object"&&j[r]._is_xml&&j[r]._is_xml){return d.decode(j[r].xml)}else{return j[r]}}return typeof(s)=="undefined"?null:s},deleteKey:function(r){a(r);if(r in j){delete j[r];if(j.__jstorage_meta&&typeof j.__jstorage_meta.TTL=="object"&&r in j.__jstorage_meta.TTL){delete j.__jstorage_meta.TTL[r]}c();return true}return false},setTTL:function(s,r){var t=+new Date();a(s);r=Number(r)||0;if(s in j){if(!j.__jstorage_meta){j.__jstorage_meta={}}if(!j.__jstorage_meta.TTL){j.__jstorage_meta.TTL={}}if(r>0){j.__jstorage_meta.TTL[s]=t+r}else{delete j.__jstorage_meta.TTL[s]}c();q();return true}return false},flush:function(){j={};c();return true},storageObj:function(){function r(){}r.prototype=j;return new r()},index:function(){var r=[],s;for(s in j){if(j.hasOwnProperty(s)&&s!="__jstorage_meta"){r.push(s)}}return r},storageSize:function(){return m},currentBackend:function(){return l},storageAvailable:function(){return !!l},reInit:function(){var r,t;if(k&&k.addBehavior){r=new Element("link");k.parentNode.replaceChild(r,k);k=r;k.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(k);k.load("jStorage");t="{}";try{t=k.getAttribute("jStorage")}catch(s){}f.jStorage=t;l="userDataBehavior"}b()}};n()})(window.jQuery||window.$);var LanguageChangedMessage=new Class({Extends:WebUIMessage,options:{actionType:null,description:"A message about the event that WebUI's language was changed.",name:"Language Changed Message",newLocale:null,previousLocale:null},initialize:function(a){this.setOptions(a);this.options.messageClass=LanguageChangedMessage},getNewLocale:function(){return this.options.newLocale},getPreviousLocale:function(){return this.options.previousLocale}});var LanguageSelectorWidget=new Class({Extends:BrowserWidget,Binds:["onSelection"],options:{componentName:"LanguageSelectorWidget",componentPrefix:"LanguageSelectorWidget",selectElementId:"LanguageSelector",selectTextKey:"LanguageSelectorWidget.select",widgetContainerId:"LanguageSelectorWidget",wrapperElementStyle:"LanguageSelectorWrapper"},initialize:function(a,b,c){this.setOptions(a);this.parent(a,b);this.availableLocales=new ArrayList();this.isConfigured=false;this.selectElement=null;this.selectElementContainer=null;this.webUIConfiguration=c;this.determineInitializationArguments();this.determineAvailableLocales()},construct:function(){this.createSpanElements();this.createSelectElement();this.createSelectElementOptions();return this.parent()},destroy:function(){this.availableLocales.clear();this.parent()},onSelection:function(){var c=this.locale;var a=new ProcessPuzzleLocale();a.parse(this.selectElement.options[this.selectElement.selectedIndex].value);var b=new LanguageChangedMessage({previousLocale:c,newLocale:a,originator:this.options.widgetContainerId});this.messageBus.notifySubscribers(b)},getAvailableLocales:function(){return this.availableLocales},getWebUIConfiguration:function(){return this.webUIConfiguration},createSelectElement:function(){this.selectElement=this.elementFactory.create("select",null,this.selectElementContainer,WidgetElementFactory.Positions.LastChild,{id:this.options.selectElementId});this.selectElement.addEvent("change",this.onSelection)}.protect(),createSelectElementOptions:function(){var a=this.elementFactory.createOption("",this.options.selectTextKey,this.selectElement,WidgetElementFactory.Positions.LastChild);a.set("selected");this.availableLocales.each(function(b,c){this.elementFactory.createOption(b.getLanguage(),this.options.componentPrefix+"."+b.getLanguage(),this.selectElement,WidgetElementFactory.Positions.LastChild)},this)}.protect(),createSpanElements:function(){var a=this.elementFactory.create("span",null,null,null,{"class":this.options.wrapperElementStyle});this.selectElementContainer=this.elementFactory.create("span",null,a)}.protect(),determineAvailableLocales:function(){for(var b=0;b<this.webUIConfiguration.getI18LocaleElements().length;b++){var c=this.webUIConfiguration.getI18Locale(b);var a=new ProcessPuzzleLocale();a.parse(c);this.availableLocales.add(a)}}.protect(),determineInitializationArguments:function(){if(!this.webUIConfiguration){var a=Class.getInstanceOf(WebUIController);if(a){this.webUIConfiguration=a.getWebUIConfiguration()}else{this.webUIConfiguration=Class.getInstanceOf(WebUIConfiguration)}}}.protect()});(function(){var c=/^(H[1-6]|HR|P|DIV|ADDRESS|PRE|FORM|TABLE|LI|OL|UL|TD|CAPTION|BLOCKQUOTE|CENTER|DL|DT|DD|SCRIPT|NOSCRIPT|STYLE)$/i;var d=/^(https?|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i;var b=/<(script|noscript|style)[\u0000-\uFFFF]*?<\/(script|noscript|style)>/g;this.MooEditable=new Class({Implements:[Events,Options],options:{actions:"bold italic underline strikethrough | insertunorderedlist insertorderedlist indent outdent | undo redo | createlink unlink | urlimage | toggleview",baseCSS:"html{ height: 100%; cursor: text; } body{ font-family: sans-serif; }",baseURL:"",cleanup:true,dimensions:null,disabled:false,elasticHeight:true,estimatedRowHeight:10,extraCSS:"",externalCSS:"",handleDialogs:true,handleLabel:true,handleSubmit:true,html:'<!DOCTYPE html><html><head><meta charset="UTF-8">{BASEHREF}<style>{BASECSS} {EXTRACSS}</style>{EXTERNALCSS}</head><body></body></html>',paragraphise:true,rootElement:"p",semantics:true,toolbar:true,xhtml:true,},initialize:function(g,f){if(!("contentEditable" in document.body)&&!("designMode" in document)){return}this.setOptions(f);this.textarea=document.id(g);this.textarea.store("MooEditable",this);this.actions=this.options.actions.clean().split(" ");this.keys={};this.dialogs={};this.protectedElements=[];this.actions.each(function(k){var h=MooEditable.Actions[k];if(!h){return}if(h.options){var j=h.options.shortcut;if(j){this.keys[j]=k}}if(h.dialogs){Object.each(h.dialogs,function(m,l){m=m.attempt(this);m.name=k+":"+l;if(typeOf(this.dialogs[k])!="object"){this.dialogs[k]={}}this.dialogs[k][l]=m},this)}if(h.events){Object.each(h.events,function(l,m){this.addEvent(m,l)},this)}}.bind(this));this.render()},toElement:function(){return this.textarea},render:function(){var f=this;var g=this.options.dimensions||this.textarea.getSize();this.container=new Element("div",{id:(this.textarea.id)?this.textarea.id+"-mooeditable-container":null,"class":"mooeditable-container",styles:{overflowY:"hidden",width:g.x+"px"}});this.textarea.addClass("mooeditable-textarea").setStyle("height",g.y+"px");this.iframe=new Element("IFrame",{"class":"mooeditable-iframe",frameBorder:0,scrolling:"no",src:'javascript:""',styles:{height:g.y+"px",width:g.x+"px"}});this.toolbar=new MooEditable.UI.Toolbar({onItemAction:function(){var h=Array.from(arguments);var j=h[0];f.action(j.name,h)}});this.attach.delay(1,this);if(this.options.handleLabel&&this.textarea.id){$$('label[for="'+this.textarea.id+'"]').addEvent("click",function(h){if(f.mode!="iframe"){return}h.preventDefault();f.focus()})}if(this.options.handleSubmit){this.form=this.textarea.getParent("form");if(!this.form){return}this.form.addEvent("submit",function(){if(f.mode=="iframe"){f.saveContent()}})}this.fireEvent("render",this)},adjustIFrameHeight:function(){var f=(this.iframe.contentDocument)?this.iframe.contentDocument:this.iframe.contentWindow.document;this.iframe.setStyle("height",f.body.offsetHeight+10);if(!this.iframe.getStyle("overflowY")){this.iframe.setStyle("overflowY","hidden")}}.protect(),tryToDecreaseHeight:function(){if(Browser.ie){return}while(this.getFrameScrollTop()==0&&this.iframe.getStyle("height").toInt()>0){var g=this.iframe.getStyle("height").toInt();var f=(g-this.options.estimatedRowHeight)>=0?g-this.options.estimatedRowHeight:0;this.iframe.setStyle("height",f)}if(this.iframe.contentWindow.getScroll().y>0){this.iframe.setStyle("height",this.iframe.getStyle("height").toInt()+this.options.estimatedRowHeight)}}.protect(),tryToIncreaseHeight:function(){var f=false;this.iframe.contentWindow.scrollTo(null,1);while(this.iframe.contentWindow.getScroll().y>0){f=true;var g=this.iframe.getStyle("height").toInt();this.iframe.setStyle("height",g+this.options.estimatedRowHeight);this.iframe.contentWindow.scrollTo(null,1)}return f}.protect(),onContainerResize:function(f){this.container.setStyle("width",f.x);this.iframe.setStyle("width",f.x);this.adjustIFrameHeight()},attach:function(){var f=this;this.mode="iframe";this.editorDisabled=false;this.container.wraps(this.textarea);this.textarea.setStyle("display","none");this.iframe.setStyle("display","").inject(this.textarea,"before");if(this.options.handleDialogs){Object.each(this.dialogs,function(m,l){Object.each(m,function(o){document.id(o).inject(f.iframe,"before");var n=null;o.addEvents({open:function(){n=f.selection.getRange();f.editorDisabled=true;f.toolbar.disable(l);f.fireEvent("dialogOpen",this)},close:function(){f.toolbar.enable();f.editorDisabled=false;f.focus();if(n){f.selection.setRange(n)}f.fireEvent("dialogClose",this)}})})})}this.win=this.iframe.contentWindow;this.doc=this.win.document;if(Browser.firefox){this.doc.designMode="On"}var h=this.options.html.substitute({BASECSS:this.options.baseCSS,EXTRACSS:this.options.extraCSS,EXTERNALCSS:(this.options.externalCSS)?this.options.externalCSS:"",BASEHREF:(this.options.baseURL)?'<base href="'+this.options.baseURL+'" />':""});this.doc.open();this.doc.write(h);this.doc.close();(Browser.ie)?this.doc.body.contentEditable=true:this.doc.designMode="On";Object.append(this.win,new Window);Object.append(this.doc,new Document);if(Browser.Element){var j=this.win.Element.prototype;for(var k in Element){if(!k.test(/^[A-Z]|\$|prototype|mooEditable/)){j[k]=Element.prototype[k]}}}else{document.id(this.doc.body)}if(Browser.ie){this.setContent(this.textarea.get("html"))}else{this.setContent(this.textarea.get("text"))}this.doc.addEvents({mouseup:this.editorMouseUp.bind(this),mousedown:this.editorMouseDown.bind(this),mouseover:this.editorMouseOver.bind(this),mouseout:this.editorMouseOut.bind(this),mouseenter:this.editorMouseEnter.bind(this),mouseleave:this.editorMouseLeave.bind(this),contextmenu:this.editorContextMenu.bind(this),click:this.editorClick.bind(this),dblclick:this.editorDoubleClick.bind(this),keypress:this.editorKeyPress.bind(this),keyup:this.editorKeyUp.bind(this),keydown:this.editorKeyDown.bind(this),focus:this.editorFocus.bind(this),blur:this.editorBlur.bind(this)});this.win.addEvents({focus:this.editorFocus.bind(this),blur:this.editorBlur.bind(this)});["cut","copy","paste"].each(function(l){f.doc.body.addListener(l,f["editor"+l.capitalize()].bind(f))});this.textarea.addEvent("keypress",this.textarea.retrieve("mooeditable:textareaKeyListener",this.keyListener.bind(this)));if(Browser.firefox2){this.doc.addEvent("focus",function(){f.win.fireEvent("focus").focus()})}if(this.doc.addEventListener){this.doc.addEventListener("focus",function(){f.win.fireEvent("focus")},true)}if(!Browser.ie&&!Browser.opera){var g=function(){f.execute("styleWithCSS",false,false);f.doc.removeEvent("focus",g)};this.win.addEvent("focus",g)}if(this.options.toolbar){document.id(this.toolbar).inject(this.container,"top");this.toolbar.render(this.actions)}if(this.options.disabled){this.disable()}this.selection=new MooEditable.Selection(this.win);this.oldContent=this.getContent();this.fireEvent("attach",this);return this},detach:function(){this.saveContent();this.textarea.setStyle("display","").removeClass("mooeditable-textarea").inject(this.container,"before");this.textarea.removeEvent("keypress",this.textarea.retrieve("mooeditable:textareaKeyListener"));if(this.doc&&this.doc.removeEvents){this.doc.removeEvents()}if(this.win&&this.win.removeEvents){this.win.removeEvents()}this.container.dispose();this.fireEvent("detach",this);this.removeEvents();return this},enable:function(){this.editorDisabled=false;this.toolbar.enable();return this},disable:function(){this.editorDisabled=true;this.toolbar.disable();return this},editorFocus:function(f){this.oldContent="";this.fireEvent("editorFocus",[f,this])},editorBlur:function(f){this.oldContent=this.saveContent().getContent();this.fireEvent("editorBlur",[f,this])},editorMouseUp:function(f){if(this.editorDisabled){f.stop();return}if(this.options.toolbar){this.checkStates()}this.fireEvent("editorMouseUp",[f,this])},editorMouseDown:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorMouseDown",[f,this])},editorMouseOver:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorMouseOver",[f,this])},editorMouseOut:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorMouseOut",[f,this])},editorMouseEnter:function(f){if(this.editorDisabled){f.stop();return}if(this.oldContent&&this.getContent()!=this.oldContent){this.focus();this.fireEvent("editorPaste",[f,this])}this.fireEvent("editorMouseEnter",[f,this])},editorMouseLeave:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorMouseLeave",[f,this])},editorContextMenu:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorContextMenu",[f,this])},editorClick:function(g){if(Browser.safari||Browser.chrome){var f=g.target;if(Element.get(f,"tag")=="img"){if(this.options.baseURL){if(f.getProperty("src").indexOf("http://")==-1){f.setProperty("src",this.options.baseURL+f.getProperty("src"))}}this.selection.selectNode(f);this.checkStates()}}this.fireEvent("editorClick",[g,this])},editorDoubleClick:function(f){this.fireEvent("editorDoubleClick",[f,this])},editorKeyPress:function(f){if(this.editorDisabled){f.stop();return}this.keyListener(f);this.fireEvent("editorKeyPress",[f,this])},editorKeyUp:function(f){if(this.editorDisabled){f.stop();return}var g=f.code;if(this.options.toolbar&&(/^enter|left|up|right|down|delete|backspace$/i.test(f.key)||(g>=33&&g<=36)||g==45||f.meta||f.control)){if(Browser.ie6){clearTimeout(this.checkStatesDelay);this.checkStatesDelay=this.checkStates.delay(500,this)}else{this.checkStates()}}this.adjustIFrameHeight();this.fireEvent("editorKeyUp",[f,this])},editorKeyDown:function(l){if(this.editorDisabled){l.stop();return}if(l.key=="enter"){if(this.options.paragraphise){if(l.shift&&(Browser.safari||Browser.chrome)){var q=this.selection;var f=q.getRange();var o=this.doc.createElement("br");f.insertNode(o);f.setStartAfter(o);f.setEndAfter(o);q.setRange(f);if(q.getSelection().focusNode==o.previousSibling){var n=this.doc.createTextNode("\u00a0");var g=o.parentNode;var m=o.nextSibling;(m)?g.insertBefore(n,m):g.appendChild(n);q.selectNode(n);q.collapse(1)}this.win.scrollTo(0,Element.getOffsets(q.getRange().startContainer).y);l.preventDefault()}else{if(Browser.firefox||Browser.safari||Browser.chrome){var j=this.selection.getNode();var h=Element.getParents(j).include(j).some(function(p){return p.nodeName.test(c)});if(!h){this.execute("insertparagraph")}}}}else{if(Browser.ie){var f=this.selection.getRange();var j=this.selection.getNode();if(f&&j.get("tag")!="li"){this.selection.insertContent("<br>");this.selection.collapse(false)}l.preventDefault()}}}if(Browser.opera){var k=l.control||l.meta;if(k&&l.key=="x"){this.fireEvent("editorCut",[l,this])}else{if(k&&l.key=="c"){this.fireEvent("editorCopy",[l,this])}else{if((k&&l.key=="v")||(l.shift&&l.code==45)){this.fireEvent("editorPaste",[l,this])}}}}this.fireEvent("editorKeyDown",[l,this])},editorCut:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorCut",[f,this])},editorCopy:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorCopy",[f,this])},editorPaste:function(f){if(this.editorDisabled){f.stop();return}this.fireEvent("editorPaste",[f,this])},keyListener:function(h){var f=(Browser.Platform.mac)?h.meta:h.control;if(!f||!this.keys[h.key]){return}h.preventDefault();var g=this.toolbar.getItem(this.keys[h.key]);g.action(h)},focus:function(){(this.mode=="iframe"?this.win:this.textarea).focus();this.fireEvent("focus",this);return this},action:function(h,f){var g=MooEditable.Actions[h];if(g.command&&typeOf(g.command)=="function"){g.command.apply(this,f)}else{this.focus();this.execute(h,false,f);if(this.mode=="iframe"){this.checkStates()}}},execute:function(h,g,f){if(this.busy){return}this.busy=true;this.doc.execCommand(h,g,f);this.saveContent();this.busy=false;return false},toggleView:function(){this.fireEvent("beforeToggleView",this);if(this.mode=="textarea"){this.mode="iframe";this.iframe.setStyle("display","");this.setContent(this.textarea.value);this.textarea.setStyle("display","none")}else{this.saveContent();this.mode="textarea";this.textarea.setStyle("display","");this.iframe.setStyle("display","none")}this.fireEvent("toggleView",this);this.focus.delay(10,this);return this},getContent:function(){var f=this.protectedElements;var g=this.doc.body.get("html").replace(/<!-- mooeditable:protect:([0-9]+) -->/g,function(j,h){return f[h.toInt()]});return this.cleanup(this.ensureRootElement(g))},getFrameScrollTop:function(){if(Browser.ie){return this.doc.documentElement.scrollTop}else{return this.iframe.contentWindow.getScroll().y}},setContent:function(g){var f=this.protectedElements;g=g.replace(b,function(h){f.push(h);return"<!-- mooeditable:protect:"+(f.length-1)+" -->"});this.doc.body.set("html",this.ensureRootElement(g));if(this.options.elasticHeight){this.adjustIFrameHeight()}return this},saveContent:function(){if(this.mode=="iframe"){if(this.textarea.set){this.textarea.set("value",this.getContent())}else{this.textarea.value=this.getContent()}}return this},ensureRootElement:function(m){if(this.options.rootElement){var l=new Element("div",{html:m.trim()});var h=-1;var p=false;var q="";var j=l.childNodes.length;for(var o=0;o<j;o++){var f=l.childNodes[o];var r=f.nodeName;if(!r.test(c)&&r!=="#comment"){if(r==="#text"){if(f.nodeValue.trim()){if(h<0){h=o}q+=f.nodeValue}}else{if(h<0){h=o}q+=new Element("div").adopt($(f).clone()).get("html")}}else{p=true}if(o==(j-1)){p=true}if(h>=0&&p){var g=new Element(this.options.rootElement,{html:q});l.replaceChild(g,l.childNodes[h]);for(var n=h+1;n<o;n++){l.removeChild(l.childNodes[n]);j--;o--;n--}h=-1;p=false;q=""}}m=l.get("html").replace(/\n\n/g,"")}return m},checkStates:function(){var f=this.selection.getNode();if(!f){return}if(typeOf(f)!="element"){return}this.actions.each(function(j){var m=this.toolbar.getItem(j);if(!m){return}m.deactivate();var n=MooEditable.Actions[j]["states"];if(!n){return}if(typeOf(n)=="function"){n.attempt([document.id(f),m],this);return}try{if(this.doc.queryCommandState(j)){m.activate();return}}catch(l){}if(n.tags){var h=f;do{var p=h.tagName.toLowerCase();if(n.tags.contains(p)){m.activate(p);break}}while((h=Element.getParent(h))!=null)}if(n.css){var h=f;do{var o=false;for(var g in n.css){var k=n.css[g];if(h.style[g.camelCase()].contains(k)){m.activate(k);o=true}}if(o||h.tagName.test(c)){break}}while((h=Element.getParent(h))!=null)}}.bind(this))},cleanup:function(g){if(!this.options.cleanup){return g.trim()}do{var f=g;if(this.options.baseURL){g=g.replace('="'+this.options.baseURL,'="')}g=g.replace(/<br class\="webkit-block-placeholder">/gi,"<br />");g=g.replace(/<span class="Apple-style-span">(.*)<\/span>/gi,"$1");g=g.replace(/ class="Apple-style-span"/gi,"");g=g.replace(/<span style="">/gi,"");g=g.replace(/<p>\s*<br ?\/?>\s*<\/p>/gi,"<p>\u00a0</p>");g=g.replace(/<p>(&nbsp;|\s)*<\/p>/gi,"<p>\u00a0</p>");if(!this.options.semantics){g=g.replace(/\s*<br ?\/?>\s*<\/p>/gi,"</p>")}if(this.options.xhtml){g=g.replace(/<br>/gi,"<br />")}if(this.options.semantics){if(Browser.ie){g=g.replace(/<li>\s*<div>(.+?)<\/div><\/li>/g,"<li>$1</li>")}if(Browser.safari||Browser.chrome){g=g.replace(/^([\w\s]+.*?)<div>/i,"<p>$1</p><div>");g=g.replace(/<div>(.+?)<\/div>/ig,"<p>$1</p>")}if(!Browser.ie){g=g.replace(/<p>[\s\n]*(<(?:ul|ol)>.*?<\/(?:ul|ol)>)(.*?)<\/p>/ig,"$1<p>$2</p>");g=g.replace(/<\/(ol|ul)>\s*(?!<(?:p|ol|ul|img).*?>)((?:<[^>]*>)?\w.*)$/g,"</$1><p>$2</p>")}g=g.replace(/<br[^>]*><\/p>/g,"</p>");g=g.replace(/<p>\s*(<img[^>]+>)\s*<\/p>/ig,"$1\n");g=g.replace(/<p([^>]*)>(.*?)<\/p>(?!\n)/g,"<p$1>$2</p>\n");g=g.replace(/<\/(ul|ol|p)>(?!\n)/g,"</$1>\n");g=g.replace(/><li>/g,">\n\t<li>");g=g.replace(/([^\n])<\/(ol|ul)>/g,"$1\n</$2>");g=g.replace(/([^\n])<img/ig,"$1\n<img");g=g.replace(/^\s*$/g,"")}g=g.replace(/<br ?\/?>$/gi,"");g=g.replace(/^<br ?\/?>/gi,"");if(this.options.paragraphise){g=g.replace(/(h[1-6]|p|div|address|pre|li|ol|ul|blockquote|center|dl|dt|dd)><br ?\/?>/gi,"$1>")}g=g.replace(/<br ?\/?>\s*<\/(h1|h2|h3|h4|h5|h6|li|p)/gi,"</$1");g=g.replace(/<span style="font-weight: bold;">(.*)<\/span>/gi,"<strong>$1</strong>");g=g.replace(/<span style="font-style: italic;">(.*)<\/span>/gi,"<em>$1</em>");g=g.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>");g=g.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>");g=g.replace(/<u\b[^>]*>(.*?)<\/u[^>]*>/gi,'<span style="text-decoration: underline;">$1</span>');g=g.replace(/<strong><span style="font-weight: normal;">(.*)<\/span><\/strong>/gi,"$1");g=g.replace(/<em><span style="font-weight: normal;">(.*)<\/span><\/em>/gi,"$1");g=g.replace(/<span style="text-decoration: underline;"><span style="font-weight: normal;">(.*)<\/span><\/span>/gi,"$1");g=g.replace(/<strong style="font-weight: normal;">(.*)<\/strong>/gi,"$1");g=g.replace(/<em style="font-weight: normal;">(.*)<\/em>/gi,"$1");g=g.replace(/<[^> ]*/g,function(h){return h.toLowerCase()});g=g.replace(/<[^>]*>/g,function(h){h=h.replace(/ [^=]+=/g,function(j){return j.toLowerCase()});return h});g=g.replace(/<[^!][^>]*>/g,function(h){h=h.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"');return h});if(this.options.xhtml){g=g.replace(/<img([^>]+)(\s*[^\/])>(<\/img>)*/gi,"<img$1$2 />")}g=g.replace(/<p>(?:\s*)<p>/g,"<p>");g=g.replace(/<\/p>\s*<\/p>/g,"</p>");g=g.replace(/<pre[^>]*>.*?<\/pre>/gi,function(h){return h.replace(/<br ?\/?>/gi,"\n")});g=g.trim()}while(g!=f);return g}});MooEditable.Selection=new Class({initialize:function(f){this.win=f},getSelection:function(){this.win.focus();return(this.win.getSelection)?this.win.getSelection():this.win.document.selection},getRange:function(){var f=this.getSelection();if(!f){return null}try{return f.rangeCount>0?f.getRangeAt(0):(f.createRange?f.createRange():null)}catch(g){return this.doc.body.createTextRange()}},setRange:function(f){if(f.select){Function.attempt(function(){f.select()})}else{var g=this.getSelection();if(g.addRange){g.removeAllRanges();g.addRange(f)}}},selectNode:function(h,j){var g=this.getRange();var f=this.getSelection();if(g.moveToElementText){Function.attempt(function(){g.moveToElementText(h);g.select()})}else{if(f.addRange){j?g.selectNodeContents(h):g.selectNode(h);f.removeAllRanges();f.addRange(g)}else{f.setBaseAndExtent(h,0,h,1)}}return h},isCollapsed:function(){var f=this.getRange();if(f&&f.item){return false}return(f&&f.boundingWidth==0)||this.getSelection().isCollapsed},collapse:function(f){var h=this.getRange();var g=this.getSelection();if(h.select){h.collapse(f);h.select()}else{f?g.collapseToStart():g.collapseToEnd()}},getContent:function(){var h=this.getRange();var f=new Element("body");if(this.isCollapsed()){return""}if(h.cloneContents){f.appendChild(h.cloneContents())}else{if(h.item!=undefined||h.htmlText!=undefined){f.set("html",h.item?h.item(0).outerHTML:h.htmlText)}else{f.set("html",h.toString())}}var g=f.get("html");return g},getText:function(){var g=this.getRange();var f=this.getSelection();return this.isCollapsed()?"":g.text||(f.toString?f.toString():"")},getNode:function(){var g=this.getRange();if(!Browser.ie||Browser.version>=9){var f=null;if(g){f=g.commonAncestorContainer;if(!g.collapsed){if(g.startContainer==g.endContainer){if(g.startOffset-g.endOffset<2){if(g.startContainer.hasChildNodes()){f=g.startContainer.childNodes[g.startOffset]}}}}while(typeOf(f)!="element"){f=f.parentNode}}return document.id(f)}return document.id(g.item?g.item(0):g.parentElement())},insertContent:function(j){if(Browser.ie){var h=this.getRange();if(h.pasteHTML){h.pasteHTML(j);h.collapse(false);h.select()}else{if(h.insertNode){h.deleteContents();if(h.createContextualFragment){h.insertNode(h.createContextualFragment(j))}else{var k=this.win.document;var g=k.createDocumentFragment();var f=k.createElement("div");g.appendChild(f);f.outerHTML=j;h.insertNode(g)}}}}else{this.win.document.execCommand("insertHTML",false,j)}}});var a={};MooEditable.Locale={define:function(f,g){if(typeOf(window.Locale)!="null"){return window.Locale.define("en-US","MooEditable",f,g)}if(typeOf(f)=="object"){Object.merge(a,f)}else{a[f]=g}},get:function(f){if(typeOf(window.Locale)!="null"){return window.Locale.get("MooEditable."+f)}return f?a[f]:""}};MooEditable.Locale.define({ok:"OK",cancel:"Cancel",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",unorderedList:"Unordered List",orderedList:"Ordered List",indent:"Indent",outdent:"Outdent",undo:"Undo",redo:"Redo",removeHyperlink:"Remove Hyperlink",addHyperlink:"Add Hyperlink",selectTextHyperlink:"Please select the text you wish to hyperlink.",enterURL:"Enter URL",enterImageURL:"Enter image URL",addImage:"Add Image",toggleView:"Toggle View"});MooEditable.UI={};MooEditable.UI.Toolbar=new Class({Implements:[Events,Options],options:{"class":""},initialize:function(f){this.setOptions(f);this.el=new Element("div",{"class":"mooeditable-ui-toolbar "+this.options["class"]});this.items={};this.content=null},toElement:function(){return this.el},render:function(f){if(this.content){this.el.adopt(this.content)}else{this.content=f.map(function(g){if(g=="|"){return this.addSeparator()}else{if(g=="/"){return this.addLineSeparator()}}return this.addItem(g)}.bind(this))}return this},addItem:function(l){var g=this;var f=MooEditable.Actions[l];if(!f){return}var j=f.type||"button";var h=f.options||{};var k=new MooEditable.UI[j.camelCase().capitalize()](Object.append(h,{name:l,"class":l+"-item toolbar-item",title:f.title,onAction:g.itemAction.bind(g)}));this.items[l]=k;document.id(k).inject(this.el);return k},getItem:function(f){return this.items[f]},addSeparator:function(){return new Element("span.toolbar-separator").inject(this.el)},addLineSeparator:function(){return new Element("div.toolbar-line-separator").inject(this.el)},itemAction:function(){this.fireEvent("itemAction",arguments)},disable:function(f){Object.each(this.items,function(g){(g.name==f)?g.activate():g.deactivate().disable()});return this},enable:function(){Object.each(this.items,function(f){f.enable()});return this},show:function(){this.el.setStyle("display","");return this},hide:function(){this.el.setStyle("display","none");return this}});MooEditable.UI.Button=new Class({Implements:[Events,Options],options:{title:"",name:"",text:"Button","class":"",shortcut:"",mode:"icon"},initialize:function(f){this.setOptions(f);this.name=this.options.name;this.render()},toElement:function(){return this.el},render:function(){var g=this;var h=(Browser.Platform.mac)?"Cmd":"Ctrl";var f=(this.options.shortcut)?" ( "+h+"+"+this.options.shortcut.toUpperCase()+" )":"";var k=this.options.title||name;var j=k+f;this.el=new Element("button",{"class":"mooeditable-ui-button "+g.options["class"],title:j,html:'<span class="button-icon"></span><span class="button-text">'+k+"</span>",events:{click:g.click.bind(g),mousedown:function(l){l.preventDefault()}}});if(this.options.mode!="icon"){this.el.addClass("mooeditable-ui-button-"+this.options.mode)}this.active=false;this.disabled=false;if(Browser.ie){this.el.addEvents({mouseenter:function(l){this.addClass("hover")},mouseleave:function(l){this.removeClass("hover")}})}return this},click:function(f){f.preventDefault();if(this.disabled){return}this.action(f)},action:function(){this.fireEvent("action",[this].concat(Array.from(arguments)))},enable:function(){if(this.active){this.el.removeClass("onActive")}if(!this.disabled){return}this.disabled=false;this.el.removeClass("disabled").set({disabled:false,opacity:1});return this},disable:function(){if(this.disabled){return}this.disabled=true;this.el.addClass("disabled").set({disabled:true,opacity:0.4});return this},activate:function(){if(this.disabled){return}this.active=true;this.el.addClass("onActive");return this},deactivate:function(){this.active=false;this.el.removeClass("onActive");return this}});MooEditable.UI.Dialog=new Class({Implements:[Events,Options],options:{"class":"",contentClass:""},initialize:function(h,g){this.setOptions(g);this.html=h;var f=this;this.el=new Element("div",{"class":"mooeditable-ui-dialog "+f.options["class"],html:'<div class="dialog-content '+f.options.contentClass+'">'+h+"</div>",styles:{display:"none"},events:{click:f.click.bind(f)}})},toElement:function(){return this.el},click:function(){this.fireEvent("click",arguments);return this},open:function(){this.el.setStyle("display","");this.fireEvent("open",this);return this},close:function(){this.el.setStyle("display","none");this.fireEvent("close",this);return this}});MooEditable.UI.AlertDialog=function(g){if(!g){return}var f=g+' <button class="dialog-ok-button">'+MooEditable.Locale.get("ok")+"</button>";return new MooEditable.UI.Dialog(f,{"class":"mooeditable-alert-dialog",onOpen:function(){var h=this.el.getElement(".dialog-ok-button");(function(){h.focus()}).delay(10)},onClick:function(h){h.preventDefault();if(h.target.tagName.toLowerCase()!="button"){return}if(document.id(h.target).hasClass("dialog-ok-button")){this.close()}}})};MooEditable.UI.PromptDialog=function(h,j,g){if(!h){return}var f='<label class="dialog-label">'+h+' <input type="text" class="text dialog-input" value="'+j+'"></label> <button class="dialog-button dialog-ok-button">'+MooEditable.Locale.get("ok")+'</button><button class="dialog-button dialog-cancel-button">'+MooEditable.Locale.get("cancel")+"</button>";return new MooEditable.UI.Dialog(f,{"class":"mooeditable-prompt-dialog",onOpen:function(){var k=this.el.getElement(".dialog-input");(function(){k.focus();k.select()}).delay(10)},onClick:function(n){n.preventDefault();if(n.target.tagName.toLowerCase()!="button"){return}var l=document.id(n.target);var k=this.el.getElement(".dialog-input");if(l.hasClass("dialog-cancel-button")){k.set("value",j);this.close()}else{if(l.hasClass("dialog-ok-button")){var m=k.get("value");k.set("value",j);this.close();if(g){g.attempt(m,this)}}}}})};MooEditable.Actions={bold:{title:MooEditable.Locale.get("bold"),options:{shortcut:"b"},states:{tags:["b","strong"],css:{"font-weight":"bold"}},events:{beforeToggleView:function(){if(Browser.firefox){var f=this.textarea.get("value");var g=f.replace(/<strong([^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>");if(f!=g){this.textarea.set("value",g)}}},attach:function(){if(Browser.firefox){var f=this.textarea.get("value");var g=f.replace(/<strong([^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>");if(f!=g){this.textarea.set("value",g);this.setContent(g)}}}}},italic:{title:MooEditable.Locale.get("italic"),options:{shortcut:"i"},states:{tags:["i","em"],css:{"font-style":"italic"}},events:{beforeToggleView:function(){if(Browser.firefox){var f=this.textarea.get("value");var g=f.replace(/<embed([^>]*)>/gi,"<tmpembed$1>").replace(/<em([^>]*)>/gi,"<i$1>").replace(/<tmpembed([^>]*)>/gi,"<embed$1>").replace(/<\/em>/gi,"</i>");if(f!=g){this.textarea.set("value",g)}}},attach:function(){if(Browser.firefox){var f=this.textarea.get("value");var g=f.replace(/<embed([^>]*)>/gi,"<tmpembed$1>").replace(/<em([^>]*)>/gi,"<i$1>").replace(/<tmpembed([^>]*)>/gi,"<embed$1>").replace(/<\/em>/gi,"</i>");if(f!=g){this.textarea.set("value",g);this.setContent(g)}}}}},underline:{title:MooEditable.Locale.get("underline"),options:{shortcut:"u"},states:{tags:["u"],css:{"text-decoration":"underline"}},events:{beforeToggleView:function(){if(Browser.firefox||Browser.ie){var f=this.textarea.get("value");var g=f.replace(/<span style="text-decoration: underline;"([^>]*)>/gi,"<u$1>").replace(/<\/span>/gi,"</u>");if(f!=g){this.textarea.set("value",g)}}},attach:function(){if(Browser.firefox||Browser.ie){var f=this.textarea.get("value");var g=f.replace(/<span style="text-decoration: underline;"([^>]*)>/gi,"<u$1>").replace(/<\/span>/gi,"</u>");if(f!=g){this.textarea.set("value",g);this.setContent(g)}}}}},strikethrough:{title:MooEditable.Locale.get("strikethrough"),options:{shortcut:"s"},states:{tags:["s","strike"],css:{"text-decoration":"line-through"}}},insertunorderedlist:{title:MooEditable.Locale.get("unorderedList"),states:{tags:["ul"]}},insertorderedlist:{title:MooEditable.Locale.get("orderedList"),states:{tags:["ol"]}},indent:{title:MooEditable.Locale.get("indent"),states:{tags:["blockquote"]}},outdent:{title:MooEditable.Locale.get("outdent")},undo:{title:MooEditable.Locale.get("undo"),options:{shortcut:"z"}},redo:{title:MooEditable.Locale.get("redo"),options:{shortcut:"y"}},unlink:{title:MooEditable.Locale.get("removeHyperlink")},createlink:{title:MooEditable.Locale.get("addHyperlink"),options:{shortcut:"l"},states:{tags:["a"]},dialogs:{alert:MooEditable.UI.AlertDialog.pass(MooEditable.Locale.get("selectTextHyperlink")),prompt:function(f){return MooEditable.UI.PromptDialog(MooEditable.Locale.get("enterURL"),"http://",function(g){f.execute("createlink",false,g.trim())})}},command:function(){var g=this.selection;var j=this.dialogs.createlink;if(g.isCollapsed()){var h=g.getNode();if(h&&h.get("tag")=="a"&&h.get("href")){g.selectNode(h);var f=j.prompt;f.el.getElement(".dialog-input").set("value",h.get("href"));f.open()}else{j.alert.open()}}else{var k=g.getText();var f=j.prompt;if(d.test(k)){f.el.getElement(".dialog-input").set("value",k)}f.open()}}},urlimage:{title:MooEditable.Locale.get("addImage"),options:{shortcut:"m"},dialogs:{prompt:function(f){return MooEditable.UI.PromptDialog(MooEditable.Locale.get("enterImageURL"),"http://",function(g){f.execute("insertimage",false,g.trim())})}},command:function(){this.dialogs.urlimage.prompt.open()}},toggleview:{title:MooEditable.Locale.get("toggleView"),command:function(){(this.mode=="textarea")?this.toolbar.enable():this.toolbar.disable("toggleview");this.toggleView()}}};MooEditable.Actions.Settings={};Element.Properties.mooeditable={get:function(){return this.retrieve("MooEditable")}};Element.implement({mooEditable:function(f){var g=this.get("mooeditable");if(!g){g=new MooEditable(this,f)}return g}})})();MooEditable.Actions.Settings.charmap={chars:[["&nbsp;","&#160;"],["&amp;","&#38;"],["&quot;","&#34;"],["&cent;","&#162;"],["&euro;","&#8364;"],["&pound;","&#163;"],["&yen;","&#165;"],["&copy;","&#169;"],["&reg;","&#174;"],["&trade;","&#8482;"],["&permil;","&#8240;"],["&micro;","&#181;"],["&middot;","&#183;"],["&bull;","&#8226;"],["&hellip;","&#8230;"],["&prime;","&#8242;"],["&Prime;","&#8243;"],["&sect;","&#167;"],["&para;","&#182;"],["&szlig;","&#223;"],["&lsaquo;","&#8249;"],["&rsaquo;","&#8250;"],["&laquo;","&#171;"],["&raquo;","&#187;"],["&lsquo;","&#8216;"],["&rsquo;","&#8217;"],["&ldquo;","&#8220;"],["&rdquo;","&#8221;"],["&sbquo;","&#8218;"],["&bdquo;","&#8222;"],["&lt;","&#60;"],["&gt;","&#62;"],["&le;","&#8804;"],["&ge;","&#8805;"],["&ndash;","&#8211;"],["&mdash;","&#8212;"],["&macr;","&#175;"],["&oline;","&#8254;"],["&curren;","&#164;"],["&brvbar;","&#166;"],["&uml;","&#168;"],["&iexcl;","&#161;"],["&iquest;","&#191;"],["&circ;","&#710;"],["&tilde;","&#732;"],["&deg;","&#176;"],["&minus;","&#8722;"],["&plusmn;","&#177;"],["&divide;","&#247;"],["&frasl;","&#8260;"],["&times;","&#215;"],["&sup1;","&#185;"],["&sup2;","&#178;"],["&sup3;","&#179;"],["&frac14;","&#188;"],["&frac12;","&#189;"],["&frac34;","&#190;"],["&fnof;","&#402;"],["&int;","&#8747;"],["&sum;","&#8721;"],["&infin;","&#8734;"],["&radic;","&#8730;"],["&sim;","&#8764;"],["&cong;","&#8773;"],["&asymp;","&#8776;"],["&ne;","&#8800;"],["&equiv;","&#8801;"],["&isin;","&#8712;"],["&notin;","&#8713;"],["&ni;","&#8715;"],["&prod;","&#8719;"],["&and;","&#8743;"],["&or;","&#8744;"],["&not;","&#172;"],["&cap;","&#8745;"],["&cup;","&#8746;"],["&part;","&#8706;"],["&forall;","&#8704;"],["&exist;","&#8707;"],["&empty;","&#8709;"],["&nabla;","&#8711;"],["&lowast;","&#8727;"],["&prop;","&#8733;"],["&ang;","&#8736;"],["&acute;","&#180;"],["&cedil;","&#184;"],["&ordf;","&#170;"],["&ordm;","&#186;"],["&dagger;","&#8224;"],["&Dagger;","&#8225;"],["&Agrave;","&#192;"],["&Aacute;","&#193;"],["&Acirc;","&#194;"],["&Atilde;","&#195;"],["&Auml;","&#196;"],["&Aring;","&#197;"],["&AElig;","&#198;"],["&Ccedil;","&#199;"],["&Egrave;","&#200;"],["&Eacute;","&#201;"],["&Ecirc;","&#202;"],["&Euml;","&#203;"],["&Igrave;","&#204;"],["&Iacute;","&#205;"],["&Icirc;","&#206;"],["&Iuml;","&#207;"],["&ETH;","&#208;"],["&Ntilde;","&#209;"],["&Ograve;","&#210;"],["&Oacute;","&#211;"],["&Ocirc;","&#212;"],["&Otilde;","&#213;"],["&Ouml;","&#214;"],["&Oslash;","&#216;"],["&OElig;","&#338;"],["&Scaron;","&#352;"],["&Ugrave;","&#217;"],["&Uacute;","&#218;"],["&Ucirc;","&#219;"],["&Uuml;","&#220;"],["&Yacute;","&#221;"],["&Yuml;","&#376;"],["&THORN;","&#222;"],["&agrave;","&#224;"],["&aacute;","&#225;"],["&acirc;","&#226;"],["&atilde;","&#227;"],["&auml;","&#228;"],["&aring;","&#229;"],["&aelig;","&#230;"],["&ccedil;","&#231;"],["&egrave;","&#232;"],["&eacute;","&#233;"],["&ecirc;","&#234;"],["&euml;","&#235;"],["&igrave;","&#236;"],["&iacute;","&#237;"],["&icirc;","&#238;"],["&iuml;","&#239;"],["&eth;","&#240;"],["&ntilde;","&#241;"],["&ograve;","&#242;"],["&oacute;","&#243;"],["&ocirc;","&#244;"],["&otilde;","&#245;"],["&ouml;","&#246;"],["&oslash;","&#248;"],["&oelig;","&#339;"],["&scaron;","&#353;"],["&ugrave;","&#249;"],["&uacute;","&#250;"],["&ucirc;","&#251;"],["&uuml;","&#252;"],["&yacute;","&#253;"],["&thorn;","&#254;"],["&yuml;","&#255;"],["&Alpha;","&#913;"],["&Beta;","&#914;"],["&Gamma;","&#915;"],["&Delta;","&#916;"],["&Epsilon;","&#917;"],["&Zeta;","&#918;"],["&Eta;","&#919;"],["&Theta;","&#920;"],["&Iota;","&#921;"],["&Kappa;","&#922;"],["&Lambda;","&#923;"],["&Mu;","&#924;"],["&Nu;","&#925;"],["&Xi;","&#926;"],["&Omicron;","&#927;"],["&Pi;","&#928;"],["&Rho;","&#929;"],["&Sigma;","&#931;"],["&Tau;","&#932;"],["&Upsilon;","&#933;"],["&Phi;","&#934;"],["&Chi;","&#935;"],["&Psi;","&#936;"],["&Omega;","&#937;"],["&alpha;","&#945;"],["&beta;","&#946;"],["&gamma;","&#947;"],["&delta;","&#948;"],["&epsilon;","&#949;"],["&zeta;","&#950;"],["&eta;","&#951;"],["&theta;","&#952;"],["&iota;","&#953;"],["&kappa;","&#954;"],["&lambda;","&#955;"],["&mu;","&#956;"],["&nu;","&#957;"],["&xi;","&#958;"],["&omicron;","&#959;"],["&pi;","&#960;"],["&rho;","&#961;"],["&sigmaf;","&#962;"],["&sigma;","&#963;"],["&tau;","&#964;"],["&upsilon;","&#965;"],["&phi;","&#966;"],["&chi;","&#967;"],["&psi;","&#968;"],["&omega;","&#969;"],["&alefsym;","&#8501;"],["&piv;","&#982;"],["&real;","&#8476;"],["&thetasym;","&#977;"],["&upsih;","&#978;"],["&weierp;","&#8472;"],["&image;","&#8465;"],["&larr;","&#8592;"],["&uarr;","&#8593;"],["&rarr;","&#8594;"],["&darr;","&#8595;"],["&harr;","&#8596;"],["&crarr;","&#8629;"],["&lArr;","&#8656;"],["&uArr;","&#8657;"],["&rArr;","&#8658;"],["&dArr;","&#8659;"],["&hArr;","&#8660;"],["&there4;","&#8756;"],["&sub;","&#8834;"],["&sup;","&#8835;"],["&nsub;","&#8836;"],["&sube;","&#8838;"],["&supe;","&#8839;"],["&oplus;","&#8853;"],["&otimes;","&#8855;"],["&perp;","&#8869;"],["&sdot;","&#8901;"],["&lceil;","&#8968;"],["&rceil;","&#8969;"],["&lfloor;","&#8970;"],["&rfloor;","&#8971;"],["&lang;","&#9001;"],["&rang;","&#9002;"],["&loz;","&#9674;"],["&spades;","&#9824;"],["&clubs;","&#9827;"],["&hearts;","&#9829;"],["&diams;","&#9830;"]]};MooEditable.Locale.define({insertCustomCharacter:"Insert custom character",insertCharacter:"Insert character"});MooEditable.UI.CharacterDialog=function(d){var c=MooEditable.Locale.get("insertCharacter")+' <select class="char">';var f=MooEditable.Actions.Settings.charmap.chars;for(var b=0,a=f.length;b<a;b++){c+='<option data-code="'+f[b][0]+'">'+f[b][1]+"</option>"}c+='</select><button class="dialog-button dialog-ok-button">'+MooEditable.Locale.get("ok")+'</button><button class="dialog-button dialog-cancel-button">'+MooEditable.Locale.get("cancel")+"</button>";return new MooEditable.UI.Dialog(c,{"class":"mooeditable-charmap-dialog",onClick:function(j){if(j.target.tagName.toLowerCase()=="button"){j.preventDefault()}var g=document.id(j.target);if(g.hasClass("dialog-cancel-button")){this.close()}else{if(g.hasClass("dialog-ok-button")){this.close();var h=g.getPrevious("select.char");var k=new Element("div").set("html",$(h.options[h.selectedIndex]).getProperty("data-code").trim());d.selection.insertContent(k.get("html"))}}}})};MooEditable.Actions.charmap={title:MooEditable.Locale.get("insertCustomCharacter"),dialogs:{prompt:function(a){return MooEditable.UI.CharacterDialog(a)}},command:function(){this.dialogs.charmap.prompt.open()},events:{toggleView:function(){if(this.mode=="textarea"){var a=this.textarea.get("value");MooEditable.Actions.Settings.charmap.chars.each(function(c){if(!["&amp;","&gt;","&lt;","&quot;","&nbsp;"].contains(c[0])){var b=new RegExp(String.fromCharCode(parseInt(c[1].replace("&#","").replace(";",""))),"g");a=a.replace(b,c[0])}},this);this.textarea.set("value",a)}}}};(function(){MooEditable=Class.refactor(MooEditable,{attach:function(){var a=this.previous();this.doc.body.addListener("paste",this.cleanPaste.bind(this));return a},cleanPaste:function(b){var a=b.clipboardData&&b.clipboardData.getData?b.clipboardData.getData("text/html"):window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):false;if((!a||""===a.trim())&&b.clipboardData&&b.clipboardData.getData){a=b.clipboardData.getData("Text")}if(!!a){if(window.clipboardData){this.selection.insertContent(this.cleanHtml(a,1))}else{this.selection.insertContent(this.cleanHtml(a))}new Event(b).stop()}else{this.selection.insertContent('<span id="INSERTION_MARKER">&nbsp;</span>');this.txtMarked=this.doc.body.get("html");this.doc.body.set("html","");this.replaceMarkerWithPastedText.delay(5,this)}return this},replaceMarkerWithPastedText:function(){var a=this.cleanHtml(this.doc.body.get("html"));this.doc.body.set("html",this.txtMarked);this.selection.selectNode(this.doc.body.getElementById("INSERTION_MARKER"));this.selection.insertContent(a);return this},cleanHtml:function(c,b){if(b){if(!this.options.paragraphise){c=c.replace(/\n/g,"<br />")}else{c="<p>"+c+"</p>";c=c.replace(/\n/g,"</p><p>");c=c.replace(/<p>\s<\/p>/gi,"")}}else{c=c.replace(/<html[^>]*?>(.*)/gim,"$1");c=c.replace(/<\/html>/gi,"");c=c.replace(/<body[^>]*?>(.*)/gi,"$1");c=c.replace(/<\/body>/gi,"");c=c.replace(/<style[^>]*?>[\s\S]*?<\/style[^>]*>/gi,"");c=c.replace(/<(?:meta|link)[^>]*>\s*/gi,"");c=c.replace(/<\\?\?xml[^>]*>/gi,"");c=c.replace(/<w:[^>]*>[\s\S]*?<\/w:[^>]*>/gi,"");c=c.replace(/<o:p>\s*<\/o:p>/g,"");c=c.replace(/<o:p>[\s\S]*?<\/o:p>/g,"&nbsp;");c=c.replace(/<\/?\w+:[^>]*>/gi,"");c=c.replace(/<\!--[\s\S]*?-->/g,"");c=c.replace(/<\!\[[\s\S]*?\]>/g,"");c=c.replace(/\s*mso-[^:]+:[^;"']+;?/gi,"");c=c.replace(/<(\w[^>]*) style='([^\']*)'([^>]*)/gim,"<$1$3");c=c.replace(/<(\w[^>]*) style="([^\"]*)"([^>]*)/gim,"<$1$3");c=c.replace(/\s*margin: 0cm 0cm 0pt\s*;/gi,"");c=c.replace(/\s*margin: 0cm 0cm 0pt\s*"/gi,'"');c=c.replace(/\s*text-indent: 0cm\s*;/gi,"");c=c.replace(/\s*text-indent: 0cm\s*"/gi,'"');c=c.replace(/\s*text-align: [^\s;]+;?"/gi,'"');c=c.replace(/\s*page-break-before: [^\s;]+;?"/gi,'"');c=c.replace(/\s*font-variant: [^\s;]+;?"/gi,'"');c=c.replace(/\s*tab-stops:[^;"']*;?/gi,"");c=c.replace(/\s*tab-stops:[^"']*/gi,"");c=c.replace(/\s*face="[^"']*"/gi,"");c=c.replace(/\s*face=[^ >]*/gi,"");c=c.replace(/\s*font-family:[^;"']*;?/gi,"");c=c.replace(/\s*font-size:[^;"']*;?/gi,"");c=c.replace(/<(\w[^>]*) class=([^ |>]*)([^>]*)/gi,"<$1$3");c=c.replace(/<(\w+)[^>]*\sstyle="[^"']*display\s?:\s?none[\s \S]*?<\/\1>/ig,"");c=c.replace(/\s*style='\s*'/gi,"");c=c.replace(/\s*style="\s*"/gi,"");c=c.replace(/<span\s*[^>]*>\s*&nbsp;\s*<\/span>/gi,"&nbsp;");c=c.replace(/<span\s*[^>]*><\/span>/gi,"");c=c.replace(/<(\w[^>]*) align=([^ |>]*)([^>]*)/gi,"<$1$3");c=c.replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3");c=c.replace(/<span([^>]*)>([\s\S]*?)<\/span>/gi,"$2");c=c.replace(/<font\s*>([\s\S]*?)<\/font>/gi,"$1");c=c.replace(/<(u|i|strike)>&nbsp;<\/\1>/gi,"&nbsp;");c=c.replace(/<h\d>\s*<\/h\d>/gi,"");c=c.replace(/<(\w[^>]*) language=([^ |>]*)([^>]*)/gi,"<$1$3");c=c.replace(/<(\w[^>]*) onmouseover="([^\"']*)"([^>]*)/gi,"<$1$3");c=c.replace(/<(\w[^>]*) onmouseout="([^\"']*)"([^>]*)/gi,"<$1$3");c=c.replace(/<h(\d)([^>]*)>/gi,"<h$1>");c=c.replace(/<(h\d)><font[^>]*>([\s\S]*?)<\/font><\/\1>/gi,"<$1>$2</$1>");c=c.replace(/<(h\d)><em>([\s\S]*?)<\/em><\/\1>/gi,"<$1>$2</$1>");c=c.replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>");c=c.replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>");c=c.replace(/<\s+[^>]*>/gi,"");c=c.replace(/<span>([\s\S]*?)<\/span>/gi,"$1");c=c.replace(/<span>([\s\S]*?)<\/span>/gi,"$1");c=c.replace(/<div>([\s\S]*?)<\/div>/gi,"$1");c=c.replace(/<div>([\s\S]*?)<\/div>/gi,"$1");c=c.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"");c=c.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"");c=c.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"");c=c.trim();if(!this.options.paragraphise){c.replace(/<p>/gi,"<br />");c.replace(/<\/p>/gi,"")}else{var a=c.substr(0,2);if("<p"!==a){c="<p>"+c+"</p>";c=c.replace(/\n/g,"</p><p>");c=c.replace(/<br[^>]*>/gi,"</p><p>")}}c=c.replace(/<br>/gi,"<br />");c=c.replace(/<br[^>]*><\/p>/gim,"</p>");c=c.replace(/<p>&nbsp;<\/p>/gi,"");c=c.replace(/<p>\s<\/p>/gi,"");c=c.replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"");c=c.trim()}return c}})}());MooEditable.Locale.define({blockFormatting:"Block Formatting",paragraph:"Paragraph",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",alignLeft:"Align Left",alignRight:"Align Right",alignCenter:"Align Center",alignJustify:"Align Justify",removeFormatting:"Remove Formatting",insertHorizontalRule:"Insert Horizontal Rule"});Object.append(MooEditable.Actions,{formatBlock:{title:MooEditable.Locale.get("blockFormatting"),type:"menu-list",options:{list:[{text:MooEditable.Locale.get("paragraph"),value:"p"},{text:MooEditable.Locale.get("heading1"),value:"h1",style:"font-size:24px; font-weight:bold;"},{text:MooEditable.Locale.get("heading2"),value:"h2",style:"font-size:18px; font-weight:bold;"},{text:MooEditable.Locale.get("heading3"),value:"h3",style:"font-size:14px; font-weight:bold;"}]},states:{tags:["p","h1","h2","h3"]},command:function(c,a){var b="<"+a+">";this.focus();this.execute("formatBlock",false,b)}},justifyleft:{title:MooEditable.Locale.get("alignLeft"),states:{css:{"text-align":"left"}}},justifyright:{title:MooEditable.Locale.get("alignRight"),states:{css:{"text-align":"right"}}},justifycenter:{title:MooEditable.Locale.get("alignCenter"),states:{tags:["center"],css:{"text-align":"center"}}},justifyfull:{title:MooEditable.Locale.get("alignJustify"),states:{css:{"text-align":"justify"}}},removeformat:{title:MooEditable.Locale.get("removeFormatting")},insertHorizontalRule:{title:MooEditable.Locale.get("insertHorizontalRule"),states:{tags:["hr"]},command:function(){this.selection.insertContent("<hr>")}}});MooEditable.Locale.define({embed:"Enter embed code",flashEmbed:"Flash Embed"});MooEditable.UI.FlashDialog=function(b){var a=MooEditable.Locale.get("embed")+' <textarea class="dialog-f" value="" rows="2" cols="40"></textarea> <button class="dialog-button dialog-ok-button">'+MooEditable.Locale.get("ok")+'</button> <button class="dialog-button dialog-cancel-button">'+MooEditable.Locale.get("cancel")+"</button>";return new MooEditable.UI.Dialog(a,{"class":"mooeditable-flash-dialog",onOpen:function(){var c=this.el.getElement(".dialog-f");(function(){c.focus();c.select()}).delay(10)},onClick:function(d){if(d.target.tagName.toLowerCase()=="button"){d.preventDefault()}var c=document.id(d.target);if(c.hasClass("dialog-cancel-button")){this.close()}else{if(c.hasClass("dialog-ok-button")){this.close();var f=new Element("div").set("html",this.el.getElement(".dialog-f").get("value").trim());b.selection.insertContent(f.get("html"))}}}})};MooEditable.Actions.flash={title:MooEditable.Locale.get("flashEmbed"),dialogs:{prompt:function(a){return MooEditable.UI.FlashDialog(a)}},command:function(){this.dialogs.flash.prompt.open()}};MooEditable.Actions.Settings.forecolor={colors:[["000000","993300","333300","003300","003366","000077","333399","333333"],["770000","ff6600","777700","007700","007777","0000ff","666699","777777"],["ff0000","ff9900","99cc00","339966","33cccc","3366f0","770077","999999"],["ff00ff","ffcc00","ffff00","00ff00","00ffff","00ccff","993366","cccccc"],["ff99cc","ffcc99","ffff99","ccffcc","ccffff","99ccff","cc9977","ffffff"]]};MooEditable.Locale.define("changeColor","Change Color");MooEditable.Actions.forecolor={type:"button-overlay",title:MooEditable.Locale.get("changeColor"),options:{overlaySize:{x:"auto"},overlayHTML:(function(){var a="";MooEditable.Actions.Settings.forecolor.colors.each(function(b){b.each(function(d){a+='<a href="#" class="forecolor-colorpicker-color" style="background-color: #'+d+'" title="#'+d.toUpperCase()+'"></a>'});a+='<span class="forecolor-colorpicker-br"></span>'});return a})()},command:function(d,c){var b=c.target;if(b.tagName.toLowerCase()!="a"){return}var a=$(b).getStyle("background-color");this.execute("forecolor",false,a);this.focus()}};MooEditable.Group=new Class({Implements:[Options],options:{actions:"bold italic underline strikethrough | insertunorderedlist insertorderedlist indent outdent | undo redo | createlink unlink | urlimage | toggleview"},initialize:function(a,c){this.setOptions(c);this.actions=this.options.actions.clean().split(" ");var b=this;this.toolbar=new MooEditable.UI.Toolbar({onItemAction:function(){var d=Array.from(arguments);var f=d[0];if(!b.activeEditor){return}b.activeEditor.focus();b.activeEditor.action(f.name,d);if(b.activeEditor.mode=="iframe"){b.activeEditor.checkStates()}}}).render(this.actions);document.id(a).adopt(this.toolbar)},add:function(a,b){return this.activeEditor=new MooEditable.Group.Item(a,this,Object.merge({toolbar:false},this.options,b))}});MooEditable.Group.Item=new Class({Extends:MooEditable,initialize:function(a,d,c){var b=this;this.group=d;this.parent(a,c);this.addEvent("attach",function(){var f=function(){if(this==b.win){b.group.activeEditor=b}};b.textarea.addEvent("focus",f);b.win.addEvent("focus",f)})}});MooEditable.Locale.define({imageAlt:"alt",imageClass:"class",imageAlign:"align",imageAlignNone:"none",imageAlignLeft:"left",imageAlignCenter:"center",imageAlignRight:"right",addEditImage:"Add/Edit Image"});MooEditable.UI.ImageDialog=function(b){var a=MooEditable.Locale.get("enterImageURL")+' <input type="text" class="dialog-url" value="" size="15"> '+MooEditable.Locale.get("imageAlt")+' <input type="text" class="dialog-alt" value="" size="8"> '+MooEditable.Locale.get("imageClass")+' <input type="text" class="dialog-class" value="" size="8"> '+MooEditable.Locale.get("imageAlign")+' <select class="dialog-align"><option>'+MooEditable.Locale.get("imageAlignNone")+"</option><option>"+MooEditable.Locale.get("imageAlignLeft")+"</option><option>"+MooEditable.Locale.get("imageAlignCenter")+"</option><option>"+MooEditable.Locale.get("imageAlignRight")+'</option></select> <button class="dialog-button dialog-ok-button">'+MooEditable.Locale.get("ok")+'</button> <button class="dialog-button dialog-cancel-button">'+MooEditable.Locale.get("cancel")+"</button>";return new MooEditable.UI.Dialog(a,{"class":"mooeditable-image-dialog",onOpen:function(){var c=this.el.getElement(".dialog-url");var d=b.selection.getNode();if(d.get("tag")=="img"){this.el.getElement(".dialog-url").set("value",d.get("src"));this.el.getElement(".dialog-alt").set("value",d.get("alt"));this.el.getElement(".dialog-class").set("value",d.className);this.el.getElement(".dialog-align").set("align",d.get("align"))}(function(){c.focus();c.select()}).delay(10)},onClick:function(g){if(g.target.tagName.toLowerCase()=="button"){g.preventDefault()}var d=document.id(g.target);if(d.hasClass("dialog-cancel-button")){this.close()}else{if(d.hasClass("dialog-ok-button")){this.close();var c=this.el.getElement(".dialog-align");var f=b.selection.getNode();if(f.get("tag")=="img"){f.set("src",this.el.getElement(".dialog-url").get("value").trim());f.set("alt",this.el.getElement(".dialog-alt").get("value").trim());f.className=this.el.getElement(".dialog-class").get("value").trim();f.set("align",$(c.options[c.selectedIndex]).get("value"))}else{var h=new Element("div");new Element("img",{src:this.el.getElement(".dialog-url").get("value").trim(),alt:this.el.getElement(".dialog-alt").get("value").trim(),"class":this.el.getElement(".dialog-class").get("value").trim(),align:$(c.options[c.selectedIndex]).get("value")}).inject(h);b.selection.insertContent(h.get("html"))}}}}})};MooEditable.Actions.image={title:MooEditable.Locale.get("addEditImage"),options:{shortcut:"m"},dialogs:{prompt:function(a){return MooEditable.UI.ImageDialog(a)}},command:function(){this.dialogs.image.prompt.open()}};MooEditable.Actions.Settings.pagebreak={imageFile:"../../Assets/MooEditable/Other/pagebreak.gif"};MooEditable.Locale.define("pageBreak","Page break");MooEditable.Actions.pagebreak={title:MooEditable.Locale.get("pageBreak"),command:function(){this.selection.insertContent('<img class="mooeditable-visual-aid mooeditable-pagebreak">')},events:{attach:function(a){if(Browser.ie){a.doc.addListener("controlselect",function(c){var b=c.target||c.srcElement;if(b.tagName.toLowerCase()!="img"){return}if(!document.id(b).hasClass("mooeditable-pagebreak")){return}if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}})}},editorMouseDown:function(d,c){var b=d.target;var a=(b.tagName.toLowerCase()=="img")&&$(b).hasClass("mooeditable-pagebreak");Function.attempt(function(){c.doc.execCommand("enableObjectResizing",false,!a)})},beforeToggleView:function(){if(this.mode=="iframe"){var a=this.getContent().replace(/<img([^>]*)class="mooeditable-visual-aid mooeditable-pagebreak"([^>]*)>/gi,"<!-- page break -->");this.setContent(a)}else{var a=this.textarea.get("value").replace(/<!-- page break -->/gi,'<img class="mooeditable-visual-aid mooeditable-pagebreak">');this.textarea.set("value",a)}},render:function(){this.options.extraCSS="img.mooeditable-pagebreak { display:block; width:100%; height:16px; background: url("+MooEditable.Actions.Settings.pagebreak.imageFile+") repeat-x; }"+this.options.extraCSS}}};MooEditable.Actions.Settings.smiley={imagesPath:"../../Assets/MooEditable/Smiley/",smileys:["angryface","blush","gasp","grin","halo","lipsaresealed","smile","undecided","wink"],fileExt:".png"};MooEditable.Locale.define("insertSmiley","Insert Smiley");MooEditable.Actions.smiley={type:"button-overlay",title:MooEditable.Locale.get("insertSmiley"),options:{overlaySize:{x:"auto"},overlayHTML:(function(){var b=MooEditable.Actions.Settings.smiley;var a="";b.smileys.each(function(c){a+='<img src="'+b.imagesPath+c+b.fileExt+'" alt="" class="smiley-image">'});return a})()},command:function(f,c){var a=c.target;if(a.tagName.toLowerCase()!="img"){return}var d=$(a).get("src");var b='<img style="border:0;" class="smiley" src="'+d+'" alt="">';this.focus();this.selection.insertContent(b)},events:{attach:function(a){if(Browser.ie){a.doc.addListener("controlselect",function(c){var b=c.target||c.srcElement;if(b.tagName.toLowerCase()!="img"){return}if(!document.id(b).hasClass("smiley")){return}if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}})}},editorMouseDown:function(d,c){var b=d.target;var a=(b.tagName.toLowerCase()=="img")&&$(b).hasClass("smiley");Function.attempt(function(){c.doc.execCommand("enableObjectResizing",false,!a)})}}};MooEditable.Locale.define({tableColumns:"columns",tableRows:"rows",tableWidth:"width",tableClass:"class",tableType:"type",tableHeader:"Header",tableCell:"Cell",tableAlign:"align",tableAlignNone:"none",tableAlignCenter:"center",tableAlignRight:"right",tableValign:"vertical align",tableValignNone:"none",tableValignTop:"top",tableValignMiddle:"middle",tableValignBottom:"bottom",addTable:"Add Table",editTable:"Edit Table",addTableRow:"Add Table Row",editTableRow:"Edit Table Row",mergeTableRow:"Merge Table Row",splitTableRow:"Split Table Row",deleteTableRow:"Delete Table Row",addTableCol:"Add Table Column",editTableCol:"Edit Table Column",mergeTableCell:"Merge Table Cell",splitTableCell:"Split Table Cell",deleteTableCol:"Delete Table Column"});MooEditable.UI.TableDialog=function(c,b){var a={tableadd:MooEditable.Locale.get("tableColumns")+' <input type="text" class="table-c" value="" size="4"> '+MooEditable.Locale.get("tableRows")+' <input type="text" class="table-r" value="" size="4"> ',tableedit:MooEditable.Locale.get("tableWidth")+' <input type="text" class="table-w" value="" size="4"> '+MooEditable.Locale.get("tableClass")+' <input type="text" class="table-c" value="" size="15"> ',tablerowedit:MooEditable.Locale.get("tableClass")+' <input type="text" class="table-c" value="" size="15"> '+MooEditable.Locale.get("tableType")+' <select class="table-c-type"><option value="th">'+MooEditable.Locale.get("tableHeader")+'</option><option value="td">'+MooEditable.Locale.get("tableCell")+"</option></select> ",tablecoledit:MooEditable.Locale.get("tableWidth")+' <input type="text" class="table-w" value="" size="4"> '+MooEditable.Locale.get("tableClass")+' <input type="text" class="table-c" value="" size="15"> '+MooEditable.Locale.get("tableAlign")+' <select class="table-a"><option>'+MooEditable.Locale.get("tableAlignNone")+"</option><option>"+MooEditable.Locale.get("tableAlignLeft")+"</option><option>"+MooEditable.Locale.get("tableAlignCenter")+"</option><option>"+MooEditable.Locale.get("tableAlignRight")+"</option></select> "+MooEditable.Locale.get("tableValign")+' <select class="table-va"><option>'+MooEditable.Locale.get("tableValignNone")+"</option><option>"+MooEditable.Locale.get("tableValignTop")+"</option><option>"+MooEditable.Locale.get("tableValignMiddle")+"</option><option>"+MooEditable.Locale.get("tableValignBottom")+"</option></select> "};a[b]+='<button class="dialog-button dialog-ok-button">'+MooEditable.Locale.get("ok")+'</button><button class="dialog-button dialog-cancel-button">'+MooEditable.Locale.get("cancel")+"</button>";var d={tableadd:{click:function(l){var h=this.el.getElement(".table-c").value.toInt();var o=this.el.getElement(".table-r").value.toInt();if(!(o>0&&h>0)){return}var g,n,j,k=[];g=new Element("tdiv");n=new Element("table").set("border",0).set("width","100%").inject(g);j=new Element("tbody").inject(n);for(var f=0;f<o;f++){k[f]=new Element("tr").inject(j,"bottom");for(var m=0;m<h;m++){new Element("td").set("html","&nbsp;").inject(k[f],"bottom")}}c.selection.insertContent(g.get("html"))}},tableedit:{load:function(g){var f=c.selection.getNode().getParent("table");this.el.getElement(".table-w").set("value",f.get("width"));this.el.getElement(".table-c").set("value",f.className)},click:function(g){var f=c.selection.getNode().getParent("table");f.set("width",this.el.getElement(".table-w").value);f.className=this.el.getElement(".table-c").value}},tablerowedit:{load:function(g){var f=c.selection.getNode().getParent("tr");this.el.getElement(".table-c").set("value",f.className);this.el.getElement(".table-c-type").set("value",c.selection.getNode().get("tag"))},click:function(g){var f=c.selection.getNode().getParent("tr");f.className=this.el.getElement(".table-c").value;f.getElements("td, th").each(function(j){if(this.el.getElement(".table-c-type")!=j.get("tag")){var h=c.doc.createElement(this.el.getElement(".table-c-type").get("value"));$(h).set("html",j.get("html")).replaces(j)}},this)}},tablecoledit:{load:function(g){var f=c.selection.getNode();if(f.get("tag")!="td"){f=f.getParent("td")}this.el.getElement(".table-w").set("value",f.get("width"));this.el.getElement(".table-c").set("value",f.className);this.el.getElement(".table-a").set("value",f.get("align"));this.el.getElement(".table-va").set("value",f.get("valign"))},click:function(g){var f=c.selection.getNode();if(f.get("tag")!="td"){f=f.getParent("td")}f.set("width",this.el.getElement(".table-w").value);f.className=this.el.getElement(".table-c").value;f.set("align",this.el.getElement(".table-a").value);f.set("valign",this.el.getElement(".table-va").value)}}};return new MooEditable.UI.Dialog(a[b],{"class":"mooeditable-table-dialog",onOpen:function(){if(d[b].load){d[b].load.apply(this)}var f=this.el.getElement("input");(function(){f.focus()}).delay(10)},onClick:function(g){if(g.target.tagName.toLowerCase()=="button"){g.preventDefault()}var f=document.id(g.target);if(f.hasClass("dialog-cancel-button")){this.close()}else{if(f.hasClass("dialog-ok-button")){this.close();d[b].click.apply(this)}}}})};Object.append(MooEditable.Actions,{tableadd:{title:MooEditable.Locale.get("addTable"),dialogs:{prompt:function(a){return MooEditable.UI.TableDialog(a,"tableadd")}},command:function(){this.dialogs.tableadd.prompt.open()}},tableedit:{title:MooEditable.Locale.get("editTable"),dialogs:{prompt:function(a){return MooEditable.UI.TableDialog(a,"tableedit")}},command:function(){if(this.selection.getNode().getParent("table")){this.dialogs.tableedit.prompt.open()}}},tablerowadd:{title:"Add Row",command:function(){var a=this.selection.getNode().getParent("tr");if(a){a.clone().inject(a,"after")}}},tablerowedit:{title:MooEditable.Locale.get("editTableRow"),dialogs:{prompt:function(a){return MooEditable.UI.TableDialog(a,"tablerowedit")}},command:function(){if(this.selection.getNode().getParent("table")){this.dialogs.tablerowedit.prompt.open()}}},tablerowspan:{title:MooEditable.Locale.get("mergeTableRow"),command:function(){var b=this.selection.getNode();if(b.get("tag")!="td"){b=b.getParent("td")}if(b){var a=b.cellIndex;var c=b.getParent().rowIndex;if(b.getParent().getParent().childNodes[c+b.rowSpan]){b.getParent().getParent().childNodes[c+b.rowSpan].deleteCell(a);b.rowSpan++}}}},tablerowsplit:{title:MooEditable.Locale.get("splitTableRow"),command:function(){var b=this.selection.getNode();if(b.get("tag")!="td"){b=b.getParent("td")}if(b){var a=b.cellIndex;var d=b.getParent().rowIndex;if(b.getProperty("rowspan")){var c=parseInt(b.getProperty("rowspan"));for(i=1;i<c;i++){b.getParent().getParent().childNodes[d+i].insertCell(a)}b.removeProperty("rowspan")}}},states:function(a){if(a.get("tag")!="td"){return}if(a){if(a.getProperty("rowspan")&&parseInt(a.getProperty("rowspan"))>1){this.el.addClass("onActive")}}}},tablerowdelete:{title:MooEditable.Locale.get("deleteTableRow"),command:function(){var a=this.selection.getNode().getParent("tr");if(a){a.getParent().deleteRow(a.rowIndex)}}},tablecoladd:{title:MooEditable.Locale.get("addTableCol"),command:function(){var f=this.selection.getNode();if(f.get("tag")!="td"){f=f.getParent("td")}if(f){var b=f.cellIndex;var a=f.getParent().getParent().childNodes.length;for(var c=0;c<a;c++){var d=$(f.getParent().getParent().childNodes[c].childNodes[b]);d.clone().inject(d,"after")}}}},tablecoledit:{title:MooEditable.Locale.get("editTableCol"),dialogs:{prompt:function(a){return MooEditable.UI.TableDialog(a,"tablecoledit")}},command:function(){if(this.selection.getNode().getParent("table")){this.dialogs.tablecoledit.prompt.open()}}},tablecolspan:{title:MooEditable.Locale.get("mergeTableCell"),command:function(){var b=this.selection.getNode();if(b.get("tag")!="td"){b=b.getParent("td")}if(b){var a=b.cellIndex+1;if(b.getParent().childNodes[a]){b.getParent().deleteCell(a);b.colSpan++}}}},tablecolsplit:{title:MooEditable.Locale.get("splitTableCell"),command:function(){var b=this.selection.getNode();if(b.get("tag")!="td"){b=b.getParent("td")}if(b){var a=b.cellIndex+1;if(b.getProperty("colspan")){var c=parseInt(b.getProperty("colspan"));for(i=1;i<c;i++){b.getParent().insertCell(a+i)}b.removeProperty("colspan")}}},states:function(a){if(a.get("tag")!="td"){return}if(a){if(a.getProperty("colspan")&&parseInt(a.getProperty("colspan"))>1){this.el.addClass("onActive")}}}},tablecoldelete:{title:MooEditable.Locale.get("deleteTableCol"),command:function(){var f=this.selection.getNode();if(f.get("tag")!="td"){f=f.getParent("td")}if(f){var a=f.getParent().getParent().childNodes.length;var b=f.cellIndex;var d=f.getParent().getParent();for(var c=0;c<a;c++){d.childNodes[c].deleteCell(b)}}}}});MooEditable.UI.ButtonOverlay=new Class({Extends:MooEditable.UI.Button,options:{overlayHTML:"",overlayClass:"",overlaySize:{x:150,y:"auto"},overlayContentClass:""},initialize:function(a){this.parent(a);this.render();this.el.addClass("mooeditable-ui-buttonOverlay");this.renderOverlay(this.options.overlayHTML)},renderOverlay:function(b){var a=this;this.overlay=new Element("div",{"class":"mooeditable-ui-button-overlay "+a.name+"-overlay "+a.options.overlayClass,html:'<div class="overlay-content '+a.options.overlayContentClass+'">'+b+"</div>",tabindex:0,styles:{left:"-999em",position:"absolute",width:a.options.overlaySize.x,height:a.options.overlaySize.y},events:{mousedown:a.clickOverlay.bind(a),focus:a.openOverlay.bind(a),blur:a.closeOverlay.bind(a)}}).inject(document.body).store("MooEditable.UI.ButtonOverlay",this);this.overlayVisible=false;window.addEvent("resize",function(){if(a.overlayVisible){a.positionOverlay()}})},openOverlay:function(){if(this.overlayVisible){return}this.overlayVisible=true;this.activate();this.fireEvent("openOverlay",this);return this},closeOverlay:function(){if(!this.overlayVisible){return}this.overlay.setStyle("left","-999em");this.overlayVisible=false;this.deactivate();this.fireEvent("closeOverlay",this);return this},clickOverlay:function(a){if(a.target==this.overlay||a.target.parentNode==this.overlay){return}this.overlay.blur();a.preventDefault();this.action(a)},click:function(a){a.preventDefault();if(this.disabled){return}if(this.overlayVisible){this.overlay.blur();return}else{this.positionOverlay();this.overlay.focus()}},positionOverlay:function(){var a=this.el.getCoordinates();this.overlay.setStyles({top:a.bottom,left:a.left});return this}});(function(){MooEditable.Locale.define({protocol:"protocol",link:"link",email:"e-Mail",urlWithoutHttp:"URL (without http://)",window:"window",sameWindow:"same window",newWindow:"new window"});String.implement({camelCaseFirst:function(){return this.replace(/\s*(\D)/,function(b){return b.toUpperCase()})}});var a=/^(https?|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i;MooEditable.UI.ExtendedLinksDialog=function(c){var b='<div class="dialog-column"><label class="dialog-label">'+MooEditable.Locale.get("protocol").camelCaseFirst()+'<br/><select class="dialog-input-protocol"><option value="http">'+MooEditable.Locale.get("link")+'</option><option value="mailto">'+MooEditable.Locale.get("email")+'</option></select></label></div><div class="dialog-column"><label class="dialog-label">'+MooEditable.Locale.get("urlWithoutHttp").camelCaseFirst()+'<br/><input type="text" class="dialog-input-url" value=""></label></div> <div class="dialog-column"><label class="dialog-label">'+MooEditable.Locale.get("window").camelCaseFirst()+'<br/><select class="dialog-input-target"><option value="_self">'+MooEditable.Locale.get("sameWindow")+'</option><option value="_blank">'+MooEditable.Locale.get("newWindow")+'</option></select></label></div><br/><button class="dialog-button dialog-ok-button">'+MooEditable.Locale.get("ok").camelCaseFirst()+'</button><button class="dialog-button dialog-cancel-button">'+MooEditable.Locale.get("cancel").camelCaseFirst()+"</button>";return new MooEditable.UI.Dialog(b,{"class":"mooeditable-prompt-dialog",onOpen:function(){var f=this.el.getElement(".dialog-input-protocol");var d=this.el.getElement(".dialog-input-url");var k=this.el.getElement(".dialog-input-target");var j=c.selection.getText();var h=c.selection.getNode();if(h.get("tag")=="a"){var g=new URI(h.href);f.set("value",g.get("scheme"));if(g.get("scheme")=="mailto"){d.set("value",h.href.replace("mailto:",""))}else{d.set("value",g.get("host"))}k.set("value",h.target||"_self")}else{if(a.test(j)){var g=new URI(j);f.set("value",g.get("scheme"));d.set("value",g.get("host"))}}(function(){d.focus();d.select()}).delay(10)},onClick:function(h){h.preventDefault();if(h.target.tagName.toLowerCase()!="button"){return}var g=document.id(h.target);var f=this.el.getElement(".dialog-input-protocol");var d=this.el.getElement(".dialog-input-url");var j=this.el.getElement(".dialog-input-target");if(g.hasClass("dialog-cancel-button")){this.close()}else{if(g.hasClass("dialog-ok-button")){if(f.get("value")=="mailto"){c.selection.insertContent('<a href="mailto:'+d.get("value")+'" target="'+j.get("value")+'">'+c.selection.getText()+"</a>")}else{c.selection.insertContent('<a href="'+f.get("value")+"://"+d.get("value")+'" target="'+j.get("value")+'">'+c.selection.getText()+"</a>")}this.close()}}}})};MooEditable.Actions.createlink.dialogs.prompt=function(b){return MooEditable.UI.ExtendedLinksDialog(b)};MooEditable.Actions.createlink.command=function(){var b=this.selection;var d=this.dialogs.createlink;if(b.isCollapsed()){var c=b.getNode();if(c.get("tag")=="a"&&c.get("href")){b.selectNode(c);d.prompt.open()}else{d.alert.open()}}else{d.prompt.open()}}})();MooEditable.UI.MenuList=new Class({Implements:[Events,Options],options:{title:"",name:"","class":"",list:[]},initialize:function(a){this.setOptions(a);this.name=this.options.name;this.render()},toElement:function(){return this.el},render:function(){var a=this;var b="";this.options.list.each(function(c){b+='<option value="{value}" style="{style}">{text}</option>'.substitute(c)});this.el=new Element("select",{"class":a.options["class"],title:a.options.title,html:b,styles:{height:"21px"},events:{change:a.change.bind(a)}});this.disabled=false;if(Browser.ie){this.el.addEvents({mouseenter:function(c){this.addClass("hover")},mouseleave:function(c){this.removeClass("hover")}})}return this},change:function(b){b.preventDefault();if(this.disabled){return}var a=b.target.value;this.action(a)},action:function(){this.fireEvent("action",[this].concat(Array.from(arguments)))},enable:function(){if(!this.disabled){return}this.disabled=false;this.el.set("disabled",false).removeClass("disabled").set({disabled:false,opacity:1});return this},disable:function(){if(this.disabled){return}this.disabled=true;this.el.set("disabled",true).addClass("disabled").set({disabled:true,opacity:0.4});return this},activate:function(b){if(this.disabled){return}var a=0;if(b){this.options.list.each(function(d,c){if(d.value==b){a=c}})}this.el.selectedIndex=a;return this},deactivate:function(){this.el.selectedIndex=0;this.el.removeClass("onActive");return this}});var NewsReaderWidget=new Class({Extends:BrowserWidget,Binds:["constructChannel","destroyChannel"],options:{channelOptions:{},channelSelector:"//rss/channel",componentName:"NewsReaderWidget",useLocalizedData:true,widgetContainerId:"NewsReaderWidget"},initialize:function(a,c,b){this.parent(a,c,b);this.channel},construct:function(){this.parent()},destroy:function(){this.parent()},unmarshall:function(){this.unmarshallChannel();this.parent()},getChannel:function(){return this.channel},compileConstructionChain:function(){this.constructionChain.chain(this.constructChannel,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyChannel,this.destroyChildHtmlElements,this.finalizeDestruction)}.protect(),constructChannel:function(){this.channel.construct(this.containerElement);this.constructionChain.callChain()}.protect(),destroyChannel:function(){this.channel.destroy()}.protect(),unmarshallChannel:function(){var a=this.dataXml.selectNode(this.options.channelSelector);if(a){this.channel=new RssChannel(this.dataXml,this.i18Resource,this.elementFactory,this.options.channelOptions);this.channel.unmarshall()}}.protect()});var RssChannel=new Class({Implements:Options,options:{buildDateSelector:"//rss/channel/lastBuildDate",descriptionSelector:"//rss/channel/description",descriptionStyle:"rssChannelDescription",documentsSelector:"//rss/channel/docs",generatorSelector:"//rss/channel/generator",itemOptions:{},itemsSelector:"//rss/channel/item",itemsWrapperStyle:"rssItemsWrapper",languageSelector:"//rss/channel/language",linkSelector:"//rss/channel/link",managingEditorSelector:"//rss/channel/managingEditor",publicationDateSelector:"//rss/channel/pubDate",showDescription:true,showTitle:true,titleSelector:"//rss/channel/title",titleStyle:"rssChannelTitle",webMasterSelector:"//rss/channel/webMaster",wrapperElementId:"rssChannelWrapper",wrapperElementTag:"div"},initialize:function(c,d,a,b){assertThat(c,not(nil()));this.setOptions(b);this.buildDate;this.containerElement;this.description;this.documents;this.elementFactory=a;this.generator;this.internationalization;this.items=new ArrayList();this.language;this.link;this.managingEditor;this.publicationDate;this.rssResource=c;this.state=BrowserWidget.States.INITIALIZED;this.title;this.webMaster;this.wrapperElement},construct:function(a){if(this.state==BrowserWidget.States.UNMARSHALLED){this.containerElement=a;this.createWrapperElement();this.createTitleElement();this.createItemsWrapper();this.constructItems();this.state=BrowserWidget.States.CONSTRUCTED}},destroy:function(){if(this.state==BrowserWidget.States.CONSTRUCTED){this.destroyItems();this.destroyPropertyElements()}this.state=BrowserWidget.States.INITIALIZED},unmarshall:function(){this.unmarshallChannelProperties();this.unmarshallItems();this.state=BrowserWidget.States.UNMARSHALLED},getBuildDate:function(){return this.buildDate},getDescription:function(){return this.description},getDocuments:function(){return this.documents},getElementFactory:function(){return this.elementFactory},getGenerator:function(){return this.generator},getItems:function(){return this.items},getLanguage:function(){return this.language},getLink:function(){return this.link},getManagingEditor:function(){return this.managingEditor},getPublicationDate:function(){return this.publicationDate},getState:function(){return this.state},getTitle:function(){return this.title},getWebMaster:function(){return this.webMaster},getWrapperElement:function(){return this.wrapperElement},constructItems:function(){this.items.each(function(b,a){b.construct(this.itemsWrapperElement)}.bind(this))}.protect(),createItemsWrapper:function(){this.itemsWrapperElement=this.elementFactory.create(this.options.wrapperElementTag,null,this.wrapperElement,WidgetElementFactory.Positions.LastChild,{"class":this.options.itemsWrapperStyle})}.protect(),createTitleElement:function(){if(this.options.showTitle){var a={"class":this.options.titleStyle};var b=this.link?null:this.title;this.titleElement=this.elementFactory.create("div",b,this.wrapperElement,WidgetElementFactory.Positions.LastChild,a);if(this.link){this.elementFactory.createAnchor(this.title,this.link,null,this.titleElement)}}}.protect(),createWrapperElement:function(){this.wrapperElement=this.elementFactory.create(this.options.wrapperElementTag,null,this.containerElement,WidgetElementFactory.Positions.LastChild,{id:this.options.wrapperElementId})}.protect(),destroyItems:function(){this.items.each(function(b,a){b.destroy()}.bind(this))}.protect(),destroyPropertyElements:function(){if(this.wrapperElement.removeEvents){this.wrapperElement.removeEvents()}if(this.wrapperElement.destroy){this.wrapperElement.destroy()}if(this.titleElement&&this.titleElement.removeEvents){this.titleElement.removeEvents()}if(this.titleElement&&this.titleElement.destroy){this.titleElement.destroy()}}.protect(),unmarshallChannelProperties:function(){this.buildDate=this.rssResource.selectNodeText(this.options.buildDateSelector);this.description=this.rssResource.selectNodeText(this.options.descriptionSelector);this.documents=this.rssResource.selectNodeText(this.options.documentsSelector);this.generator=this.rssResource.selectNodeText(this.options.generatorSelector);this.language=this.rssResource.selectNodeText(this.options.languageSelector);this.link=this.rssResource.selectNodeText(this.options.linkSelector);this.managingEditor=this.rssResource.selectNodeText(this.options.managingEditorSelector);this.publicationDate=this.rssResource.selectNodeText(this.options.publicationDateSelector);this.title=this.rssResource.selectNodeText(this.options.titleSelector);this.webMaster=this.rssResource.selectNodeText(this.options.webMasterSelector)}.protect(),unmarshallItem:function(b){var a=new RssItem(b,this.elementFactory,this.options.itemOptions);a.unmarshall();this.items.add(a)}.protect(),unmarshallItems:function(){var a=this.rssResource.selectNodes(this.options.itemsSelector);a.each(function(b,c){this.unmarshallItem(b)},this)}.protect()});var RssItem=new Class({Implements:Options,options:{descriptionSelector:"description",descriptionStyle:"rssItemDescription",globalUniqueIdSelector:"guid",linkSelector:"link",publicationDateSelector:"pubDate",showDescription:true,showTitle:true,titleSelector:"title",titleStyle:"rssItemTitle",trancatedDescriptionEnding:"...",truncatedDescriptionLength:120,truncateDescription:false},initialize:function(a,b,c){assertThat(a,not(nil()));this.setOptions(c);this.containerElement;this.description;this.elementFactory=b;this.globalUniqueId;this.itemResource=a;this.link;this.publicationDate;this.state=BrowserWidget.States.INITIALIZED;this.title},construct:function(a){if(this.state==BrowserWidget.States.UNMARSHALLED){this.containerElement=a;this.createTitleElement();this.createDescriptionElement();this.state=BrowserWidget.States.CONSTRUCTED}},destroy:function(){if(this.state==BrowserWidget.States.CONSTRUCTED){this.destroyPropertyElements()}this.state=BrowserWidget.States.INITIALIZED},unmarshall:function(){this.description=XmlResource.selectNodeText(this.options.descriptionSelector,this.itemResource);this.globalUniqueId=XmlResource.selectNodeText(this.options.globalUniqueIdSelector,this.itemResource);this.link=XmlResource.selectNodeText(this.options.linkSelector,this.itemResource);this.publicationDate=XmlResource.selectNodeText(this.options.publicationDateSelector,this.itemResource);this.title=XmlResource.selectNodeText(this.options.titleSelector,this.itemResource);this.state=BrowserWidget.States.UNMARSHALLED},getDescription:function(){return this.description},getGlobalUniqueId:function(){return this.globalUniqueId},getLink:function(){return this.link},getPublicationDate:function(){return this.publicationDate},getState:function(){return this.state},getTitle:function(){return this.title},createDescriptionElement:function(){if(this.options.showDescription){var a={"class":this.options.descriptionStyle};var b;if(this.options.truncateDescription){b=this.description.substr(0,this.options.truncatedDescriptionLength)+this.options.trancatedDescriptionEnding}else{b=this.description}this.descriptionElement=this.elementFactory.create("div",b,this.containerElement,WidgetElementFactory.Positions.LastChild,a)}}.protect(),createTitleElement:function(){var a={"class":this.options.titleStyle};var b=this.link?null:this.title;this.titleElement=this.elementFactory.create("div",b,this.containerElement,WidgetElementFactory.Positions.LastChild,a);if(this.link){this.elementFactory.createAnchor(this.title,this.link,null,this.titleElement)}}.protect(),destroyPropertyElement:function(a){if(a.removeEvents){a.removeEvents()}if(a.destroy){a.destroy()}}.protect(),destroyPropertyElements:function(){this.destroyPropertyElement(this.titleElement);this.destroyPropertyElement(this.descriptionElement)}});var RssResource=new Class({Extends:XmlResource,options:{},initialize:function(b,a){assertThat(b,not(nil()));this.parent(b,a);this.channel=null},release:function(){},unmarshall:function(){this.unmarshallChannel()},getChannel:function(){return this.channel},getItems:function(){return this.channel.getItems()},unmarshallChannel:function(){this.channel=new RssChannel(this);this.channel.unmarshall()}.protect(),});var PartyEventWidget=new Class({Extends:BrowserWidget,Binds:["constructEvents","destroyEvents"],options:{componentName:"EventWidget",eventOptions:{},eventsSelector:"//pp:eventList/events/event",useLocalizedData:true,widgetContainerId:"EventWidget"},initialize:function(a,c,b){this.parent(a,c,b);this.events=new ArrayList()},construct:function(){this.parent()},destroy:function(){this.parent()},unmarshall:function(){this.unmarshallEvents();this.parent()},getEvents:function(){return this.events},compileConstructionChain:function(){this.constructionChain.chain(this.constructEvents,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyEvents,this.destroyChildHtmlElements,this.finalizeDestruction)}.protect(),constructEvents:function(){this.events.each(function(b,a){b.construct(this.containerElement)}.bind(this));this.constructionChain.callChain()}.protect(),destroyEvents:function(){this.events.each(function(b,a){b.destroy()}.bind(this));this.destructionChain.callChain()}.protect(),unmarshallEvents:function(){var a=this.dataXml.selectNodes(this.options.eventsSelector);if(a){a.each(function(c,b){var d=new PartyEvent(c,this.elementFactory,this.options.eventOptions);d.unmarshall();this.events.add(d)}.bind(this))}}.protect()});var PartyEvent=new Class({Implements:Options,options:{descriptionSelector:"description",descriptionStyle:"eventDescription",endDateSelector:"schedule/endDate",isFullDaySelector:"@isFullDay",linkSelector:"link",locationAddressSelector:"location/address",locationLinkSelector:"location/link",locationStyle:"eventLocation",programDescriptionSelector:"program/description",programLinkSelector:"program/link",publicationDateSelector:"pubDate",scheduleStyle:"eventSchedule",showDescription:true,showLocation:true,showSchedule:true,showTitle:true,startDateSelector:"schedule/startDate",titleSelector:"title",titleStyle:"eventTitle",trancatedDescriptionEnding:"...",truncatedDescriptionLength:120,truncateDescription:false},initialize:function(b,a,c){assertThat(b,not(nil()));this.setOptions(c);this.containerElement;this.description;this.elementFactory=a;this.endDate;this.globalUniqueId;this.eventResource=b;this.isFullDay;this.link;this.locationAddress;this.locationElement;this.locationLink;this.programDescription;this.programLink;this.publicationDate;this.scheduleElement;this.startDate;this.state=BrowserWidget.States.INITIALIZED;this.title},construct:function(a){if(this.state==BrowserWidget.States.UNMARSHALLED){this.containerElement=a;this.createTitleElement();this.createDescriptionElement();this.createScheduleElement();this.createLocationElement();this.state=BrowserWidget.States.CONSTRUCTED}},destroy:function(){if(this.state==BrowserWidget.States.CONSTRUCTED){this.destroyPropertyElements();this.destroyScheduleElements();this.destroyLocationElements()}this.state=BrowserWidget.States.INITIALIZED},unmarshall:function(){this.unmarshallProperties();this.unmarshallSchedule();this.unmarshallLocation();this.state=BrowserWidget.States.UNMARSHALLED},getDescription:function(){return this.description},getElementFactory:function(){return this.elementFactory},getEndDate:function(){return this.endDate},getGlobalUniqueId:function(){return this.globalUniqueId},getLink:function(){return this.link},getLocationAddress:function(){return this.locationAddress},getLocationLink:function(){return this.locationLink},getProgramDescription:function(){return this.programDescription},getProgramLink:function(){return this.programLink},getPublicationDate:function(){return this.publicationDate},getStartDate:function(){return this.startDate},getState:function(){return this.state},getTitle:function(){return this.title},createDescriptionElement:function(){if(this.options.showDescription){var a={"class":this.options.descriptionStyle};var b;if(this.options.truncateDescription){b=this.description.substr(0,this.options.truncatedDescriptionLength)+this.options.trancatedDescriptionEnding}else{b=this.description}this.descriptionElement=this.elementFactory.create("div",b,this.containerElement,WidgetElementFactory.Positions.LastChild,a)}}.protect(),createLocationElement:function(){if(this.options.showLocation){var a={"class":this.options.locationStyle};this.locationElement=this.elementFactory.create("div",this.locationAddress,this.containerElement,WidgetElementFactory.Positions.LastChild,a)}}.protect(),createScheduleElement:function(){if(this.options.showSchedule){var b={"class":this.options.scheduleStyle};var a=this.startDate+" - "+this.endDate;this.scheduleElement=this.elementFactory.create("div",a,this.containerElement,WidgetElementFactory.Positions.LastChild,b)}}.protect(),createTitleElement:function(){var a={"class":this.options.titleStyle};var b=this.link?null:this.title;this.titleElement=this.elementFactory.create("div",b,this.containerElement,WidgetElementFactory.Positions.LastChild,a);if(this.link){this.elementFactory.createAnchor(this.title,this.link,null,this.titleElement)}}.protect(),destroyLocationElements:function(){this.destroyPropertyElement(this.locationElement)}.protect(),destroyPropertyElement:function(a){if(a.removeEvents){a.removeEvents()}if(a.destroy){a.destroy()}}.protect(),destroyPropertyElements:function(){this.destroyPropertyElement(this.titleElement);this.destroyPropertyElement(this.descriptionElement)}.protect(),destroyScheduleElements:function(){this.destroyPropertyElement(this.scheduleElement)}.protect(),unmarshallLocation:function(){this.locationAddress=XmlResource.selectNodeText(this.options.locationAddressSelector,this.eventResource);this.locationLink=XmlResource.selectNodeText(this.options.locationLinkSelector,this.eventResource)}.protect(),unmarshallProperties:function(){this.description=XmlResource.selectNodeText(this.options.descriptionSelector,this.eventResource);this.link=XmlResource.selectNodeText(this.options.linkSelector,this.eventResource);this.programDescription=XmlResource.selectNodeText(this.options.programDescriptionSelector,this.eventResource);this.programLink=XmlResource.selectNodeText(this.options.programLinkSelector,this.eventResource);this.publicationDate=XmlResource.selectNodeText(this.options.publicationDateSelector,this.eventResource);this.title=XmlResource.selectNodeText(this.options.titleSelector,this.eventResource)}.protect(),unmarshallSchedule:function(){this.isFullDay=XmlResource.selectNodeText(this.options.isFullDaySelector,this.eventResource);this.startDate=XmlResource.selectNodeText(this.options.startDateSelector,this.eventResource);this.endDate=XmlResource.selectNodeText(this.options.endDateSelector,this.eventResource)}.protect()});var PhotoGaleryImage=new Class({Implements:Options,options:{captionSelector:"caption",linkSelector:"link",thumbnailSelector:"thumbnailUri",uriSelector:"uri"},initialize:function(a,c,b){this.setOptions(b);this.anchorElement;this.caption;this.data;this.dataAsText;this.definitionXml=a;this.internationalization=c;this.link;this.thumbnailUri;this.uri;this.state=PhotoGaleryImage.States.INITIALIZED},construct:function(){this.compileDataFromProperties();this.state=PhotoGaleryImage.States.CONSTRUCTED},destroy:function(){this.data=null;this.dataAsText=null;this.link=null;this.thumbnailUri=null;this.uri=null;this.state=PhotoGaleryImage.States.INITIALIZED},unmarshall:function(){this.unmarshallProperties();this.state=PhotoGaleryImage.States.UNMARSHALLED},getCaption:function(){return this.caption},getData:function(){return this.data},getDataAsText:function(){return this.dataAsText},getLink:function(){return this.link},getState:function(){return this.state},getThumbnailUri:function(){return this.thumbnailUri},getUri:function(){return this.uri},compileDataFromProperties:function(){var caption=this.caption?"caption:'"+this.caption+"'":null;var href=this.link?"href:'"+this.link+"'":null;var thumbnail=this.thumbnailUri?"thumbnail:'"+this.thumbnailUri+"'":null;var dataFragment=caption?caption:"";if(dataFragment!=""&&href){dataFragment+=", "}dataFragment+=href?href:"";if(dataFragment!=""&&thumbnail){dataFragment+=", "}dataFragment+=thumbnail?thumbnail:"";this.dataAsText="'"+this.uri+"': {"+dataFragment+"}";this.data=eval("({"+this.dataAsText+"})")}.protect(),unmarshallProperties:function(){this.caption=XmlResource.selectNodeText(this.options.captionSelector,this.definitionXml);this.caption=this.internationalization.getText(this.caption);this.link=XmlResource.selectNodeText(this.options.linkSelector,this.definitionXml);this.thumbnailUri=XmlResource.selectNodeText(this.options.thumbnailSelector,this.definitionXml);this.uri=XmlResource.selectNodeText(this.options.uriSelector,this.definitionXml)}.protect(),});PhotoGaleryImage.States={UNINITIALIZED:0,INITIALIZED:1,UNMARSHALLED:2,CONSTRUCTED:3};var PhotoGaleryWidget=new Class({Extends:BrowserWidget,Binds:["compileDataObject","instantiateSlideShow","onComplete","onEnd","onShow","onStart"],options:{accessKeysDefault:null,accessKeysSelector:"pp:widgetDefinition/properties/accessKeys",automaticallyLinkSlideDefault:false,automaticallyLinkSlideSelector:"pp:widgetDefinition/properties/automaticallyLinkSlideToFullSizedImage",centerImagesDefault:true,centerImagesSelector:"pp:widgetDefinition/properties/centerImages",componentName:"PhotoGaleryWidget",descriptionSelector:"/pp:widgetDefinition/description",effectDurationDefault:750,effectDurationSelector:"pp:widgetDefinition/properties/effectDuration",eventDeliveryDelay:50,firstSlideDefault:0,firstSlideSelector:"pp:widgetDefinition/properties/firstSlide",galeryLinkDefault:null,galeryLinkSelector:"pp:widgetDefinition/properties/galeryLink",heightDefault:300,heightSelector:"pp:widgetDefinition/properties/height",imageFolderUriDefault:"",imageFolderUriSelector:"pp:widgetDefinition/properties/imageFolderUri",imagesSelector:"/pp:widgetData/images/image",loopShowDefault:true,loopShowSelector:"pp:widgetDefinition/properties/loopShow",nameSelector:"/pp:widgetDefinition/name",overlapImagesDefault:true,overlapImagesSelector:"pp:widgetDefinition/properties/overlapImages",resizeImagesDefault:true,resizeImagesSelector:"pp:widgetDefinition/properties/resizeImages",showControllerDefault:true,showControllerSelector:"pp:widgetDefinition/properties/showController",showImageCaptionsDefault:true,showImageCaptionsSelector:"pp:widgetDefinition/properties/showImageCaptions",showSlidesRandomDefault:false,showSlidesRandomSelector:"pp:widgetDefinition/properties/showSlidesRandom",showThumbnailsDefault:true,showThumbnailsSelector:"pp:widgetDefinition/properties/showThumbnails",skipTransitionDefault:null,skipTransitionSelector:"pp:widgetDefinition/properties/skipTransition",slideChangeDelayDefault:2000,slideChangeDelaySelector:"pp:widgetDefinition/properties/slideChangeDelay",slideTransitionDefault:"Sine",slideTransitionSelector:"pp:widgetDefinition/properties/slideTransition",startPausedDefault:true,startPausedSelector:"pp:widgetDefinition/properties/startPaused",thumbnailFileNameRuleDefault:null,thumbnailFileNameRuleSelector:"pp:widgetDefinition/properties/thumbnailFileNameRule",widthDefault:450,widthSelector:"pp:widgetDefinition/properties/width"},initialize:function(a,b){this.setOptions(a);this.parent(a,b);this.accessKeys;this.automaticallyLinkSlide;this.centerImages;this.constructionChain=new Chain();this.data;this.dataAsText="";this.effectDuration;this.firstSlide;this.galeryLink;this.height;this.images=new LinkedHashMap();this.imageFolderUri;this.loopShow;this.overlapImages;this.resizeImages;this.showController;this.showImageCaptions;this.showSlidesRandom;this.showThumbnails;this.skipTransition;this.slideChangeDelay;this.slideShow;this.slideTransition;this.startPaused;this.thumbnailFileNameRule;this.width},construct:function(){this.parent()},destroy:function(){this.destroyComponents();this.destroyChildElements(this.containerElement);this.resetFields();this.parent()},onComplete:function(){if(this.state<BrowserWidget.States.CONSTRUCTED){this.logger.trace(this.options.componentName+".onComplete() completed to load Slideshow 2.");this.constructionChain.callChain()}},onEnd:function(){this.logger.trace(this.options.componentName+".onEnd() ended Slideshow 2.")},onShow:function(){if(this.state<BrowserWidget.States.CONSTRUCTED){this.logger.trace(this.options.componentName+".onShow() started to load Slideshow 2.");this.constructionChain.callChain()}},onStart:function(){if(this.state<BrowserWidget.States.CONSTRUCTED){this.logger.trace(this.options.componentName+".onStart() started to load Slideshow 2.");this.constructionChain.callChain()}},unmarshall:function(){this.unmarshallProperties();this.unmarshallImages();return this.parent()},getAccessKeys:function(){return this.accessKeys},getAutomaticallyLinkSlide:function(){return this.automaticallyLinkSlide},getCenterImages:function(){return this.centerImages},getData:function(){return this.data},getEffectDuration:function(){return this.effectDuration},getFirstSlide:function(){return this.firstSlide},getGaleryLink:function(){return this.galeryLink},getHeight:function(){return this.height},getImages:function(){return this.images},getImageFolderUri:function(){return this.imageFolderUri},getLoopShow:function(){return this.loopShow},getOverlapImages:function(){return this.overlapImages},getResizeImages:function(){return this.resizeImages},getShowController:function(){return this.showController},getShowImageCaptions:function(){return this.showImageCaptions},getShowSlidesRandom:function(){return this.showSlidesRandom},getShowThumbnails:function(){return this.showThumbnails},getSkipTransition:function(){return this.skipTransition},getSlideChangeDelay:function(){return this.slideChangeDelay},getSlideShow:function(){return this.slideShow},getSlideTransition:function(){return this.slideTransition},getStartPaused:function(){return this.startPaused},getThumbnailFileNameRule:function(){return this.thumbnailFileNameRule},getWidth:function(){return this.width},compileDataObject:function(){this.images.each(function(imageEntry,index){var image=imageEntry.getValue();image.construct();if(this.dataAsText){this.dataAsText+=", "}this.dataAsText+=image.getDataAsText()},this);this.data=eval("({"+this.dataAsText+"})");this.constructionChain.callChain()}.protect(),compileConstructionChain:function(){this.constructionChain.chain(this.compileDataObject,this.instantiateSlideShow,this.finalizeConstruction)}.protect(),destroyChildElements:function(a){var b=a.getChildren?a.getChildren("*"):new Array();b.each(function(d,c){if(d.getChildren("*").length>0){this.destroyChildElements(d)}if(d.removeEvents){d.removeEvents()}if(d.destroy){d.destroy()}}.bind(this))}.protect(),destroyComponents:function(){if(this.slideShow){this.slideShow.destroy()}}.protect(),instantiateSlideShow:function(){var a={captions:this.showImageCaptions,center:this.centerImages,controller:this.showController,delay:this.slideChangeDelay,duration:this.effectDuration,fast:this.skipTransition,height:this.height,href:this.galeryLink,hu:this.imageFolderUri,linked:this.automaticallyLinkSlide,loop:this.loopShow,onComplete:this.onComplete,onEnd:this.onEnd,onShow:this.onShow,onStart:this.onStart,overlap:this.overlapImages,paused:this.startPaused,random:this.showSlidesRandom,replace:this.thumbnailFileNameRule,resize:this.resizeImages,slide:this.firstSlide,thumbnails:this.showThumbnails,transition:this.slideTransition,width:this.width};this.slideShow=new Slideshow(this.containerElement,this.data,a)}.protect(),resetFields:function(){this.accessKeys=null;this.automaticallyLinkSlide=null;this.centerImages=null;this.data=null;this.dataAsText="";this.effectDuration=null;this.firstSlide=null;this.galeryLink=null;this.height=null;this.imageFolderUri=null;this.loopShow=null;this.overlapImages=null;this.resizeImages=null;this.showController=null;this.showImageCaptions=null;this.showSlidesRandom=null;this.showThumbnails=null;this.skipTransition=null;this.slideChangeDelay=null;this.slideTransition=null;this.startPaused=null;this.thumbnailFileNameRule=null;this.width=null;this.images.clear()}.protect(),unmarshallImages:function(){var a=this.dataXml.selectNodes(this.options.imagesSelector);if(a){a.each(function(d,b){var c=new PhotoGaleryImage(d,this.i18Resource);c.unmarshall();this.images.put(c.getUri(),c)},this)}}.protect(),unmarshallProperties:function(){this.accessKeys=this.unmarshallProperty(this.options.accessKeysDefault,this.options.accessKeysSelector);this.automaticallyLinkSlide=this.unmarshallProperty(this.options.automaticallyLinkSlideDefault,this.options.automaticallyLinkSlideSelector);this.centerImages=parseBoolean(this.unmarshallProperty(this.options.centerImagesDefault,this.options.centerImagesSelector));this.effectDuration=parseInt(this.unmarshallProperty(this.options.effectDurationDefault,this.options.effectDurationSelector));this.firstSlide=parseInt(this.unmarshallProperty(this.options.firstSlideDefault,this.options.firstSlideSelector));this.galeryLink=this.unmarshallProperty(this.options.galeryLinkDefault,this.options.galeryLinkSelector);this.height=parseInt(this.unmarshallProperty(this.options.heightDefault,this.options.heightSelector));this.imageFolderUri=this.unmarshallProperty(this.options.imageFolderUriDefault,this.options.imageFolderUriSelector);this.loopShow=parseBoolean(this.unmarshallProperty(this.options.loopShowDefault,this.options.loopShowSelector));this.overlapImages=parseBoolean(this.unmarshallProperty(this.options.overlapImagesDefault,this.options.overlapImagesSelector));this.resizeImages=parseBoolean(this.unmarshallProperty(this.options.resizeImagesDefault,this.options.resizeImagesSelector));this.showController=parseBoolean(this.unmarshallProperty(this.options.showControllerDefault,this.options.showControllerSelector));this.showImageCaptions=parseBoolean(this.unmarshallProperty(this.options.showImageCaptionsDefault,this.options.showImageCaptionsSelector));this.showSlidesRandom=parseBoolean(this.unmarshallProperty(this.options.showSlidesRandomDefault,this.options.showSlidesRandomSelector));this.showThumbnails=parseBoolean(this.unmarshallProperty(this.options.showThumbnailsDefault,this.options.showThumbnailsSelector));this.skipTransition=eval("("+this.unmarshallProperty(this.options.skipTransitionDefault,this.options.skipTransitionSelector)+")");this.slideChangeDelay=parseInt(this.unmarshallProperty(this.options.slideChangeDefault,this.options.slideChangeDelaySelector));this.slideTransition=this.unmarshallProperty(this.options.slideTransitionDefault,this.options.slideTransitionSelector);this.startPaused=parseBoolean(this.unmarshallProperty(this.options.startPausedDefault,this.options.startPausedSelector));this.thumbnailFileNameRule=this.unmarshallProperty(this.options.thumbnailFileNameRuleDefault,this.options.thumbnailFileNameRuleSelector);this.width=parseInt(this.unmarshallProperty(this.options.widthDefault,this.options.widthSelector))}.protect(),unmarshallProperty:function(c,a){var b=this.definitionXml.selectNodeText(a);if(b){return b}else{return c}}.protect()});var DocumentResource=new Class({Implements:[Events,Options],Binds:["checkResourceAvailability","onResourceLoaded"],options:{idSelector:"@id",type:null},initialize:function(b,a){this.setOptions(a);this.availabilityCheckIsRunning;this.id=null;this.htmlElement=null;this.resourceElement=b;this.resourceAvailable=false;this.resourceUri=null;this.loadChain=new Chain();this.logger=Class.getInstanceOf(WebUILogger)},load:function(){if(!this.isResourceLoaded()){this.loadChain.chain(this.checkResourceAvailability,this.loadResource).callChain()}else{this.onResourceLoaded()}},onResourceError:function(){this.fireEvent("resourceError",this.resourceUri)},onResourceLoaded:function(){this.fireEvent("resourceLoaded",this)},release:function(){if(this.htmlElement){this.htmlElement.destroy()}},unmarshall:function(){this.id=XmlResource.selectNodeText(this.options.idSelector,this.resourceElement);this.resourceUri=XmlResource.determineNodeText(this.resourceElement);this.resourceUri=this.transformToResourceUriToAbsolute()},getId:function(){return this.htmlElement.get("id")},getResourceType:function(){return this.options.type},getResourceUri:function(){return this.resourceUri},checkResourceAvailability:function(){this.remoteResource=new RemoteResource(this.resourceUri,{async:false,onSuccess:function(b,c){this.resourceAvailable=true;this.availabilityCheckIsRunning=false;this.loadChain.callChain()}.bind(this),onException:function(c,b){this.loadChain.clearChain();if(this.availabilityCheckIsRunning){this.availabilityCheckIsRunning=false;this.onResourceError()}}.bind(this),onFailure:function(b){this.loadChain.clearChain();if(this.availabilityCheckIsRunning){this.availabilityCheckIsRunning=false;this.onResourceError()}}.bind(this)});try{this.availabilityCheckIsRunning=true;this.remoteResource.retrieve()}catch(a){throw new UndefinedDocumentResourceException(this.resourceUri,{cause:a,source:this.componentName})}}.protect(),determineBaseUri:function(){}.protect(),transformToResourceUriToAbsolute:function(){var b=this.resourceUri;var a=document.location.href;a=a.lastIndexOf("#")>0?a.substring(0,a.lastIndexOf("#")):a;a=a.lastIndexOf("?")>0?a.substring(0,a.lastIndexOf("?")):a;a=a.substring(0,a.lastIndexOf("/"));while(b.indexOf("../")==0){b=b.substring(b.indexOf("../")+3);a=a.substring(0,a.lastIndexOf("/"))}return a+"/"+b}});var DocumentImage=new Class({Extends:DocumentResource,Binds:["loadResource"],options:{titleSelector:"@title"},initialize:function(b,a){this.options.type="Image";this.parent(b,a);this.title=null},release:function(){this.parent()},unmarshall:function(){this.parent();this.title=XmlResource.selectNodeText(this.options.titleSelector,this.resourceElement)},getTitle:function(){return this.title},checkResourceAvailability:function(){this.resourceAvailable=true;this.availabilityCheckIsRunning=false;this.loadChain.callChain()}.protect(),isResourceLoaded:function(){return false}.protect(),loadResource:function(){Asset.image(this.resourceUri,{id:this.id,title:this.title,onAbort:function(){this.onResourceError()}.bind(this),onError:function(){this.onResourceError()}.bind(this),onLoad:function(){this.onResourceLoaded()}.bind(this)})}.protect()});var DocumentScript=new Class({Extends:DocumentResource,Binds:["loadResource"],initialize:function(b,a){this.options.type="Script";this.parent(b,a)},release:function(){this.parent()},isResourceLoaded:function(){var a=$$("script[src='"+this.resourceUri+"']");return a.length>0}.protect(),loadResource:function(){Asset.javascript(this.resourceUri,{id:this.id,onLoad:function(){this.htmlElement=$$("script[src='"+this.resourceUri+"']");this.onResourceLoaded()}.bind(this)})}.protect()});var DocumentStyleSheet=new Class({Extends:DocumentResource,Binds:["loadResource"],options:{componentName:"DocumentStyleSheet",idPrefix:"css-preload-"},initialize:function(b,a){this.options.type="StyleSheet";this.parent(b,a);this.remoteResource},release:function(){this.parent()},isResourceLoaded:function(){var a=$$("link[href='"+this.resourceUri+"']");return a.length>0}.protect(),loadResource:function(){new RemoteStyleSheet(this.resourceUri,{onReady:function(b,a){this.logger.debug("Stylesheet: '"+b+"' was added to the document.");this.htmlElement=a;this.onResourceLoaded()}.bind(this),onError:function(){this.logger.debug("Error: Couldn't load style sheet '"+this.resourceUri+"'.");this.onResourceError()}.bind(this),onStart:function(){this.logger.debug("Started to add: '"+this.resourceUri+"' to the document.")}.bind(this)}).start()}.protect()});var ResourceManager=new Class({Implements:[Events,Options],Binds:["onResourceError","onResourceLoaded"],options:{documentImagesSelector:"images/image",documentScriptsSelector:"javaScripts/javaScript",documentStyleSheetsSelector:"styleSheets/styleSheet",eventFireDelay:5,type:null},initialize:function(b,a){this.setOptions(a);this.error=null;this.numberOfResourcesLoaded=0;this.resourceDefinition=b;this.resourceUri=null;this.resources=new ArrayList();this.state=ResourceManager.States.INITIALIZED;this.styleSheets=new ArrayList()},load:function(){if(this.resources.size()>0){this.resources.each(function(b,a){b.load()},this)}else{this.state=ResourceManager.States.LOADED;this.fireEvent("resourcesLoaded",this)}},onResourceError:function(a){this.error=new UndefinedDocumentResourceException(a);this.fireEvent("resourceError",this.error,this.options.eventFireDelay);this.onResourceLoaded(a)},onResourceLoaded:function(a){this.numberOfResourcesLoaded++;if(this.resources.size()>0&&this.numberOfResourcesLoaded>=this.resources.size()){this.state=ResourceManager.States.LOADED;this.fireEvent("resourcesLoaded",this,this.options.eventFireDelay)}},release:function(){this.resources.each(function(b,a){b.release()},this);this.styleSheets.clear();this.resources.clear();this.numberOfResourcesLoaded=0},unmarshall:function(){this.unmarshallResources();this.state=ResourceManager.States.UNMARSHALLED},getError:function(){return this.error},getResources:function(){return this.resources},getResourceType:function(){return this.options.type},getResourceUri:function(){return resourceUri},getState:function(){return this.state},getStyleSheets:function(){return this.styleSheets},isSuccess:function(){return this.error==null},unmarshallResource:function(b,a){var c=XmlResource.selectNodes(b,this.resourceDefinition);c.each(function(f,d){var g=new a(f,{onResourceLoaded:this.onResourceLoaded,onResourceError:this.onResourceError});g.unmarshall();this.resources.add(g);if(instanceOf(g,DocumentStyleSheet)){this.styleSheets.add(g)}},this)}.protect(),unmarshallResources:function(){this.unmarshallResource(this.options.documentScriptsSelector,DocumentScript);this.unmarshallResource(this.options.documentStyleSheetsSelector,DocumentStyleSheet);this.unmarshallResource(this.options.documentImagesSelector,DocumentImage)}.protect()});ResourceManager.States={INITIALIZED:0,UNMARSHALLED:1,LOADED:2};var UndefinedDocumentResourceException=new Class({Extends:WebUIException,options:{description:"Given document resource: '{resourceName}' doesn't exist or can't be accessed.",name:"UndefinedDocumentException"},initialize:function(b,a){this.setOptions(a);this.parent(a);this.parameters={resourceName:b}}});var NoneExistingScrollableElementException=new Class({Extends:WebUIException,options:{description:"The specifified scrollable element: '{scrollableElementId}' doesn't exist.",name:"NoneExistingScrollableElementException"},initialize:function(b,a){this.setOptions(a);this.parent(a);this.parameters={scrollableElementId:b}}});var ScrollArea=new Class({Implements:Options,Binds:["onScrollContent","onScrollableElementClick","onScrollableElementKeyDown","onScrollableElementMouseWheel"],options:{componentName:"ScrollArea",contentHeight:null,contentViewElementClass:"contentEl",contentWidth:null,handleOpacity:1,handleActiveOpacity:0.85,paddingElementClass:"paddingEl",},initialize:function(b,c,a){assertThat(b,not(nil()));this.setOptions(a);this.borderHeight;this.contentViewElement;this.contentWrapperElement;this.hasFocusTimeout;this.scrollableElement=b;this.scrollableElementPadding=this.scrollableElement.getStyles("padding-top","padding-right","padding-bottom","padding-left");this.scrollableElementSize=this.scrollableElement.getStyles("height","width");this.scrollControls;this.sliderTimeout;this.step;this.overHang;this.paddingHeight;this.paddingWidth;this.windowFxScroll=c},construct:function(){this.createContentViewElement();this.determineBorderHeight();this.determinePadding();this.createPaddingElement();this.setContentElementStyle();this.adjustContentWrapperWidth();this.determineOverHang();this.constructScrollControls();this.addScrollableElementEvents()},destroy:function(){this.removeScrollableElementEvents();this.restoreContentElement();this.destroyScrollControls();this.destroyPaddingElement();this.destroyContentViewElement()},onScrollContent:function(a){this.contentViewElement.scrollTo(0,a)},onScrollableElementClick:function(a){this.hasFocus=true;this.hasFocusTimeout=(function(){clearInterval(this.hasFocusTimeout);this.hasFocus=true}.bind(this)).delay(50)},onScrollableElementKeyDown:function(a){if(a.key==="up"){a=new Event(a).stop();this.scrollControls.scrollUp()}else{if(a.key==="down"||a.key==="space"){a=new Event(a).stop();this.scrollControls.scrollDown()}}},onScrollableElementMouseWheel:function(a){a.stop();if(a.wheel>0){this.scrollControls.scrollUp()}else{if(a.wheel<0){this.scrollControls.scrollDown()}}},refresh:function(a){this.setContentViewSize(a);this.adjustContentWrapperWidth();this.determineOverHang();this.scrollControls.refresh(this.overHang)},getContentViewElement:function(){return this.contentViewElement},getContentViewSize:function(){var a=this.contentViewElement.getSize().x;a-=parseInt(this.contentWrapperElement.getStyle("margin-left"))+parseInt(this.contentWrapperElement.getStyle("margin-right"));a-=parseInt(this.contentWrapperElement.getStyle("padding-left"))+parseInt(this.contentWrapperElement.getStyle("padding-right"));a+=this.scrollControls.getEffectiveWidth();if(this.scrollControls.isVisible()){a-=this.scrollControls.getWidth()}return{x:a,y:this.contentViewElement.getSize().y}},getContentWrapperElement:function(){return this.contentWrapperElement},adjustContentWrapperWidth:function(){this.determineOverHang();var a=this.overHang<=0?"0px":"15px";this.contentWrapperElement.setStyle("margin-right",a)}.protect(),addScrollableElementEvents:function(){this.scrollableElement.addEvents({mousewheel:this.onScrollableElementMouseWheel,keydown:this.onScrollableElementKeyDown,click:this.onScrollableElementClick})}.protect(),constructScrollControls:function(){this.scrollControls=new ScrollControls(this.contentViewElement,this.overHang,{onScrollContent:this.onScrollContent});this.scrollControls.construct()}.protect(),createContentViewElement:function(){this.contentViewElement=new Element("div",{"class":this.options.contentViewElementClass});this.contentViewElement.wraps(this.scrollableElement);this.contentViewElement.setStyles({overflow:"hidden",padding:0,});this.determinePadding();this.setContentViewSize()}.protect(),createPaddingElement:function(){this.contentWrapperElement=new Element("div",{"class":this.options.paddingElementClass});this.contentWrapperElement.adopt(this.contentViewElement.getChildren());this.contentWrapperElement.inject(this.contentViewElement,"top");this.contentWrapperElement.setStyles(this.scrollableElementPadding);this.contentWrapperElement.setStyles({display:"inline","float":"left"})}.protect(),destroyContentViewElement:function(){if(this.contentViewElement&&this.contentViewElement.destroy){this.contentViewElement.destroy();this.contentViewElement=null}}.protect(),destroyPaddingElement:function(){if(this.contentWrapperElement&&this.contentWrapperElement.destroy){this.contentWrapperElement.destroy();this.contentWrapperElement=null}}.protect(),destroyScrollControls:function(){if(this.scrollControls){this.scrollControls.removeEvent("scrollContent",this.onScrollContent);this.scrollControls.destroy()}}.protect(),determineBorderHeight:function(){this.borderHeight=parseFloat(this.scrollableElement.getStyle("border-top-width"))+parseFloat(this.scrollableElement.getStyle("border-bottom-width"))}.protect(),determineOverHang:function(){this.overHang=this.scrollableElement.getSize().y+parseInt(this.contentWrapperElement.getStyle("padding-top"))-this.contentViewElement.getSize().y}.protect(),determinePadding:function(){this.paddingHeight=parseFloat(this.scrollableElement.getStyle("padding-top"))+parseFloat(this.scrollableElement.getStyle("padding-bottom"));this.paddingWidth=parseFloat(this.scrollableElement.getStyle("padding-left"))+parseFloat(this.scrollableElement.getStyle("padding-right"))}.protect(),removeScrollableElementEvents:function(){if(this.scrollableElement&&this.scrollableElement.removeEvent){this.scrollableElement.removeEvent("mousewheel",this.onScrollableElementMouseWheel);this.scrollableElement.removeEvent("keydown",this.onScrollableElementKeyDown);this.scrollableElement.removeEvent("click",this.onScrollableElementClick)}}.protect(),restoreContentElement:function(){if(this.contentViewElement){this.scrollableElement.dispose();this.scrollableElement.inject(this.contentViewElement,"before")}this.scrollableElement.setStyles(this.scrollableElementSize)}.protect(),setContentElementStyle:function(){this.scrollableElement.setStyles({height:"100%",margin:"0px",padding:"0px",width:"100%"})}.protect(),setContentViewSize:function(a){if(a&&a.x&&a.y){this.options.contentHeight=a.y;this.options.contentWidth=a.x}else{if(!this.options.contentHeight&&!this.options.contentWidth){this.options.contentHeight=parseInt(this.scrollableElement.getStyle("height"));this.options.contentWidth=parseInt(this.scrollableElement.getStyle("width"))}}this.contentViewElement.setStyles({width:this.options.contentWidth+"px",height:this.options.contentHeight+"px"})}.protect()});var ScrollControls=new Class({Implements:[Events,Options],Binds:["onDocumentClick","onDocumentKeyDown","onDocumentMouseUp","scrollDown","scrollUp"],options:{componentName:"ScrollControls",disabledOpacity:0,downBtnClass:"downBtn",increment:15,scrollBarClass:"scrollBar",scrollControlsYClass:"scrollControlsY",scrollHandleClass:"scrollHandle",scrollHandleBGClass:"scrollHandleBG",scrollHandleTopClass:"scrollHandleTop",scrollHandleMiddleClass:"scrollHandleMiddle",scrollHandleBottomClass:"scrollHandleBottom",scrollSlotClass:"scrollSlot",upBtnClass:"upBtn"},initialize:function(c,b,a){assertThat(c,not(nil()));assertThat(b,not(nil()));this.setOptions(a);this.contentViewElement=c;this.downButton;this.downInterval;this.overHang=b;this.scrollSlot;this.scrollHandle;this.scrollHandleBG;this.slider;this.state=BrowserWidget.States.INITIALIZED;this.upButton;this.upInterval},construct:function(){this.createControlElements();this.setHeights();this.createSlider();this.illuminateScrollControls();this.addScrollHandleEvents();this.addUpButtonEvents();this.addDownButtonEvents();this.addContentViewEvents();this.addDocumentEvents();this.state=BrowserWidget.States.CONSTRUCTED},destroy:function(){clearInterval(this.sliderTimeout);this.removeScrollHandleEvents();this.removeDownButtonEvents();this.removeUpButtonEvents();this.removeContentViewEvents();this.removeDocumentEvents();this.destroySlider();this.destroyControlElements();this.state=BrowserWidget.States.INITIALIZED},onDocumentClick:function(a){this.hasFocus=false},onDocumentKeyDown:function(a){if((this.hasFocus||this.options.fullWindowMode)&&(a.key==="down"||a.key==="space"||a.key==="up")){this.scrollableElement.fireEvent("keydown",a)}},onDocumentMouseUp:function(a){this.scrollHandle.removeClass(this.options.scrollHandleClass+"-Active").setStyle("opacity",this.options.handleOpacity);this.stopScrollUp();this.stopScrollDown()},refresh:function(a){this.overHang=a;this.updateSlider();this.illuminateScrollControls();this.setHeights()},scrollDown:function(){var a=this.contentViewElement.getScroll().y+this.options.increment;this.slider.set(a)},scrollUp:function(){var a=this.contentViewElement.getScroll().y-this.options.increment;if(a<0){a=0}this.slider.set(a)},getEffectiveWidth:function(){return(this.isVisible()?this.getWidth():0)},getSlider:function(){return this.slider},getWidth:function(){return this.scrollControlsYWrapper?this.scrollControlsYWrapper.getSize().x:0},isVisible:function(){return this.overHang>0?true:false},addContentViewEvents:function(){this.contentViewElement.addEvents({scroll:function(a){this.slider.set(this.contentViewElement.getScroll().y)}.bind(this)})}.protect(),addDocumentEvents:function(){document.addEvents({mouseup:this.onDocumentMouseUp,keydown:this.onDocumentKeyDown,click:this.onDocumentClick})}.protect(),addDownButtonEvents:function(){this.downButton.addEvents({mousedown:function(a){clearInterval(this.upInterval);clearInterval(this.downInterval);this.downInterval=this.scrollDown.periodical(10,this);this.downButton.addClass(this.options.downBtnClass+"-Active")}.bind(this),mouseup:function(a){this.stopScrollDown()}.bind(this),mouseout:function(a){this.stopScrollDown()}.bind(this)})}.protect(),addScrollHandleEvents:function(){this.scrollHandle.addEvents({mousedown:function(a){this.scrollHandle.addClass(this.options.scrollHandleClass+"-Active").setStyle("opacity",this.options.handleActiveOpacity)}.bind(this)})}.protect(),addUpButtonEvents:function(){this.upButton.addEvents({mousedown:function(a){clearInterval(this.upInterval);clearInterval(this.downInterval);this.upInterval=this.scrollUp.periodical(10,this);this.upButton.addClass(this.options.upBtnClass+"-Active")}.bind(this),mouseup:function(a){this.stopScrollUp()}.bind(this),mouseout:function(a){this.stopScrollUp()}.bind(this)})}.protect(),createControlElements:function(){this.scrollControlsYWrapper=new Element("div",{"class":this.options.scrollControlsYClass}).inject(this.contentViewElement,"bottom");this.upButton=new Element("div",{"class":this.options.upBtnClass}).inject(this.scrollControlsYWrapper,"bottom");this.downButton=new Element("div",{"class":this.options.downBtnClass}).inject(this.scrollControlsYWrapper,"bottom");this.scrollSlot=new Element("div",{"class":this.options.scrollSlotClass}).inject(this.scrollControlsYWrapper,"bottom");this.scrollHandle=new Element("div",{"class":this.options.scrollHandleClass}).inject(this.scrollSlot,"inside");this.scrollHandleTop=new Element("div",{"class":this.options.scrollHandleTopClass}).inject(this.scrollHandle,"inside");this.scrollHandleBG=new Element("div",{"class":this.options.scrollHandleBGClass}).inject(this.scrollHandle,"inside");this.scrollHandleMiddle=new Element("div",{"class":this.options.scrollHandleMiddleClass}).inject(this.scrollHandle,"inside");this.scrollHandleBottom=new Element("div",{"class":this.options.scrollHandleBottomClass}).inject(this.scrollHandle,"inside")}.protect(),createSlider:function(){var a=this.overHang>=0?Math.round(this.overHang):0;this.slider=new Slider(this.scrollSlot,this.scrollHandle,{range:[0,a],mode:"vertical",snap:true,onChange:function(b,c){if(this.state==BrowserWidget.States.CONSTRUCTED){this.fireEvent("scrollContent",b)}}.bind(this)});this.slider.set(0)}.protect(),destroyControlElements:function(){if(this.upButton){this.upButton.destroy();this.upButton=null}if(this.downButton){this.downButton.destroy();this.downButton=null}if(this.scrollHandleTop){this.scrollHandleTop.destroy();this.scrollHandleTop=null}if(this.scrollHandleBG){this.scrollHandleBG.destroy();this.scrollHandleBG=null}if(this.scrollHandleMiddle){this.scrollHandleMiddle.destroy();this.scrollHandleMiddle=null}if(this.scrollHandleBottom){this.scrollHandleBottom.destroy();this.scrollHandleBottom=null}if(this.scrollHandle){this.scrollHandle.destroy();this.scrollHandle=null}if(this.scrollSlot){this.scrollSlot.destroy();this.scrollSlot=null}if(this.scrollControlsYWrapper){this.scrollControlsYWrapper.destroy();this.scrollControlsYWrapper=null}}.protect(),destroySlider:function(){if(this.slider){this.slider.removeEvents();this.slider=null}}.protect(),greyOut:function(){this.scrollHandle.setStyles({opacity:this.options.disabledOpacity});this.scrollHandleTop.setStyles({opacity:this.options.disabledOpacity});this.scrollHandleBG.setStyles({opacity:this.options.disabledOpacity});this.scrollHandleMiddle.setStyles({opacity:this.options.disabledOpacity});this.scrollHandleBottom.setStyles({opacity:this.options.disabledOpacity});this.upButton.setStyles({opacity:this.options.disabledOpacity});this.scrollControlsYWrapper.setStyles({opacity:this.options.disabledOpacity});this.downButton.setStyles({opacity:this.options.disabledOpacity});this.scrollSlot.setStyles({opacity:this.options.disabledOpacity})}.protect(),illuminateScrollControls:function(){if(this.overHang<=0){this.greyOut()}else{this.unGrey()}}.protect(),removeContentViewEvents:function(){if(this.contentViewElement&&this.contentViewElement.removeEvents){this.contentViewElement.removeEvents()}}.protect(),removeDocumentEvents:function(){document.removeEvent("mouseup",this.onDocumentMouseUp);document.removeEvent("keydown",this.onDocumentKeyDown);document.removeEvent("click",this.onDocumentClick)}.protect(),removeDownButtonEvents:function(){if(this.downButton&&this.downButton.removeEvents){this.downButton.removeEvents()}this.stopScrollDown()}.protect(),removeScrollHandleEvents:function(){if(this.scrollHandle&&this.scrollHandle.removeEvents){this.scrollHandle.removeEvents()}}.protect(),removeUpButtonEvents:function(){if(this.upButton&&this.upButton.removeEvents){this.upButton.removeEvents()}this.stopScrollUp()}.protect(),setHandleHeight:function(){var f=this.overHang>0?1/(1+this.overHang/this.contentViewElement.getSize().y):1;var d=this.scrollSlot.getSize().y;var c=Math.round(f*d);var a=this.scrollHandleBottom.getSize().y+this.scrollHandleTop.getSize().y;if(c<a){c=a}this.scrollHandle.setStyles({height:c+"px"});var b=c-(this.scrollHandleTop.getSize().y+this.scrollHandleBottom.getSize().y);b=b>0?b:0;this.scrollHandleBG.setStyles({height:b+"px"})}.protect(),setHeights:function(){this.setScrollSlotHeight();this.setHandleHeight()}.protect(),setScrollSlotHeight:function(){var a=this.contentViewElement.getSize().y-(this.downButton.getSize().y+this.upButton.getSize().y+parseInt(this.scrollSlot.getStyle("top"))+parseInt(this.scrollSlot.getStyle("margin-bottom")));a=a>0?a:0;this.scrollSlot.setStyles({height:a+"px"})}.protect(),stopScroll:function(){this.stopScrollDown();this.stopScrollUp()}.protect(),stopScrollDown:function(){clearInterval(this.downInterval);if(this.downButton&&this.downButton.removeClass){this.downButton.removeClass(this.options.downBtnClass+"-Active")}},stopScrollUp:function(){clearInterval(this.downInterval);if(this.upButton&&this.upButton.removeClass){this.upButton.removeClass(this.options.upBtnClass+"-Active")}},unGrey:function(){this.scrollHandle.setStyles({display:"block",opacity:1});this.scrollHandleTop.setStyles({opacity:1});this.scrollHandleBG.setStyles({opacity:1});this.scrollHandleMiddle.setStyles({opacity:1});this.scrollHandleBottom.setStyles({opacity:1});this.scrollControlsYWrapper.setStyles({opacity:1});this.upButton.setStyles({opacity:1});this.downButton.setStyles({opacity:1});this.scrollSlot.setStyles({opacity:1})}.protect(),updateSlider:function(){if(this.overHang>0){this.slider.setRange([0,this.overHang])}this.slider.set(0)}});var ScrollingBehaviour=new Class({Implements:Options,options:{contentHeight:null,contentWidth:null,disabledOpacity:0,downBtnClass:"downBtn",fullWindowMode:false,handleOpacity:1,handleActiveOpacity:0.85,increment:15,restrictedBrowsers:[Browser.Engine.presto925,Browser.Platform.ipod,Browser.Engine.webkit419],scrollBarClass:"scrollBar",scrollHandleClass:"scrollHandle",scrollHandleBGClass:"scrollHandleBG",scrollHandleTopClass:"scrollHandleTop",scrollHandleMiddleClass:"scrollHandleMiddle",scrollHandleBottomClass:"scrollHandleBottom",scrollControlsYClass:"scrollControlsY",selector:".scroll",smoothMooScroll:{toAnchor:true,toMooScrollArea:true},upBtnClass:"upBtn"},initialize:function(b,a){if(this.options.restrictedBrowsers.contains(true)){return}this.setOptions(a);this.scrollArea;this.scrollableElement;this.windowFxScroll=new Fx.Scroll(document.window,{wait:false});this.identifyScrollableElement(b)},construct:function(){this.scrollArea=new ScrollArea(this.scrollableElement,this.windowFxScroll,this.options);this.scrollArea.construct();if(this.options.smoothMooScroll.toAnchor||this.options.smoothMooScroll.toMooScrollArea){this.smoothMooScroll=new SmoothScroll({toAnchor:this.options.smoothMooScroll.toAnchor,toMooScrollArea:this.options.smoothMooScroll.toMooScrollArea},this.scrollArea.contentEl,this.windowFxScroll)}},destroy:function(){if(this.scrollArea){this.scrollArea.destroy()}},loadContent:function(a){this.scrollArea.loadContent(a)},refresh:function(a){this.scrollArea.refresh(a)},setSlider:function(a){this.scrollAreas.setSlider(a)},getContentViewSize:function(){return this.scrollArea.getContentViewSize()},getScrollableElement:function(){return this.scrollableElement},getScrollArea:function(){return this.scrollArea},identifyScrollableElement:function(a){this.scrollableElement=$(a);if(!this.scrollableElement){throw new NoneExistingScrollableElementException(a)}}});var SmoothScroll=new Class({Extends:Fx.Scroll,initialize:function(b,c,d){this.setOptions(b);this.windowFxScroll=d;this.context=c;c=c||document;this.context=c;var g=c.getDocument(),f=c.getWindow();this.parent(c,b);this.links=(this.options.links)?$$(this.options.links):$$(g.links);var a=f.location.href.match(/^[^#]*/)[0]+"#";this.links.each(function(j){if(j.href.indexOf(a)!=0){return}var h=j.href.substr(a.length);if(h&&$(h)&&$(h).getParents().contains($(this.context))){this.useLink(j,h,true)}else{if(h&&$(h)&&!this.inMooScrollArea($(h))){this.useLink(j,h,false)}}},this);if(!Browser.Engine.webkit419){this.addEvent("complete",function(){f.location.hash=this.anchor},true)}},inMooScrollArea:function(a){return a.getParents().filter(function(c,b){return c.match("[rel=MooScrollArea]")}).length>0},putAnchorInAddressBar:function(a){window.location.href="#"+a},useLink:function(b,a,c){b.removeEvents("click");b.addEvent("click",function(d){if(!a||!$(a)){return}this.anchor=a;if(c){if(this.options.toMooScrollArea&&this.options.toAnchor){this.windowFxScroll.toElement(this.context.getParent()).chain(function(g,f){this.toElement(a).chain(function(){this.putAnchorInAddressBar(a)}.bind(this))}.bind(this))}else{if(this.options.toMooScrollArea){this.windowFxScroll.toElement(this.context.getParent()).chain(function(){this.putAnchorInAddressBar(a)}.bind(this))}else{if(this.options.toAnchor){this.toElement(a).chain(function(){this.putAnchorInAddressBar(a)}.bind(this))}}}}else{this.windowFxScroll.toElement(a).chain(function(){this.putAnchorInAddressBar(a)}.bind(this))}d.stop()}.bind(this))}});var SkinChangedMessage=new Class({Extends:WebUIMessage,options:{actionType:null,description:"A message about the event that WebUI's skin was changed.",name:"SkingChangedMessage",newSkin:null,previousSkin:null},initialize:function(a){this.setOptions(a);this.options.messageClass=SkinChangedMessage},getNewSkin:function(){return this.options.newSkin},getPreviousSkin:function(){return this.options.previousSkin}});var SkinSelectorWidget=new Class({Extends:BrowserWidget,Binds:["onSelection"],options:{componentPrefix:"SkinSelectorWidget",selectElementId:"SkinSelector",selectTextKey:"SkinSelectorWidget.select",widgetContainerId:"SkinSelectorWidget",wrapperElementStyle:"SkinSelectorWrapper"},initialize:function(a,b,c){this.setOptions(a);this.parent(a,b);this.availableSkins=new HashMap();this.isConfigured=false;this.selectElement=null;this.selectElementContainer=null;this.webUIConfiguration=c;this.determineInitializationArguments();this.determineAvailableSkins()},construct:function(){this.createSpanElements();this.createSelectElement();this.createSelectElementOptions();return this.parent()},destroy:function(){this.availableSkins.clear();this.parent()},onSelection:function(){var c=this.skin;var b=this.selectElement.options[this.selectElement.selectedIndex].value;var a=new SkinChangedMessage({previousSkin:c,newSkin:b,originator:this.options.widgetContainerId});this.messageBus.notifySubscribers(a)},getAvailableSkins:function(){return this.availableSkins},getWebUIConfiguration:function(){return this.webUIConfiguration},createSelectElement:function(){this.selectElement=this.elementFactory.create("select",null,this.selectElementContainer,WidgetElementFactory.Positions.FirstChild,{id:this.options.selectElementId});this.selectElement.addEvent("change",this.onSelection)}.protect(),createSelectElementOptions:function(){var a=this.elementFactory.createOption("",this.options.selectTextKey,this.selectElement,WidgetElementFactory.Positions.LastChild);a.set("selected");this.availableSkins.each(function(c,b){this.elementFactory.createOption(c.getKey(),c.getKey(),this.selectElement,WidgetElementFactory.Positions.LastChild)},this)}.protect(),createSpanElements:function(){var a=this.elementFactory.create("span",null,null,null,{"class":this.options.wrapperElementStyle});this.selectElementContainer=this.elementFactory.create("span",null,a,WidgetElementFactory.Positions.LastChild)}.protect(),determineAvailableSkins:function(){for(var b=0;b<this.webUIConfiguration.getAvailableSkinElements().length;b++){var a=this.webUIConfiguration.getSkinNameByIndex(b);var c=this.webUIConfiguration.getSkinPathByIndex(b);this.availableSkins.put(a,c)}}.protect(),determineInitializationArguments:function(){if(!this.webUIConfiguration){var a=Class.getInstanceOf(WebUIController);this.webUIConfiguration=a.getWebUIConfiguration()}}.protect()});(function(){WhenPaused=1<<0;WhenPlaying=1<<1;OnStart=1<<2;Slideshow=new Class({Implements:[Chain,Events,Options],options:{accesskeys:{first:{key:"shift left",label:"Shift + Leftwards Arrow"},prev:{key:"left",label:"Leftwards Arrow"},pause:{key:"p",label:"P"},next:{key:"right",label:"Rightwards Arrow"},last:{key:"shift right",label:"Shift + Rightwards Arrow"}},captions:true,center:true,classes:[],controller:true,data:null,delay:2000,duration:1000,fast:false,height:false,href:"",hu:"",linked:false,loader:true,loop:true,match:/\?slide=(\d+)$/,overlap:true,paused:false,random:false,replace:[/(\.[^\.]+)$/,"t$1"],resize:"fill",slide:0,thumbnails:true,titles:false,transition:"sine:in:out",width:false},initialize:function(g,m,s){this.setOptions(s);this.el=document.id(g);if(!this.el){return}var o=window.location.href.match(this.options.match);this.slide=this._slide=this.options.match&&o?o[1].toInt():this.options.slide;this.counter=this.timeToNextTransition=this.timeToTransitionComplete=0;this.direction="left";this.cache={};this.paused=false;if(!this.options.overlap){this.options.duration*=2}var n=this.el.getElement("a")||new Element("a");if(!this.options.href){this.options.href=n.get("href")||""}if(this.options.hu.length&&!this.options.hu.test(/\/$/)){this.options.hu+="/"}if(this.options.fast===true){this.options.fast=WhenPaused|WhenPlaying}var r="slideshow first prev play pause next last images captions controller thumbnails hidden visible inactive active loader".split(" ");var q=r.map(function(u,t){return this.options.classes[t]||u},this);this.classes=q.associate(r);this.classes.get=function(){var v="."+this.slideshow;for(var u=0,t=arguments.length;u<t;u++){v+="-"+this[arguments[u]]}return v}.bind(this.classes);if(!m){this.options.hu="";m={};var h=this.el.getElements(this.classes.get("thumbnails")+" img");this.el.getElements(this.classes.get("images")+" img").each(function(v,w){var x=v.src,u=v.alt||v.title,t=v.getParent().href,y=h[w]?h[w].src:"";m[x]={caption:u,href:t,thumbnail:y}})}var l=this.load(m);if(!l){return}this.events={};this.events.push=function(u,t){if(!this[u]){this[u]=[]}this[u].push(t);document.addEvent(u,t);return this}.bind(this.events);this.accesskeys={};for(action in this.options.accesskeys){var k=this.options.accesskeys[action];this.accesskeys[action]=accesskey={label:k.label};["shift","control","alt"].each(function(t){var u=new RegExp(t,"i");accesskey[t]=k.key.test(u);k.key=k.key.replace(u,"")});accesskey.key=k.key.trim()}this.events.push("keyup",function(t){Object.each(this.accesskeys,function(v,u){if(t.key==v.key&&t.shift==v.shift&&t.control==v.control&&t.alt==v.alt){this[u]()}},this)}.bind(this));var g=this.el.getElement(this.classes.get("images"));var j=this.el.getElement("img")||new Element("img");var p=g?g.empty():new Element("div",{"class":this.classes.get("images").substr(1)}).inject(this.el);var f=p.getSize();this.height=this.options.height||f.y;this.width=this.options.width||f.x;p.set({styles:{height:this.height,width:this.width}});this.el.store("images",p);this.a=this.image=j;if(Browser.ie&&Browser.version>=7){this.a.style.msInterpolationMode="bicubic"}this.a.set("styles",{display:"none"});this.b=this.a.clone();[this.a,this.b].each(function(t){n.clone().cloneEvents(n).grab(t).inject(p)});this.options.captions&&new a(this);this.options.controller&&new c(this);this.options.loader&&new d(this);this.options.thumbnails&&new b(this);this._preload(this.options.fast&OnStart)},go:function(h,g){var f=(this.slide+this.data.images.length)%this.data.images.length;if(h==f||Date.now()<this.timeToTransitionComplete){return}clearTimeout(this.timer);this.timeToNextTransition=0;this.direction=g?g:h<this._slide?"right":"left";this.slide=this._slide=h;if(this.preloader){this.preloader=this.preloader.destroy()}this._preload((this.options.fast&WhenPlaying)||(this.paused&&this.options.fast&WhenPaused))},first:function(){this.prev(true)},prev:function(f){var g=0;if(!f){if(this.options.random){if(this.showed.i<2){return}this.showed.i-=2;g=this.showed.array[this.showed.i]}else{g=(this.slide-1+this.data.images.length)%this.data.images.length}}this.go(g,"right")},pause:function(f){if(f!=undefined){this.paused=f?false:true}if(this.paused){this.paused=false;this.timeToTransitionComplete=Date.now()+this.timeToTransitionComplete;this.timer=this._preload.delay(50,this);[this.a,this.b].each(function(h){["morph","tween"].each(function(j){if(this.retrieve&&this.retrieve(j)){this.get(j).resume()}},h)});this.controller&&this.el.retrieve("pause").getParent().removeClass(this.classes.play)}else{this.paused=true;this.timeToTransitionComplete=this.timeToTransitionComplete-Date.now();clearTimeout(this.timer);[this.a,this.b].each(function(h){["morph","tween"].each(function(j){if(this.retrieve&&this.retrieve(j)){this.get(j).pause()}},h)});if(this.controller&&this.el.retrieve&&this.el.retrieve("pause")){var g=this.el.retrieve("pause");if(g.getParent()){g.getParent().addClass(this.classes.play)}}}},next:function(f){var g=f?this.data.images.length-1:this._slide;this.go(g,"left")},last:function(){this.next(true)},load:function(h){this.firstrun=true;this.showed={array:[],i:0};if(typeOf(h)=="array"){this.options.captions=false;h=new Array(h.length).associate(h.map(function(p,o){return p+"?"+o}))}this.data={images:[],captions:[],hrefs:[],thumbnails:[],targets:[],titles:[]};for(var l in h){var k=h[l]||{},l=this.options.hu+l,g=k.caption?k.caption.trim():"",f=k.href?k.href.trim():this.options.linked?l:this.options.href,j=k.target?k.target.trim():"_self",n=k.thumbnail?this.options.hu+k.thumbnail.trim():l.replace(this.options.replace[0],this.options.replace[1]),m=g.replace(/<.+?>/gm,"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"'");this.data.images.push(l);this.data.captions.push(g);this.data.hrefs.push(f);this.data.targets.push(j);this.data.thumbnails.push(n);this.data.titles.push(m)}if(this.options.random){this.slide=this._slide=Number.random(0,this.data.images.length-1)}if(this.options.thumbnails&&this.el.retrieve("thumbnails")){this._thumbnails()}if(this.el.retrieve("images")){[this.a,this.b].each(function(o){["morph","tween"].each(function(q){if(this.retrieve(q)){this.get(q).cancel()}},o)});this.slide=this._slide=this.timeToTransitionComplete=0;this.go(0)}return this.data.images.length},destroy:function(f){Object.each(this.events,function(h,g){if("each" in h){h.each(function(j){document.removeEvent(g,j)})}});this.pause(1);"caption loader thumbnails".split(" ").each(function(g,h){this.options[g]&&this[g].retrieve&&(h=this[g].retrieve("timer"))&&clearTimeout(h)},this);typeOf(this.el[f])=="function"&&this.el[f]();if(this.el.eliminate){this.el.eliminate("uid")}if(this.preloader&&this.preloader.removeEvents){this.preloader.removeEvents()}if(this.preloader&&this.preloader.destroy){this.preloader.destroy()}},_preload:function(f){var k=this.data.images[this._slide].replace(/([^?]+).*/,"$1");var h=loaded=!!this.cache[k];if(!h){if(!this.preloader){this.preloader=new Asset.image(k,{onerror:function(){},onload:function(){this.store("loaded",true)}})}loaded=this.preloader.retrieve("loaded")&&this.preloader.get("width")}if(loaded&&Date.now()>this.timeToNextTransition&&Date.now()>this.timeToTransitionComplete){var k=this.data.images[this._slide].replace(/([^?]+).*/,"$1");if(this.preloader){this.cache[k]={height:this.preloader.get("height"),src:k,width:this.preloader.get("width")}}if(this.stopped){if(this.options.captions){this.caption.get("morph").cancel().start(this.classes.get("captions","hidden"))}this.pause(1);if(this.end){this.fireEvent("end")}this.stopped=this.end=false;return}this.image=this.counter%2?this.b:this.a;this.image.set("styles",{display:"block",height:null,visibility:"hidden",width:null,zIndex:this.counter});this.image.set(this.cache[k]);this.image.width=this.cache[k].width;this.image.height=this.cache[k].height;this.options.resize&&this._resize(this.image);this.options.center&&this._center(this.image);var g=this.image.getParent();if(this.data.hrefs[this._slide]){g.set("href",this.data.hrefs[this._slide]);g.set("target",this.data.targets[this._slide])}else{g.erase("href");g.erase("target")}var j=this.data.titles[this._slide];this.image.set("alt",j);this.options.titles&&g.set("title",j);this.options.loader&&this.loader.fireEvent("hide");this.options.captions&&this.caption.fireEvent("update",f);this.options.thumbnails&&this.thumbnails.fireEvent("update",f);this._show(f);this._loaded(f)}else{if(Date.now()>this.timeToNextTransition&&this.options.loader){this.loader.fireEvent("show")}this.timer=this._preload.delay(50,this,f)}},_show:function(g){if(!this.image.retrieve("morph")){var h=this.options.overlap?{link:"cancel"}:{link:"chain"};$$(this.a,this.b).set("morph",Object.merge(h,{duration:this.options.duration,onStart:this._start.bind(this),onComplete:this._complete.bind(this),transition:this.options.transition}))}var k=this.classes.get("images",(this.direction=="left"?"next":"prev")),l=this.classes.get("images","visible"),f=this.counter%2?this.a:this.b;if(g){f.get("morph").cancel().set(k);this.image.get("morph").cancel().set(l)}else{if(this.options.overlap){f.get("morph").set(l);this.image.get("morph").set(k).start(l)}else{var j=function(m){this.image.get("morph").start(m)}.pass(l,this);if(this.firstrun){return j()}k=this.classes.get("images",(this.direction=="left"?"prev":"next"));this.image.get("morph").set(k);f.get("morph").set(l).start(k).chain(j)}}this.fireEvent("show")},_loaded:function(f){this.counter++;this.timeToNextTransition=Date.now()+this.options.duration+this.options.delay;this.direction="left";this.timeToTransitionComplete=f?0:Date.now()+this.options.duration;if(this._slide==(this.data.images.length-1)&&!this.options.loop&&!this.options.random){this.stopped=this.end=true}if(this.options.random){this.showed.i++;if(this.showed.i>=this.showed.array.length){var g=this._slide;if(this.showed.array.getLast()!=g){this.showed.array.push(g)}while(this._slide==g){this.slide=this._slide=Number.random(0,this.data.images.length-1)}}else{this.slide=this._slide=this.showed.array[this.showed.i]}}else{this.slide=this._slide;this._slide=(this.slide+1)%this.data.images.length}if(this.image.getStyle("visibility")!="visible"){(function(){this.image.setStyle("visibility","visible")}).delay(1,this)}if(this.preloader){this.preloader=this.preloader.destroy()}this.paused||this._preload()},_center:function(g){var j=g.getSize(),k=j.y,f=j.x;g.set("styles",{left:(f-this.width)/-2,top:(k-this.height)/-2})},_resize:function(g){var k=g.get("height").toFloat(),f=g.get("width").toFloat(),l=this.height/k,j=this.width/f;if(this.options.resize=="fit"){l=j=l>j?j:l}if(this.options.resize=="fill"){l=j=l>j?l:j}g.set("styles",{height:Math.ceil(k*l),width:Math.ceil(f*j)})},_start:function(){this.fireEvent("start")},_complete:function(){if(this.firstrun&&this.options.paused){this.pause(1)}this.firstrun=false;this.fireEvent("complete",[],10)}});var a=new Class({Implements:[Chain,Events,Options],options:{delay:0,link:"cancel"},initialize:function(h){if(!h){return}var g=h.options.captions;if(g===true){g={}}this.setOptions(g);var j=h.el.getElement(h.classes.get("captions")),f=j?j.dispose().empty():new Element("div",{"class":h.classes.get("captions").substr(1)});h.caption=f;f.set({"aria-busy":false,"aria-hidden":false,events:{update:this.update.bind(h)},morph:this.options,role:"description"}).store("delay",this.options.delay);if(!f.get("id")){f.set("id","Slideshow-"+Date.now())}h.el.retrieve("images").set("aria-labelledby",f.get("id"));f.inject(h.el)},update:function(f){var j=!this.data.captions[this._slide].length,l;if(l=this.caption.retrieve("timer")){clearTimeout(l)}if(f){var k=j?"hidden":"visible";this.caption.set({"aria-hidden":j,html:this.data.captions[this._slide]}).get("morph").cancel().set(this.classes.get("captions",k))}else{var h=j?function(){}:function(m){this.caption.store("timer",setTimeout(function(n){this.caption.set("html",n).morph(this.classes.get("captions","visible"))}.pass(m,this),this.caption.retrieve("delay")))}.pass(this.data.captions[this._slide],this);var g=function(){this.caption.set("aria-busy",false)}.bind(this);this.caption.set("aria-busy",true).get("morph").cancel().start(this.classes.get("captions","hidden")).chain(h,g)}}});var c=new Class({Implements:[Chain,Events,Options],options:{link:"cancel"},initialize:function(k){if(!k){return}var g=k.options.captions;if(g===true){g={}}this.setOptions(g);var l=k.el.getElement(k.classes.get("controller")),f=l?l.dispose().empty():new Element("div",{"class":k.classes.get("controller").substr(1)});k.controller=f;f.set({"aria-hidden":false,role:"menubar"});var j=new Element("ul",{role:"menu"}).inject(f),h=0;Object.each(k.accesskeys,function(p,o){var m=new Element("li",{"class":(o=="pause"&&this.options.paused)?this.classes.play+" "+this.classes[o]:this.classes[o]}).inject(j);var n=this.el.retrieve(o,new Element("a",{role:"menuitem",tabindex:h++,title:p.label}).inject(m));n.set("events",{click:function(q){this[q]()}.pass(o,this),mouseenter:function(q){this.addClass(q)}.pass(this.classes.active,n),mouseleave:function(q){this.removeClass(q)}.pass(this.classes.active,n)})},k);f.set({events:{hide:this.hide.pass(k.classes.get("controller","hidden"),f),show:this.show.pass(k.classes.get("controller","visible"),f)},morph:this.options}).store("hidden",false);k.events.push("keydown",this.keydown.bind(k)).push("keyup",this.keyup.bind(k)).push("mousemove",this.mousemove.bind(k));f.inject(k.el).fireEvent("hide")},hide:function(f){if(this.get("aria-hidden")=="false"){this.set("aria-hidden",true).morph(f)}},keydown:function(f){Object.each(this.accesskeys,function(h,g){if(f.key==h.key&&f.shift==h.shift&&f.control==h.control&&f.alt==h.alt){if(this.controller.get("aria-hidden")=="true"){this.controller.get("morph").set(this.classes.get("controller","visible"))}this.el.retrieve(g).fireEvent("mouseenter")}},this)},keyup:function(f){Object.each(this.accesskeys,function(h,g){if(f.key==h.key&&f.shift==h.shift&&f.control==h.control&&f.alt==h.alt){if(this.controller.get("aria-hidden")=="true"){this.controller.set("aria-hidden",false).fireEvent("hide")}this.el.retrieve(g).fireEvent("mouseleave")}},this)},mousemove:function(h){var f=this.el.retrieve("images").getCoordinates(),g=(h.page.x>f.left&&h.page.x<f.right&&h.page.y>f.top&&h.page.y<f.bottom)?"show":"hide";this.controller.fireEvent(g)},show:function(f){if(this.get("aria-hidden")=="true"){this.set("aria-hidden",false).morph(f)}}});var d=new Class({Implements:[Chain,Events,Options],options:{fps:20,link:"cancel"},initialize:function(j){if(!j){return}var h=j.options.loader;if(h===true){h={}}this.setOptions(h);var f=new Element("div",{"aria-hidden":false,"class":j.classes.get("loader").substr(1),morph:this.options,role:"progressbar"}).store("animate",false).store("i",0).store("delay",1000/this.options.fps).inject(j.el);j.loader=f;var g=f.getStyle("backgroundImage").replace(/url\(['"]?(.*?)['"]?\)/,"$1").trim();if(g){if(g.test(/\.png$/)&&Browser.ie&&Browser.version<7){f.setStyles({backgroundImage:"none",filter:'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+g+'", sizingMethod="crop")'})}new Asset.image(g,{onload:function(){var l=f.getSize(),m=this.get("width"),k=this.get("height");if(m>l.x){f.store("x",l.x).store("animate","x").store("frames",(m/l.x).toInt())}if(k>l.y){f.store("y",l.y).store("animate","y").store("frames",(k/l.y).toInt())}}})}f.set("events",{animate:this.animate.bind(f),hide:this.hide.pass(j.classes.get("loader","hidden"),f),show:this.show.pass(j.classes.get("loader","visible"),f)});f.fireEvent("hide")},animate:function(){var f=this.retrieve("animate");if(!f){return}var g=(this.retrieve("i").toInt()+1)%this.retrieve("frames");this.store("i",g);var h=(g*this.retrieve(f))+"px";if(f=="x"){this.setStyle("backgroundPosition",h+" 0px")}if(f=="y"){this.setStyle("backgroundPosition","0px "+h)}},hide:function(f){if(this.get("aria-hidden")=="false"){this.set("aria-hidden",true).morph(f);if(this.retrieve("animate")){clearTimeout(this.retrieve("timer"))}}},show:function(f){if(this.get("aria-hidden")=="true"){this.set("aria-hidden",false).morph(f);if(this.retrieve("animate")){this.store("timer",function(){this.fireEvent("animate")}.periodical(this.retrieve("delay"),this))}}}});var b=new Class({Implements:[Chain,Events,Options],options:{columns:null,fps:50,link:"cancel",position:null,rows:null,scroll:null},initialize:function(j){var f=(j.options.thumbnails===true)?{}:j.options.thumbnails;this.setOptions(f);var l=j.el.getElement(j.classes.get("thumbnails"));var n=l?l.empty():new Element("div",{"class":j.classes.get("thumbnails").substr(1)});j.thumbnails=n;n.set({role:"menubar",styles:{overflow:"hidden"}});var h=n.retrieve("uid","Slideshow-"+Date.now());var g=new Element("ul",{role:"menu",styles:{left:0,position:"absolute",top:0},tween:{link:"cancel"}}).inject(n);j.data.thumbnails.each(function(r,q){var o=new Element("li",{id:h+q}).inject(g);var p=new Element("a",{"class":j.classes.get("thumbnails","hidden").substr(1),events:{click:this.click.pass(q,j)},href:j.data.images[q],morph:this.options,role:"menuitem",tabindex:q}).store("uid",q).inject(o);if(j.options.titles){p.set("title",j.data.titles[q])}new Asset.image(r,{onload:this.onload.pass(q,j)}).inject(p)},this);n.set("events",{scroll:this.scroll.bind(n),update:this.update.bind(j)});var m=n.getCoordinates();if(!f.scroll){f.scroll=(m.height>m.width)?"y":"x"}var k=(f.scroll=="y")?"top bottom height y width".split(" "):"left right width x height".split(" ");n.store("props",k);n.store("delay",1000/this.options.fps);j.events.push("mousemove",this.mousemove.bind(n));n.inject(j.el)},click:function(f){this.go(f);return false},mousemove:function(g){var f=this.getCoordinates();if(g.page.x>f.left&&g.page.x<f.right&&g.page.y>f.top&&g.page.y<f.bottom){this.store("page",g.page);if(!this.retrieve("mouseover")){this.store("mouseover",true);this.store("timer",function(){this.fireEvent("scroll")}.periodical(this.retrieve("delay"),this))}}else{if(this.retrieve("mouseover")){this.store("mouseover",false);clearTimeout(this.retrieve("timer"))}}},onload:function(l){var k=this.thumbnails;var t=k.getElements("a")[l];if(t){(function(r){var x=l==this.slide?"active":"inactive";if(r.store){r.store("loaded",true);var w=r.get("morph");w.set(this.classes.get("thumbnails","hidden"));w.start(this.classes.get("thumbnails",x))}}).delay(Math.max(1000/this.data.thumbnails.length,100),this,t)}if(k.retrieve("limit")){return}var p=k.retrieve("props");var v=this.options.thumbnails;var q=p?p[1]:"right";var j=p[2];var h=p[4];var u=k.getElement("li:nth-child("+(l+1)+")").getCoordinates();if(v.columns||v.rows){k.setStyles({height:this.height,width:this.width});if(v.columns.toInt()){k.setStyle("width",u.width*v.columns.toInt())}if(v.rows.toInt()){k.setStyle("height",u.height*v.rows.toInt())}}var g=k.getCoordinates();if(v.position){if(v.position.test(/bottom|top/)){k.setStyles({bottom:"auto",top:"auto"}).setStyle(v.position,-g.height)}if(v.position.test(/left|right/)){k.setStyles({left:"auto",right:"auto"}).setStyle(v.position,-g.width)}}var o=g[h]>=u[h]?Math.floor(g[h]/u[h]):1;var s=Math.ceil(this.data.images.length/o);var f=this.data.images.length%o;var m=s*u[j],n=k.getElement("ul").setStyle(j,m);n.getElements("li").setStyles({height:u.height,width:u.width});k.store("limit",g[j]-m)},scroll:function(h,l){var f=this.getCoordinates();var o=this.getElement("ul").getPosition();var q=this.retrieve("props");var j=q[3];var u;var r=q[0];var w=q[2];var s;var v=this.getElement("ul").set("tween",{property:r}).get("tween");if(h!=undefined){var m=this.retrieve("uid"),t=document.id(m+h).getCoordinates();u=f[r]+(f[w]/2)-(t[w]/2)-t[r];s=(o[j]-f[r]+u).limit(this.retrieve("limit"),0);v[l?"set":"start"](s)}else{var g=f[q[2]]/3,p=this.retrieve("page"),k=-(this.retrieve("delay")*0.01);if(p[j]<(f[r]+g)){u=(p[j]-f[r]-g)*k}else{if(p[j]>(f[r]+f[w]-g)){u=(p[j]-f[r]-f[w]+g)*k}}if(u){s=(o[j]-f[r]+u).limit(this.retrieve("limit"),0);v.set(s)}}},update:function(f){var h=this.thumbnails;var g=h.retrieve("uid");h.getElements("a").each(function(j,k){if(j.retrieve("loaded")){if(j.retrieve("uid")==this._slide){if(!j.retrieve("active",false)){j.store("active",true);var m=this.classes.get("thumbnails","active");if(f){j.get("morph").set(m)}else{j.morph(m)}}}else{if(j.retrieve("active",true)){j.store("active",false);var l=this.classes.get("thumbnails","inactive");if(f){j.get("morph").set(l)}else{j.morph(l)}}}}},this);if(!h.retrieve("mouseover")){h.fireEvent("scroll",[this._slide,f])}}})})();(function(){Slideshow.Flash=new Class({Extends:Slideshow,options:{color:["#FFF"]},initialize:function(b,c,a){a=a||{};a.overlap=true;if(a.color){a.color=Array.from(a.color)}this.parent(b,c,a)},_show:function(b){if(!this.image.retrieve("tween")){$$(this.a,this.b).set("tween",{duration:this.options.duration,link:"cancel",onStart:this._start.bind(this),onComplete:this._complete.bind(this),property:"opacity"})}if(b){this.image.get("tween").cancel().set(1)}else{this.el.retrieve("images").setStyle("background",this.options.color[this.slide%this.options.color.length]);var a=(this.counter%2)?this.a:this.b;a.get("tween").cancel().set(0);this.image.get("tween").set(0).start(1)}}})})();Slideshow.Fold=new Class({Extends:Slideshow,_show:function(b){if(!this.image.retrieve("tween")){var c=(this.options.overlap)?{duration:this.options.duration}:{duration:this.options.duration/2};$$(this.a,this.b).set("tween",Object.merge(c,{link:"chain",onStart:this._start.bind(this),onComplete:this._complete.bind(this),property:"clip",transition:this.options.transition}))}var a=(this.counter%2)?this.a:this.b,f=this._rect(this.image),g=Math.ceil(f.top+(f.bottom-f.top)/2);if(b){a.get("tween").cancel().set("rect(0, 0, 0, 0)");this.image.get("tween").cancel().set("rect(auto, auto, auto, auto)")}else{if(this.options.overlap){a.get("tween").set("rect(auto, auto, auto, auto)");this.image.get("tween").set(f.top+" "+f.left+" "+g+" "+f.left).start(f.top+" "+f.right+" "+g+" "+f.left).start(f.top+" "+f.right+" "+f.bottom+" "+f.left)}else{var d=function(h){this.image.get("tween").set(h.top+" "+h.left+" "+g+" "+h.left).start(h.top+" "+h.right+" "+g+" "+h.left).start(h.top+" "+h.right+" "+h.bottom+" "+h.left)}.pass(f,this);if(this.firstrun){return d()}f=this._rect(a);a.get("tween").set(f.top+" "+f.right+" "+f.bottom+" "+f.left).start(f.top+" "+f.right+" "+g+" "+f.left).start(f.top+" "+f.left+" "+g+" "+f.left).chain(d)}}},_rect:function(a){var b=a.getCoordinates(this.el.retrieve("images"));b.left=(b.left<0)?Math.abs(b.left):0;b.top=(b.top<0)?Math.abs(b.top):0;b.right=(b.right>this.width)?b.left+this.width:b.width;b.bottom=(b.bottom>this.height)?b.top+this.height:b.height;return b}});(function(){Slideshow.KenBurns=new Class({Extends:Slideshow,options:{pan:[100,100],zoom:[50,50]},initialize:function(b,c,a){a=a||{};a.overlap=true;a.resize="fill";["pan","zoom"].each(function(d){if(this[d]!=undefined){if(typeOf(this[d])!="array"){this[d]=[this[d],this[d]]}this[d].map(function(f){return(f.toInt()||0).limit(0,100)})}},a);this.parent(b,c,a)},_show:function(c){if(!this.image.retrieve("morph")){$$(this.a,this.b).set({tween:{duration:this.options.duration,link:"cancel",onStart:this._start.bind(this),onComplete:this._complete.bind(this),property:"opacity"},morph:{duration:(this.options.delay+this.options.duration*2),link:"cancel",transition:"linear"}})}this.image.set("styles",{bottom:"auto",left:"auto",right:"auto",top:"auto"});var f=["top left","top right","bottom left","bottom right"][this.counter%4].split(" ");this.image.setStyles([0,0].associate(f));var j=this.data.images[this._slide].replace(/([^?]+).*/,"$1"),b=this.cache[j];dh=this.height/b.height;dw=this.width/b.width;delta=(dw>dh)?dw:dh;var a={},g=(Number.random.apply(Number,this.options.zoom)/100)+1,h=Math.abs((Number.random.apply(Number,this.options.pan)/100)-1);["height","width"].each(function(n,k){var m=Math.ceil(b[n]*delta),l=(m*g).toInt();a[n]=[l,m];if(dw>dh||k){m=(this[n]-this.image[n]);l=(m*h).toInt();a[f[k]]=[l,m]}},this);var d=((this.firstrun&&this.options.paused)||this.paused);if(c||d){this._center(this.image);this.image.get("morph").cancel();if(d){this.image.get("tween").cancel().set(0).start(1)}else{this.image.get("tween").cancel().set(1)}}else{this.image.get("morph").start(a);this.image.get("tween").set(0).start(1)}}})})();Slideshow.Push=new Class({Extends:Slideshow,initialize:function(b,c,a){a=a||{};a.overlap=true;this.parent(b,c,a)},_show:function(c){var a=[this.image,((this.counter%2)?this.a:this.b)];if(!this.image.retrieve("fx")){this.image.store("fx",new Fx.Elements(a,{duration:this.options.duration,link:"cancel",onStart:this._start.bind(this),onComplete:this._complete.bind(this),transition:this.options.transition}))}this.image.set("styles",{left:"auto",right:"auto"}).setStyle(this.direction,this.width);var b={"0":{},"1":{}};b["0"][this.direction]=[this.width,0];b["1"][this.direction]=[0,-this.width];if(a[1].getStyle(this.direction)=="auto"){var d=this.width-a[1].width;a[1].set("styles",{left:"auto",right:"auto"}).setStyle(this.direction,d);b["1"][this.direction]=[d,-this.width]}if(c){for(var f in b){b[f][this.direction]=b[f][this.direction][1]}this.image.retrieve("fx").cancel().set(b)}else{this.image.retrieve("fx").start(b)}}});var DocumentElement=new Class({Implements:[Events,Options,TimeOutBehaviour],Binds:["associateEditor","authorization","checkTimeOut","createHtmlElement","constructPlugin","finalizeConstruction","injectHtmlElement","onPluginConstructed","onPluginError"],options:{componentName:"DocumentElement",defaultTag:"div",eventFireDelay:2,idPrefix:"Desktop-Element-",idSelector:"@id",isEditable:false,isEditableSelector:"@isEditable",pluginSelector:"plugin",referenceSelector:"@href",sourceSelector:"@source",styleSelector:"@elementStyle",tagSelector:"@tag"},initialize:function(c,a,b){assertThat(c,not(nil()));assertThat(a,not(nil()));this.setOptions(b);this.definitionElement=c;this.resourceUri=null;this.constructionChain=new Chain();this.contextElement;this.editable;this.editor;this.elementFactory;this.error=null;this.htmlElement;this.id;this.logger=WebUILogger?Class.getInstanceOf(WebUILogger):null;this.plugin;this.reference;this.resourceBundle=a;this.source;this.status=DocumentElement.States.INITIALIZED;this.style;this.tag;this.text;this.where},construct:function(a,b){if(this.status!=DocumentElement.States.UNMARSHALLED){throw new UnconfiguredDocumentElementException("destroy","initialized")}this.logger.trace(this.options.componentName+".construct() of '"+this.id+"'started.");assertThat(a,not(nil()));this.contextElement=a;this.where=b;this.elementFactory=new WidgetElementFactory(a,this.resourceBundle);this.startTimeOutTimer("construct");this.compileConstructionChain();this.constructionChain.callChain()},destroy:function(){if(this.status==DocumentElement.States.INITIALIZED){throw new UnconfiguredDocumentElementException("destroy","initialized")}if(this.plugin){this.plugin.destroy()}if(this.status==DocumentElement.States.CONSTRUCTED){this.deleteHtmlElement()}if(this.status<=DocumentElement.States.CONSTRUCTED){this.resetProperties()}if(this.editor){this.editor.detach()}this.error=null;this.status=DocumentElement.States.INITIALIZED},onPluginConstructed:function(){this.constructionChain.callChain()},onPluginError:function(a){this.error=a;this.revertConstruction()},unmarshall:function(){this.unmarshallProperties();this.unmarshallPlugin();this.status=DocumentElement.States.UNMARSHALLED},getDefinitionElement:function(){return this.definitionElement},getBind:function(){return this.bind},getEditor:function(){return this.editor},getHtmlElement:function(){return this.htmlElement},getId:function(){return this.id},getPlugin:function(){return this.plugin},getReference:function(){return this.reference},getResourceBundle:function(){return this.resourceBundle},getSource:function(){return this.source},getState:function(){return this.status},getStyle:function(){return this.style},getTag:function(){return this.tag},getText:function(){return this.text},getResourceType:function(){return this.options.type},getResourceUri:function(){return resourceUri},isEditable:function(){return this.editable?this.editable:this.options.isEditable},isSuccess:function(){return this.error==null},associateEditor:function(){if(this.isEditable()){this.editor=DocumentElementEditorFactory.create(this,{});this.editor.attach()}this.constructionChain.callChain()}.protect(),authorization:function(){this.editable=this.options.isEditable;this.constructionChain.callChain()}.protect(),compileConstructionChain:function(){this.constructionChain.chain(this.createHtmlElement,this.injectHtmlElement,this.constructPlugin,this.authorization,this.associateEditor,this.finalizeConstruction)}.protect(),constructPlugin:function(){if(this.plugin){this.plugin.construct()}else{this.constructionChain.callChain()}}.protect(),createAnchorIfNeeded:function(){if(this.reference){this.elementFactory.createAnchor(this.text,this.reference,null,this.htmlElement)}else{if(this.text){this.htmlElement.appendText(this.resourceBundle.getText(this.text))}}}.protect(),createHtmlElement:function(){if(this.tag){this.htmlElement=new Element(this.tag);if(this.id){this.htmlElement.set("id",this.id)}if(this.source){this.htmlElement.set("src",this.source)}if(this.style){this.htmlElement.addClass(this.style)}this.createAnchorIfNeeded()}this.constructionChain.callChain()}.protect(),deleteHtmlElement:function(){if(this.htmlElement){if(this.htmlElement.destroy){this.htmlElement.destroy()}this.htmlElement=null}}.protect(),definitionElementAttribute:function(a,b){var c=XmlResource.selectNode(a,this.definitionElement);if(c){return c.value}else{return b}}.protect(),finalizeConstruction:function(){this.stopTimeOutTimer();this.status=DocumentElement.States.CONSTRUCTED;this.constructionChain.clearChain();this.fireEvent("constructed",this,this.options.eventFireDelay)}.protect(),injectHtmlElement:function(){this.htmlElement.inject(this.contextElement,this.where);this.constructionChain.callChain()}.protect(),resetProperties:function(){this.id=null;this.htmlElement=null;this.reference=null;this.style=null;this.tag=null;this.text=null}.protect(),revertConstruction:function(){this.stopTimeOutTimer();this.constructionChain.clearChain();if(this.plugin){this.plugin.destroy()}this.deleteHtmlElement();this.status=DocumentElement.States.INITIALIZED;this.fireEvent("constructionError",this.error)}.protect(),timeOut:function(a){this.error=a;this.revertConstruction()}.protect(),unmarshallId:function(){this.id=this.definitionElementAttribute(this.options.idSelector);if(!this.id){this.id=this.options.idPrefix+(new Date().getTime())}if(this.dataElementsIndex>0){this.id+="#"+this.dataElementsIndex}}.protect(),unmarshallIsEditable:function(){this.options.isEditable=parseBoolean(XmlResource.selectNodeText(this.options.isEditableSelector,this.definitionElement,null,this.options.isEditable))}.protect(),unmarshallPlugin:function(){var a=XmlResource.selectNode(this.options.pluginSelector,this.definitionElement);if(a){this.plugin=new DocumentPlugin(a,this.resourceBundle,{onConstructed:this.onPluginConstructed,onConstructionError:this.onPluginError});this.plugin.unmarshall()}}.protect(),unmarshallProperties:function(){this.unmarshallId();this.unmarshallIsEditable();this.unmarshallReference();this.unmarshallSource();this.unmarshallStyle();this.unmarshallTag();this.unmarshallText()}.protect(),unmarshallReference:function(){this.reference=this.definitionElementAttribute(this.options.referenceSelector)}.protect(),unmarshallSource:function(){this.source=this.definitionElementAttribute(this.options.sourceSelector)}.protect(),unmarshallStyle:function(){this.style=this.definitionElementAttribute(this.options.styleSelector)}.protect(),unmarshallTag:function(){this.tag=this.definitionElementAttribute(this.options.tagSelector);if(!this.tag){this.tag=this.options.defaultTag}}.protect(),unmarshallText:function(){this.text=XmlResource.determineNodeText(this.definitionElement);if(this.resourceBundle&&this.text){this.text=this.resourceBundle.getText(this.text.trim())}if(!this.text){this.text=""}}});DocumentElement.States={INITIALIZED:0,UNMARSHALLED:1,CONSTRUCTED:2};var CompositeDocumentElement=new Class({Extends:DocumentElement,Binds:["constructNestedElements","onNestedElementConstructed","onNestedElementConstructionError"],options:{componentName:"CompositeDocumentElement",subElementsSelector:"compositeElement | element | compositeDataElement | dataElement | formElement | formField | tableElement",tagName:"div"},initialize:function(d,a,c,b){this.parent(d,a,b);this.dataXml=c;this.elements=new LinkedHashMap();this.nestedElementsConstructionChain=new Chain();this.nestedElementsContext;this.numberOfConstructedNestedElements=0},construct:function(a,b){this.parent(a,b)},destroy:function(){this.elements.each(function(b,a){var c=b.getValue();if(c.getState()>DocumentElement.States.INITIALIZED){c.destroy()}},this);this.numberOfConstructedNestedElements=0;this.parent()},onNestedElementConstructed:function(a){this.numberOfConstructedNestedElements++;this.nestedElementsConstructionChain.callChain()},onNestedElementConstructionError:function(a){this.error=a;this.revertConstruction();this.fireEvent("constructionError",this.error)},unmarshall:function(){this.parent();if(!this.tag){this.tag=this.options.tagName}this.unmarshallNestedElements()},getElement:function(a){return this.elements.get(a)},getElements:function(){return this.elements},addElement:function(a){this.elements.put(a.getId(),a)}.protect(),compileConstructionChain:function(){this.constructionChain.chain(this.createHtmlElement,this.injectHtmlElement,this.associateEditor,this.constructPlugin,this.constructNestedElements,this.authorization,this.finalizeConstruction)}.protect(),constructNestedElements:function(a){if(a){this.nestedElementsContext=a}else{this.nestedElementsContext=this.htmlElement}if(this.elements.size()>0){this.elements.each(function(c,b){var d=c.getValue();this.nestedElementsConstructionChain.chain(function(){d.construct(this.nestedElementsContext)}.bind(this))},this);this.nestedElementsConstructionChain.chain(function(){this.nestedElementsConstructionChain.clearChain();this.constructionChain.callChain()}.bind(this));this.nestedElementsConstructionChain.callChain()}else{this.constructionChain.callChain()}}.protect(),instantiateDocumentElement:function(b){var a={onConstructed:this.onNestedElementConstructed,onConstructionError:this.onNestedElementConstructionError};if(this.options.variables){a.variables=this.options.variables}return DocumentElementFactory.create(b,this.resourceBundle,this.dataXml,a)}.protect(),revertConstruction:function(){this.elements.each(function(b,a){var c=b.getValue();if(c.getState()>DocumentElement.States.INITIALIZED){c.destroy()}},this);this.elements.clear();this.numberOfConstructedNestedElements=0;this.parent()}.protect(),unmarshallNestedElement:function(c,b){var a=this.instantiateDocumentElement(c);a.unmarshall();this.addElement(a);return a}.protect(),unmarshallNestedElements:function(){var a=XmlResource.selectNodes(this.options.subElementsSelector,this.definitionElement);a.each(function(c,b){this.unmarshallNestedElement(c)},this)}.protect()});var DataElementBehaviour=new Class({options:{bindSelector:"@bind",hrefSelector:"/@href",eventFireDelay:2,indexVariable:"index",indexVariableSelector:"@indexVariable",maxOccuresSelector:"@maxOccures",minOccuresSelector:"@minOccures",overwriteElementReference:true,sourceSelector:"@source",variables:{index:"'*'"}},initialize:function(d,a,c,b){this.bind;this.bindedData;this.dataXml=c;this.dataElementsNumber;this.href;this.maxOccures;this.minOccures;this.numberOfConstructedSiblings=0;this.siblings;this.source},onSiblingConstructed:function(){this.numberOfConstructedSiblings++;if(this.numberOfConstructedSiblings==this.siblings.size()){this.constructionChain.callChain()}},onSiblingConstructionError:function(a){this.error=a;this.revertConstruction();this.fireEvent("constructionError",this.error,this.options.eventFireDelay)},unmarshallDataBehaviour:function(){this.unmarshallDataProperties();this.loadDataSource();this.determineDataElementsNumber();this.instantiateSiblings()},getBind:function(){return this.bind},getBindedData:function(){return this.bindedData},getDataElementsIndex:function(){return this.dataElementsIndex},getDataElementsNumber:function(){return this.dataElementsNumber},getDataXml:function(){return this.dataXml},getIndexVariable:function(){return this.options.indexVariable},getMaxOccures:function(){return this.maxOccures},getMinOccures:function(){return this.minOccures},getSiblings:function(){return this.siblings},getSource:function(){return this.source},checkIfBindVariableNeeded:function(){if(this.maxOccures){if((this.maxOccures=="unbounded"||this.maxOccures>0)&&(this.bind.search("{.*}")==-1)){throw new MissingBindVariableException(this.id)}}}.protect(),constructSiblings:function(){if(this.siblings.size()>0){this.numberOfConstructedSiblings=0;this.siblings.each(function(a,b){a.construct(this.contextElement,this.where)},this)}else{this.constructionChain.callChain()}}.protect(),determineDataElementsNumber:function(){var a=this.bind.substitute(this.options.variables);this.bindedData=this.dataXml.selectNodes(a);if(this.maxOccures=="unbounded"&&this.bindedData.length>1){this.dataElementsNumber=this.bindedData.length}if(this.maxOccures>1&&this.maxOccures<this.bindedData.length){this.dataElementsNumber=this.maxOccures}}.protect(),destroySiblings:function(){this.siblings.each(function(a,b){a.destroy()},this);this.numberOfConstructedSiblings=0}.protect(),initializeBindVariables:function(){if(!this.options.variables[this.options.indexVariable]){this.options.variables[this.options.indexVariable]="'*'"}}.protect(),instantiateSiblings:function(){for(var b=2;b<=this.dataElementsNumber;b++){var c=this.options.variables;c[this.options.indexVariable]=b;var a=DocumentElementFactory.create(this.definitionElement,this.resourceBundle,this.dataXml,{onConstructed:this.onSiblingConstructed,onConstructionError:this.onSiblingConstructionError,variables:c});a.unmarshall();this.siblings.add(a)}if(this.dataElementsNumber>1){this.options.variables[this.options.indexVariable]=1}}.protect(),loadDataSource:function(){if(this.source){this.dataXml=new XmlResource(this.source)}}.protect(),resetProperties:function(){this.bind=null;this.maxOccures=null;this.minOccures=null;this.source=null}.protect(),retrieveData:function(){if(this.bind&&this.dataXml){var b=this.bind.substitute(this.options.variables);var a=null;if(instanceOf(this.dataXml,XmlResource)){this.text=this.dataXml.selectNodeText(b);a=this.dataXml.selectNodeText(b+this.options.hrefSelector)}else{if(typeOf(this.dataXml)=="element"){if(b.indexOf("/")<0){this.text=XmlResource.determineNodeText(this.dataXml);a=XmlResource.selectNodeText("@href",this.dataXml)}else{this.text=XmlResource.selectNodeText(b,this.dataXml);a=XmlResource.selectNodeText(b+this.options.hrefSelector,this.dataXml)}}}if(this.text){this.text.trim()}if(a&&this.options.overwriteElementReference){this.reference=a}}this.constructionChain.callChain()}.protect(),unmarshallDataProperties:function(){this.bind=this.definitionElementAttribute(this.options.bindSelector);this.options.indexVariable=this.definitionElementAttribute(this.options.indexVariableSelector,this.options.indexVariable);this.maxOccures=this.definitionElementAttribute(this.options.maxOccuresSelector);this.minOccures=this.definitionElementAttribute(this.options.minOccuresSelector);this.source=this.definitionElementAttribute(this.options.sourceSelector);this.checkIfBindVariableNeeded();this.initializeBindVariables()}});var CompositeDataElement=new Class({Extends:CompositeDocumentElement,Binds:["constructSiblings","finalizeConstruction","onSiblingConstructed","onSiblingConstructionError","retrieveData"],Implements:DataElementBehaviour,options:{componentName:"CompositeDataElement"},initialize:function(d,a,c,b){this.parent(d,a,c,b);this.contextElement;this.bind;this.dataElementsNumber=1;this.maxOccures;this.minOccures;this.siblings=new ArrayList();this.source;this.where},construct:function(a,b){this.contextElement=a;this.where=b;this.parent(a,b)},destroy:function(){this.destroySiblings();this.parent()},unmarshall:function(){this.unmarshallDataBehaviour();this.parent()},compileConstructionChain:function(){this.constructionChain.chain(this.retrieveData,this.createHtmlElement,this.injectHtmlElement,this.associateEditor,this.constructPlugin,this.constructNestedElements,this.authorization,this.constructSiblings,this.finalizeConstruction)}.protect()});var DataElement=new Class({Extends:DocumentElement,Binds:["constructSiblings","finalizeConstruction","onSiblingConstructed","onSiblingConstructionError","retrieveData"],Implements:DataElementBehaviour,options:{componentName:"DataElement",isEditable:true,},initialize:function(d,a,c,b){this.parent(d,a,b);this.setUp(c)},construct:function(a,b){this.parent(a,b)},destroy:function(){this.destroySiblings();this.parent();this.numberOfConstructedSiblings=0},unmarshall:function(){this.unmarshallDataBehaviour();this.parent()},compileConstructionChain:function(){this.constructionChain.chain(this.retrieveData,this.createHtmlElement,this.injectHtmlElement,this.constructPlugin,this.authorization,this.associateEditor,this.constructSiblings,this.finalizeConstruction)}.protect(),injectHtmlElement:function(){this.htmlElement.addClass(DataElement.CLASS);this.parent()}.protect(),setUp:function(a){this.dataXml=a;this.numberOfConstructedSiblings=0;this.siblings=new ArrayList()}.protect(),});DataElement.CLASS="dataElement";var DocumentElementEditor=new Class({Implements:[Events,Options],Binds:["onBlur","onClick"],options:{dataType:"string",inputStyle:{background:"transparent",border:"none",width:"20em"},mininmumWidth:"400",restriction:null,styleProperties:["color","display","font-family","font-size","font-weight","line-height","margin","height","padding","position","text-align","width"],},initialize:function(b,a){this.setOptions(a);assertThat(b,not(nil()));this.inputElement;this.previousValue;this.state=DocumentElementEditor.States.DETACHED;this.subjectHtmlElement=b;this.text},attach:function(){if(this.state==DocumentElementEditor.States.DETACHED){this.subjectHtmlElement.addEvent("focus",this.onClick);this.subjectHtmlElement.addEvent("click",this.onClick);this.state=DocumentElementEditor.States.ATTACHED}},detach:function(){if(this.state==DocumentElementEditor.States.EDITING||this.state==DocumentElementEditor.States.ATTACHED){if(this.inputElement){this.removeInputElement()}this.state=DocumentElementEditor.States.DETACHED}},onBlur:function(){if(this.state==DocumentElementEditor.States.EDITING){this.removeInputElement();this.state=DocumentElementEditor.States.ATTACHED;this.fireEvent("editEnd",this)}},onClick:function(){if(this.state==DocumentElementEditor.States.ATTACHED){this.saveCurrentValue();this.injectInputElement();this.state=DocumentElementEditor.States.EDITING;this.fireEvent("editStart",this)}},onKeypress:function(){},getInputElement:function(){return this.inputElement},getPreviousValue:function(){return this.previousValue},getState:function(){return this.state},getSubjectElement:function(){return this.subjectHtmlElement},getText:function(){return this.text},isChanged:function(){return !(this.text&&this.text.equals(this.previousValue))},injectInputElement:function(){var a=this.subjectHtmlElement.getStyles(this.options.styleProperties);this.subjectHtmlElement.setStyle("display","none");this.inputElement=new Element("input",{events:{blur:this.onBlur},name:this.subjectHtmlElement.get("id"),type:"text",value:this.text,styles:this.options.inputStyle});this.inputElement.setStyles(a);if(this.inputElement.getStyle("width").toInt()<this.options.minimumWidth){this.inputElement.setStyle("width",this.options.minimumWidth)}this.inputElement.inject(this.subjectHtmlElement,"after")}.protect(),removeInputElement:function(){this.text=this.inputElement.get("value");this.inputElement.removeEvents();this.inputElement.destroy();this.subjectHtmlElement.removeEvent("focus",this.onClick);this.subjectHtmlElement.removeEvent("click",this.onClick);this.subjectHtmlElement.set("text",this.text);this.subjectHtmlElement.setStyle("display","inline")}.protect(),saveCurrentValue:function(){this.text=this.subjectHtmlElement.get("text");this.previousValue=this.text}});DocumentElementEditor.DataType={BOOLEAN:"boolean",INTEGER:"integer",LONG_INTEGER:"longInteger",STRING:"string",TEXT:"text",TIME_POINT:"timePoint"};DocumentElementEditor.DataType.TIME_POINT.Precission={YEAR:"year",MONTH:"month",DAY:"day",HOUR:"hour",MINUTE:"minute",SECOND:"second",MILLI_SECOND:"milliSecond"};DocumentElementEditor.States={DETACHED:"detached",ATTACHED:"attached",EDITING:"editing"};var DataElementEditor=new Class({Extends:DocumentElementEditor,options:{},initialize:function(b,a){this.parent(b,a)}});var DocumentBody=new Class({Extends:CompositeDocumentElement,options:{componentName:"DocumentBody"},initialize:function(b,a,d,c){this.parent(b,a,d,c)},construct:function(a,b){this.parent(a,b)},constructed:function(){this.parent()},unmarshall:function(){this.parent()}});var DocumentElementEditorFactory=new Class({Implements:Options,options:{},initialize:function(){},create:function(d,b){var c=d.getHtmlElement();var a=null;switch(d.options.componentName){case"CompositeDataElement":case"FormField":a=new DataElementEditor(d.getValueElement(),b);break;case"DataElement":a=new DataElementEditor(c,b);break;case"CompositeDocumentElement":case"DocumentElement":a=new DocumentElementEditor(c,b);break;case"TableBody":case"TableCell":case"TableElement":case"TableHeader":case"TableRow":a=new TableElementEditor(c,b);break}return a}});DocumentElementEditorFactory.create=function(c,b){var a=new DocumentElementEditorFactory();var d=a.create(c,b);return d};var DocumentElementFactory=new Class({Implements:Options,options:{},initialize:function(){},create:function(d,a,c,b){var f;switch(d.tagName.toUpperCase()){case"COMPOSITEDATAELEMENT":f=new CompositeDataElement(d,a,c,b);break;case"COMPOSITEELEMENT":f=new CompositeDocumentElement(d,a,c,b);break;case"DATAELEMENT":f=new DataElement(d,a,c,b);break;case"DOCUMENTBODY":f=new DocumentBody(d,a,c,b);break;case"DOCUMENTFOOTER":f=new DocumentFooter(d,a,c,b);break;case"DOCUMENTHEADER":f=new DocumentHeader(d,a,c,b);break;case"FORMELEMENT":f=new FormElement(d,a,c,b);break;case"FORMFIELD":f=new FormField(d,a,c,b);break;case"TABLEELEMENT":f=new TableElement(d,a,c,b);break;case"TABLECOLUMN":f=new TableColumn(d,a,c,b);break;case"ELEMENT":default:f=new DocumentElement(d,a,b);break}return f}});DocumentElementFactory.create=function(g,a,f,c){var b=new DocumentElementFactory();var d=b.create(g,a,f,c);return d};var DocumentFooter=new Class({Extends:CompositeDocumentElement,options:{componentName:"DocumentFooter"},initialize:function(b,a,d,c){this.parent(b,a,d,c)},construct:function(a,b){this.parent(a,b)},unmarshall:function(){this.parent()}});var DocumentHeader=new Class({Extends:CompositeDocumentElement,options:{componentName:"DocumentHeader"},initialize:function(b,a,d,c){this.parent(b,a,d,c)},construct:function(a,b){this.parent(a,b)},unmarshall:function(){this.parent()}});var DocumentPlugin=new Class({Implements:[Events,Options],Binds:["finalizeConstruction","instantiateWidget","loadResources","onResourceError","onResourcesLoaded","onWidgetConstructed","onWidgetError"],options:{componentName:"DocumentPlugin",nameSelector:"@name",optionsSelector:"widget/options",resourcesSelector:"resources",widgetNameSelector:"widget/@name"},initialize:function(b,c,a){this.setOptions(a);this.constructChain=new Chain();this.definitionElement=b;this.error=null;this.internationalization=c;this.logger=Class.getInstanceOf(WebUILogger);this.name;this.onLoad;this.resources;this.state=DocumentPlugin.States.INITIALIZED;this.widget;this.widgetName;this.widgetOptions;this.constructChain.chain(this.loadResources,this.instantiateWidget,this.finalizeConstruction)},construct:function(){this.logger.trace(this.options.componentName+".construct() of '"+this.name+"' started.");this.constructChain.callChain()},destroy:function(){if(this.resources){this.resources.release()}if(this.widget&&this.widget.destroy&&typeOf(this.widget.destroy)=="function"){this.widget.destroy()}this.state=DocumentPlugin.States.INITIALIZED},loadResources:function(){if(this.resources){this.resources.load()}else{this.constructChain.callChain()}},onResourceError:function(a){this.error=a},onResourcesLoaded:function(){if(this.resources.isSuccess()){this.state=DocumentPlugin.States.LOADED;this.fireEvent("resourcesLoaded",this);this.constructChain.callChain()}else{this.constructChain.clearChain();this.resources.release();this.fireEvent("constructionError",this.error)}},onWidgetConstructed:function(){this.constructChain.callChain()},onWidgetError:function(a){this.error=a;this.constructChain.clearChain();this.fireEvent("constructionError",this.error)},unmarshall:function(){this.unmarshallProperties();this.unmarshallResources();this.unmarshallWidget();this.state=DocumentPlugin.States.UNMARSHALLED},getDefinitionElement:function(){return this.definitionElement},getError:function(){return this.error},getOnLoad:function(){return this.onLoad},getResources:function(){return this.resources},getState:function(){return this.state},getWidget:function(){return this.widget},getWidgetName:function(){return this.widgetName},getWidgetOptions:function(){return this.widgetOptions},isSuccess:function(){return this.error==null},finalizeConstruction:function(){this.constructChain.clearChain();this.state=DocumentPlugin.States.CONSTRUCTED;this.fireEvent("constructed",this)}.protect(),instantiateWidget:function(){if(this.widgetName){try{var widgetClass=eval(this.widgetName);var mergedOptions=Object.merge(this.widgetOptions,{onConstructed:this.onWidgetConstructed,onError:this.onWidgetError});this.widget=new widgetClass(mergedOptions,this.internationalization);this.widget.unmarshall();this.widget.construct()}catch(exception){this.onWidgetError(exception)}}else{this.onWidgetConstructed()}}.protect(),unmarshallOptions:function(){var a=XmlResource.selectNode(this.options.optionsSelector,this.definitionElement);if(a){var b=new OptionsResource(a);b.unmarshall();this.widgetOptions=b.getOptions()}}.protect(),unmarshallProperties:function(){this.name=XmlResource.selectNodeText(this.options.nameSelector,this.definitionElement)}.protect(),unmarshallResources:function(){var a=XmlResource.selectNode(this.options.resourcesSelector,this.definitionElement);if(a){this.resources=new ResourceManager(a,{onResourcesLoaded:this.onResourcesLoaded,onResourceError:this.onResourceError});this.resources.unmarshall()}}.protect(),unmarshallWidget:function(){this.widgetName=XmlResource.selectNodeText(this.options.widgetNameSelector,this.definitionElement);this.unmarshallOptions()}});DocumentPlugin.States={INITIALIZED:0,UNMARSHALLED:1,LOADED:2,CONSTRUCTED:3};var FormElement=new Class({Extends:CompositeDataElement,options:{componentName:"FormElement",methodSelector:"method"},initialize:function(d,a,c,b){this.parent(d,a,c,b);this.controlsContainerElement;this.fieldsContainerElement;this.method},construct:function(a,b){this.parent(a,b)},destroy:function(){this.parent()},unmarshall:function(a){this.parent()},getMethod:function(){return this.method},constructNestedElements:function(){this.parent(this.fieldsContainerElement)}.protect(),createHtmlElement:function(){this.htmlElement=this.elementFactory.createForm(this.id,this.method,this.contextElement,WidgetElementFactory.Positions.LastChild);this.controlsContainerElement=this.htmlElement.getChildren()[1];this.fieldsContainerElement=this.htmlElement.getChildren()[0];this.constructionChain.callChain()}.protect(),unmarshallProperties:function(){this.method=this.resourceBundle.getText(XmlResource.determineAttributeValue(this.definitionElement,this.options.methodSelector));this.parent()}});var FormField=new Class({Extends:DataElement,options:{componentName:"FormField",labelSelector:"label"},initialize:function(d,a,c,b){this.parent(d,a,c,b);this.elementFactory;this.label;this.labelElement;this.valueElement},construct:function(a,b){this.parent(a,b)},destroy:function(){this.parent()},unmarshall:function(){this.parent()},getElementFactory:function(){return this.elementFactory},getLabel:function(){return this.label},getLabelElement:function(){return this.labelElement},getValueElement:function(){return this.valueElement},associateEditor:function(){if(this.isEditable()){this.editor=DocumentElementEditorFactory.create(this,{});this.editor.attach()}this.constructionChain.callChain()}.protect(),createHtmlElement:function(){this.htmlElement=this.elementFactory.createStaticRow(this.label,this.text,this.id,this.contextElement,WidgetElementFactory.Positions.LastChild,this.reference);this.labelElement=this.htmlElement.getChildren("label")[0];this.valueElement=this.htmlElement.getChildren("span")[0];this.constructionChain.callChain()},unmarshallProperties:function(){this.label=this.resourceBundle.getText(XmlResource.determineAttributeValue(this.definitionElement,this.options.labelSelector));this.parent()}});var ImageElement=new Class({Extends:DocumentElement,options:{componentName:"ImageElement",},initialize:function(c,a,b){this.parent(c,a,b)},construct:function(a,b){this.tag="IMG";this.parent(a,b)},destroy:function(){this.parent()},unmarshall:function(){this.parent()},});var ImageLensBehaviour=new Class({Implements:[Options],options:{borderColor:"#888",borderSize:4,componentName:"ImageLensBehaviour",lensSize:100},initialize:function(a){this.setOptions(a);this.lensStyle},construct:function(){this.defineLensStyle();this.createLensElement();this.calculateActualImageSize()},destroy:function(){},setPosition:function(c){var b=parseInt(e.pageX-offset.left);var a=parseInt(e.pageY-offset.top);if(b<0||a<0||b>obj.width()||a>obj.height()){target.hide()}else{target.show();b=String(((e.pageX-offset.left)*widthRatio-target.width()/2)*(-1));a=String(((e.pageY-offset.top)*heightRatio-target.height()/2)*(-1));target.css({backgroundPosition:b+"px "+a+"px"});b=String(e.pageX-target.width()/2);a=String(e.pageY-target.height()/2);target.css({left:b+"px",top:a+"px"})}},unmarshall:function(){},calculateActualImageSize:function(){var d=options.imageSrc?options.imageSrc:$(this).attr("src");var a="<img style='display:none;' src='"+d+"' />";var c=0;var b=0;$(a).load(function(){c=$(this).width()/obj.width();b=$(this).height()/obj.height()}).appendTo($(this).parent());target.css({backgroundImage:"url('"+d+"')"});target.mousemove(setPosition);$(this).mousemove(setPosition)}.protect(),createLensElement:function(){this.target=$("<div style='"+this.lensStyle+"' class='"+options.lensCss+"'>&nbsp;</div>").appendTo($(this).parent());this.targetSize=this.target.size()}.protect(),defineLensStyle:function(){this.lensStyle="background-position: 0px 0px;width: "+String(options.lensSize)+"px;height: "+String(options.lensSize)+"px;float: left;display: none;border-radius: "+String(options.lensSize/2+options.borderSize)+"px;border: "+String(options.borderSize)+"px solid "+options.borderColor+";background-repeat: no-repeat;position: absolute;"}.protect()});var MissingBindVariableException=new Class({Extends:WebUIException,options:{description:"Data element's: '{dataElementId}' 'bind' property doesn't contains any variables.",name:"MissingBindVariableException"},initialize:function(a,b){this.setOptions(b);this.parent(b);this.parameters={dataElementId:a}}});var SmartDocument=new Class({Extends:AbstractDocument,Binds:["constructBody","constructFooter","constructHeader","destroyHeaderBodyAndFooter","determineContainerElement","loadResources","onBodyConstructed","onConstructionError","onFooterConstructed","onHeaderConstructed","onResourceError","onResourcesLoaded"],options:{componentName:"SmartDocument",bodySelector:"documentBody",footerSelector:"documentFooter",headerSelector:"documentHeader",rootElementName:"/smartDocumentDefinition"},initialize:function(b,a){this.parent(b,a);this.documentBody=null;this.documentFooter=null;this.documentHeader=null},construct:function(){this.parent()},destroy:function(){this.parent()},onBodyConstructed:function(){this.constructionChain.callChain()},onFooterConstructed:function(){this.constructionChain.callChain()},onHeaderConstructed:function(){this.constructionChain.callChain()},unmarshall:function(){var a={onConstructed:this.onHeaderConstructed,onConstructionError:this.onConstructionError};if(this.options.documentVariables){a.variables=this.options.documentVariables}this.documentHeader=this.unmarshallDocumentComponent(this.options.rootElementName+"/"+this.options.headerSelector,a);this.documentBody=this.unmarshallDocumentComponent(this.options.rootElementName+"/"+this.options.bodySelector,a);this.documentFooter=this.unmarshallDocumentComponent(this.options.rootElementName+"/"+this.options.footerSelector,a);this.parent()},getBody:function(){return this.documentBody},getFooter:function(){return this.documentFooter},getHeader:function(){return this.documentHeader},compileConstructionChain:function(){this.constructionChain.chain(this.determineContainerElement,this.loadResources,this.constructHeader,this.constructBody,this.constructFooter,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyHeaderBodyAndFooter,this.releseResource,this.detachEditor,this.resetProperties,this.finalizeDestruction)}.protect(),constructBody:function(){if(this.documentBody){this.documentBody.construct(this.containerElement,"bottom")}else{this.constructionChain.callChain()}}.protect(),constructFooter:function(){if(this.documentFooter){this.documentFooter.construct(this.containerElement,"bottom")}else{this.constructionChain.callChain()}}.protect(),constructHeader:function(){if(this.documentHeader){this.documentHeader.construct(this.containerElement,"bottom")}else{this.constructionChain.callChain()}}.protect(),destroyHeaderBodyAndFooter:function(){if(this.documentHeader){this.documentHeader.destroy()}if(this.documentBody){this.documentBody.destroy()}if(this.documentFooter){this.documentFooter.destroy()}this.destructionChain.callChain()}.protect(),resetProperties:function(){this.documentHeader=null;this.documentBody=null;this.documentFooter=null;this.parent()}.protect(),revertConstruction:function(){if(this.resources){this.resources.release()}if(this.documentHeader){this.documentHeader.destroy()}if(this.documentBody){this.documentBody.destroy()}if(this.documentFooter){this.documentFooter.destroy()}this.parent()}.protect(),unmarshallDocumentComponent:function(a,b){var d=null;var c=this.documentDefinition.selectNode(a);if(c){d=DocumentElementFactory.create(c,this.i18Resource,this.documentContent,b)}if(d){d.unmarshall()}return d}.protect()});var TableBody=new Class({Extends:DocumentElement,Binds:["createRowElement","constructRows","onRowConstructed","onRowConstructionError"],options:{componentName:"TableBody",},initialize:function(f,a,c,d,b){this.parent(f,a,b);this.columnHeaders=d;this.dataSet=c;this.rowsConstructionChain=new Chain();this.rows=new ArrayList()},construct:function(a,b){this.tag="TBODY";this.parent(a,b)},destroy:function(){this.parent()},onRowConstructed:function(a){this.rowsConstructionChain.callChain()},onRowConstructionError:function(a){this.error=a;this.revertConstruction()},unmarshall:function(){this.unmarshallRows();this.parent()},getRows:function(){return this.rows},compileConstructionChain:function(){this.constructionChain.chain(this.createHtmlElement,this.injectHtmlElement,this.constructPlugin,this.authorization,this.associateEditor,this.constructRows,this.finalizeConstruction)}.protect(),constructRows:function(){this.rows.each(function(b,a){this.rowsConstructionChain.chain(function(){b.construct(this.htmlElement)}.bind(this))}.bind(this));this.rowsConstructionChain.chain(function(){this.rowsConstructionChain.clearChain();this.constructionChain.callChain()}.bind(this));this.rowsConstructionChain.callChain()}.protect(),deleteHtmlElement:function(){this.destroyRows();this.parent()}.protect(),destroyRows:function(){this.rows.each(function(b,a){b.destroy()}.bind(this))}.protect(),unmarshallRows:function(){this.dataSet.each(function(b,a){var c=new TableRow(this.definitionElement,this.resourceBundle,this.dataSet[a],this.columnHeaders,{isEditable:this.isEditable(),onConstructed:this.onRowConstructed,onConstructionError:this.onRowConstructionError});c.unmarshall();this.rows.add(c)},this)}.protect(),});var TableCell=new Class({Extends:DataElement,options:{componentName:"TableCell",},initialize:function(d,a,c,b){this.parent(d,a,c,b)},construct:function(a,b){this.tag="TD";this.text=this.label;this.parent(a,b)},destroy:function(){this.parent()},unmarshall:function(){this.parent()},});var TableColumnHeader=new Class({Extends:DocumentElement,options:{bindSelector:"@bind",componentName:"TableColumnHeader",labelSelector:"@label"},initialize:function(c,a,b){this.parent(c,a,b);this.bind;this.label},construct:function(a,b){this.tag="TH";this.text=this.label;this.parent(a,b)},destroy:function(){this.parent()},selectDataDefinition:function(a){return XmlResource.selectNode(this.bind,a)},unmarshall:function(){this.unmarshallBind();this.unmarshallLabel();this.parent()},getBind:function(){return this.bind},getLabel:function(){return this.label},unmarshallBind:function(){this.bind=XmlResource.selectNodeText(this.options.bindSelector,this.definitionElement)}.protect(),unmarshallLabel:function(){this.label=XmlResource.selectNodeText(this.options.labelSelector,this.definitionElement)}});var TableElement=new Class({Extends:CompositeDataElement,Binds:["constructBody","constructHeader","createTableElement","onBodyConstructed","onBodyConstructionError","onHeaderConstructed","onHeaderConstructionError"],options:{componentName:"TableElement",editableClass:"editableContainer",readOnlyClass:"readOnlyContainer"},initialize:function(d,a,c,b){this.parent(d,a,c,b);this.body;this.header;this.maxRowCount;this.tableElement},construct:function(a,b){this.parent(a,b)},destroy:function(){this.parent()},onBodyConstructed:function(a){this.constructionChain.callChain()},onBodyConstructionError:function(a){this.error=a;this.revertConstruction()},onHeaderConstructed:function(a){this.constructionChain.callChain()},onHeaderConstructionError:function(a){this.error=a;this.revertConstruction()},unmarshall:function(){this.parent()},getBody:function(){return this.body},getContainerClass:function(){return this.isEditable()?this.options.editableClass:this.options.readOnlyClass},getHeader:function(){return this.header},getMaxRowCount:function(){return this.maxRowCount},compileConstructionChain:function(){this.constructionChain.chain(this.createHtmlElement,this.createTableElement,this.injectHtmlElement,this.associateEditor,this.constructPlugin,this.constructNestedElements,this.authorization,this.constructHeader,this.constructBody,this.finalizeConstruction)}.protect(),constructBody:function(){this.body.construct(this.tableElement,"bottom")}.protect(),constructHeader:function(){this.header.construct(this.tableElement,"bottom")}.protect(),createHtmlElement:function(){this.tag="div";this.style=this.getContainerClass();this.parent()}.protect(),createTableElement:function(){this.tableElement=this.elementFactory.create("table",null,this.htmlElement,WidgetElementFactory.Positions.LastChild,{id:this.id});this.constructionChain.callChain()}.protect(),unmarshallBody:function(){this.body=new TableBody(this.definitionElement,this.resourceBundle,this.bindedData,this.header.getColumnHeaders(),{isEditable:this.isEditable(),onConstructed:this.onBodyConstructed,onConstructionError:this.onBodyConstructionError});this.body.unmarshall()}.protect(),unmarshallDataBehaviour:function(){this.unmarshallDataProperties();this.loadDataSource();this.determineDataElementsNumber();this.unmarshallHeader();this.unmarshallBody()}.protect(),unmarshallHeader:function(){this.header=new TableHeader(this.definitionElement,this.resourceBundle,{onConstructed:this.onHeaderConstructed,onConstructionError:this.onHeaderConstructionError});this.header.unmarshall()}.protect()});var TableElementEditor=new Class({Extends:DocumentElementEditor,options:{},initialize:function(b,a){this.parent(b,a)}});var TableHeader=new Class({Extends:DocumentElement,Binds:["createHeaderRowElement","constructColumnHeaders","onColumnHeaderConstructed","onColumnHeaderConstructionError"],options:{componentName:"TableHeader",tableColumnsSelector:"tableColumn"},initialize:function(c,a,b){this.parent(c,a,b);this.columnHeaderConstructionChain=new Chain();this.columnHeaders=new ArrayList();this.headerRowElement},construct:function(a,b){this.tag="THEAD";this.parent(a,b)},destroy:function(){this.parent()},onColumnHeaderConstructed:function(a){this.columnHeaderConstructionChain.callChain()},onColumnHeaderConstructionError:function(a){this.error=a;this.revertConstruction()},unmarshall:function(){this.unmarshallColumnHeaders();this.parent()},getColumnHeaders:function(){return this.columnHeaders},compileConstructionChain:function(){this.constructionChain.chain(this.createHtmlElement,this.createHeaderRowElement,this.injectHtmlElement,this.constructPlugin,this.authorization,this.associateEditor,this.constructColumnHeaders,this.finalizeConstruction)}.protect(),constructColumnHeaders:function(){this.columnHeaders.each(function(b,a){this.columnHeaderConstructionChain.chain(function(){b.construct(this.headerRowElement)}.bind(this))}.bind(this));this.columnHeaderConstructionChain.chain(function(){this.columnHeaderConstructionChain.clearChain();this.constructionChain.callChain()}.bind(this));this.columnHeaderConstructionChain.callChain()}.protect(),createHeaderRowElement:function(){this.headerRowElement=this.elementFactory.create("tr",null,this.htmlElement,WidgetElementFactory.Positions.LastChild);this.constructionChain.callChain()}.protect(),deleteHtmlElement:function(){this.headerRowElement.removeEvents();this.headerRowElement.destroy();this.parent()}.protect(),unmarshallColumnHeaders:function(){var c=XmlResource.selectNodes(this.options.tableColumnsSelector,this.definitionElement);for(var a=0;a<c.length;a++){var b=new TableColumnHeader(c[a],this.resourceBundle,{onConstructed:this.onColumnHeaderConstructed,onConstructionError:this.onColumnHeaderConstructionError});b.unmarshall();this.columnHeaders.add(b)}}.protect(),});var TableRow=new Class({Extends:DocumentElement,Binds:["createTableRowElement","constructTableCells","onTableCellConstructed","onTableCellConstructionError"],options:{componentName:"TableRow",tableColumnsSelector:"tableColumn"},initialize:function(f,a,d,c,b){this.parent(f,a,b);this.columnHeaders=c;this.rowData=d;this.tableCellsConstructionChain=new Chain();this.tableCells=new ArrayList();this.tableRowElement},construct:function(a,b){this.tag="TR";this.parent(a,b)},destroy:function(){this.parent()},onTableCellConstructed:function(){this.tableCellsConstructionChain.callChain()},onTableCellConstructionError:function(a){this.error=a;this.revertConstruction()},unmarshall:function(){this.unmarshallTableCells();this.parent()},getTableCells:function(){return this.tableCells},compileConstructionChain:function(){this.constructionChain.chain(this.createHtmlElement,this.injectHtmlElement,this.constructPlugin,this.authorization,this.associateEditor,this.constructTableCells,this.finalizeConstruction)}.protect(),constructTableCells:function(){this.tableCells.each(function(b,a){this.tableCellsConstructionChain.chain(function(){b.construct(this.htmlElement)}.bind(this))}.bind(this));this.tableCellsConstructionChain.chain(function(){this.tableCellsConstructionChain.clearChain();this.constructionChain.callChain()}.bind(this));this.tableCellsConstructionChain.callChain()}.protect(),deleteHtmlElement:function(){this.parent()}.protect(),unmarshallTableCells:function(){this.columnHeaders.each(function(b,a){var c=b.selectDataDefinition(this.rowData);var d=new TableCell(b.getDefinitionElement(),this.resourceBundle,c,{isEditable:this.isEditable(),onConstructed:this.onTableCellConstructed,onConstructionError:this.onTableCellConstructionError});d.unmarshall();this.tableCells.add(d)},this)}.protect(),});var UnconfiguredDocumentElementException=new Class({Extends:WebUIException,options:{description:"When calling method: '{methodName}' of a DocumentElement it should be in: '{statusName}' .",name:"UnconfiguredDocumentElementException"},initialize:function(b,a,c){this.setOptions(c);this.parent(c);this.parameters={methodName:b,statusName:a}}});var SplashForm=new Class({Implements:[Events,Options],Binds:["constructForm","constructImageWrapper","constructStatusDisplay","determineBrowserLanguage","determineStatusText","finalizeConstruction","onImageLoaded","onImageLoadError","positionForm","preloadImage"],options:{componentName:"SplashForm",containerClass:"splashForm",containerElementId:"splashForm",imageId:"splashFormImage",imageTitle:"Splashform Image",imageUri:"Desktops/Images/SplashForm.png",statusDisplayClass:"statusDisplay",statusDisplayStyles:{color:"black",height:"30px",width:"100%",paddingLeft:"10px"}},initialize:function(a){this.setOptions(a);this.browserLanguage;this.constructionChain=new Chain();this.containerElement=$(this.options.containerElementId);this.imageElement;this.imageWrapperElement;this.splashFormElement;this.statusDisplayElement;this.statusText},construct:function(){this.constructionChain.chain(this.preloadImage,this.determineBrowserLanguage,this.determineStatusText,this.constructForm,this.constructImageWrapper,this.constructStatusDisplay,this.positionForm,this.finalizeConstruction);this.constructionChain.callChain()},destroy:function(){this.destroyElement(this.imageElement);this.destroyElement(this.splashFormElement)},onImageLoaded:function(){this.constructionChain.callChain()},onImageLoadError:function(a){this.error=a;this.fireEvent("error",a);this.destroy()},updateStatus:function(a){this.statusDisplayElement.set("text",this.statusText+a)},getBrowserLanguage:function(){return this.browserLanguage.getLanguage()},getContainerElement:function(){return this.containerElement},getImageElement:function(){return this.imageElement},getSplashFormElement:function(){return this.splashFormElement},getStatusText:function(){return this.statusText},constructForm:function(){this.splashFormElement=new Element("div",{id:"splashForm","class":this.options.containerClass,styles:{left:"50%",position:"absolute",visibility:"hidden",top:"50%",zIndex:"999"}});this.containerElement.grab(this.splashFormElement,"top");this.constructionChain.callChain()}.protect(),constructImageWrapper:function(){this.imageWrapperElement=new Element("div");this.imageWrapperElement.grab(this.imageElement);this.splashFormElement.grab(this.imageWrapperElement,"bottom");this.constructionChain.callChain()}.protect(),constructStatusDisplay:function(){this.statusDisplayElement=new Element("div",{"class":this.options.statusDisplayClass});this.statusDisplayElement.setStyles(this.options.statusDisplayStyles);this.statusDisplayElement.set("text",this.statusText);this.splashFormElement.grab(this.statusDisplayElement,"bottom");this.constructionChain.callChain()}.protect(),destroyElement:function(a){if(a){if(a.removeEvents){a.removeEvents()}if(a.destroy){a.destroy()}}}.protect(),determineBrowserLanguage:function(){this.browserLanguage=new ProcessPuzzleLocale();this.browserLanguage.parse(navigator.language||navigator.userLanguage);this.constructionChain.callChain()}.protect(),determineStatusText:function(){if(SplashForm.StatusText[this.getBrowserLanguage()]){this.statusText=SplashForm.StatusText[this.getBrowserLanguage()]}else{this.browserLanguage=new ProcessPuzzleLocale({language:"en"});this.statusText=SplashForm.StatusText[this.getBrowserLanguage()]}this.constructionChain.callChain()}.protect(),finalizeConstruction:function(){this.constructionChain.clearChain();this.fireEvent("constructed",this)}.protect(),positionForm:function(){this.splashFormElement.setStyle("margin-left",-(this.splashFormElement.getStyle("width").toInt()/2));this.splashFormElement.setStyle("margin-top",-(this.splashFormElement.getStyle("height").toInt()/2));this.splashFormElement.setStyle("visibility","visible");this.constructionChain.callChain()}.protect(),preloadImage:function(){this.imageElement=Asset.image(this.options.imageUri,{id:this.options.imageId,title:this.options.imageTitle,onAbort:function(){this.onImageLoadError()}.bind(this),onError:function(){this.onImageLoadError()}.bind(this),onLoad:function(){this.onImageLoaded()}.bind(this)})}.protect()});SplashForm.StatusText={en:"Constructing desktop: ",ge:"Aufbau der Benutzeroberflache: ",hu:"Felhasznli fellet ptse: ",sp:"La construccin de la interfaz de usuario: "};var DuplicatedTabException=new Class({Extends:WebUIException,options:{description:"Tab name violates uniquness constraint.",name:"DuplicatedTabException",tabName:null},initialize:function(a){this.setOptions(a);this.parent(a)},getTabName:function(){return this.options.tabName}});var Tab=new Class({Implements:[Events,Options],Binds:["onSelection"],options:{caption:null,captionSelector:"@caption",componentName:"Tab",currentTabId:"current",id:null,idPrefix:"tab_",idSelector:"@tabId",isDefaultSelector:"@isDefault",messagePropertiesSelector:"messageProperties",tabsStyle:"Tabs"},initialize:function(b,c,a){assertThat(c,not(nil()));this.setOptions(a);this.active=false;this.anchorElement;this.caption=this.options.caption?c.getText(this.options.caption):null;this.defaultTab;this.definitionElement=b;this.id=this.options.id;this.internationalization=c;this.listItemElement;this.logger=Class.getInstanceOf(WebUILogger);this.messageProperties;this.visible=false},activate:function(){if(this.isVisible()){this.active=true;this.setListItemId(this.options.currentTabId)}},changeCaption:function(a){this.caption=a.getText(this.id);if(this.anchorElement!=null&&this.anchorText!=null){this.anchorElement.removeChild(this.anchorText);var b=caption.replace(/ /g,String.fromCharCode(160));this.anchorText=document.createTextNode(b);this.anchorElement.appendChild(this.anchorText)}},construct:function(a){assertThat(a,not(nil()));this.createHtmlElements(a);this.visible=true},deActivate:function(){if(this.isVisible()){this.active=false;this.setListItemId("")}},destroy:function(){if(this.isVisible()){this.removeLIElement()}this.visible=false;this.active=false},equals:function(a){if(!instanceOf(a,Tab)){return false}return this.id.equals(a.id)},onSelection:function(){this.activate();this.fireEvent("tabSelected",this)},unmarshall:function(){this.unmarshallProperties()},getCaption:function(){return this.caption},getId:function(){return this.id},getMessageProperties:function(){return this.messageProperties},isActive:function(){return this.active},isDefault:function(){return this.defaultTab},isVisible:function(){return this.visible},createHtmlElements:function(a){var b=this.caption.replace(/ /g,String.fromCharCode(160));this.anchorElement=new Element("a",{id:this.id,href:"#",events:{click:this.onSelection}});this.anchorElement.appendText(b);this.listItemElement=new Element("li");this.listItemElement.appendChild(this.anchorElement);a.grab(this.listItemElement,"bottom");this.logger.trace(this.options.componentName+".createHtmlElements added a 'LI' element to represent tab: "+this.id)}.protect(),removeLIElement:function(){if(this.listItemElement!=null){if(this.anchorElement.destroy){this.anchorElement.removeEvents();this.anchorElement.destroy()}else{this.anchorElement.removeNode()}this.anchorElement=null;if(this.listItemElement.destroy){this.listItemElement.destroy()}else{this.listItemElement.removeNode()}this.listItemElement=null}else{throw new UnconfiguredWidgetException({message:"Can't remove tab's parent LI element.",source:"Tab.removeLIElement"})}}.protect(),setListItemId:function(a){if(this.listItemElement!=null){this.listItemElement.set("id",a)}else{throw new UnconfiguredWidgetException({message:"Can't set undefined LI element's id.",source:"Tab.setListItemId"})}}.protect(),unmarshallProperties:function(){this.id=this.options.idPrefix+XmlResource.selectNodeText(this.options.idSelector,this.definitionElement);this.caption=this.internationalization.getText(XmlResource.selectNodeText(this.options.captionSelector,this.definitionElement));this.defaultTab=parseBoolean(XmlResource.selectNodeText(this.options.isDefaultSelector,this.definitionElement,null,false));this.messageProperties=XmlResource.selectNodeText(this.options.messagePropertiesSelector,this.definitionElement)}.protect()});var TabSelectedMessage=new Class({Extends:WebUIMessage,options:{actionType:null,contextItemId:null,description:"A message about the event that a tab was selected.",documentContentURI:null,documentType:AbstractDocument.Types.SMART,documentURI:null,documentVariables:null,name:"TabSelectedMessage",tabId:null},initialize:function(a){this.setOptions(a);this.options.messageClass=TabSelectedMessage},getActionType:function(){return this.options.actionType},getActivityType:function(){return this.options.activityType},getContextItemId:function(){return this.options.contextItemId},getDocumentContentURI:function(){return this.options.documentContentURI},getDocumentType:function(){return this.options.documentType},getDocumentURI:function(){return this.options.documentURI},getDocumentVariables:function(){return this.options.documentVariables},getId:function(){return this.options.tabId}});var TabWidget=new Class({Extends:BrowserWidget,Binds:["activateDefaultTab","constructButtons","constructTabs","createHtmlElements","onClose","onTabSelected"],options:{TAB_LIST_STYLE:"Tabs",TAB_WIDGET_STYLE:"TabWidgetWrapper",BUTTONCLASSNAME:"Buttons",backgroundImage:"Images/bg.gif",buttonPrefix:"button_",closeButtonCaptionKey:"TabWidget.Close",componentName:"TabWidget",idDefault:"TabWidget",idSelector:"/pp:tabWidgetDefinition/tabWidget/@tabWidgetId",printButtonCaptionKey:"TabWidget.Print",selectedTabClassDefault:"selectedTab",selectedTabClassSelector:"/pp:tabWidgetDefinition/tabWidget/@selectedTabClass",showCloseButtonDefault:false,showCloseButtonSelector:"/pp:tabWidgetDefinition/tabWidget/@showCloseButton",showPrintButtonDefault:false,showPrintButtonSelector:"/pp:tabWidgetDefinition/tabWidget/@showPrintButton",tabCaptionSelector:"@caption",tabDefinitionSelector:"/pp:tabWidgetDefinition/tabWidget/tab",tabIdSelector:"@tabId",tabIsDefaultSelector:"@isDefault",tabLeftImage:"Images/DocumentTab-Left.gif",tabRightImage:"Images/DocumentTab-Right.gif",tabLeftOnImage:"Images/DocumentTab-Left-Selected.gif",tabRightOnImage:"Images/DocumentTab-Right-Selected.gif",tabsSelector:"tab",widgetContainerId:"TabWidget",widgetDefinitionSelector:"/pp:tabWidgetDefinition/tabWidget",widgetDefinitionURI:"TabsDefinition.xml"},initialize:function(a,b){this.setOptions(a);this.parent(a,b);this.activeTab=null;this.buttonsListElement;this.id;this.isVisible=false;this.selectedTabClass;this.showCloseButton;this.showPrintButton;this.tabListElement;this.tabs=new LinkedHashMap();this.tabsWrapperElement},activateTab:function(a){if(this.activeTab!=null){this.activeTab.deActivate()}var b=this.tabs.get(a);b.activate();this.activeTab=b;this.storeComponentState();this.notifySubscribers()},addTab:function(d,a,c){if(this.state<=BrowserWidget.States.INITIALIZED){throw new UnconfiguredWidgetException()}if(this.tabs.get(d)!=null){throw new DuplicatedTabException({tabName:d})}var b=new Tab(null,this.i18Resource,{id:d,caption:a,onTabSelected:this.onTabSelected});this.tabs.put(b.getId(),b);if(this.state==BrowserWidget.States.CONSTRUCTED){b.construct(this.tabListElement)}if(c==null||(c!=null&&c==false)){this.activateTab(d)}},changeCaptions:function(a){tabs.moveFirst();var b;while(b=tabs.getNext()){if(b.changeCaption!=null){b.changeCaption(a)}}},construct:function(){this.parent();this.isVisible=true},destroy:function(){if(this.tabListElement){this.tabs.each(function(b,a){b.getValue().destroy()},this);if(this.tabListElement.destroy){this.tabListElement.removeEvents();this.tabListElement.destroy()}else{this.tabListElement.removeNode()}}if(this.tabsWrapperElement&&this.tabsWrapperElement.destroy){this.tabsWrapperElement.destroy()}if(this.buttonsListElement){if(this.buttonsListElement.destroy){this.buttonsListElement.removeEvents();this.buttonsListElement.destroy()}else{this.buttonsListElement.removeNode()}}this.parent();this.isVisible=false},moveFirstToLast:function(){var a=null;if(htmlDivElement!=null){var d=htmlDivElement.getElementsByTagName("ul");for(var b=0;b<d.length;b++){if(d[b].className==TAB_LIST_STYLE){a=d[b]}}}if(a==null){return}var c=a.firstChild;if(c!=null){a.appendChild(c)}},moveLastToFirst:function(){var a=null;if(htmlDivElement!=null){var f=htmlDivElement.getElementsByTagName("ul");for(var b=0;b<f.length;b++){if(f[b].className==TAB_LIST_STYLE){a=f[b]}}}if(a==null){return}var d=a.firstChild;if(d!=null){var c=a.lastChild;if(d!=c){a.insertBefore(c,d)}}},onClose:function(){if(this.activeTab){this.removeTab(this.activeTab.getId())}},onPrint:function(){},onTabSelected:function(a){if(!a.getId().equals(this.activeTab.getId())){this.activateTab(a.getId())}},removeAllTabs:function(){this.tabs.each(function(c,a){var b=c.getValue();b.destroy()},this);this.tabs.clear();this.activeTab=null},removeTab:function(b){if(this.state<=BrowserWidget.States.INITIALIZED){throw new UnconfiguredWidgetException()}var a=this.tabs.next(this.activeTab.getId());var c=this.tabs.previous(this.activeTab.getId());if(a!=null&&!a.getId().equals(b)){this.activateTab(a.getId())}else{if(c!=null&&!c.getId().equals(b)){this.activateTab(c.getId())}}this.tabs.get(b).destroy();this.tabs.remove(b);if(this.tabs.size()==0){this.activeTab=null}},unmarshall:function(){this.unmarshallProperties();this.unmarshallTabs();this.parent()},activeTabId:function(){return(tabs.getCountOfObjects()>0?activeTab.getId():"undefined")},getActiveTab:function(){return this.activeTab},getCloseButtonId:function(){return this.options.buttonPrefix+this.options.closeButtonCaptionKey},getId:function(){return this.id},getPrintButtonId:function(){return this.options.buttonPrefix+this.options.printButtonCaptionKey},getSelectedTabClass:function(){return this.selectedTabClass},getShowCloseButton:function(){return this.showCloseButton},getShowPrintButton:function(){return this.showPrintButton},getTabById:function(a){return this.tabs.get(a)},getTabCount:function(){return this.tabs.size()},getTabExist:function(a){return tabs.exists(a)},getTabs:function(){return this.tabs},isCloseButtonVisible:function(){return this.showCloseButton},isPrintButtonVisible:function(){return this.showPrintButton},setCloseButtonVisibility:function(a){this.options.showCloseButton=a},setPrintButtonVisibility:function(a){this.options.showPrintButton=a},setBackgroundImage:function(a){backgroundImage=(a==null?backgroundImage:a)},setTabLefImage:function(a){tabLeftImage=(a==null?tabLeftImage:a)},setTabRightImage:function(a){tabRightImage=(a==null?tabRightImage:a)},setTabLeftOnImage:function(a){tabLeftOnImage=(a==null?tabLeftOnImage:a)},setTabRightOnImage:function(a){tabRightOnImage=(a==null?tabRightOnImage:a)},activateDefaultTab:function(){if(this.activeTab){this.activateTab(this.activeTab.getId())}else{this.activateTab(this.tabs.get(this.tabs.firstKey()).getId())}this.constructionChain.callChain()}.protect(),compileConstructionChain:function(){this.constructionChain.chain(this.createHtmlElements,this.constructTabs,this.constructButtons,this.activateDefaultTab,this.finalizeConstruction)}.protect(),compileStateSpecification:function(){this.stateSpecification={currentTabId:this.activeTab.getId()}}.protect(),constructButtons:function(){if(this.showCloseButton||this.showPrintButton){this.buttonsListElement=this.elementFactory.create("ul",null,null,null,{"class":this.options.BUTTONCLASSNAME});if(this.showCloseButton){this.createButton(this.options.closeButtonCaptionKey,this.onClose)}if(this.showPrintButton){this.createButton(this.options.printButtonCaptionKey,this.onPrint)}}this.constructionChain.callChain()}.protect(),constructTabs:function(){this.tabs.each(function(b,a){var c=b.getValue();c.construct(this.tabListElement)},this);this.constructionChain.callChain()}.protect(),createButton:function(a,c){var d=this.elementFactory.create("li",null,this.buttonsListElement,WidgetElementFactory.Positions.LastChild);var b={href:"#",id:this.options.buttonPrefix+a};this.elementFactory.createAnchor(a.replace(/ /g,String.fromCharCode(160)),null,c,d,WidgetElementFactory.Positions.LastChild,b)}.protect(),createHtmlElements:function(){this.tabsWrapperElement=this.elementFactory.create("div",null,null,null,{"class":this.options.TAB_WIDGET_STYLE});this.tabListElement=this.elementFactory.create("ul",null,this.tabsWrapperElement,null,{"class":this.options.TAB_LIST_STYLE});this.constructionChain.callChain()}.protect(),hideButtons:function(){if(htmlDivElement!=null){var c=htmlDivElement.getElementsByTagName("ul");for(var b=0;b<c.length;b++){if(c[b].className==BUTTONCLASSNAME){var a=c[b];htmlDivElement.removeChild(a)}}}else{throw new UserException("Division not defined","TabWidget._RemoveUnorderedListTag()")}}.protect(),notifySubscribers:function(){var argumentText=this.activeTab.getMessageProperties();var arguments=argumentText!=null?eval("("+argumentText+")"):{};arguments.originator=this.options.componentName;arguments.tabId=this.activeTab.getId();var tabSelectedMessage=new TabSelectedMessage(arguments);this.messageBus.notifySubscribers(tabSelectedMessage)}.protect(),parseStateSpecification:function(){if(this.stateSpecification){this.currentItemId=this.stateSpecification.currentTabId}}.protect(),removeUnorderedListTag:function(){if(htmlDivElement!=null){var c=htmlDivElement.getElementsByTagName("ul");for(var b=0;b<c.length;b++){if(c[b].className==this.options.TAB_LIST_STYLE){var a=c[b];htmlDivElement.removeChild(a)}}}else{throw new UserException("Division not defined","TabWidget._RemoveUnorderedListTag()")}}.protect(),saveComponentState:function(b){var d="";if(this.activeTab!=null){d=d+b+this.activeTab.caption}else{d=d+b+"null"}for(var c=1;c<=this.tabs.getCountOfObjects();c++){var a=this.tabs.getItemByIndex(c-1);d=d+b+a.caption+b+a.state+b+a.id}return d}.protect(),unmarshallProperties:function(){this.id=this.definitionXml.selectNodeText(this.options.idSelector,null,this.options.idDefault);this.selectedTabClass=this.definitionXml.selectNodeText(this.options.selectedTabClassSelector,null,this.options.selectedTabClassDefault);this.showCloseButton=parseBoolean(this.definitionXml.selectNodeText(this.options.showCloseButtonSelector,null,this.options.showCloseButtonDefault));this.showPrintButton=parseBoolean(this.definitionXml.selectNodeText(this.options.showCloseButtonSelector,null,this.options.showCloseButtonDefault))}.protect(),unmarshallTabs:function(){var a=this.definitionXml.selectNodes(this.options.tabDefinitionSelector);a.each(function(d,b){var c=new Tab(d,this.i18Resource,{onTabSelected:this.onTabSelected});c.unmarshall();this.tabs.put(c.getId(),c);if(c.isDefault()){this.activeTab=c}},this)}.protect(),});var MooEditableDialog=new Class({Implements:[Options],Binds:["open"],options:{action:null,componentName:"MooEditableDialog",notification:null,windowName:null},initialize:function(b,a){this.setOptions(a);this.editor=b;this.name},open:function(){switch(this.options.action){case DesktopWindow.Activity.SHOW_NOTIFICATION:this.editor.showNotification(this.options.notification);break;case DesktopWindow.Activity.SHOW_WINDOW:this.editor.showWindow(this.options.windowName);break}},prompt:function(){this.editor.showNotification(this.options.windowName)},isCollapsed:function(){return false},});var WebUIConfiguration=new Class({Implements:[Class.Singleton,Options],options:{appenderBatchSizeSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@batchSize | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@batchSize | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@batchSize | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@batchSize",appenderCommandLineObjectExpansionDepthSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@commandLineObjectExpansionDepth | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@commandLineObjectExpansionDepth | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@commandLineObjectExpansionDepth | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@commandLineObjectExpansionDepth",appenderComplainAboutPopUpBlockingSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@complainAboutPopUpBlocking | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@complainAboutPopUpBlocking | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@complainAboutPopUpBlocking | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@complainAboutPopUpBlocking",appenderContainerElementIdSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@containerElementId | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@containerElementId | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@containerElementId | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@containerElementId",appenderFailCallbackSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@failCallback | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@failCallback | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@failCallback | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@failCallback",appenderFocusPopUpSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@focusPopUp | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@focusPopUp | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@focusPopUp | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@focusPopUp",appenderHeightSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@height | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@height | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@height | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@height",appenderInitiallyMinimizedSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@initiallyMinimized | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@initiallyMinimized | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@initiallyMinimized | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@initiallyMinimized",appenderLayoutSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@layoutReference | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@layoutReference | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@layoutReference | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@layoutReference",appenderLazyInitSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@lazyInit | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@lazyInit | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@lazyInit | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@lazyInit",appenderMaxMessagesSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@maxMessages | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@maxMessages | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@maxMessages | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@maxMessages",appenderNameSelector:"@name",appenderNewestMessageAtTopSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@newestMessageAtTop | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@newestMessageAtTop | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@newestMessageAtTop | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@newestMessageAtTop",appenderPostVariableNameSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@postVariableName | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@postVariableName | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@postVariableName | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@postVariableName",appenderReopenWhenClosedSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@reopenWhenClosed | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@reopenWhenClosed | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@reopenWhenClosed | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@reopenWhenClosed",appenderRequestSuccessCallbackSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@requestSuccessCallback | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@requestSuccessCallback | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@requestSuccessCallback | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@requestSuccessCallback",appenderScrollToLatestMessageSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@scrollToLatestMessage | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@scrollToLatestMessage | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@scrollToLatestMessage | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@scrollToLatestMessage",appenderShowCommandLineSelector:"wui:appenders/ajaxAppender[@name='{appenderName}']/@showCommandLine | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@showCommandLine | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@showCommandLine | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@showCommandLine",appenderSendAllOnUnloadSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@sendAllOnUnload | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@sendAllOnUnload | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@sendAllOnUnload | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@sendAllOnUnload",appenderTimedSendingSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@timedSending | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@timedSending | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@timedSending | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@timedSending",appenderTimerIntervalSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@timerInterval | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@timerInterval | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@timerInterval | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@timerInterval",appenderThresholdSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@threshold | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@threshold | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@threshold | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@threshold",appenderTypeSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}'] | wui:appenders/wui:popUpAppender[@name='{appenderName}'] | wui:appenders/wui:inPageAppender[@name='{appenderName}'] | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']",appenderURLSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@url | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@url | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@url | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@url",appenderUseDocumentWriteSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@useDocumentWrite | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@useDocumentWrite | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@useDocumentWrite | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@useDocumentWrite",appenderUseOldPopUpSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@useOldPopUp | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@useOldPopUp | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@useOldPopUp | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@useOldPopUp",appenderWaitForResponseSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@waitForResponse | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@waitForResponse | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@waitForResponse | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@waitForResponse",appenderWidthSelector:"wui:appenders/wui:ajaxAppender[@name='{appenderName}']/@width | wui:appenders/wui:popUpAppender[@name='{appenderName}']/@width | wui:appenders/wui:inPageAppender[@name='{appenderName}']/@width | wui:appenders/wui:browserConsoleAppender[@name='{appenderName}']/@width",applicationNameSelector:"/pp:processPuzzleConfiguration/ac:application/ac:applicationName",applicationVersionSelector:"/pp:processPuzzleConfiguration/ac:application/ac:version",availableSkinElementsSelector:"wui:desktop/wui:availableSkins/wui:skin",defaultSkinSelector:"wui:desktop/wui:defaultSkin/@name",desktopConfigurationURISelector:"/pp:processPuzzleConfiguration/wui:webUI/wui:desktop/@configurationURI",eraseStateWhenSkinChangeSelector:"/pp:processPuzzleConfiguration/wui:webUI/wui:desktop/@eraseStateOnSkinChange",i18DefaultLocaleSelector:"in:defaultLocale/text()",i18ElementSelector:"/pp:processPuzzleConfiguration/in:internationalization",i18LocaleSelector:"text()",i18LocaleElementsSelector:"in:availableLocales/in:locale",i18ResourceBundleElementsSelector:"in:resouceBundles/in:resourceBundle",i18ResourceBundleNameSelector:"text()",i18ResourceBundleNameSpaceSelector:"in:resouceBundles/@nameSpace",layoutElementsSelector:"wui:logging/wui:layouts/wui:patternLayout | wui:logging/wui:layouts/wui:xmlLayout",layoutNameSelector:"@name",layoutPatternSelector:"wui:layouts/wui:patternLayout[@name='{layoutName}']/@pattern | wui:layouts/wui:xmlLayout[@name='{layoutName}']/@pattern",loggerAppenderLayoutSelector:"wui:appender/@layout",loggerAppenderLevelSelector:"wui:appender/@level",loggerAppenderReferenceSelector:"wui:loggers/wui:logger[@name='{loggerName}']/wui:appenderReference/@name",loggerAppendersSelector:"wui:logging/wui:appenders/wui:ajaxAppender | wui:logging/wui:appenders/wui:popUpAppender | wui:logging/wui:appenders/wui:inPageAppender | wui:logging/wui:appenders/wui:browserConsoleAppender",loggerAppenderTypeSelector:"wui:appender/@type",loggerElementsSelector:"wui:logging/wui:loggers/wui:logger",loggerLayoutPatternSelector:"wui:layout/@pattern",loggerLayoutTypeSelector:"wui:layout/@type",loggerLevelSelector:"wui:loggers/wui:logger[@name='{loggerName}']/@level",loggerNameSelector:"@name",loggerIsDefaultSelector:"wui:loggers/wui:logger[@name='{loggerName}']/@isDefault",loggingSelector:"/pp:processPuzzleConfiguration/wui:webUI/wui:logging",menuDefinitionURISelector:"/pp:processPuzzleConfiguration/wui:webUI/wui:desktop/wui:menu/@definitionURI",nameSpaces:"xmlns:pp='http://www.processpuzzle.com' xmlns:ac='http://www.processpuzzle.com/ApplicationConfiguration' xmlns:bc='http://www.processpuzzle.com/BeanContainerConfiguration' xmlns:bd='http://www.processpuzzle.com/BusinessDefinitionsConfiguration' xmlns:bi='http://www.processpuzzle.com/BusinessImplementationsConfiguration' xmlns:dl='http://www.processpuzzle.com/DataLoadersConfiguration' xmlns:em='http://www.processpuzzle.com/EmailConfiguration' xmlns:fc='http://www.processpuzzle.com/FrontControllerConfiguration' xmlns:in='http://www.processpuzzle.com/InternationalizationConfiguration' xmlns:pr='http://www.processpuzzle.com/PersistenceConfiguration' xmlns:rt='http://www.processpuzzle.com/RuntimeConfiguration' xmlns:wui='http://www.processpuzzle.com/WebUIConfiguration'",resourceBundleNameSpaceSelector:"xmlns:pp='http://www.processpuzzle.com'",skinConfigurationSelector:"wui:desktop/wui:availableSkins/wui:skin[@name='{skinName}']/@configurationURI",skinNameAttributeSelector:"@name",skinPathSelector:"wui:desktop/wui:availableSkins/wui:skin[@name='{skinName}']/@relativePath",skinPathAttributeSelector:"@relativePath",webUIElementSelector:"/pp:processPuzzleConfiguration/wui:webUI"},initialize:function(a,b){return this.check()||this.setUp(a,b)},setUp:function(a,b){this.setOptions(b);this.applicationName;this.applicationVersion;this.availableLocales=new ArrayList();this.configurationURI=a;this.i18Element=null;this.isLoaded=false;this.loggingElement=null;this.xmlResource=null;this.webUIElement=null;this.load();this.determineAvailableLocales()},load:function(){if(this.isLoaded){this.release()}this.xmlResource=new XmlResource(this.configurationURI,{nameSpaces:this.options.nameSpaces});this.i18Element=this.xmlResource.selectNode(this.options.i18ElementSelector);this.loggingElement=this.xmlResource.selectNode(this.options.loggingSelector);this.webUIElement=this.xmlResource.selectNode(this.options.webUIElementSelector);this.isLoaded=true},release:function(){if(this.isLoaded){this.i18Element=null;this.loggingElement=null;this.xmlResource=null;this.webUIElement=null;this.isLoaded=false}},getApplicationName:function(){return this.xmlResource.selectNodeText(this.options.applicationNameSelector,this.webUIElement)},getApplicationVersion:function(){return this.xmlResource.selectNodeText(this.options.applicationVersionSelector,this.webUIElement)},getAvailableLocales:function(){return this.availableLocales},getAvailableSkinElements:function(){return this.xmlResource.selectNodes(this.options.availableSkinElementsSelector,this.webUIElement)},getConfigurationElement:function(){return this.webUIElement},getDefaultSkin:function(){return this.xmlResource.selectNode(this.options.defaultSkinSelector,this.webUIElement).nodeValue},getEraseStateWhenSkinChange:function(){return parseBoolean(this.xmlResource.selectNodeText(this.options.eraseStateWhenSkinChangeSelector,this.webUIElement,false))},getI18DefaultLocale:function(){return this.xmlResource.selectNode(this.options.i18DefaultLocaleSelector,this.i18Element).nodeValue},getI18Element:function(){return this.i18Element},getI18Locale:function(a){return this.xmlResource.selectNode(this.options.i18LocaleSelector,this.getI18LocaleElements()[a]).nodeValue},getI18LocaleElements:function(){return this.xmlResource.selectNodes(this.options.i18LocaleElementsSelector,this.i18Element)},getI18ResourceBundleElements:function(){return this.xmlResource.selectNodes(this.options.i18ResourceBundleElementsSelector,this.i18Element)},getI18ResourceBundleName:function(a){return this.xmlResource.selectNode(this.options.i18ResourceBundleNameSelector,this.getI18ResourceBundleElements()[a]).nodeValue},getI18ResourceBundleNameSpace:function(){return this.xmlResource.selectNode(this.options.i18ResourceBundleNameSpaceSelector,this.i18Element).value},getLoggerAppenderElement:function(){return this.xmlResource.selectNode(this.options.loggerAppenderSelector,this.webUIElement)},getLoggerAppenderType:function(){return this.xmlResource.selectNode(this.options.loggerAppenderTypeSelector,this.loggingElement).value},getLoggerElements:function(){return this.xmlResource.selectNodes(this.options.loggerElementsSelector,this.webUIElement)},getLoggerLayoutElement:function(){return this.xmlResource.selectNode(this.options.loggerLayoutSelector,this.loggingElement)},getLoggerLayoutPattern:function(){return this.xmlResource.selectNode(this.options.loggerLayoutPatternSelector,this.loggingElement).value},getLoggerLayoutType:function(){return this.xmlResource.selectNode(this.options.loggerLayoutTypeSelector,this.loggingElement).value},getLoggerLevel:function(b){var a=this.options.loggerLevelSelector.substitute({loggerName:b});return this.xmlResource.selectNode(a,this.loggingElement).value},getLoggerName:function(b){var a=this.getLoggerElements();return this.xmlResource.selectNode(this.options.loggerNameSelector,a[b]).value},getLoggingAppenderBatchSize:function(b){var a=this.options.appenderBatchSizeSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderCommandLineObjectExpansionDepth:function(b){var a=this.options.appenderCommandLineObjectExpansionDepthSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderComplainAboutPopUpBlocking:function(a){return this.determineLoggingElementValue(this.options.appenderComplainAboutPopUpBlockingSelector.substitute({appenderName:a}))},getLoggingAppenderContainerElementId:function(a){return this.determineLoggingElementValue(this.options.appenderContainerElementIdSelector.substitute({appenderName:a}))},getLoggingAppenderElements:function(){return this.xmlResource.selectNodes(this.options.loggerAppendersSelector,this.webUIElement)},getLoggingAppenderFailCallback:function(b){var a=this.options.appenderFailCallbackSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderFocusPopUp:function(b){var a=this.options.appenderFocusPopUpSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderHeight:function(a){return parseInt(this.determineLoggingElementValue(this.options.appenderHeightSelector.substitute({appenderName:a})))},getLoggingAppenderInitiallyMinimized:function(b){var a=this.determineLoggingElementValue(this.options.appenderInitiallyMinimizedSelector.substitute({appenderName:b}));return new Boolean().parseBoolean(a)},getLoggingAppenderLazyInit:function(b){var a=this.options.appenderLazyInitSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderLayoutReference:function(b){var a=this.options.appenderLayoutSelector.substitute({appenderName:b});return this.xmlResource.selectNode(a,this.loggingElement).value},getLoggingAppenderMaxMessages:function(b){var a=this.options.appenderMaxMessagesSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderName:function(a){var b=this.getLoggingAppenderElements();return this.xmlResource.selectNode(this.options.appenderNameSelector,b[a]).value},getLoggingAppenderNewestMessageAtTop:function(b){var a=this.options.appenderNewestMessageAtTopSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderPostVariableName:function(b){var a=this.options.appenderPostVariableNameSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderReopenWhenClosed:function(b){var a=this.options.appenderReopenWhenClosedSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderRequestSuccessCallback:function(b){var a=this.options.appenderRequestSuccessCallbackSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderScrollToLatestMessage:function(b){var a=this.options.appenderScrollToLatestMessageSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderSendAllOnUnload:function(b){var a=this.options.appenderSendAllOnUnloadSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderShowCommandLine:function(b){var a=this.options.appenderShowCommandLineSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderThreshold:function(a){return this.determineLoggingElementValue(this.options.appenderThresholdSelector.substitute({appenderName:a}))},getLoggingAppenderTimedSending:function(b){var a=this.options.appenderTimedSendingSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderTimerInterval:function(b){var a=this.options.appenderTimerIntervalSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderType:function(b){var a=this.options.appenderTypeSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.nodeName}else{return null}},getLoggingAppenderURL:function(b){var a=this.options.appenderURLSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderUseDocumentWrite:function(a){return this.determineLoggingElementValue(this.options.appenderUseDocumentWriteSelector.substitute({appenderName:a}))},getLoggingAppenderUseOldPopUp:function(b){var a=this.options.appenderUseOldPopUpSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderWaitForResponse:function(b){var a=this.options.appenderWaitForResponseSelector.substitute({appenderName:b});var c=this.xmlResource.selectNode(a,this.loggingElement);if(c){return c.value}else{return null}},getLoggingAppenderWidth:function(a){return parseInt(this.determineLoggingElementValue(this.options.appenderWidthSelector.substitute({appenderName:a})))},getLoggingLayoutName:function(a){var b=this.getLoggingLayoutElements();return this.xmlResource.selectNode(this.options.layoutNameSelector,b[a]).value},getLoggingLayoutElements:function(){return this.xmlResource.selectNodes(this.options.layoutElementsSelector,this.webUIElement)},getLoggingLayoutPattern:function(b){var a=this.options.layoutPatternSelector.substitute({layoutName:b});return this.xmlResource.selectNode(a,this.loggingElement).value},getLoggingLoggerAppenderReference:function(b){var a=this.options.loggerAppenderReferenceSelector.substitute({loggerName:b});return this.xmlResource.selectNode(a,this.loggingElement).value},getLoggingLoggerIsDefault:function(a){return this.determineLoggingElementValue(this.options.loggerIsDefaultSelector.substitute({loggerName:a}))},getMenuDefinitionURI:function(){return this.xmlResource.selectNode(this.options.menuDefinitionURISelector).nodeValue},getSkinConfiguration:function(a){var b=this.options.skinConfigurationSelector.substitute({skinName:a});return this.xmlResource.selectNode(b,this.webUIElement).value},getSkinNameByIndex:function(a){var b=this.getAvailableSkinElements();return this.xmlResource.selectNode(this.options.skinNameAttributeSelector,b[a]).value},getSkinPath:function(a){var b=this.options.skinPathSelector.substitute({skinName:a});return this.xmlResource.selectNode(b,this.webUIElement).value},getSkinPathByIndex:function(a){var b=this.getAvailableSkinElements();return this.xmlResource.selectNode(this.options.skinPathAttributeSelector,b[a]).value},isSupportedLocale:function(a){var b=false;this.availableLocales.each(function(c,d){if(a.equals(c)){b=true}}.bind(this));return b},determineAvailableLocales:function(){for(var b=0;b<this.getI18LocaleElements().length;b++){var c=this.getI18Locale(b);var a=new ProcessPuzzleLocale();a.parse(c);this.availableLocales.add(a)}}.protect(),determineLoggingElementValue:function(a){var b=this.xmlResource.selectNode(a,this.loggingElement);if(b){return b.value}else{return null}}});SYSTEM_WINDOWS={ABOUT:"about",DOCUMENT_EXPLORER:"documentExplorer"};var TextAreaEditor=new Class({Extends:DocumentEditor,Binds:["onDocumentSelectedMessage","onEditorClick","onMooEditableAttach"],options:{componentName:"TextAreaEditor",createLinkAlert:"selectionNeeded",createLinkPromt:SYSTEM_WINDOWS.DOCUMENT_EXPLORER,dimensions:{x:500,y:100},numberOfColumns:120,numberOfRows:50,urlImagePromt:SYSTEM_WINDOWS.DOCUMENT_EXPLORER,},initialize:function(b,a){this.parent(b,a);this.initialContent;this.mooEditable},attach:function(b,a){this.initialContent=a;this.parent(b)},detach:function(){this.mooEditable.detach();this.parent()},onContainerResize:function(a){this.mooEditable.onContainerResize(a)},onDocumentSelectedMessage:function(a){this.mooEditable.execute("createlink",null,a.getDocumentURI())},onEditorClick:function(event,editor){var subjectElement=event.target;if(subjectElement.get("tag").toUpperCase()!="A"&&subjectElement.getParent().get("tag").toUpperCase()=="A"){subjectElement=subjectElement.getParent()}if(subjectElement.get("tag").toUpperCase()=="A"){if(subjectElement.get("onclick")){eval(subjectElement.get("onclick"))}else{if(subjectElement.get("href")){document.location.href=subjectElement.get("href")}}}},onMooEditableAttach:function(){this.attachChain.callChain()},textAddImage:function(){this.mooEditable.action("urlimage",[])},textAddLink:function(){this.mooEditable.action("createlink",[])},textAlignCenter:function(){this.mooEditable.action("justifycenter",[])},textAlignLeft:function(){this.mooEditable.action("justifyleft",[])},textAlignJustify:function(){this.mooEditable.action("justifyfull",[])},textAlignRight:function(){this.mooEditable.action("justifyright",[])},textBold:function(){this.mooEditable.action("bold",[])},textIndent:function(){this.mooEditable.action("indent",[])},textItalic:function(){this.mooEditable.action("italic",[])},textOrderedList:function(){this.mooEditable.action("insertorderedlist",[])},textOutdent:function(){this.mooEditable.action("outdent",[])},textRedo:function(){this.mooEditable.action("redo",[])},textRemoveLink:function(){this.mooEditable.action("unlink",[])},textStrikethrough:function(){this.mooEditable.action("strikethrough",[])},textToggleView:function(){this.mooEditable.action("toggleview",[])},textUnderline:function(){this.mooEditable.action("underline",[])},textUndo:function(){this.mooEditable.action("undo",[])},textUnorderedList:function(){this.mooEditable.action("insertunorderedlist",[])},getMooEditable:function(){return this.mooEditable},defineDialogWindows:function(){MooEditable.Actions.createlink.dialogs.alert=function(a){return new MooEditableDialog(this,{action:DesktopWindow.Activity.SHOW_NOTIFICATION,notification:this.options.createLinkAlert})}.bind(this);MooEditable.Actions.createlink.dialogs.prompt=function(a){return new MooEditableDialog(this,{action:DesktopWindow.Activity.SHOW_WINDOW,windowName:this.options.createLinkPromt})}.bind(this);MooEditable.Actions.urlimage.dialogs.prompt=function(a){return new MooEditableDialog(this,{action:DesktopWindow.Activity.SHOW_WINDOW,windowName:this.options.urlImagePromt})}.bind(this)}.protect(),instantiateTools:function(){this.defineDialogWindows();var a="";this.styleSheets.each(function(c,b){a+="<link rel='stylesheet' type='text/css' href='"+c+"'>"},this);this.mooEditable=new MooEditable(this.subjectElement,{externalCSS:a,handleDialogs:false,handleLabel:false,handleSubmit:false,onAttach:this.onMooEditableAttach,onEditorClick:this.onEditorClick,toolbar:false})}.protect(),});var ToolBarButton=new Class({Implements:[Events,Options],Binds:["onSelection"],options:{buttonStyle:"toolBarButton",captionSelector:"caption",iconImageSelector:"iconImage",messagePropertiesSelector:"messageProperties",nameSelector:"@name",showCaption:false,toolTipStyle:"toolBarToolTip"},initialize:function(c,a,b){this.setOptions(b);this.anchorElement;this.definitionXml=c;this.caption;this.factory=a;this.iconImageUri;this.imageElement;this.listItemElement;this.messageProperties;this.name=new Date().getTime();this.parentElement;this.spanElement;this.state=ToolBarButton.States.INITIALIZED;this.toolTipElement},construct:function(a){assertThat(a,not(nil()));this.parentElement=a;this.instantiateHtmlElements();this.state=ToolBarButton.States.CONSTRUCTED},destroy:function(){if(this.toolTipElement&&this.toolTipElement.destroy){this.toolTipElement.destroy()}if(this.imageElement&&this.imageElement.destroy){this.imageElement.destroy()}if(this.spanElement&&this.spanElement.destroy){this.spanElement.destroy()}if(this.anchorElement&&this.anchorElement.destroy){this.anchorElement.destroy()}if(this.listItemElement&&this.listItemElement.destroy){this.listItemElement.destroy()}this.state=ToolBarButton.States.INITIALIZED},onSelection:function(){this.fireEvent("onSelection",this)},unmarshall:function(){this.unmarshallProperties();this.state=ToolBarButton.States.UNMARSHALLED},getCaption:function(){return this.caption},getIconImage:function(){return this.iconImageUri},getMessageProperties:function(){return this.messageProperties},getName:function(){return this.name},getParentElement:function(){return this.parentElement},getState:function(){return this.state},instantiateHtmlElements:function(){var a=this.options.showCaption?this.caption:"";this.listItemElement=this.factory.create("li",null,this.parentElement,WidgetElementFactory.Positions.lastChild,{id:this.name});this.anchorElement=this.factory.createAnchor(a,null,this.onSelection,this.listItemElement,WidgetElementFactory.Positions.lastChild);this.spanElement=this.factory.create("span",null,this.anchorElement,WidgetElementFactory.Positions.lastChild,{"class":this.options.buttonStyle});this.imageElement=this.factory.create("img",null,this.spanElement,WidgetElementFactory.Positions.lastChild,{src:this.iconImageUri,alt:a});this.toolTipElement=this.factory.create("span",this.caption,this.anchorElement,WidgetElementFactory.Positions.lastChild,{"class":this.options.toolTipStyle})},unmarshallProperties:function(){this.caption=XmlResource.selectNodeText(this.options.captionSelector,this.definitionXml);this.iconImageUri=XmlResource.selectNodeText(this.options.iconImageSelector,this.definitionXml);this.messageProperties=XmlResource.selectNodeText(this.options.messagePropertiesSelector,this.definitionXml);this.name=XmlResource.selectNodeText(this.options.nameSelector,this.definitionXml)}.protect(),});ToolBarButton.States={UNINITIALIZED:0,INITIALIZED:1,UNMARSHALLED:2,CONSTRUCTED:3};var ToolBarButtonFactory=new Class({Implements:Options,options:{},initialize:function(){},create:function(d,c,a){var b;switch(d.tagName.toUpperCase()){case"DIVIDER":b=new ToolBarDivider(d,c,a);break;case"BUTTON":default:b=new ToolBarButton(d,c,a);break}return b}});ToolBarButtonFactory.create=function(f,d,b){var a=new ToolBarButtonFactory();var c=a.create(f,d,b);return c};var ToolBarDivider=new Class({Implements:Options,options:{dividerStyle:"toolBarDivider",iconImageSelector:"iconImage",dividerIconImageUri:"Desktops/Images/ToolboxDivider.jpg",namePrefix:"divider_"},initialize:function(c,a,b){this.setOptions(b);this.definitionXml=c;this.factory=a;this.dividerIconImageUri;this.imageElement;this.listItemElement;this.name=UniqueId.generate(this.options.namePrefix);this.parentElement;this.state=ToolBarButton.States.INITIALIZED;this.toolTipElement},construct:function(a){assertThat(a,not(nil()));this.parentElement=a;this.instantiateHtmlElements();this.state=ToolBarButton.States.CONSTRUCTED},destroy:function(){if(this.imageElement&&this.imageElement.destroy){this.imageElement.destroy()}if(this.spanElement&&this.spanElement.destroy){this.spanElement.destroy()}if(this.listItemElement&&this.listItemElement.destroy){this.listItemElement.destroy()}this.state=ToolBarButton.States.INITIALIZED},onSelection:function(){},unmarshall:function(){this.unmarshallProperties();this.state=ToolBarButton.States.UNMARSHALLED},getIconImage:function(){return this.dividerIconImageUri},getName:function(){return this.name},getParentElement:function(){return this.parentElement},getState:function(){return this.state},instantiateHtmlElements:function(){this.listItemElement=this.factory.create("li",null,this.parentElement,WidgetElementFactory.Positions.lastChild,{id:this.name});this.spanElement=this.factory.create("span",null,this.listItemElement,WidgetElementFactory.Positions.lastChild,{"class":this.options.dividerStyle});this.imageElement=this.factory.create("img",null,this.spanElement,WidgetElementFactory.Positions.lastChild,{src:this.dividerIconImageUri})},unmarshallProperties:function(){this.dividerIconImageUri=XmlResource.selectNodeText(this.options.iconImageSelector,this.definitionXml,null,this.options.dividerIconImageUri)}.protect(),});var ToolBarWidget=new Class({Extends:BrowserWidget,Binds:["onButtonSelection"],options:{buttonsSelector:"/toolBarDefinition/buttons/button | /toolBarDefinition/buttons/divider",componentName:"ToolBarWidget",descriptionSelector:"/toolBarDefinition/description",dividerIconImageUri:"Desktops/Images/ToolboxDivider.jpg",listStyleSelector:"/toolBarDefinition/buttons/@elementStyle",nameSelector:"/toolBarDefinition/name",showCaptionsSelector:"/toolBarDefinition/showCaptions"},initialize:function(a,b){this.parent(a,b);this.buttons=new LinkedHashMap();this.description;this.dividers=new ArrayList();this.name;this.listElement;this.listStyle;this.showCaptions=false;this.wrapperElement},construct:function(){this.constructHtmlElements();this.constructButtons();return this.parent()},destroy:function(){this.destroyButtons();this.destroyDividers();if(this.listElement&&this.listElement.destroy){this.listElement.destroy()}if(this.wrapperElement&&this.wrapperElement.destroy){this.wrapperElement.destroy()}this.parent()},onButtonSelection:function(button){var argumentText=button.getMessageProperties();var arguments=argumentText!=null?eval("("+argumentText+")"):null;arguments.originator=this.name;this.messageBus.notifySubscribers(new MenuSelectedMessage(arguments))},unmarshall:function(){this.unmarshallProperties();this.unmarshallButtons();return this.parent()},getButtons:function(){return this.buttons},getDescription:function(){return this.description},getListStyle:function(){return this.listStyle},getName:function(){return this.name},constructButtons:function(){this.buttons.each(function(a,c){var b=a.getValue();b.construct(this.listElement)},this)}.protect(),constructHtmlElements:function(){this.wrapperElement=this.elementFactory.create("div",null,this.containerElement,WidgetElementFactory.Positions.LastChild,{id:this.name});this.listElement=this.elementFactory.create("ul",null,this.wrapperElement,WidgetElementFactory.Positions.LastChild,{"class":this.listStyle})}.protect(),destroyButtons:function(){this.buttons.each(function(a,b){var c=a.getValue();c.destroy()},this);this.buttons.clear()}.protect(),destroyDividers:function(){this.buttons.each(function(b,a){b.destroy()},this);this.buttons.clear()}.protect(),unmarshallButtons:function(){var a=this.definitionXml.selectNodes(this.options.buttonsSelector);a.each(function(d,c){var b=ToolBarButtonFactory.create(d,this.elementFactory,{onSelection:this.onButtonSelection,showCaption:this.showCaptions,dividerIconImageUri:this.options.dividerIconImageUri});b.unmarshall();this.buttons.put(b.getName(),b)},this)}.protect(),unmarshallProperties:function(){this.description=this.definitionXml.selectNodeText(this.options.descriptionSelector);this.listStyle=this.definitionXml.selectNodeText(this.options.listStyleSelector);this.name=this.definitionXml.selectNodeText(this.options.nameSelector);this.showCaptions=parseBoolean(this.definitionXml.selectNodeText(this.options.showCaptionsSelector,null,false))}.protect()});var TreeNodeType=new Class({dMinusPicture:"minus.gif",dPlusPicture:"plus.gif",dMinus_lastPicture:"minus_last.gif",dPlus_lastPicture:"plus_last.gif",dMinus_nolinesPicture:"minus_nolines.gif",dMinus_no_rootPicture:"minus_no_root.gif",dMinus_last_no_rootPicture:"minus_last_no_root.gif",dPlus_nolinesPicture:"plus_nolines.gif",dPlus_no_rootPicture:"plus_no_root.gif",dPlus_last_no_rootPicture:"plus_last_no_root.gif",dT_no_rootPicture:"t_no_root.gif",Implements:[Options],options:{captionClass:"nodeCaption",captionClassWhenSelectable:"selectedHover",captionLinkClass:"nodeCaptionLink",componentName:"TreeNodeType",imagesFolder:"Images/",nodeClassWhenHidden:"hiddenNode",nodeClassWhenVisible:"nodeWrapper",nodeHandlerClass:"nodeHandler",nodeHandlerSourceWhenHasNext:"t.gif",nodeHandlerSourceWhenLast:"lastnode.gif",nodeIconClass:"nodeIcon",nodeImageClass:"nodeImage",nodeIconImages:{closedFolder:"folder_closed.gif",openedFolder:"folder_open.gif",help:"help_16x16.gif",page:"page16x16.gif",user:"user_16x16.gif"},trailingImageClass:"trailingImage",trailingImageWhenParentHasNext:"line.gif",trailingImageWhenParentIsLast:"white.gif"},initialize:function(a){this.setOptions(a)},determineNodeHandlerImage:function(a){return a.nextSibling?this.getNodeHandlerSourceWhenHasNext():this.getNodeHandlerSourceWhenLast()},determineNodeImage:function(a){return this.options.imagesFolder+this.options.nodeIconImages.page},getCaptionClass:function(){return this.options.captionClass},getCaptionClassWhenSelectable:function(){return this.options.captionClassWhenSelectable},getCaptionLinkClass:function(){return this.options.captionLinkClass},getImagesFolder:function(){return this.options.imagesFolder},getLineImageWhenLast:function(){return this.getImagesFolder()+this.options.lineImageWhenLast},getLineImageWhenHasNext:function(){return this.getImagesFolder()+this.options.lineImageWhenHasNext},getNodeHandlerClass:function(){return this.options.nodeHandlerClass},getNodeHandlerSourceWhenLast:function(){return this.getImagesFolder()+this.options.nodeHandlerSourceWhenLast},getNodeHandlerSourceWhenHasNext:function(){return this.getImagesFolder()+this.options.nodeHandlerSourceWhenHasNext},getNodeIconClass:function(){return this.options.nodeIconClass},getNodeIconSource:function(){return this.getImagesFolder()+this.options.nodeIconImages.page},getNodeImageClass:function(){return this.options.nodeImageClass},getNodeWrapperClass:function(){return this.options.nodeClassWhenVisible},getTrailingImageClass:function(){return this.options.trailingImageClass},getTrailingImageWhenParentHasNext:function(){return this.getImagesFolder()+this.options.trailingImageWhenParentHasNext},getTrailingImageWhenParentIsLast:function(){return this.getImagesFolder()+this.options.trailingImageWhenParentIsLast}});var CompositeTreeNodeType=new Class({Extends:TreeNodeType,options:{componentName:"CompositeTreeNodeType",nodeHandlerSourceWhenFirstAndClosed:"plus_last_no_root.gif",nodeHandlerSourceWhenFirstAndOpened:"minus_last_no_root.gif",nodeHandlerSourceWhenFirstAndHasNextAndClosed:"plus_no_root.gif",nodeHandlerSourceWhenFirstAndHasNextAndOpened:"minus_no_root.gif",nodeHandlerSourceWhenHasNextAndClosed:"plus.gif",nodeHandlerSourceWhenHasNextAndOpened:"minus.gif",nodeHandlerSourceWhenLastAndClosed:"plus_last.gif",nodeHandlerSourceWhenLastAndOpened:"minus_last.gif"},initialize:function(a){this.parent(a)},determineNodeHandlerImage:function(a){if(a.isOpened){if(a.previousSibling&&a.nextSibling){return this.getNodeHandlerSourceWhenHasNextAndOpened()}else{if(a.previousSibling&&!a.nextSibling){return this.getNodeHandlerSourceWhenLastAndOpened()}else{if(!a.previousSibling&&a.nextSibling){return this.getNodeHandlerSourceWhenFirstAndHasNextAndOpened()}}}}else{if(a.previousSibling&&a.nextSibling){return this.getNodeHandlerSourceWhenHasNextAndClosed()}else{if(a.previousSibling&&!a.nextSibling){return this.getNodeHandlerSourceWhenLastAndClosed()}else{if(!a.previousSibling&&a.nextSibling){return this.getNodeHandlerSourceWhenFirstAndHasNextAndClosed()}}}}},determineNodeImage:function(b){var a;if(b.isOpened){a=this.options.nodeIconImages.openedFolder}else{a=this.options.nodeIconImages.closedFolder}return this.getImagesFolder()+a},getLineImageWhenLast:function(a){if(a==this.getStateNameWhenClosed()){return this.getImagesFolder()+this.options.lineImageWhenLastAndCloseed}else{return this.getImagesFolder()+this.options.lineImageWhenLastAndOpened}},getLineImageWhenHasNext:function(a){if(a==this.getStateNameWhenClosed()){return this.getImagesFolder()+this.options.lineImageWhenHasNextAndClosed}else{return this.getImagesFolder()+this.options.lineImageWhenHasNextAndOpened}},getNodeHandlerSourceWhenFirstAndClosed:function(){return this.getImagesFolder()+this.options.nodeHandlerSourceWhenFirstAndClosed},getNodeHandlerSourceWhenFirstAndOpened:function(){return this.getImagesFolder()+this.options.nodeHandlerSourceWhenFirstAndOpened},getNodeHandlerSourceWhenFirstAndHasNextAndClosed:function(){return this.getImagesFolder()+this.options.nodeHandlerSourceWhenFirstAndHasNextAndClosed},getNodeHandlerSourceWhenFirstAndHasNextAndOpened:function(){return this.getImagesFolder()+this.options.nodeHandlerSourceWhenFirstAndHasNextAndOpened},getNodeHandlerSourceWhenHasNextAndClosed:function(){return this.getImagesFolder()+this.options.nodeHandlerSourceWhenHasNextAndClosed},getNodeHandlerSourceWhenHasNextAndOpened:function(){return this.getImagesFolder()+this.options.nodeHandlerSourceWhenHasNextAndOpened},getNodeHandlerSourceWhenLastAndClosed:function(){return this.getImagesFolder()+this.options.nodeHandlerSourceWhenLastAndClosed},getNodeHandlerSourceWhenLastAndOpened:function(){return this.getImagesFolder()+this.options.nodeHandlerSourceWhenLastAndOpened},getStateNameWhenClosed:function(){return this.CLOSED_STATE},getStateNameWhenOpened:function(){return this.OPENED_STATE}});folderNodeType=new CompositeTreeNodeType("folder","folder_closed.gif","folder_open.gif");userNodeType=new TreeNodeType("user","user_16x16.gif");pageNodeType=new TreeNodeType("page","page16x16.gif");helpNodeType=new TreeNodeType("help","help_16x16.gif");var TreeNode=new Class({Implements:[Events,Options],Binds:["addNodeEvents","createNodeCaption","createNodeHandlerImage","createNodeIcon","createNodeWrapperElement","finalizeConstruction","insertTrailingImages","onCaptionClick"],options:{captionSelector:"@caption",componentName:"TreeNode",dataXmlNameSpace:"xmlns:pp='http://www.processpuzzle.com'",imageUriSelector:"@image",messageSelector:"messageProperties",nodeIDSelector:"@nodeId",orderNumberSelector:"@orderNumber",selectable:false,target:"_blank",url:null},initialize:function(a,c,f,b,d){assertThat(c,not(nil()));assertThat(f,not(nil()));assertThat(b,not(nil()));this.setOptions(d);this.caption;this.constructionChain=new Chain();this.containerElement;this.elementFactory=b;this.imageUri;this.message;this.nodeCaptionElement;this.nodeHandlerElement;this.nodeIconElement;this.nodeResource=f;this.nodeWrapperElement;this.nextSibling;this.nodeID;this.nodeType=c;this.orderNumber;this.parentNode=a;this.previousSibling;this.selectPicElement;this.state;this.trailingImages=new ArrayList();this.state=BrowserWidget.States.INITIALIZED},bubbleUpNames:function(){return this.parentNode?this.parentNode.bubbleUpNames()+"/"+this.caption:this.caption},changeCaption:function(){this.caption=this.webUiController.getText(this.name);if(this.nodeCaptionElement!=null&&this.captionTextNode!=null){this.nodeCaptionElement.removeChild(this.captionTextNode);this.captionTextNode=document.createTextNode(this.caption);this.nodeCaptionElement.appendChild(this.captionTextNode)}for(var a=0;a<this.childs.length;a++){this.childs[a].changeCaption(this.webUiController)}},construct:function(){if(this.state==BrowserWidget.States.UNMARSHALLED){this.compileConstructionChain();this.constructionChain.callChain()}},destroy:function(){this.destroyNodeElement(this.nodeHandlerElement);this.destroyNodeElement(this.nodeIconElement);this.destroyNodeElement(this.nodeCaptionElement);this.destroyNodeElement(this.nodeWrapperElement);this.destroyTrailingImages();this.state=BrowserWidget.States.INITIALIZED},findNodeByPath:function(a){if(a==this.caption){return this}else{null}},onCaptionClick:function(){this.fireEvent("nodeSelected",this)},unmarshall:function(){this.unmarshallProperties();this.unmarshallMessage();this.state=BrowserWidget.States.UNMARSHALLED},getCaption:function(){return this.caption},getCaptionElement:function(){return this.nodeCaptionElement},getContainerElement:function(){return this.containerElement},getId:function(){return this.nodeID},getImageUri:function(){return this.imageUri},getMessage:function(){return this.message},getNodeImageElement:function(){return this.nodeIconElement},getNextSibling:function(){return this.nextSibling},getNodeType:function(){return this.nodeType},getNodeWrapperElement:function(){return this.nodeWrapperElement},getOrderNumber:function(){return this.orderNumber},getParentNode:function(){return this.parentNode},getPreviousSibling:function(){return this.previousSibling},hasNext:function(){return !(this.nextSibling==null)},isVisible:function(){return this.visible},addNodeEvents:function(){this.nodeCaptionElement.addEvents({click:this.onCaptionClick});this.constructionChain.callChain()}.protect(),compileConstructionChain:function(){this.constructionChain.chain(this.createNodeWrapperElement,this.createNodeHandlerImage,this.createNodeIcon,this.createNodeCaption,this.insertTrailingImages,this.addNodeEvents,this.finalizeConstruction)}.protect(),createNodeCaption:function(b){var a={"class":this.nodeType.getCaptionClass(),id:this.nodeID};this.nodeCaptionElement=this.elementFactory.create("span",this.caption,this.nodeWrapperElement,WidgetElementFactory.Positions.LastChild,a);this.constructionChain.callChain()}.protect(),createNodeHandlerImage:function(){var a={"class":this.nodeType.getNodeHandlerClass()+" "+this.nodeType.getNodeImageClass(),src:this.nodeType.determineNodeHandlerImage(this)};this.nodeHandlerElement=this.elementFactory.create("img",null,this.nodeWrapperElement,WidgetElementFactory.Positions.LastChild,a);this.constructionChain.callChain()}.protect(),createNodeIcon:function(){var a={"class":this.nodeType.getNodeIconClass()+" "+this.nodeType.getNodeImageClass(),src:this.imageUri};this.nodeIconElement=this.elementFactory.create("img",null,this.nodeWrapperElement,WidgetElementFactory.Positions.LastChild,a);this.constructionChain.callChain()}.protect(),createNodeWrapperElement:function(){var a=this.determineWrapperContextElement();var c=this.determinWrapperContextPosition();var b={"class":this.nodeType.getNodeWrapperClass()};this.nodeWrapperElement=this.elementFactory.create("div",null,a,c,b);this.constructionChain.callChain()}.protect(),destroyNodeElement:function(a){if(a&&a.removeEvents){a.removeEvents()}if(a&&a.destroy){a.destroy()}}.protect(),destroyTrailingImages:function(){this.trailingImages.each(function(b,a){this.destroyNodeElement(b)}.bind(this));this.trailingImages.clear()}.protect(),determineWrapperContextElement:function(){if(this.previousSibling){if(instanceOf(this.previousSibling,CompositeTreeNode)){return this.previousSibling.findLastVisibleChild().getNodeWrapperElement()}else{return this.previousSibling.getNodeWrapperElement()}}else{return this.parentNode.getNodeWrapperElement()}}.protect(),determinWrapperContextPosition:function(){if(this.previousSibling||(this.parentNode&&!instanceOf(this.parentNode,RootTreeNode))){return WidgetElementFactory.Positions.After}else{return WidgetElementFactory.Positions.LastChild}}.protect(),finalizeConstruction:function(){this.state=BrowserWidget.States.CONSTRUCTED;this.constructionChain.clearChain();this.fireEvent("constructed",this)}.protect(),implementCompositeIfChildNodesExists:function(){var a=XmlResource.selectNodes(this.options.childNodesSelector,this.nodeResource);if(a){this.implement({alert:function(b){alert(b)}});this.unmarshallChildNodes()}}.protect(),insertTrailingImages:function(c,d){var b=this.getParentNode();while(b){var f=b.hasNext()?this.nodeType.getTrailingImageWhenParentHasNext():this.nodeType.getTrailingImageWhenParentIsLast();var a={"class":this.nodeType.getTrailingImageClass()+" "+this.nodeType.getNodeImageClass(),src:f};this.trailingImages.add(this.elementFactory.create("img",null,this.nodeWrapperElement,WidgetElementFactory.Positions.FirstChild,a));b=b.getParentNode()}this.constructionChain.callChain()}.protect(),unmarshallMessage:function(){var a=XmlResource.selectNode(this.options.messageSelector,this.nodeResource);if(a){this.message=new MenuSelectedMessage({messageResource:a});this.message.unmarshall()}}.protect(),unmarshallProperties:function(){this.nodeID=XmlResource.selectNodeText(this.options.nodeIDSelector,this.nodeResource);this.caption=XmlResource.selectNodeText(this.options.captionSelector,this.nodeResource);this.imageUri=XmlResource.selectNodeText(this.options.imageUriSelector,this.nodeResource,this.options.dataXmlNameSpace,this.nodeType.determineNodeImage(this));this.orderNumber=XmlResource.selectNodeText(this.options.orderNumberSelector,this.nodeResource)}.protect()});var CompositeTreeNode=new Class({Extends:TreeNode,Binds:["constructChildNodes","onChildNodeConstructed","onNodeHandlerClick","onNodeSelected"],constants:{NODE_PATH_SEPARATOR:"/"},options:{childNodesSelector:"treeNode",componentName:"CompositeTreeNode",initialyOpened:false,isOpenedSelector:"@isOpened"},initialize:function(a,c,f,b,d){this.parent(a,c,f,b,d);this.childNodes=new ArrayList();this.isOpened=this.options.initialyOpened;this.numberOfConstructedChildNodes=0},close:function(){if(this.isOpened){this.isOpened=false;this.destroyChildNodes();this.replaceNodeImage();this.replaceNodeHandlerImage()}},construct:function(){this.parent()},destroy:function(){this.destroyChildNodes();this.parent()},findChildNodeByName:function(a){var b=null;this.childNodes.each(function(d,c){if(d.getCaption()==a){b=d}}.bind(this));return b},findLastVisibleChild:function(){if(this.isOpened){var a=this.childNodes.getLast();if(instanceOf(a,CompositeTreeNode)){return a.findLastVisibleChild()}else{return a}}else{return this}},findNodeByPath:function(c){if(this.pathStartsWithThisNode(c)){if(this.pathRefersToSubnode(c)){var b=this.nextNodeNameInPath(c);var a=this.findChildNodeByName(b);if(a!=null){return a.findNodeByPath(this.nextNodePathFragment(c))}else{return null}}else{return this}}else{return this.findChildNodeByName(c)}},onChildNodeConstructed:function(a){this.numberOfConstructedChildNodes++;if(this.numberOfConstructedChildNodes==this.childNodes.size()){this.constructionChain.callChain()}},onNodeHandlerClick:function(){if(this.isOpened){this.close()}else{this.open()}},onNodeSelected:function(a){this.fireEvent("nodeSelected",a)},open:function(){if(!this.isOpened){this.isOpened=true;this.unmarshallChildNodes();this.constructChildNodes();this.replaceNodeImage();this.replaceNodeHandlerImage()}},unmarshall:function(){this.unmarshallChildNodes();this.parent()},getChildCount:function(){return this.childNodes.length},getChildNodes:function(){return this.childNodes},getFirstChild:function(){if(this.hasChilds()){return this.childNodes[0]}return null},getLastChild:function(){if(this.hasChilds()){return this.childNodes[this.childNodes.length-1]}return null},getState:function(){return this.state},hasChilds:function(){return(this.childNodes.length>0)},appendNodeImage:function(){this.parent();this.nodeImageElement.set("src",this.nodeType.determineNodeImage(this.options.state));this.nodeImageElement.addEvent("click",this.onFolderClickHandler)}.protect(),compileConstructionChain:function(){this.constructionChain.chain(this.createNodeWrapperElement,this.createNodeHandlerImage,this.createNodeIcon,this.createNodeCaption,this.insertTrailingImages,this.constructChildNodes,this.finalizeConstruction)}.protect(),constructChildNodes:function(){if(this.isOpened){this.childNodes.each(function(b,a){b.construct()}.bind(this))}else{this.constructionChain.callChain()}}.protect(),createNodeHandlerImage:function(){this.parent();this.nodeHandlerElement.addEvent("click",this.onNodeHandlerClick)}.protect(),currentNodeNameInPath:function(a){return a.indexOf(this.constants.NODE_PATH_SEPARATOR)>=0?a.substring(0,a.indexOf(this.constants.NODE_PATH_SEPARATOR)):a}.protect(),destroyChildNodes:function(){this.childNodes.each(function(b,a){b.destroy()}.bind(this));this.childNodes.clear();this.numberOfConstructedChildNodes=0}.protect(),nextNodePathFragment:function(a){return a.indexOf(this.constants.NODE_PATH_SEPARATOR)>=0?a.substring(a.indexOf(this.constants.NODE_PATH_SEPARATOR)+1):a}.protect(),nextNodeNameInPath:function(a){var b=a.substring(this.currentNodeNameInPath(a).length+1);return this.currentNodeNameInPath(b)}.protect(),pathRefersToSubnode:function(a){return a.indexOf(this.constants.NODE_PATH_SEPARATOR)>0}.protect(),pathStartsWithThisNode:function(a){return this.currentNodeNameInPath(a)==this.caption}.protect(),replaceNodeHandlerImage:function(){this.nodeHandlerElement.set("src",this.nodeType.determineNodeHandlerImage(this))}.protect(),replaceNodeImage:function(){this.nodeIconElement.set("src",this.nodeType.determineNodeImage(this))}.protect(),unmarshallChildNodes:function(){this.childNodes.clear();var a=XmlResource.selectNodes(this.options.childNodesSelector,this.nodeResource);if(a){a.each(function(b,c){var d=TreeNodeFactory.create(this,b,this.elementFactory,{onConstructed:this.onChildNodeConstructed,onNodeSelected:this.onNodeSelected});if(c>0&&c<a.length){this.childNodes.get(c-1).nextSibling=d;d.previousSibling=this.childNodes.get(c-1)}d.unmarshall();this.childNodes.add(d)}.bind(this))}}.protect(),unmarshallProperties:function(){this.isOpened=parseBoolean(XmlResource.selectNodeText(this.options.isOpenedSelector,this.nodeResource,this.options.dataXmlNameSpace,this.options.initialyOpened));this.parent()}.protect()});CompositeTreeNode.States={CLOSED:"closed",OPENED:"opened"};var LeafTreeNode=new Class({Extends:TreeNode,options:{componentName:"LeafTreeNode",},initialize:function(a,c,f,b,d){this.parent(a,c,f,b,d)}});var RootTreeNode=new Class({Extends:CompositeTreeNode,options:{componentName:"RootTreeNode",initialyOpened:true,isVisible:false},initialize:function(b,d,a,c){this.parent(null,b,d,a,c);this.containerElement;this.isVisible=false},construct:function(a){this.containerElement=a;this.parent()},getNodeWrapperElement:function(){return this.isVisible?this.nodeWrapperElement:this.containerElement},getWidgetElement:function(){return widgetElement},compileConstructionChain:function(){if(this.options.isVisible){this.constructionChain.chain(this.createNodeWrapperElement,this.createNodeHandlerImage,this.createNodeIcon,this.createNodeCaption,this.insertTrailingImages,this.constructChildNodes,this.finalizeConstruction)}else{this.constructionChain.chain(this.constructChildNodes,this.finalizeConstruction)}}.protect(),determineWrapperContextElement:function(){return this.containerElement}.protect(),determinWrapperContenxtPosition:function(){return WidgetElementFactory.Positions.LastChild}.protect(),finalizeConstruction:function(){if(this.options.isVisible){this.parent()}else{this.state=BrowserWidget.States.UNMARSHALLED;this.constructionChain.clearChain();this.fireEvent("constructed",this)}}.protect()});var RootTreeNodeType=new Class({Extends:CompositeTreeNodeType,options:{componentName:"RootTreeNodeType",nodeHandlerSourceWhenHasNextAndClosed:"plus_no_root.gif",nodeHandlerSourceWhenHasNextAndOpened:"minus_no_root.gif",},initialize:function(a){this.parent(a)},});var TreeNodeFactory=new Class({Implements:Options,options:{nodeTypeOptions:{}},initialize:function(a){this.setOptions(a);this.treeNodeType=new TreeNodeType(this.options.nodeTypeOptions);this.compositeTreeNodeType=new CompositeTreeNodeType(this.options.nodeTypeOptions);this.rootTreeNodeType=new RootTreeNodeType(this.options.nodeTypeOptions)},create:function(a,g,c,d){var b=XmlResource.selectNodes("treeNode",g).length>0?true:false;var f;if(b){f=new CompositeTreeNode(a,this.compositeTreeNodeType,g,c,d)}else{f=new LeafTreeNode(a,this.treeNodeType,g,c,d)}return f},getCompositeTreeNodeType:function(){return this.compositeTreeNodeType},getRootTreeNodeType:function(){return this.rootTreeNodeType},getTreeNodeType:function(){return this.treeNodeType}});TreeNodeFactory.create=function(a,d,c,b){if(!TreeNodeFactory.singleInstance){TreeNodeFactory.singleInstance=new TreeNodeFactory()}return TreeNodeFactory.singleInstance.create(a,d,c,b)};TreeNodeFactory.singleInstance;var TreeWidget=new Class({Extends:BrowserWidget,Binds:["constructTreeNodes","destroyTreeNodes","onNodeSelected","onRootNodeConstructed"],constants:{},options:{componentName:"TreeWidget",imagesFolder:"",nodeOptions:{},nodeTypeOptions:{},pathSeparator:".",rootNodeSelector:"//pp:treeDefinition/rootNode",showRootNode:false,widgetContainerId:"TreeWidget"},initialize:function(a,c,b){this.parent(a,c,b);this.compositeTreeNodeType;this.rootNode;this.rootNodeType;this.selectedNode;this.treeNodeType;this.instantiateNodeFactory();this.instantiateNodeTypes()},changeCaptions:function(){if(this.rootNode!=null){this.rootNode.changeCaption(this.controller)}},construct:function(){this.parent()},destroy:function(){this.parent()},findNodeByPath:function(a){return this.rootNode?this.rootNode.findNodeByPath(a):null},getSelectedNode:function(){if(this.getSelectedNameListSize()==0){return null}return this.rootNode.findNodeByPath(this.getSelectedNodeFullCaption())},onNodeSelected:function(a){this.selectedNode=a;this.messageBus.notifySubscribers(this.adjustMessage(a.getMessage()))},onRootNodeConstructed:function(a){this.constructionChain.callChain()},unmarshall:function(){this.unmarshallRootNode()},getCompositeTreeNodeType:function(){return this.compositeTreeNodeType},getRootNode:function(){return this.rootNode},getSelectedNameList:function(){return this.selectedNameList},getSelectedNameListSize:function(){return this.selectedNameListSize},getTreeNodeType:function(){return this.treeNodeType},adjustMessage:function(a){a.options.originator=this.options.componentName;return a}.protect(),compileConstructionChain:function(){this.constructionChain.chain(this.constructTreeNodes,this.finalizeConstruction)}.protect(),compileDestructionChain:function(){this.destructionChain.chain(this.destroyTreeNodes,this.finalizeDestruction)}.protect(),constructTreeNodes:function(){this.rootNode.construct(this.containerElement)}.protect(),destroyTreeNodes:function(){this.rootNode.destroy();this.rootNode=null;this.destructionChain.callChain()}.protect(),instantiateNodeFactory:function(){TreeNodeFactory.singleInstance=new TreeNodeFactory({nodeTypeOptions:this.options.nodeTypeOptions})}.protect(),instantiateNodeTypes:function(){this.treeNodeType=TreeNodeFactory.singleInstance.getTreeNodeType();this.compositeTreeNodeType=TreeNodeFactory.singleInstance.getCompositeTreeNodeType();this.rootNodeType=TreeNodeFactory.singleInstance.getRootTreeNodeType()}.protect(),unmarshallRootNode:function(){var a=this.dataXml.selectNode(this.options.rootNodeSelector);if(a){var b=Object.merge(this.options.nodeOptions,{isVisible:this.options.showRootNode,onConstructed:this.onRootNodeConstructed,onNodeSelected:this.onNodeSelected});this.rootNode=new RootTreeNode(this.rootNodeType,a,this.elementFactory,this.options.nodeOptions);this.rootNode.unmarshall()}}.protect()});var VideoPlayerWidget=new Class({Extends:ToolBarWidget,options:{componentName:"VideoPlayerWidget",descriptionSelector:"/pp:widgetDefinition/description",nameSelector:"/pp:widgetDefinition/name"},initialize:function(a,b){this.setOptions(a);this.parent(a,b)},construct:function(){return this.parent()},destroy:function(){this.parent()},unmarshall:function(){return this.parent()},});function getWebUIController(){try{return parent.webUIController}catch(a){return null}}function loadDocument(a,b,c){getWebUIController().loadDocument(a,b,c)}function loadInfo(a,b,c){getWebUIController().loadInfoPanelDocument(a,b,c)}function setToDirty(){getWebUIController().getDocumentManager().getActiveDocument().setToDirty()}function setToClean(){getWebUIController().getDocumentManager().getActiveDocument().setToClean()}function saveDocument(){getWebUIController().getDocumentManager().getActiveDocument().save()}function cancelModification(){getWebUIController().getDocumentManager().getActiveDocument().cancel()}var UnconfiguredWebUIControllerException=new Class({Extends:WebUIException,options:{description:"WebUIController is unconfigured, therefore the requested operation can't be carried out.",name:"UnconfiguredWebUIControllerException"},initialize:function(a){this.setOptions(a);this.parent(a)}});ROOT_LOGGER_NAME="WebUI";FRONT_CONTROLLER="CommandControllerServlet";var WebUIController=new Class({Implements:[Class.Singleton,Events,Options],Binds:["changeLanguage","constructDesktop","configureLogger","destroySplashForm","determineCurrentUserLocale","finalizeConfiguration","loadDocument","loadInternationalizations","loadWebUIConfiguration","onDesktopComponentConstructed","onDesktopConstructed","onError","restoreComponentsState","storeComponentsState","storeWebUIState","subscribeToWebUIMessages","webUIMessageHandler"],options:{artifactTypesXslt:"Commons/JavaScript/WebUIController/TransformBusinessDefinitionToArtifactTypes.xsl",compatibleBrowserVersions:{ie:8,firefox:4,safari:4,chrome:10,opera:10},componentName:"WebUIController",configurationUri:"Configuration.xml",contextRootPrefix:"../../",eraseStateWhenSkinChange:false,errorPageUri:"Commons/FrontController/WebUiError.jsp",eventFireDelay:5,languageSelectorElementId:"LanguageSelectorWidget",loggerGroupName:"WebUIController",messageOriginator:"webUIController",reConfigurationDelay:500,showSplashForm:false,splashFormUri:"Desktops/Images/SplashForm.png",unsupportedBrowserMessage:"We appologize. This site utilizes more modern browsers, namely: Internet Explorer 8+, FireFox 4+, Chrome 10+, Safari 4+",urlRefreshPeriod:1000},initialize:function(b,a){return this.check()||this.setUp(b,a)},setUp:function(b,a){this.setOptions(b);if(a!=null&&a!="undefined"){this.options.window=a}this.configurationChain=new Chain();this.desktop;this.error;this.isConfigured=false;this.languageSelector;this.locale;this.logger;this.messageBus=new WebUIMessageBus();this.resourceBundle;this.prefferedLanguage;this.recentHash=this.determineCurrentHash();this.refreshUrlTimer;this.skin;this.splashForm;this.stateManager;this.userName;this.userLocation;this.warningContainer;this.webUIConfiguration;this.webUIException;if(this.browserIsSupported()){if(this.options.showSplashForm){this.showSplashForm()}this.loadWebUIConfiguration();this.updateOptionsWithConfiguration();this.configureLogger();this.instantiateComponentStateManager();this.restoreComponentsState(),this.determineCurrentUserLocale();this.determineDefaultSkin();this.loadInternationalizations();this.logger.debug("Browser Interface is initialized with context root prefix: "+this.options.contextRootPrefix)}else{this.showWebUIExceptionPage(new Error(this.options.unsupportedBrowserMessage))}}.protect(),changeLanguage:function(a){this.logger.debug(this.options.componentName+".changeLanguage().");this.destroy();if(this.options.showSplashForm){this.showSplashForm()}this.locale=a;this.configure.delay(this.options.reConfigurationDelay,this)},changeSkin:function(a){this.logger.debug(this.options.componentName+".changeSkin().");if(a!=this.getCurrentSkin()){if(this.options.eraseStateWhenSkinChange){this.stateManager.reset()}this.destroy();if(this.options.showSplashForm){this.showSplashForm()}this.skin=a;this.configure.delay(this.options.reConfigurationDelay,this)}},configure:function(){this.configurationChain.chain(this.loadWebUIConfiguration,this.configureLogger,this.restoreComponentsState,this.determineCurrentUserLocale,this.loadInternationalizations,this.constructDesktop,this.subscribeToWebUIMessages,this.storeWebUIState,this.destroySplashForm,this.finalizeConfiguration).callChain()},destroy:function(){if(this.isConfigured){this.locale=null;this.messageBus.tearDown();if(this.languageSelector){this.languageSelector.destroy()}this.desktop.destroy();this.webUIConfiguration.release();this.resourceBundle.release();window.location.hash="";clearInterval(this.refreshUrlTimer);this.isConfigured=false}},loadDocument:function(f,b,c,a){this.logger.debug(this.options.componentName+".loadDocument( '"+f+"' )");var d=new MenuSelectedMessage({activityType:AbstractDocument.Activity.LOAD_DOCUMENT,documentType:a,documentURI:f,documentContentURI:b,documentVariables:c,originator:this.options.messageOriginator});this.messageBus.notifySubscribers(d)},loadHtmlDocument:function(a){this.loadDocument(a,null,null,AbstractDocument.Types.HTML)},loadSmartDocument:function(c,a,b){this.loadDocument(c,a,b,AbstractDocument.Types.SMART)},onDesktopComponentConstructed:function(a){if(this.splashForm){this.splashForm.updateStatus(a)}},onDesktopConstructed:function(){this.logger.debug(this.options.componentName+", constructing desktop is finished.");this.configurationChain.callChain()},onError:function(a){this.error=a;this.showWebUIExceptionPage(this.error)},restoreComponentsState:function(){this.logger.debug(this.options.componentName+".restoreComponentsState() started.");this.stateManager.restore();if(window.location.hash.substring(2)){var a=this.stateManager.toString();try{this.stateManager.parseUri(window.location.hash.substring(2));this.messageBus.notifySubscribers(new WebUIStateRestoredMessage())}catch(b){this.stateManager.parse(a);this.logger.debug("restoreComponentsState() exception: "+b)}}this.configurationChain.callChain()},storeComponentsState:function(){this.stateManager.persist();var a=this.stateManager.toUri();if(this.recentHash!=a){this.recentHash=a;window.location.hash="!"+a}},webUIMessageHandler:function(a){if(!this.isConfigured){throw new UnconfiguredWebUIControllerException({source:"WebUIController.webUIMessageHandler()"})}if(instanceOf(a,LanguageChangedMessage)&&a.getNewLocale()!=this.getCurrentLocale()){this.changeLanguage(a.getNewLocale())}else{if(instanceOf(a,SkinChangedMessage)){this.changeSkin(a.getNewSkin())}else{if(instanceOf(a,MenuSelectedMessage)&&a.getActionType()=="changeSkin"){this.changeSkin(a.getProperty("skinName"))}}}this.lastHandledMessage=a},getContextRootPrefix:function(){return this.contextRootPrefix},getCurrentLocale:function(){return this.locale},getCurrentSkin:function(){return this.skin},getDesktop:function(){return this.desktop},getIsConfigured:function(){return this.isConfigured},getLanguageSelector:function(){return this.languageSelector},getLocale:function(){return this.locale},getLogger:function(){return this.logger},getMessageBus:function(){return this.messageBus},getPrefferedLanguage:function(){return this.prefferedLanguage},getResourceBundle:function(){return this.resourceBundle},getStateManager:function(){return this.stateManager},getText:function(b,a){return this.getTextInternal(b,a)},getUserLocation:function(){return this.userLocation},getUserName:function(){return this.userName},getWebUIConfiguration:function(){return this.webUIConfiguration},getWebUIException:function(){return this.webUiException},setUserLocation:function(a){this.userLocation=a},setUserName:function(a){this.userName=a},setLanguage:function(a){this.setLanguageInternal(a)},browserIsSupported:function(){if(Browser.version>=this.options.compatibleBrowserVersions[Browser.name]){return true}else{return false}}.protect(),configureLogger:function(){this.logger=new WebUILogger(this.webUIConfiguration);this.logger.debug(this.options.componentName+".configureLogger() started.");this.configurationChain.callChain()}.protect(),constructDesktop:function(){this.logger.debug(this.options.componentName+".constructDesktop() started.");var a=this.webUIConfiguration.getSkinConfiguration(this.skin);this.desktop=new Desktop(this.webUIConfiguration,this.resourceBundle,{configurationURI:a,onDesktopComponentConstructed:this.onDesktopComponentConstructed,onConstructed:this.onDesktopConstructed,onError:this.onError});this.desktop.unmarshall();try{this.desktop.construct()}catch(b){this.onError(b)}}.protect(),destroySplashForm:function(){if(this.splashForm){this.splashForm.destroy()}this.configurationChain.callChain()}.protect(),determineCurrentHash:function(){if(window.location.hash.indexOf("#")!=-1){return window.location.hash.substring(1)}else{return""}}.protect(),determineCurrentUserLocale:function(){this.logger.debug(this.options.componentName+".determineCurrentUserLocale() started.");var a=new ProcessPuzzleLocale();a.parse(navigator.language||navigator.userLanguage);a.options.country=null;a.options.variant=null;if(this.locale==null){var c=this.stateManager.retrieveComponentState(this.options.componentName);if(c){var b=c.locale;this.locale=new ProcessPuzzleLocale();this.locale.parse(b)}else{if(this.webUIConfiguration.isSupportedLocale(a)){this.locale=a}else{this.locale=new ProcessPuzzleLocale();this.locale.parse(this.webUIConfiguration.getI18DefaultLocale())}}}this.configurationChain.callChain()}.protect(),determineDefaultSkin:function(){this.skin=this.webUIConfiguration.getDefaultSkin()}.protect(),finalizeConfiguration:function(){this.refreshUrlTimer=this.storeComponentsState.periodical(this.options.urlRefreshPeriod,this);this.isConfigured=true;this.fireEvent("configured",this,this.options.eventFireDelay)}.protect(),getTextInternal:function(c,a){if(this.resourceBundle==null){if(a!=null){return a}else{return c}}var d;try{d=this.resourceBundle.getText(c)}catch(f){if(f instanceof IllegalArgumentException){if(a!=null){return a}return c}else{var b=new UserException("Unknown problem occured.","WebUIController getText()");throw b}}return d}.protect(),instantiateComponentStateManager:function(){var a=this.webUIConfiguration.getApplicationName();a+="."+this.webUIConfiguration.getApplicationVersion();a+=".ComponentStateManager";this.stateManager=new ComponentStateManager({componentName:a})}.protect(),loadInternationalizations:function(){this.logger.debug(this.options.componentName+".loadInternationalizations() started.");try{this.resourceBundle=new XMLResourceBundle(this.webUIConfiguration);this.resourceBundle.load(this.locale);this.logger.debug("Resource bundles: "+this.options.contextRootPrefix+this.resourceBundle.getResourceBundleNames()+" was loaded.")}catch(a){this.onError(a)}this.configurationChain.callChain()}.protect(),loadWebUIConfiguration:function(){try{this.webUIConfiguration=new WebUIConfiguration(this.options.configurationUri);if(!this.webUIConfiguration.isLoaded){this.webUIConfiguration.load()}}catch(a){this.onError(a)}this.configurationChain.callChain()}.protect(),setLanguage:function(b){this.logger.debug(this.options.componentName+".setLanguage() started.");prefferedLanguage=b;if(b!=null){var a=new ProcessPuzzleLocale(b);if(applicationConfiguration!=null){applicationConfiguration.setLocale(a);this.loadInternationalizations(applicationConfiguration.getBundlePath(),a)}}}.protect(),showSplashForm:function(){this.splashForm=new SplashForm({imageUri:this.options.splashFormUri});this.splashForm.construct()}.protect(),showWebUIExceptionPage:function(c){var d=$$("body");this.warningContainer=new Element("div",{id:"warning"});d.grab(this.warningContainer,"top");var g=new Element("h1");g.appendText("Error Occured");this.warningContainer.grab(g);var a=new Element("h3");a.appendText(c.name);this.warningContainer.grab(a);var b=new Element("p");b.appendText(c.message);this.warningContainer.grab(b);var f=new Element("p");if(c.stack){f.appendText(c.stack);this.warningContainer.grab(f)}}.protect(),storeWebUIState:function(){this.logger.debug(this.options.componentName+".storeWebUIState() started.");this.stateManager.storeComponentState(this.options.componentName,{locale:this.locale.toString()});this.configurationChain.callChain()}.protect(),subscribeToWebUIMessages:function(){this.logger.debug(this.options.componentName+".subscribeToWebUIMessages() started.");this.messageBus.subscribeToMessage(LanguageChangedMessage,this.webUIMessageHandler);this.messageBus.subscribeToMessage(MenuSelectedMessage,this.webUIMessageHandler);this.messageBus.subscribeToMessage(SkinChangedMessage,this.webUIMessageHandler);this.configurationChain.callChain()}.protect(),updateOptionsWithConfiguration:function(){this.options.eraseStateWhenSkinChange=this.webUIConfiguration.getEraseStateWhenSkinChange()}});var WebUIStateRestoredMessage=new Class({Extends:WebUIMessage,options:{description:"State of Web User Interface restored from URL.",name:"WebUIStateRestoredMessage"},initialize:function(a){this.setOptions(a);this.options.messageClass=WebUIStateRestoredMessage}});var TestMessageOne=new Class({Extends:WebUIMessage,options:{description:"Test Message One description",name:"Test Message One"},initialize:function(a){this.setOptions(a);this.options.messageClass=TestMessageOne}});var TestMessageTwo=new Class({Extends:WebUIMessage,options:{description:"Test Message Two description",name:"Test Message Two"},initialize:function(a){this.setOptions(a);this.options.messageClass=TestMessageTwo}});