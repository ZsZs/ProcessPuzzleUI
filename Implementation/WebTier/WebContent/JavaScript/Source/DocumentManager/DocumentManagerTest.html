<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
	<title>Test page for DocumentManager.js</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link type="text/css" rel="stylesheet" href="../JsUnit/app/css/jsUnitStyle.css">

	<!--[if IE]>
	    <script type="text/javascript" src="../../Libraries/MochaUI/excanvas.js"></script>
	<![endif]--> 
    
    <script type="text/javascript" src="../../Libraries/JsHamcrest/jshamcrest.js"></script>
    <script type="text/javascript" src="../../Libraries/Log4JavaScript/log4javascript.js"></script>
    <script type="text/javascript" src="../../Libraries/MooTools/mootools-core-1.4.0-full-compat.js"></script>
    <script type="text/javascript" src="../../Libraries/MooTools/mootools-more-1.4.0.1.js"></script>
    <script type="text/javascript" src="../../Libraries/MochaUI/Core.js"></script>
    <script type="text/javascript" src="../../Libraries/MochaUI/Dock.js"></script>
    <script type="text/javascript" src="../../Libraries/MochaUI/Layout.js"></script>
    <script type="text/javascript" src="../../Libraries/MochaUI/Tabs.js"></script>
    <script type="text/javascript" src="../../Libraries/MochaUI/Window.js"></script>
    <script type="text/javascript" src="../../Libraries/MochaUI/Modal.js"></script>
    <script type="text/javascript" src="../../Libraries/RemoteStyleSheet/RemoteStyleSheet.js"></script>
	<script type="text/javascript" src="../../Libraries/Sarissa/sarissa.js"></script>  
    <script type="text/javascript" src="../../Libraries/Sarissa/sarissa_ieemu_xpath.js"></script>
	<script type="text/javascript" src="../../Libraries/XMLforScript/xmlIO.js"></script>
	<script type="text/javascript" src="../../Libraries/XMLforScript/xmlEscape.js"></script>
	<script type="text/javascript" src="../../Libraries/XMLforScript/xmlsax.js"></script>
	<script type="text/javascript" src="../../Libraries/XMLforScript/preMadeSaxEventHandler.js"></script>
    
    <script type="text/javascript" src="../JsUnit/app/jsUnitCore.js"></script>

    <script type="text/javascript" src="../Singleton/Singleton.js"></script>
    <script type="text/javascript" src="../WebUIMessageBus/WebUIMessage.js"></script>
    
    <script type="text/javascript" src="../BrowserWidget/BrowserWidget.js"></script>
	<script type="text/javascript" src="../FundamentalTypes/StringTokenizer.js"></script>
	<script type="text/javascript" src="../ComponentStateManager/DefaultStateUriTransformer.js"></script>
	<script type="text/javascript" src="../ComponentStateManager/ComponentStateManager.js"></script>
    <script type="text/javascript" src="../DesktopConfigurator/ConfigurationTimeoutException.js"></script>
    <script type="text/javascript" src="../DesktopConfigurator/DesktopConfigurator.js"></script>
    <script type="text/javascript" src="../DesktopConfigurator/DesktopStructure.js"></script>
    <script type="text/javascript" src="../DesktopConfigurator/PanelInterpreter.js"></script>
    <script type="text/javascript" src="../DesktopConfigurator/plugins/tree/scripts/tree.js"></script>
    <script type="text/javascript" src="../DocumentManager/DocumentManager.js"></script>
    <script type="text/javascript" src="../FundamentalTypes/ArrayList.js"></script>
    <script type="text/javascript" src="../FundamentalTypes/HashMap.js"></script>
	<script type="text/javascript" src="../FundamentalTypes/JavaCompatibility.js"></script>
	<script type="text/javascript" src="../FundamentalTypes/LinkedHashMap.js"></script>
    <script type="text/javascript" src="../FundamentalTypes/XmlResource.js"></script>
    <script type="text/javascript" src="../FundamentalTypes/WebUIException.js"></script>
	<script type="text/javascript" src="../HierarchicalMenuWidget/HierarchicalMenuWidget.js"></script>
	<script type="text/javascript" src="../HierarchicalMenuWidget/MenuSelectedMessage.js"></script>
	<script type="text/javascript" src="../Internationalization/Locale.js"></script>
	<script type="text/javascript" src="../Internationalization/LocaleUtil.js"></script>
	<script type="text/javascript" src="../Internationalization/ResourceKey.js"></script>
	<script type="text/javascript" src="../Internationalization/ResourceCache.js"></script>
	<script type="text/javascript" src="../Internationalization/XMLBundleParser.js"></script>
	<script type="text/javascript" src="../Internationalization/XMLResourceBundle.js"></script>
    <script type="text/javascript" src="../LanguageSelectorWidget/LanguageChangedMessage.js"></script>
    <script type="text/javascript" src="../LanguageSelectorWidget/LanguageSelectorWidget.js"></script>
    <script type="text/javascript" src="../SkinSelectorWidget/SkinChangedMessage.js"></script>
    <script type="text/javascript" src="../SkinSelectorWidget/SkinSelectorWidget.js"></script>
    <script type="text/javascript" src="../TabWidget/TabSelectedMessage.js"></script>
    <script type="text/javascript" src="../TabWidget/Tab.js"></script>
    <script type="text/javascript" src="../TabWidget/TabWidget.js"></script>
    <script type="text/javascript" src="../WebUIConfiguration/WebUIConfiguration.js"></script>
    <script type="text/javascript" src="../WebUIController/WebUIController.js"></script>
    <script type="text/javascript" src="../WebUIController/WebUIStateRestoredMessage.js"></script>
    <script type="text/javascript" src="../WebUILogger/WebUILogger.js"></script>
    <script type="text/javascript" src="../WebUIMessageBus/TestMessageOne.js"></script>
    <script type="text/javascript" src="../WebUIMessageBus/TestMessageTwo.js"></script>
    <script type="text/javascript" src="../WebUIMessageBus/WebUIMessageBus.js"></script>
	
	<script type="text/javascript">
	window.addEvent('domready', function() {
		runTestFunction();
	});

	var CONFIGURATION_URI = "../WebUIController/SampleConfiguration.xml";
	var SAMPLE_DOCUMENT_ONE = "../WebUIController/Content/SampleContentOne";
	var SAMPLE_DOCUMENT_TWO = "../WebUIController/Content/SampleContentTwo";
	var controller;
	var documentManager;
	var messageBus;
	var stateManager;
	
	JsHamcrest.Integration.JsUnit();
	
	function setUp() {
        messageBus = new WebUIMessageBus();
        stateManager = new ComponentStateManager();
		controller = new WebUIController({ contextRootPrefix : "../../", configurationUri : CONFIGURATION_URI });
		documentManager = new DocumentManager();
	}

	function tearDown() {
		controller.destroy();
		controller = null;
	}

	function testInitialization() {
		assertTrue( "DocumentManager.initialize()...", true );
		assertEquals( "... retrieves a reference to ComponentStateManager.", stateManager, documentManager.getStateManager() ); 
		assertEquals( "... retrieves a reference to WebUIController.", controller, documentManager.getController() ); 
	}
	
	function testLoadDocument() {
		//SETUP:
		controller.configure();
		
		//EXCERCISE:
		documentManager.loadDocument({ documentURI : SAMPLE_DOCUMENT_ONE });
		
		//VERIFY:
		var documentsPanel = $('documents-panel');
		assertTrue( "After WebUIController.loadDocument()...", true );
		assertEquals( "... stores current document URI", SAMPLE_DOCUMENT_ONE, documentManager.currentDocumentProperties['documentURI'] );
//		assertEquals( "... adds page content.", "Minta tartalom - 1", Sarissa.getText( documentsPanel.getElements( "H1" )[0] ));
	}
	
	function testRestore() {
		//SETUP:
		controller.configure();
		documentManager.loadDocument({ documentURI : SAMPLE_DOCUMENT_ONE });
		
		//EXCERCISE:
		stateManager.storeCurrentState( "DocumentManager", { documentURI : SAMPLE_DOCUMENT_TWO } );
		documentManager.restore();
		
		//VERIFY:
		var documentsPanel = $('documents-panel');
		assertTrue( "After WebUIController.loadDocument()...", true );
		assertEquals( "... stores current document URI", SAMPLE_DOCUMENT_TWO, documentManager.currentDocumentProperties['documentURI'] );
	}	
      
	//runs a test function during debugging
	function runTestFunction(){
		setUp();
		testLoadDocument();
		tearDown();
	}
	</script>
</head>

<body>
   <h1>DocumentManager.js test page</h1>
   <div id='desktop'></div>
</body>
</html>
